var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(ah,v){var am,o,aa,b,A,O,r,u,q,Y,n=true,I="undefined",ao=("sizcache"+Math.random()).replace(".",""),g=String,m=ah.document,p=m.documentElement,F=0,t=0,S=[].pop,al=[].push,z=[].slice,C=[].indexOf||function(ay){var ax=0,e=this.length;for(;ax<e;ax++){if(this[ax]===ay){return ax}}return -1},aq=function(e,ax){e[ao]=ax==null||ax;return e},av=function(){var e={},ax=[];return aq(function(ay,az){if(ax.push(ay)>aa.cacheLength){delete e[ax.shift()]}return(e[ay]=az)},e)},aj=av(),ak=av(),B=av(),M="[\\x20\\t\\r\\n\\f]",y="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",w=y.replace("w","w#"),au="([*^$|!~]?=)",ae="\\["+M+"*("+y+")"+M+"*(?:"+au+M+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+w+")|)|)"+M+"*\\]",aw=":("+y+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+ae+")|[^:]|\\\\.)*|.*))\\)|)",N=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)",ai=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),h=new RegExp("^"+M+"*,"+M+"*"),W=new RegExp("^"+M+"*([\\x20\\t\\r\\n\\f>+~])"+M+"*"),ab=new RegExp(aw),ad=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,R=/^:not/,ag=/[\x20\t\r\n\f]*[+~]/,ap=/:not\($/,G=/h\d/i,ac=/input|select|textarea|button/i,H=/\\(?!\\)/g,V={ID:new RegExp("^#("+y+")"),CLASS:new RegExp("^\\.("+y+")"),NAME:new RegExp("^\\[name=['\"]?("+y+")['\"]?\\]"),TAG:new RegExp("^("+y.replace("w","w*")+")"),ATTR:new RegExp("^"+ae),PSEUDO:new RegExp("^"+aw),POS:new RegExp(N,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),needsContext:new RegExp("^"+M+"*[>+~]|"+N,"i")},Z=function(ax){var az=m.createElement("div");try{return ax(az)}catch(ay){return false}finally{az=null}},l=Z(function(e){e.appendChild(m.createComment(""));return !e.getElementsByTagName("*").length}),Q=Z(function(e){e.innerHTML="<a href='#'></a>";return e.firstChild&&typeof e.firstChild.getAttribute!==I&&e.firstChild.getAttribute("href")==="#"}),E=Z(function(ax){ax.innerHTML="<select></select>";var e=typeof ax.lastChild.getAttribute("multiple");return e!=="boolean"&&e!=="string"}),P=Z(function(e){e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!e.getElementsByClassName||!e.getElementsByClassName("e").length){return false}e.lastChild.className="e";return e.getElementsByClassName("e").length===2}),a=Z(function(ax){ax.id=ao+0;ax.innerHTML="<a name='"+ao+"'></a><div name='"+ao+"'></div>";p.insertBefore(ax,p.firstChild);var e=m.getElementsByName&&m.getElementsByName(ao).length===2+m.getElementsByName(ao+0).length;o=!m.getElementById(ao);p.removeChild(ax);return e});try{z.call(p.childNodes,0)[0].nodeType}catch(at){z=function(ax){var ay,e=[];for(;(ay=this[ax]);ax++){e.push(ay)}return e}}function af(az,e,aB,aE){aB=aB||[];e=e||m;var aC,ax,aD,ay,aA=e.nodeType;if(!az||typeof az!=="string"){return aB}if(aA!==1&&aA!==9){return[]}aD=A(e);if(!aD&&!aE){if((aC=ad.exec(az))){if((ay=aC[1])){if(aA===9){ax=e.getElementById(ay);if(ax&&ax.parentNode){if(ax.id===ay){aB.push(ax);return aB}}else{return aB}}else{if(e.ownerDocument&&(ax=e.ownerDocument.getElementById(ay))&&O(e,ax)&&ax.id===ay){aB.push(ax);return aB}}}else{if(aC[2]){al.apply(aB,z.call(e.getElementsByTagName(az),0));return aB}else{if((ay=aC[3])&&P&&e.getElementsByClassName){al.apply(aB,z.call(e.getElementsByClassName(ay),0));return aB}}}}}return an(az.replace(ai,"$1"),e,aB,aE,aD)}af.matches=function(ax,e){return af(ax,null,null,e)};af.matchesSelector=function(e,ax){return af(ax,null,null,[e]).length>0};function X(e){return function(ay){var ax=ay.nodeName.toLowerCase();return ax==="input"&&ay.type===e}}function f(e){return function(ay){var ax=ay.nodeName.toLowerCase();return(ax==="input"||ax==="button")&&ay.type===e}}function T(e){return aq(function(ax){ax=+ax;return aq(function(ay,aC){var aA,az=e([],ay.length,ax),aB=az.length;while(aB--){if(ay[(aA=az[aB])]){ay[aA]=!(aC[aA]=ay[aA])}}})})}b=af.getText=function(aA){var az,ax="",ay=0,e=aA.nodeType;if(e){if(e===1||e===9||e===11){if(typeof aA.textContent==="string"){return aA.textContent}else{for(aA=aA.firstChild;aA;aA=aA.nextSibling){ax+=b(aA)}}}else{if(e===3||e===4){return aA.nodeValue}}}else{for(;(az=aA[ay]);ay++){ax+=b(az)}}return ax};A=af.isXML=function(e){var ax=e&&(e.ownerDocument||e).documentElement;return ax?ax.nodeName!=="HTML":false};O=af.contains=p.contains?function(ax,e){var az=ax.nodeType===9?ax.documentElement:ax,ay=e&&e.parentNode;return ax===ay||!!(ay&&ay.nodeType===1&&az.contains&&az.contains(ay))}:p.compareDocumentPosition?function(ax,e){return e&&!!(ax.compareDocumentPosition(e)&16)}:function(ax,e){while((e=e.parentNode)){if(e===ax){return true}}return false};af.attr=function(ay,ax){var az,e=A(ay);if(!e){ax=ax.toLowerCase()}if((az=aa.attrHandle[ax])){return az(ay)}if(e||E){return ay.getAttribute(ax)}az=ay.getAttributeNode(ax);return az?typeof ay[ax]==="boolean"?ay[ax]?ax:null:az.specified?az.value:null:null};aa=af.selectors={cacheLength:50,createPseudo:aq,match:V,attrHandle:Q?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:o?function(az,ay,ax){if(typeof ay.getElementById!==I&&!ax){var e=ay.getElementById(az);return e&&e.parentNode?[e]:[]}}:function(az,ay,ax){if(typeof ay.getElementById!==I&&!ax){var e=ay.getElementById(az);return e?e.id===az||typeof e.getAttributeNode!==I&&e.getAttributeNode("id").value===az?[e]:v:[]}},TAG:l?function(e,ax){if(typeof ax.getElementsByTagName!==I){return ax.getElementsByTagName(e)}}:function(e,aA){var az=aA.getElementsByTagName(e);if(e==="*"){var aB,ay=[],ax=0;for(;(aB=az[ax]);ax++){if(aB.nodeType===1){ay.push(aB)}}return ay}return az},NAME:a&&function(e,ax){if(typeof ax.getElementsByName!==I){return ax.getElementsByName(name)}},CLASS:P&&function(ay,ax,e){if(typeof ax.getElementsByClassName!==I&&!e){return ax.getElementsByClassName(ay)}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(H,"");e[3]=(e[4]||e[5]||"").replace(H,"");if(e[2]==="~="){e[3]=" "+e[3]+" "}return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if(e[1]==="nth"){if(!e[2]){af.error(e[0])}e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd"));e[4]=+((e[6]+e[7])||e[2]==="odd")}else{if(e[2]){af.error(e[0])}}return e},PSEUDO:function(ax){var ay,e;if(V.CHILD.test(ax[0])){return null}if(ax[3]){ax[2]=ax[3]}else{if((ay=ax[4])){if(ab.test(ay)&&(e=c(ay,true))&&(e=ay.indexOf(")",ay.length-e)-ay.length)){ay=ay.slice(0,e);ax[0]=ax[0].slice(0,e)}ax[2]=ay}}return ax.slice(0,3)}},filter:{ID:o?function(e){e=e.replace(H,"");return function(ax){return ax.getAttribute("id")===e}}:function(e){e=e.replace(H,"");return function(ay){var ax=typeof ay.getAttributeNode!==I&&ay.getAttributeNode("id");return ax&&ax.value===e}},TAG:function(e){if(e==="*"){return function(){return true}}e=e.replace(H,"").toLowerCase();return function(ax){return ax.nodeName&&ax.nodeName.toLowerCase()===e}},CLASS:function(e){var ax=aj[ao][e];if(!ax){ax=aj(e,new RegExp("(^|"+M+")"+e+"("+M+"|$)"))}return function(ay){return ax.test(ay.className||(typeof ay.getAttribute!==I&&ay.getAttribute("class"))||"")}},ATTR:function(ay,ax,e){return function(aB,aA){var az=af.attr(aB,ay);if(az==null){return ax==="!="}if(!ax){return true}az+="";return ax==="="?az===e:ax==="!="?az!==e:ax==="^="?e&&az.indexOf(e)===0:ax==="*="?e&&az.indexOf(e)>-1:ax==="$="?e&&az.substr(az.length-e.length)===e:ax==="~="?(" "+az+" ").indexOf(e)>-1:ax==="|="?az===e||az.substr(0,e.length+1)===e+"-":false}},CHILD:function(e,ay,az,ax){if(e==="nth"){return function(aC){var aB,aD,aA=aC.parentNode;if(az===1&&ax===0){return true}if(aA){aD=0;for(aB=aA.firstChild;aB;aB=aB.nextSibling){if(aB.nodeType===1){aD++;if(aC===aB){break}}}}aD-=ax;return aD===az||(aD%az===0&&aD/az>=0)}}return function(aB){var aA=aB;switch(e){case"only":case"first":while((aA=aA.previousSibling)){if(aA.nodeType===1){return false}}if(e==="first"){return true}aA=aB;case"last":while((aA=aA.nextSibling)){if(aA.nodeType===1){return false}}return true}}},PSEUDO:function(az,ay){var e,ax=aa.pseudos[az]||aa.setFilters[az.toLowerCase()]||af.error("unsupported pseudo: "+az);if(ax[ao]){return ax(ay)}if(ax.length>1){e=[az,az,"",ay];return aa.setFilters.hasOwnProperty(az.toLowerCase())?aq(function(aC,aE){var aB,aA=ax(aC,ay),aD=aA.length;while(aD--){aB=C.call(aC,aA[aD]);aC[aB]=!(aE[aB]=aA[aD])}}):function(aA){return ax(aA,0,e)}}return ax}},pseudos:{not:aq(function(e){var ax=[],ay=[],az=r(e.replace(ai,"$1"));return az[ao]?aq(function(aB,aG,aE,aC){var aF,aA=az(aB,null,aC,[]),aD=aB.length;while(aD--){if((aF=aA[aD])){aB[aD]=!(aG[aD]=aF)}}}):function(aC,aB,aA){ax[0]=aC;az(ax,null,aA,ay);return !ay.pop()}}),has:aq(function(e){return function(ax){return af(e,ax).length>0}}),contains:aq(function(e){return function(ax){return(ax.textContent||ax.innerText||b(ax)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===false},disabled:function(e){return e.disabled===true},checked:function(e){var ax=e.nodeName.toLowerCase();return(ax==="input"&&!!e.checked)||(ax==="option"&&!!e.selected)},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return !aa.pseudos.empty(e)},empty:function(ax){var e;ax=ax.firstChild;while(ax){if(ax.nodeName>"@"||(e=ax.nodeType)===3||e===4){return false}ax=ax.nextSibling}return true},header:function(e){return G.test(e.nodeName)},text:function(ay){var ax,e;return ay.nodeName.toLowerCase()==="input"&&(ax=ay.type)==="text"&&((e=ay.getAttribute("type"))==null||e.toLowerCase()===ax)},radio:X("radio"),checkbox:X("checkbox"),file:X("file"),password:X("password"),image:X("image"),submit:f("submit"),reset:f("reset"),button:function(ax){var e=ax.nodeName.toLowerCase();return e==="input"&&ax.type==="button"||e==="button"},input:function(e){return ac.test(e.nodeName)},focus:function(e){var ax=e.ownerDocument;return e===ax.activeElement&&(!ax.hasFocus||ax.hasFocus())&&!!(e.type||e.href)},active:function(e){return e===e.ownerDocument.activeElement},first:T(function(){return[0]}),last:T(function(e,ax){return[ax-1]}),eq:T(function(e,ay,ax){return[ax<0?ax+ay:ax]}),even:T(function(e,ay){for(var ax=0;ax<ay;ax+=2){e.push(ax)}return e}),odd:T(function(e,ay){for(var ax=1;ax<ay;ax+=2){e.push(ax)}return e}),lt:T(function(e,az,ay){for(var ax=ay<0?ay+az:ay;--ax>=0;){e.push(ax)}return e}),gt:T(function(e,az,ay){for(var ax=ay<0?ay+az:ay;++ax<az;){e.push(ax)}return e})}};function d(ax,e,ay){if(ax===e){return ay}var az=ax.nextSibling;while(az){if(az===e){return -1}az=az.nextSibling}return 1}u=p.compareDocumentPosition?function(ax,e){if(ax===e){q=true;return 0}return(!ax.compareDocumentPosition||!e.compareDocumentPosition?ax.compareDocumentPosition:ax.compareDocumentPosition(e)&4)?-1:1}:function(aE,aD){if(aE===aD){q=true;return 0}else{if(aE.sourceIndex&&aD.sourceIndex){return aE.sourceIndex-aD.sourceIndex}}var aB,ax,ay=[],e=[],aA=aE.parentNode,aC=aD.parentNode,aF=aA;if(aA===aC){return d(aE,aD)}else{if(!aA){return -1}else{if(!aC){return 1}}}while(aF){ay.unshift(aF);aF=aF.parentNode}aF=aC;while(aF){e.unshift(aF);aF=aF.parentNode}aB=ay.length;ax=e.length;for(var az=0;az<aB&&az<ax;az++){if(ay[az]!==e[az]){return d(ay[az],e[az])}}return az===aB?d(aE,e[az],-1):d(ay[az],aD,1)};[0,0].sort(u);n=!q;af.uniqueSort=function(ax){var ay,e=1;q=n;ax.sort(u);if(q){for(;(ay=ax[e]);e++){if(ay===ax[e-1]){ax.splice(e--,1)}}}return ax};af.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};function c(aA,aF){var ax,aB,aD,aE,aC,ay,e,az=ak[ao][aA];if(az){return aF?0:az.slice(0)}aC=aA;ay=[];e=aa.preFilter;while(aC){if(!ax||(aB=h.exec(aC))){if(aB){aC=aC.slice(aB[0].length)}ay.push(aD=[])}ax=false;if((aB=W.exec(aC))){aD.push(ax=new g(aB.shift()));aC=aC.slice(ax.length);ax.type=aB[0].replace(ai," ")}for(aE in aa.filter){if((aB=V[aE].exec(aC))&&(!e[aE]||(aB=e[aE](aB)))){aD.push(ax=new g(aB.shift()));aC=aC.slice(ax.length);ax.type=aE;ax.matches=aB}}if(!ax){break}}return aF?aC.length:aC?af.error(aA):ak(aA,ay).slice(0)}function K(aA,ay,az){var e=ay.dir,aB=az&&ay.dir==="parentNode",ax=t++;return ay.first?function(aE,aD,aC){while((aE=aE[e])){if(aB||aE.nodeType===1){return aA(aE,aD,aC)}}}:function(aF,aE,aD){if(!aD){var aC,aG=F+" "+ax+" ",aH=aG+am;while((aF=aF[e])){if(aB||aF.nodeType===1){if((aC=aF[ao])===aH){return aF.sizset}else{if(typeof aC==="string"&&aC.indexOf(aG)===0){if(aF.sizset){return aF}}else{aF[ao]=aH;if(aA(aF,aE,aD)){aF.sizset=true;return aF}aF.sizset=false}}}}}else{while((aF=aF[e])){if(aB||aF.nodeType===1){if(aA(aF,aE,aD)){return aF}}}}}}function s(e){return e.length>1?function(aA,az,ax){var ay=e.length;while(ay--){if(!e[ay](aA,az,ax)){return false}}return true}:e[0]}function J(e,ax,ay,az,aC){var aA,aF=[],aB=0,aD=e.length,aE=ax!=null;for(;aB<aD;aB++){if((aA=e[aB])){if(!ay||ay(aA,az,aC)){aF.push(aA);if(aE){ax.push(aB)}}}}return aF}function ar(ay,ax,aA,az,aB,e){if(az&&!az[ao]){az=ar(az)}if(aB&&!aB[ao]){aB=ar(aB,e)}return aq(function(aN,aK,aE,aM){if(aN&&aB){return}var aL,aG,aH,aF=[],aO=[],aD=aK.length,aC=aN||D(ax||"*",aE.nodeType?[aE]:aE,[],aN),aI=ay&&(aN||!ax)?J(aC,aF,ay,aE,aM):aC,aJ=aA?aB||(aN?ay:aD||az)?[]:aK:aI;if(aA){aA(aI,aJ,aE,aM)}if(az){aH=J(aJ,aO);az(aH,[],aE,aM);aL=aH.length;while(aL--){if((aG=aH[aL])){aJ[aO[aL]]=!(aI[aO[aL]]=aG)}}}if(aN){aL=ay&&aJ.length;while(aL--){if((aG=aJ[aL])){aN[aF[aL]]=!(aK[aF[aL]]=aG)}}}else{aJ=J(aJ===aK?aJ.splice(aD,aJ.length):aJ);if(aB){aB(null,aK,aJ,aM)}else{al.apply(aK,aJ)}}})}function L(aC){var ax,aA,ay,aB=aC.length,aF=aa.relative[aC[0].type],aG=aF||aa.relative[" "],az=aF?1:0,aD=K(function(aH){return aH===ax},aG,true),aE=K(function(aH){return C.call(ax,aH)>-1},aG,true),e=[function(aJ,aI,aH){return(!aF&&(aH||aI!==Y))||((ax=aI).nodeType?aD(aJ,aI,aH):aE(aJ,aI,aH))}];for(;az<aB;az++){if((aA=aa.relative[aC[az].type])){e=[K(s(e),aA)]}else{aA=aa.filter[aC[az].type].apply(null,aC[az].matches);if(aA[ao]){ay=++az;for(;ay<aB;ay++){if(aa.relative[aC[ay].type]){break}}return ar(az>1&&s(e),az>1&&aC.slice(0,az-1).join("").replace(ai,"$1"),aA,az<ay&&L(aC.slice(az,ay)),ay<aB&&L((aC=aC.slice(ay))),ay<aB&&aC.join(""))}e.push(aA)}}return s(e)}function i(az,ay){var e=ay.length>0,aA=az.length>0,ax=function(aK,aE,aJ,aI,aQ){var aF,aG,aL,aP=[],aO=0,aH="0",aB=aK&&[],aM=aQ!=null,aN=Y,aD=aK||aA&&aa.find.TAG("*",aQ&&aE.parentNode||aE),aC=(F+=aN==null?1:Math.E);if(aM){Y=aE!==m&&aE;am=ax.el}for(;(aF=aD[aH])!=null;aH++){if(aA&&aF){for(aG=0;(aL=az[aG]);aG++){if(aL(aF,aE,aJ)){aI.push(aF);break}}if(aM){F=aC;am=++ax.el}}if(e){if((aF=!aL&&aF)){aO--}if(aK){aB.push(aF)}}}aO+=aH;if(e&&aH!==aO){for(aG=0;(aL=ay[aG]);aG++){aL(aB,aP,aE,aJ)}if(aK){if(aO>0){while(aH--){if(!(aB[aH]||aP[aH])){aP[aH]=S.call(aI)}}}aP=J(aP)}al.apply(aI,aP);if(aM&&!aK&&aP.length>0&&(aO+ay.length)>1){af.uniqueSort(aI)}}if(aM){F=aC;Y=aN}return aB};ax.el=0;return e?aq(ax):ax}r=af.compile=function(e,aB){var ay,ax=[],aA=[],az=B[ao][e];if(!az){if(!aB){aB=c(e)}ay=aB.length;while(ay--){az=L(aB[ay]);if(az[ao]){ax.push(az)}else{aA.push(az)}}az=B(e,i(aA,ax))}return az};function D(ax,aB,aA,ay){var az=0,e=aB.length;for(;az<e;az++){af(ax,aB[az],aA,ay)}return aA}function an(ay,e,aA,aE,aD){var aB,aH,ax,aG,aF,aC=c(ay),az=aC.length;if(!aE){if(aC.length===1){aH=aC[0]=aC[0].slice(0);if(aH.length>2&&(ax=aH[0]).type==="ID"&&e.nodeType===9&&!aD&&aa.relative[aH[1].type]){e=aa.find.ID(ax.matches[0].replace(H,""),e,aD)[0];if(!e){return aA}ay=ay.slice(aH.shift().length)}for(aB=V.POS.test(ay)?-1:aH.length-1;aB>=0;aB--){ax=aH[aB];if(aa.relative[(aG=ax.type)]){break}if((aF=aa.find[aG])){if((aE=aF(ax.matches[0].replace(H,""),ag.test(aH[0].type)&&e.parentNode||e,aD))){aH.splice(aB,1);ay=aE.length&&aH.join("");if(!ay){al.apply(aA,z.call(aE,0));return aA}break}}}}}r(ay,aC)(aE,e,aD,aA,ag.test(ay));return aA}if(m.querySelectorAll){(function(){var aB,aC=an,aA=/'|\\/g,ay=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,ax=[":focus"],e=[":active",":focus"],az=p.matchesSelector||p.mozMatchesSelector||p.webkitMatchesSelector||p.oMatchesSelector||p.msMatchesSelector;Z(function(aD){aD.innerHTML="<select><option selected=''></option></select>";if(!aD.querySelectorAll("[selected]").length){ax.push("\\["+M+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!aD.querySelectorAll(":checked").length){ax.push(":checked")}});Z(function(aD){aD.innerHTML="<p test=''></p>";if(aD.querySelectorAll("[test^='']").length){ax.push("[*^$]="+M+"*(?:\"\"|'')")}aD.innerHTML="<input type='hidden'/>";if(!aD.querySelectorAll(":enabled").length){ax.push(":enabled",":disabled")}});ax=new RegExp(ax.join("|"));an=function(aJ,aE,aL,aO,aN){if(!aO&&!aN&&(!ax||!ax.test(aJ))){var aH,aM,aG=true,aD=ao,aF=aE,aK=aE.nodeType===9&&aJ;if(aE.nodeType===1&&aE.nodeName.toLowerCase()!=="object"){aH=c(aJ);if((aG=aE.getAttribute("id"))){aD=aG.replace(aA,"\\$&")}else{aE.setAttribute("id",aD)}aD="[id='"+aD+"'] ";aM=aH.length;while(aM--){aH[aM]=aD+aH[aM].join("")}aF=ag.test(aJ)&&aE.parentNode||aE;aK=aH.join(",")}if(aK){try{al.apply(aL,z.call(aF.querySelectorAll(aK),0));return aL}catch(aI){}finally{if(!aG){aE.removeAttribute("id")}}}}return aC(aJ,aE,aL,aO,aN)};if(az){Z(function(aE){aB=az.call(aE,"div");try{az.call(aE,"[test!='']:sizzle");e.push("!=",aw)}catch(aD){}});e=new RegExp(e.join("|"));af.matchesSelector=function(aE,aG){aG=aG.replace(ay,"='$1']");if(!A(aE)&&!e.test(aG)&&(!ax||!ax.test(aG))){try{var aD=az.call(aE,aG);if(aD||aB||aE.document&&aE.document.nodeType!==11){return aD}}catch(aF){}}return af(aG,null,null,[aE]).length>0}}})()}aa.pseudos.nth=aa.pseudos.eq;function x(){}aa.filters=x.prototype=aa.pseudos;aa.setFilters=new x();if(typeof define==="function"&&define.amd){define(function(){return af})}else{ah.Sizzle=af}})(window);"use strict";var $jsRoot=this;function emptyFunction(){}function $A(c){if(!c){return[]}if(c.toArray){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}var Class={createCore:function(){var e=null,d=$A(arguments);if(Object.isFunction(d[0])){e=d.shift()}function a(){this.initialize.apply(this,arguments)}Object.extend(a,Class.Methods);a.superclass=e;a.subclasses=[];if(e){var b=function(){};b.prototype=e.prototype;a.prototype=new b;e.subclasses.push(a)}for(var c=0;c<d.length;c++){a.addMethods(d[c])}if(!a.prototype.initialize){a.prototype.initialize=emptyFunction}a.prototype.constructor=a;return a},create:function(){var a=Class.createCore.apply(this,arguments);return a},free:function(a){if(a.finalize){a.finalize()}a=null}};Class.Methods={addMethods:function(b){if(!b){return this}var f=this.superclass&&this.superclass.prototype;var h=Object.keys(b);if(!Object.keys({toString:true}).length){h.push("toString","valueOf")}var g=function(){};for(var e=0,d=h.length;e<d;e++){var m=h[e];var l=b[m];var c=Object.isFunction(l);if(f&&c&&l.argumentNames().first()=="$super"){var a=l;l=(function(i){return function(){return(f[i]||g).apply(this,arguments)}})(m).wrap(a);l.valueOf=a.valueOf.bind(a);l.toString=a.toString.bind(a)}this.prototype[m]=l}return this}};Object.extend=function(a,e,f,d){for(var c in e){var b=e[c];if(f&&((b===undefined)||(b===null))){continue}if(d&&(b==="")){continue}a[c]=b}return a};Object.getCascadeFieldValue=function(f,c){var a;var e=f.split(".");if(!c){var c=this}for(var d=0,b=e.length;d<b;++d){a=c[e[d]];if(!a){break}else{c=a}}return a};Object._inherit=function(b){if(b===null){b={}}var a=typeof(b);if(!(DataType.isFunctionType(a)||DataType.isObjectType(a))){throw TypeError()}function c(){}c.prototype=b;return new c()};if(!Object.create){Object.create=Object._inherit}Object.copyValues=function(b,e,g){if(!g){return Object.extend(b,source)}else{for(var c=0,a=g.length;c<a;++c){var f=g[c];var d=e[f];if(d!==undefined){b[f]=d}}return b}};Object.extend(Object,{keys:function(a){var b=[];for(var c in a){b.push(c)}return b},isFunction:function(a){return typeof a=="function"},isUndefined:function(a){return typeof a=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a},wrap:function(b){var a=this;return function(){return b.apply(this,[a.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var a=this;return this._methodized=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this);return a.apply(null,b)}}});if(!Function.prototype.bind){Object.extend(Function.prototype,{bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var a=this,c=$A(arguments),b=c.shift();return function(){return a.apply(b,c.concat($A(arguments)))}}})}Object.extend(Array.prototype,{first:function(){return this[0]},last:function(){return this[this.length-1]},clear:function(){this.length=0;return this},without:function(){var a=$A(arguments);return this.select(function(b){return !a.include(b)})},removeAt:function(a){this.splice(a,1)},remove:function(b){var a=this.indexOf(b);if(a>=0){return this.removeAt(a)}}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,a){a||(a=0);var b=this.length;if(a<0){a=b+a}for(;a<b;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b,a){a=isNaN(a)?this.length:(a<0?this.length+a:a)+1;var c=this.slice(0,a).reverse().indexOf(b);return(c<0)?c:a-c-1}}Object.extend(String.prototype,{truncate:function(b,a){b=b||30;a=Object.isUndefined(a)?"...":a;return this.length>b?this.slice(0,b-a.length)+a:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var b=new RegExp(Prototype.ScriptFragment,"img");var a=new RegExp(Prototype.ScriptFragment,"im");return(this.match(b)||[]).map(function(c){return(c.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var a=arguments.callee;a.text.data=this;return a.div.innerHTML},unescapeHTML:function(){var a=new Element("div");a.innerHTML=this.stripTags();return a.childNodes[0]?(a.childNodes.length>1?$A(a.childNodes).inject("",function(b,c){return b+c.nodeValue}):a.childNodes[0].nodeValue):""},toQueryParams:function(b){var a=this.strip().match(/([^?#]*)(#.*)?$/);if(!a){return{}}return a[1].split(b||"&").inject({},function(e,f){if((f=f.split("="))[0]){var c=decodeURIComponent(f.shift());var d=f.length>1?f.join("="):f[0];if(d!=undefined){d=decodeURIComponent(d)}if(c in e){if(!Object.isArray(e[c])){e[c]=[e[c]]}e[c].push(d)}else{e[c]=d}}return e})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return a<1?"":new Array(a+1).join(this)},camelize:function(){var d=this.split("-"),a=d.length;if(a==1){return d[0]}var c=this.charAt(0)=="-"?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0];for(var b=1;b<a;b++){c+=d[b].charAt(0).toUpperCase()+d[b].substring(1)}return c},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(b){var a=this.gsub(/[\x00-\x1f\\]/,function(c){var d=String.specialChar[c[0]];return d?d:"\\u00"+c[0].charCodeAt().toPaddedString(2,16)});if(b){return'"'+a.replace(/"/g,'\\"')+'"'}return"'"+a.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(a){return this.sub(a||Prototype.JSONFilter,"#{1}")},isJSON:function(){var a=this;if(a.blank()){return false}a=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(a)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(a){return this.indexOf(a)>-1},startsWith:function(a){return this.indexOf(a)===0},endsWith:function(a){var b=this.length-a.length;return b>=0&&this.lastIndexOf(a)===b},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,b){return new Template(this,b).evaluate(a)}});Object.extend(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){var c=this;for(var a=0;a<arguments.length;a++){var b=new RegExp("\\{"+a+"\\}","gi");c=c.replace(b,arguments[a])}return c},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},pad:function(g,f,e){var h=f||" ";var c=[];for(var d=0,b=g-this.length;d<b;++d){c.push(h)}var m=this;if(e){return m+c.join("")}else{return c.join("")+m}},lpad:function(b,a){return this.pad(b,a,false)},rpad:function(b,a){return this.pad(b,a,true)},reverse:function(){var d=this.length;var b=[];for(var c=d-1;c>=0;--c){b.push(this.charAt(c))}return b.join("")},toCharArray:function(){var c=[];for(var d=0,b=this.length;d<b;++d){c.push(this.charAt(d))}return c},hyphenize:function(f){if(!f){f="-"}var b=this.length;var d=[];for(var e=0;e<b;++e){var g=this.charAt(e);if((e!==0)&&(g>="A")&&(g<="Z")){d.push(f+g.toLowerCase())}else{d.push(g)}}return d.join("")}});if(!String.prototype.trim){Object.extend(String.prototype,{trim:function(){return this.replace(/^\s*|\s*$/g,"")}})}if(!String.prototype.trimLeft){String.prototype.trimLeft=String.prototype.ltrim}if(!String.prototype.trimRight){String.prototype.trimLeft=String.prototype.rtrim}var StringUtils={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var b=0,a=e.length;b<a;++b){var f=e.charAt(b);var d=(f>="0")&&(f<="9");if((!d)&&(f!=".")){return false}}return true},serializeValue:function(b,e){var d=e||[];var c=DataType.getType(b);if(d.indexOf(c)>=0){return b.toString()}if(b===null){return StringUtils.SNULL}else{if(typeof(b)=="undefined"){return StringUtils.SUNDEFINED}else{if(b!=b){return StringUtils.SNAN}else{switch(c){case"boolean":return b?StringUtils.STRUE:StringUtils.SFALSE;break;case"number":var a=(b>=0)?StringUtils.SPOSITIVE:"";return a+b;break;case DataType.DATE:return StringUtils.SDATEPREFIX+b.toString();default:return b.toString()}}}}},deserializeValue:function(d,a){if(typeof(d)!=="string"){return d}switch(d){case StringUtils.STRUE:return true;break;case StringUtils.SFALSE:return false;break;case StringUtils.SNULL:return null;break;case StringUtils.SUNDEFINED:return undefined;break;case StringUtils.SNAN:return NaN;break;default:if(a){switch(a){case DataType.FLOAT:return parseFloat(d);break;case DataType.INT:return parseInt(d);break;case"number":return parseFloat(d);break;case"boolean":return !!d;break;default:return d}}else{var c=d.charAt(0);switch(c){case StringUtils.SPOSITIVE:case StringUtils.SNEGATIVE:var b=d.substring(1);if(StringUtils.isAllDigitalChar(b)){return parseFloat(d)}else{return d}break;case StringUtils.SDATEPREFIX:var b=d.substr(1);return new Date(b);default:return d}}}}};Object.extend(Date.prototype,{copyFrom:function(a){this.setFullYear(a.getFullYear(),a.getMonth(),a.getDate());this.setTime(a.getTime())}});Math.sqr=function(a){return a*a};Math.sign=function(a){return(a>=0)?1:-1};if(!this.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}Class.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1};Class.PropList=function(){this.props=[]};Class.PropList.prototype={addProperty:function(c,b){if(!b){b={}}var a;a=this.getPropInfo(c);if(!a){a={};this.props.push(a)}a=Object.extend(a,b);if(a.serializable===undefined){a.serializable=true}a.name=c;return a},removeProperty:function(b){var a=this.indexOf(b);if(a>=0){this.props.splice(a,1)}},removePropAt:function(a){if(a>=0){var b=this.props[a];if(b){this.props.splice(a,1)}}},getLength:function(){return this.props.length},indexOf:function(c){for(var b=0,a=this.props.length;b<a;++b){if(this.props[b].name===c){return b}}return -1},getPropInfoAt:function(a){if(a>=0){return this.props[a]}else{return null}},getPropInfo:function(c){var a;var b=this.indexOf(c);var a=this.getPropInfoAt(b);return a},hasProperty:function(a){return(this.indexOf(a)>=0)},clear:function(){this.props.clear()},clone:function(){var a=new Class.PropList();a.props=this.props.slice();return a},appendList:function(a){for(var c=0,b=a.props.length;c<b;++c){this.props.push(a.props[c])}}};Class.PropList.prototype.constructor=Class.PropList;Class.EventHandlerList=function(){this.handlers=[]};Class.EventHandlerList.prototype={add:function(b,a){if(!a){a=null}this.handlers.push({thisArg:a,handler:b})},remove:function(d,a){var b=this.indexesOf(d,a);if(b.length>0){for(var c=b.length-1;c>=0;--c){this.removeAt(b[c])}}},removeAt:function(b){for(var c=b,a=this.handlers.length;c<a;++c){this.handlers[c]=this.handlers[c+1]}this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(a){return this.handlers[a]},indexOf:function(d,b){for(var c=0,a=this.handlers.length;c<a;++c){if(this.handlers[c].handler==d){if((b!==undefined)&&(this.handlers[c].thisArg===b)){return c}else{if(b===undefined){return c}}}}return -1},indexesOf:function(e,c){var a=[];for(var d=0,b=this.handlers.length;d<b;++d){if(this.handlers[d].handler==e){if((c!==undefined)&&(this.handlers[d].thisArg===c)){a.push(d)}else{if(c===undefined){a.push(d)}}}}return a},getLength:function(){return this.handlers.length}};Class.EventHandlerList.constructor=Class.EventHandlerList;var DataType={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(a){return(a==DataType.STRING)||(a==DataType.NUMBER)||(a==DataType.INT)||(a==DataType.FLOAT)||(a==DataType.BOOL)||(a==DataType.UNDEFINED)||(a==DataType.PRIMARY)},isComplexType:function(a){return !(DataType.isSimpleType(a)||DataType.isFunctionType(a))},isFunctionType:function(a){return a==DataType.FUNCTION},isObjectType:function(a){return a==DataType.OBJECT},isDateType:function(a){return a==DataType.DATE},isObjectExType:function(b){var a=DataType.isComplexType(b)&&(!DataType.isObjectType(b))&&(!DataType.isDateType(b));if(a){var c=ClassEx.findClass(b);a=c&&ClassEx.isOrIsDescendantOf(c,ObjectEx)}return a},getType:function(b){var a=typeof(b);switch(a){case"undefined":return DataType.UNDEFINED;case"function":return DataType.FUNCTION;case"boolean":return DataType.BOOL;case"string":return DataType.STRING;case"number":if(Math.floor(b)==b){return DataType.INT}else{return DataType.FLOAT}case"object":if(this.isDateValue(b)){return DataType.DATE}else{if(DataType.isArrayValue(b)){return DataType.ARRAY}else{if(ClassEx.isClass(b)){return DataType.CLASS}else{if(DataType.isObjectExValue(b)&&b.getClassName){return b.getClassName()}else{return DataType.OBJECT}}}}default:return a}},isSimpleValue:function(a){return DataType.isSimpleType(typeof(a))},isUndefinedValue:function(a){return typeof(a)=="undefined"},isNullValue:function(a){return(a===null)},isFunctionValue:function(a){return typeof(a)=="function"},isObjectValue:function(a){if(a){return(typeof(a)=="object")&&(!DataType.isArrayValue(a))&&(!DataType.isDateValue(a))}else{return false}},isDateValue:function(a){if(a){return((typeof(a)=="object")&&(a.getFullYear!==undefined))}return false},isArrayValue:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},isObjectExValue:function(a){return(a instanceof ObjectEx)},createInstance:function(a){switch(a){case DataType.UNDEFINED:return undefined;case DataType.DATE:return new Date();case DataType.ARRAY:return new Array();case DataType.OBJECT:return new Object();case DataType.FUNCTION:return new Function();default:var b=ClassEx.findClass(a.capitalizeFirst());return new b()}}};var ClassEx={isClass:function(a){if(!a){return false}return(a.superclass&&a.subclasses)},findClass:function(b,a){return Object.getCascadeFieldValue(b,a||$jsRoot)},getClassName:function(a){return a.prototype.CLASS_NAME},getPrototype:function(a){return a.prototype},getSuperClass:function(a){return a.superclass||a.constructor.superclass},getSuperClassPrototype:function(a){if(a.superclass){return a.superclass.prototype}else{return null}},_getCommonSuperClass2:function(c,b){var a=c;while(a&&(!ClassEx.isOrIsDescendantOf(b,a))){a=ClassEx.getSuperClass(a)}return a},getCommonSuperClass:function(e){if(!e||!e.length){return null}var a=e[0].getClass?e[0].getClass():null;if(!a){return null}for(var c=1,b=e.length;c<b;++c){var d=e[c].getClass?e[c].getClass():null;if(!d){return null}a=ClassEx._getCommonSuperClass2(a,d)}return a},isDescendantOf:function(c,b){var a=ClassEx.getSuperClass(c);while(a&&(a!==b)){a=ClassEx.getSuperClass(a)}return !!a},isOrIsDescendantOf:function(b,a){return(b===a)||ClassEx.isDescendantOf(b,a)},isOrIsDescendantOfClasses:function(c,d){for(var b=0,a=d.length;b<a;++b){if(ClassEx.isOrIsDescendantOf(c,d[b])){return true}}return false},_ensurePropertySystem:function(c){var b=ClassEx.getPrototype(c);if(!b){return}if(!b.hasOwnProperty("properties")){var a=ClassEx.getSuperClass(c);if(a){ClassEx._ensurePropertySystem(a)}ClassEx._createPropertyList(c);if(b.hasOwnProperty("initProperties")){b.initProperties.apply(b)}}},_createPropertyList:function(a){if(!ClassEx.getPrototype(a).hasOwnProperty("properties")){ClassEx.getPrototype(a).properties=new Class.PropList()}},getOwnPropList:function(b){var a=ClassEx.getPrototype(b);if(a){a._initPropertySystem();return a.properties}else{return null}},getAllPropList:function(c){var a;var b=ClassEx.getSuperClassPrototype(c);if(b){a=b.getAllPropList().clone();a.appendList(ClassEx.getOwnPropList(c))}else{a=ClassEx.getOwnPropList(c)}return a},getPropListOfScopes:function(e,d){var b=function(l,h){var n=ClassEx.getOwnPropList(l).clone();if(n){for(var g=n.getLength()-1;g>=0;--g){var f=n.getPropInfoAt(g);var m=f.scope||Class.PropertyScope.DEFAULT;if(h.indexOf(m)<0){n.removePropAt(g)}}}return n};var a;var c=ClassEx.getSuperClass(e);if(c){a=ClassEx.getPropListOfScopes(c,d).clone();a.appendList(b(e,d))}else{a=b(e,d)}return a},defineProp:function(b,c,a){ClassEx._ensurePropertySystem(b);return ClassEx.getPrototype(b).defineProp(c,a)},defineProps:function(g,a){ClassEx._ensurePropertySystem(g);var f=ClassEx.getPrototype(g);for(var d=0,b=a.length;d<b;++d){var e=a[d];var h=e.name;var c=e;f.defineProp(h,c)}},getPropInfo:function(a,b){return ClassEx.getPrototype(a).getPropInfo(b)},defineEvent:function(b,a){return ClassEx.getPrototype(b).defineEvent(a)},getUnusedMethodName:function(e,d,c){var g=c||0;var b=g;var f=ClassEx.getPrototype(e);var a=d+Number(b).toString();while(f[a]){++b;a=d+Number(b).toString()}return a},extendMethod:function(d,b,g){var c=ClassEx.getPrototype(d);var f=c[b];var a=ClassEx.getUnusedMethodName(d,"__$changed$_"+b+"__");c[a]=f;var e=(function(h){return function(){return c[h].apply(this,arguments)}})(a).wrap(g);c[b]=e;e.valueOf=g.valueOf.bind(g);e.toString=g.toString.bind(g)},extend:function(q,o){var f=ClassEx.getPrototype(q);var g=ClassEx.getSuperClassPrototype(q);var m=Object.keys(o);if(!Object.keys({toString:true}).length){m.push("toString","valueOf")}for(var d=0,c=m.length;d<c;d++){var p=m[d],n=o[p];if(typeof(n)=="function"){var l=n.argumentNames();var e=l.first();if(e=="$origin"){var a=n;var b=f[p];var h=ClassEx.getUnusedMethodName(q,"__$changed$_"+p+"__");f[h]=b;n=(function(i){return function(){return f[i].apply(this,arguments)}})(h).wrap(a);n.valueOf=a.valueOf.bind(a);n.toString=a.toString.bind(a);l.shift();e=l.first()}if(e=="$super"){var a=n;n=(function(i){return function(){return g[i].apply(this,arguments)}})(p).wrap(a);n.valueOf=a.valueOf.bind(a);n.toString=a.toString.bind(a)}}f[p]=n}return q}};var ObjectEx=Class.create({CLASS_NAME:"ObjectEx",initialize:function(){this._initPropertySystem();this.initPropValues();this._updateStatus=0;this._modifiedProps=[];this._finalized=false;this.afterInitialization()},afterInitialization:function(){},finalize:function(){if(!this._finalized){this.doFinalize();this.invokeEvent("finalize",{obj:this});this._finalized=true}},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePropValueSetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bubbleEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("eventHandlers",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE,getter:function(){var a=this.getPropStoreFieldValue("eventHandlers");if(!a){a={};this.setPropStoreFieldValue("eventHandlers",a)}return a}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){if(!this.getPrototype().hasOwnProperty("properties")){var a=this.getSuperClassPrototype();if(a){a._initPropertySystem.apply(a)}this._createPropertyList();if(this.getPrototype().hasOwnProperty("initProperties")){this.getPrototype().initProperties.apply(this.getPrototype())}}},_createPropertyList:function(){if(!this.getPrototype().hasOwnProperty("properties")){this.getPrototype().properties=new Class.PropList()}},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getSerializationName:function(){return this.getClassName()},getPrototype:function(){if(this.prototype){return this.prototype}else{return this.constructor.prototype}},getSuperClassPrototype:function(){if(this.constructor&&this.constructor.superclass){return this.constructor.superclass.prototype}else{return null}},getOwnPropList:function(){this._initPropertySystem();return this.getPrototype().properties},getAllPropList:function(){var a;var b=this.getSuperClassPrototype();if(b){a=b.getAllPropList().clone();a.appendList(this.getOwnPropList())}else{a=this.getOwnPropList().clone()}return a},getPropListOfScopes:function(a){return ClassEx.getPropListOfScopes(this.getClass(),a)},getPropInfoHashKey:function(a){return ObjectEx._PROPINFO_HASHKEY_PREFIX+a},getDefPropStoreFieldName:function(a){return ObjectEx._PROP_STOREFIELD_PREFIX+a},defineProp:function(c,a){if(!a){a={}}if(a.serializable===undefined){a.serializable=true}if(!a.storeField){a.storeField=this.getDefPropStoreFieldName(c)}var b=this.getOwnPropList();var d=b.addProperty(c,a);if(a.getter!==null){d.getter=this.createPropGetter(d,a.getter)}if(a.setter!==null){d.setter=this.createPropSetter(d,a.setter)}this[this.getPropInfoHashKey(c)]=d;return d},createPropGetter:function(f,a){var d=f.name.toString().upperFirst();var c="get"+d;var b="doGet"+d;var e=this[b];if(!e){e=a||new Function('return this["'+f.storeField+'"];');this.getPrototype()[b]=e}this.getPrototype()[c]=function(){var g=Array.prototype.slice.call(arguments);return this[b].apply(this,g)};return b},createPropSetter:function(g,f){var d=g.name.toString();var c=d.upperFirst();var b="set"+c;var a="doSet"+c;var e=this[a];if(!this[a]){e=f||new Function("value",'this["'+g.storeField+'"] = value;');this.getPrototype()[a]=e}this.getPrototype()[b]=function(){var h=Array.prototype.slice.call(arguments);var i=h[0];this[a].apply(this,h);this.notifyPropSet(d,i);return this};return a},hasProperty:function(a){return(this.getPropInfo(a)!=null)},getPropInfo:function(e){var b=e||"";var d=this.getPropInfoHashKey(b)||"";var a=this[d];if(!a){a=this.getOwnPropList().getPropInfo(b);if(!a){var c=this.getSuperClassPrototype();if(c&&c.getPropInfo){a=c.getPropInfo(b)}else{a=null}}}return a},getPropertyDataType:function(a){var b=this.getPropInfo(a);return b?b.dataType:null},isPropertySerializable:function(b){var c=this.getPropInfo(b);var a=c.serializable;return(a===undefined)||(!!a)},getPropStoreFieldValue:function(a){var b=this.getPropInfo(a);if(b.storeField){return this[b.storeField]}else{return undefined}},getPropValue:function(c){var a;var d=this.getPropInfo(c);if(d){if(d.getter){var b=Array.prototype.slice.call(arguments);b.shift();a=this[d.getter].apply(this,b)}else{a=this[d.storeField]}return a}else{return null}},setPropStoreFieldValue:function(c,b){var a;var d=this.getPropInfo(c);if(d.storeField){this[d.storeField]=b}},setPropValue:function(c,b,a){var d=this.getPropInfo(c);if(d){if(d.setter){this[d.setter].apply(this,[b])}else{if(a){this[d.storeField]=b}}this.notifyPropSet(c,b)}return this},setPropValueX:function(){var a=Array.prototype.slice.call(arguments);var b=a.shift();var c=this.getPropInfo(b);if(c){if(c.setter){this[c.setter].apply(this,a)}this.notifyPropSet(b,this.getPropValue(b))}return this},setPropValues:function(c,a){for(var b in c){if(c.hasOwnProperty(b)){if(this.hasProperty(b)){var d=c[b];this.setPropValue(b,d,a)}}}return this},_isPropGetOrSetEvent:function(a){return(a=="propValueGet")||(a=="propValueSet")},notifyPropSet:function(a,b,c){if(this.isUpdating()){if(this._modifiedProps.indexOf(a)<0){this._modifiedProps.push(a)}return}if(this._isPropGetOrSetEvent(a)||this.isEventPropName(a)){return}this.doPropChanged(a,b);if(this.getPropStoreFieldValue("enablePropValueSetEvent")){this.invokeEvent("propValueSet",{propName:a,propValue:b})}if(!c){this.objectChange([a])}},objectChange:function(a){this.doObjectChange(a);this.invokeEvent("change",{changedPropNames:a})},doObjectChange:function(a){},doPropChanged:function(a,b){},defineEvent:function(b){return;var c=this.eventNameToPropName(b);var a=this.defineProp(c,{serializable:false,setter:null});return a},eventNameToPropName:function(a){return"__event_"+a},isEventPropName:function(a){return((typeof(a)=="string")&&(a.indexOf("__event_")>=0))},isEventHandlerList:function(a){return(a&&(typeof(a)=="object")&&(a instanceof Class.EventHandlerList))},getEventHandlerList:function(b){var c=this.getEventHandlers();var a=c[b];if(!a){a=new Class.EventHandlerList();c[b]=a}return a},addEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.add(d,a)}else{return null}},addOnceEventListener:function(c,d,a){var b=this;var e=function(f){b.removeEventListener(c,e,a);d(f)};return this.addEventListener(c,e,a)},removeEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.remove(d,a)}},invokeEvent:function(a,b){if(!b){b={}}b.name=a;b.target=this;b.stopPropagation=this._eventStopPropagation;this.dispatchEvent(a,b)},relayEvent:function(a,b){b.currentTarget=this;this.dispatchEvent(a,b)},dispatchEvent:function(b,e){var f=this.getEventHandlerList(b);if(this.isEventHandlerList(f)){for(var c=0,a=f.getLength();c<a;++c){var g=f.getHandlerInfo(c);if(g.handler){g.handler.apply(g.thisArg,[e])}}}var d=this.getHigherLevelObj();if(!e.cancelBubble&&this.getBubbleEvent()&&d){if(d.relayEvent){d.relayEvent(b,e)}}},stopEventPropagation:function(a){a.cancelBubble=true},assign:function(a){return a.assignTo(this)},assignTo:function(a){var b={};this.saveObj(b,"json");a.loadObj(b,"json")},clone:function(){var b=this.getClass();var a=new b();this.assignTo(a);return a},beginUpdate:function(){++this._updateStatus},endUpdate:function(){--this._updateStatus;this.checkUpdateStatus();if(!this.isUpdating()){var a=this._modifiedProps;this._modifiedProps=[];this.doEndUpdate(a)}},doEndUpdate:function(c){if(c.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent")){for(var b=0,a=c.length;b<a;++b){var d=c[b];var e=this.getPropValue(d);this.notifyPropSet(d,e,true)}}this.objectChange(c)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(a){return(this._modifiedProps.indexOf(a)>=0)},checkUpdateStatus:function(){if(this._updateStatus<=0){this._updateStatus=0}},copyPropsTo:function(b){var d=this.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var e=d.getPropInfoAt(c).name;if(b.hasProperty(e)){var f=this.getPropValue(e);b.setPropValue(e,f,true)}}}});ObjectEx._PROPINFO_HASHKEY_PREFIX="__$propInfo__";ObjectEx._PROP_STOREFIELD_PREFIX="__$";var JsonUtility={DEF_LOAD_TIMEOUT:20000,FILE_EXT_JSON:".json",FILE_EXT_JSON_JS_WRAPPER:".jsonjs",DEF_SERIALIZE_TO_JSCODE_VARNAME:"__jsonvar__",parse:function(a){return JSON.parse(a)},parseFromJsWrappedCode:function(code,jsVarName){if(!jsVarName){jsVarName=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}eval(code);return JsonUtility.parse(eval(jsVarName))},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==JsonUtility.FILE_EXT_JSON_JS_WRAPPER){return JsonUtility.loadJsWrapper(b,d,a)}else{return JsonUtility.loadJson(b,d,a)}},loadJsWrapper:function(url,callback,options){var loptions=options||{};var wrapperVarName=loptions.wrapperVarName||JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(jsonObj,isSuccess){if(callback){callback(jsonObj,isSuccess)}};var wrapperCallback=function(src,isSuccess){var jsonObj=null;if(isSuccess){var wrapperVar=eval(wrapperVarName);if(wrapperVar){if(typeof(wrapperVar)=="string"){jsonObj=JsonUtility.parse(wrapperVar)}else{jsonObj=wrapperVar}}runCallBack(jsonObj,true)}else{runCallBack(null,false)}};WebShow.ScriptLoader.load(url,wrapperCallback,loptions)},loadJson:function(c,e,b){loptions=b||{};if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}loptions.resultType=WebShow.FileLoader.ResultType.TEXT;loptions.extractBody=false;var d=function(h,f,g){if(f){var i=JsonUtility.parse(h);e(i,true)}else{e(null,false)}};var a=new WebShow.XHRLoader();a.load(c,d,loptions)},serializeToStr:function(b,a){if(a&&a.prettyPrint){return JSON.stringify(b,null,a.indentSpaces||2)}else{return JSON.stringify(b)}},serializeToJsCode:function(d,b,e){if(!e){e="'"}if(!b){b=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var a=JsonUtility.serializeToStr(d);var c=new RegExp(e,"g");a=a.replace(c,"\\"+e);return"var "+b+" = "+e+a+e}};var XmlUtility={DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:20000,DEF_BYPASS_ROOT_ELEM:true,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(b,a){if(!b){b=""}if(!a){a=""}if(document.implementation&&document.implementation.createDocument){var f=document.implementation.createDocument(a,b,null);return f}else{var f=new ActiveXObject("MSXML2.DOMDocument");if(b){var d="";var c=b;var e=b.indexOf(":");if(e!=-1){d=b.substring(0,e);c=b.substring(e+1)}var g="<"+(d?(d+":"):"")+c+(a?((d?" xmlns:":" xmlns")+d+'="'+a+'"'):"")+"/>";f.loadXML(g)}return f}},parse:function(d){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"application/xml")}else{if(typeof ActiveXObject!="undefined"){var c=XmlUtility.newDocument();c.loadXML(d);return c}else{var a="data:text/xml;charset=utf-8,"+encodeURIComponent(d);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==XmlUtility.FILE_EXT_XML_JS_WRAPPER){return XmlUtility.loadHelper.loadJsWrapper(b,d,a)}if(!a){a={disableInclude:false}}if(!a.disableInclude){return XmlUtility.loadHelper.loadAndHandleIncludeElement(b,d,a)}else{return XmlUtility.loadHelper.loadSimple(b,d,a.timeout)}},loadHelper:{loadSimple:function(a,h,f){var b=(h!=null);if((f===null)||(f===undefined)){f=XmlUtility.DEF_LOAD_TIMEOUT}if(!(document.implementation&&document.implementation.createDocument)){return XmlUtility.loadHelper.loadSimpleViaDoc(a,h)}else{var d=new XMLHttpRequest();var i=null;if(f){i=setTimeout(function(){l(null,false)},f)}var l=function(m,e){if(i){clearTimeout(i)}if(h){h(m,e)}};if(b){d.onreadystatechange=function(){if(d.readyState==4){var e=d.responseXML;if(e&&e.documentElement){l(e,true)}else{l(null,false)}}}}try{d.open("get",a,b);d.send(null)}catch(c){WebShow.reportError(c);l(null,false)}var g=d.responseXML;if(g&&g.documentElement){return g}else{return null}}},loadSimpleViaDoc:function(c,e){var b="dummy_dummy_dummy_dummy";var d=(e!=null);var a=XmlUtility.newDocument(b);a.async=d;if(d){a.onreadystatechange=function(){if(a.readyState==4){if((!a.documentElement)||(a.documentElement.tag==b)){e(a,false)}else{e(a,true)}}}}a.load(c);return a},loadAndHandleIncludeElement:function(c,f,b){var e;if(b){e=b.timeout}else{e=null}var d=(f==null);if(d){var a=XmlUtility.loadHelper.loadSimple(c,null,e);if(a&&a.documentElement){XmlUtility.loadHelper.handleIncludedXmlInElement(a.documentElement,null,b);return a}else{return null}}else{return XmlUtility.loadHelper.loadSimple(c,function(h,g){if(!g){f(h,false)}else{XmlUtility.loadHelper.handleIncludedXmlInElement(h.documentElement,function(i){f(h,true)},b)}},e)}},loadJsWrapper:function(url,callback,options){options=options||{};var wrapperVarName=options.wrapperVarName||XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;var loadTimeout=options.timeout;if((loadTimeout===null)||(loadTimeout===undefined)){loadTimeout=XmlUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(xmldoc,isSuccess){if(callback){callback(xmldoc,isSuccess)}};var wrapperCallback=function(src,isSuccess){if(isSuccess){var xmlContent=eval(wrapperVarName);var doc=XmlUtility.parse(xmlContent);runCallBack(doc,true)}else{runCallBack(null,false)}};options.timeout=loadTimeout;WebShow.ScriptLoader.load(url,wrapperCallback,options)},getIncludeElements:function(b,c){var a=[];if(!c){c=XmlUtility.DEF_INCLUDE_TAG_NAME}return b.getElementsByTagName(c)},handleIncludedXmlInElement:function(b,p,r){if(!r){r={}}var l=r.includeTagName||XmlUtility.DEF_INCLUDE_TAG_NAME;var q=r.srcAttribName||XmlUtility.DEF_INCLUDE_SRC_ATTRIB;var a=(r.bypassRootElem!=null)?r.bypassRootElem:XmlUtility.DEF_BYPASS_ROOT_ELEM;var m=(p==null);var o=XmlUtility.getXmlDocUrl(b.ownerDocument);var h=XmlUtility.loadHelper.getIncludeElements(b,l);if(!q){var d=null}var e=null;var n=0;var c=h.length;if(c<=0){if(p){p(0)}return null}var f;for(var g=h.length-1;g>=0;--g){e=h[g];d=e.getAttribute(q);if(d){d=WebShow.URL.mergePath(d,o);if(m){f=XmlUtility.loadHelper.loadSimple(d);if(f){XmlUtility.loadHelper.insertIncludedSection(f,e,a)}}else{XmlUtility.loadHelper.loadSimple(d,(function(t,s,i){if(i&&s){f=s;XmlUtility.loadHelper.insertIncludedSection(f,t,a)}n++;if(n==c){p(n)}}).bind(this,e))}}}return b},insertIncludedSection:function(m,h,a){var c=[];if(a){var d=m.documentElement.firstChild;while(d){if(d.nodeType==Node.ELEMENT_NODE){c.push(d)}d=d.nextSibling}}else{c.push(m.documentElement)}var f;var b=h.ownerDocument;var e=b.documentElement;for(var n=0,g=c.length;n<g;++n){var f=c[n];if(b.importNode){f=b.importNode(f,true)}h.parentNode.insertBefore(f,h)}h.parentNode.removeChild(h);return b}},serializeNode:function(b,a){if(a&&a.prettyPrint){return XmlUtility.serializeNodePretty(b)}if(typeof XMLSerializer!="undefined"){return(new XMLSerializer()).serializeToString(b)}else{if(b.xml){return b.xml}else{throw"XML.serialize is not supported or can't serialize "+b}}},serializeNodePretty:function(a){try{return XML((new XMLSerializer()).serializeToString(a)).toXMLString()}catch(b){return XmlUtility.serializeNode(a)}},serializeNodeToJsCode:function(d,a,c){if(!c){c="'"}if(!a){a=XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var e=XmlUtility.serializeNode(d);var b=new RegExp(c,"g");e=e.replace(b,"\\"+c);return"var "+a+" = "+c+e+c+";"},parseFromJsWrappedCode:function(code,jsVarName){eval(code);var xmlText=eval(jsVarName);return XmlUtility.parse(xmlText)},getXmlDocUrl:function(a){return a.url||a.documentURI||a.URL||a.location}};var ObjSerializer=Class.create({CLASS_NAME:"ObjSerializer",serializeValue:function(a){return a},deserializeValue:function(b,a){return b},propNameToStorageName:function(a){return a},storageNameToPropName:function(a){return a},getObjCustomSaveMethod:function(a){return(a.doSaveObj)},getObjCustomLoadMethod:function(a){return(a.doLoadObj)},getObjCustomPropSaveMethod:function(a){return(a.doSaveProp)},getObjCustomPropLoadMethod:function(a){return(a.doLoadProp)},isUndefined:function(a){return DataType.isUndefinedValue(a)},isNull:function(a){return(a===null)},isNaN:function(a){return a!=a},isFunction:function(a){return DataType.isFunctionValue(a)},isArray:function(a){return DataType.isArrayValue(a)},isDate:function(a){return DataType.isDateValue(a)},isObject:function(a){return DataType.isObjectValue(a)},isObjectEx:function(a){return DataType.isObjectExValue(a)},isSimpleType:function(b){var a=typeof(b);return(a=="string")||(a=="number")||(a=="boolean")||(a=="undefined")||(this.isNull(b))},isComplexType:function(a){return(!this.isSimpleType(a))},createChildStorageNode:function(c,b,a){},appendArrayItemStorageNode:function(b,c,a){},getNameForArrayItemStorageNode:function(a){var b=this.getDefaultArrayItemStorageName();return b},getChildStorageNode:function(a,b){},getAllArrayItemStorageNodes:function(a){},getAllStoredStorageNames:function(a){},setStorageNodeExplicitType:function(a,b){},getStorageNodeExplicitType:function(a){},getStorageNodeName:function(a){},isComplexStorageNode:function(a){},isComplexArrayItemStorageNode:function(a){},isSimpleStorageNode:function(a){},getValueExplicitType:function(a){if(a instanceof ObjectEx){return a.getClassName()}else{if(this.isObject(a)){return DataType.OBJECT}else{if(this.isArray(a)){return DataType.ARRAY}else{if(this.isDate(a)){return DataType.DATE}else{return(typeof a)}}}}},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function save(d,c,b){if(typeof(d)=="object"){var e=this.getObjCustomSaveMethod(d);if(e){return e(d,c,this)}}var a=this.doSave(d,c,b||{});if(a&&this.isFunction(d.saved)){d.saved()}return a},doSave:function(c,b,a){if(typeof(c)=="object"){if(c instanceof ObjectEx){this.doSaveObjectEx(c,b,a)}else{if(this.isArray(c)){this.doSaveArray(c,b)}else{if(this.isDate(c)){this.doSaveDate(c,b)}else{this.doSaveSimpleObject(c,b)}}}}this.setStorageNodeExplicitType(b,this.getValueExplicitType(c));return c},doSaveSimpleObject:function(d,b){for(var e in d){if(!d.hasOwnProperty(e)){continue}var a=d[e];var c;if(this.isComplexType(a)){c=this.getValueExplicitType(a)}this.doSaveFieldValue(d,e,a,b,c)}},doSaveArray:function(b,e){for(var c=0,a=b.length;c<a;++c){var d=b[c];var g=this.getNameForArrayItemStorageNode(d);if(this.isComplexType(d)){var f=this.appendArrayItemStorageNode(e,this.propNameToStorageName(g),this.isArray(d));this.setStorageNodeExplicitType(f,this.getValueExplicitType(d));this.save(d,f)}else{this.doAppendArrayItemSimpleValue(this.serializeValue(d),typeof(d),e)}}},doSaveDate:function(c,b){var a=c.toUTCString();this.doSaveSimpleValue(c,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,b)},doSaveObjectEx:function(f,b,o){var m=f.getAllPropList();var h=o.propFilter;for(var g=0,c=m.getLength();g<c;++g){var a=m.getPropInfoAt(g);var d=h?h(a,f):true;if(!d){continue}var e=this.getObjCustomPropSaveMethod(f);var n=false;if(e){n=e(f,a,b,this)}if(!!n){continue}if(a.serializable){this.doSaveObjectExProp(f,a,b,o)}}},doSaveObjectExProp:function(e,h,c,a){var b=h.name;var g=h.dataType;var f=e.getPropValue(b);if(a.saveDefaultValues||(f!==h.defaultValue)){var d;if(f instanceof ObjectEx){if(f.getClassName()!=g){d=f.getClassName()}}else{if(this.isComplexType(f)){d=this.getValueExplicitType(f);if(d==g){d=undefined}}}this.doSaveFieldValue(e,b,f,c,d)}},doSaveFieldValue:function(d,e,b,a,c){if(typeof(b)!="function"){if(this.isComplexType(b)){subNode=this.createChildStorageNode(a,this.propNameToStorageName(e),this.isArray(b));if(c){this.setStorageNodeExplicitType(subNode,c)}this.save(b,subNode)}else{this.doSaveSimpleValue(d,this.propNameToStorageName(e),this.serializeValue(b),this.getValueExplicitType(b),a)}}},doSaveSimpleValue:function(d,a,c,e,b){},doAppendArrayItemSimpleValue:function(b,c,a){},load:function(c,b){if(!c){var e=this.getStorageNodeExplicitType(b);if(e){c=DataType.createInstance(e)}else{if(this.doLoadUntypedNode){return this.doLoadUntypedNode(b)}else{return null}}}if(typeof(c)==="object"){var d=this.getObjCustomLoadMethod(c);if(d){return d(c,b,this)}}var a=this.doLoad(c,b);if(a&&this.isFunction(c.loaded)){c.loaded()}return a},doLoad:function(c,a){var b=this.getStorageNodeExplicitType(a);if(typeof(c)=="object"){if(c instanceof ObjectEx){c=this.doLoadObjectEx(c,a)}else{if(this.isArray(c)){c=this.doLoadArray(c,a)}else{if(this.isDate(c)){c=this.doLoadDate(c,a)}else{c=this.doLoadSimpleObject(c,a)}}}}return c},doLoadArray:function(m,a){var g=this.getAllArrayItemStorageNodes(a);for(var f=0,c=g.length;f<c;++f){var b=g[f];if(this.isComplexArrayItemStorageNode(b)){var e;var d=this.getStorageNodeExplicitType(b)||this.getStorageNodeName(b);if(d){e=DataType.createInstance(d);this.load(e,b)}else{e={};this.load(e,b)}m.push(e)}else{var h=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(b));m.push(h)}}return m},doLoadDate:function(e,d){var a=this.propNameToStorageName(this.getDefaultDateStorageName());var b=this.doLoadSimpleValue(e,a,DataType.DATE,d);if(b){var c=new Date(b);e.copyFrom(c);return e}else{return undefined}},doLoadSimpleObject:function(d,a){var b=this.getAllStoredStorageNames(a);for(var e=0,c=b.length;e<c;++e){var n=b[e];var m=this.storageNameToPropName(n);var f=this.getChildStorageNode(a,n);if(f){var o;var h=this.getStorageNodeExplicitType(f);if(h){o=DataType.createInstance(h)}else{o={}}this.load(o,f);d[m]=o}else{var g=this.doLoadSimpleValue(d,n,null,a);d[m]=g}}return d},doLoadObjectEx:function(f,e){var d=f.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var h=d.getPropInfoAt(c);if(!h.serializable){continue}var g=this.getObjCustomPropLoadMethod(f);var b=false;if(g){b=g(f,h,e,this)}if(!!b){continue}this.doLoadObjectExProp(f,h,e)}return f},doLoadObjectExProp:function(c,f,b){var a=f.name;var e=f.dataType;var d=this.doLoadFieldValue(c,a,b,e);if((d!==null)&&(d!==undefined)){c.setPropValue(a,d,true)}},doLoadFieldValue:function(f,h,c,b){var a;var e=false;if(DataType.isComplexType(b)){var g=this.getChildStorageNode(c,this.propNameToStorageName(h));if(g){var d=this.getStorageNodeExplicitType(g);if(d&&(d!=b)){a=DataType.createInstance(d)}else{a=DataType.createInstance(b)}this.load(a,g);e=true}}if(DataType.isSimpleType(b)||(!e)){a=this.doLoadSimpleValue(f,this.propNameToStorageName(h),b,c)}return a},doLoadSimpleValue:function(d,a,e,c){var b=this.doLoadSimpleStorageValue(a,c);return this.deserializeValue(b,e)},doLoadSimpleStorageValue:function(a,b){},doGetArrayItemSimpleStorageValue:function(a){}});var JsonObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(d,c,b){var a=b?[]:{};d[c]=a;return a},appendArrayItemStorageNode:function(c,d,b){var a=b?[]:{};c.push(a);return a},getChildStorageNode:function(b,c){var a=b[c];if(this.isSimpleType(a)){a=null}return a},getAllArrayItemStorageNodes:function(b){var a=Array.prototype.slice.call(b);return a},getAllStoredStorageNames:function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){if(b!=this.TYPE_TAG_NAME){a.push(b)}}}return a},isComplexStorageNode:function(a){return this.isComplexType(a)},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)},isSimpleStorageNode:function(a){return this.isSimpleType(a)},setStorageNodeExplicitType:function(a,b){if(!this.isArray(a)){a[this.TYPE_TAG_NAME]=b}},getStorageNodeExplicitType:function(b){var a=b[this.TYPE_TAG_NAME]||null;if((!a)&&this.isArray(b)){return DataType.ARRAY}else{return a}},doSaveSimpleValue:function(d,a,c,e,b){b[a]=c},doAppendArrayItemSimpleValue:function(b,c,a){return a.push(b)},doLoadSimpleStorageValue:function(a,b){return b[a]},doLoadUntypedNode:function(a){return a},doGetArrayItemSimpleStorageValue:function(a){return a}});var XmlObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getElemTextValue:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==Node.TEXT_NODE){a+=d.childNodes[c].nodeValue}}return a},serializeValue:function(a){return StringUtils.serializeValue(a)},deserializeValue:function(b,a){return StringUtils.deserializeValue(b,a)},createChildStorageNode:function(d,c,b){var a=d.ownerDocument.createElement(c);d.appendChild(a);return a},appendArrayItemStorageNode:function(b,c,a){return this.createChildStorageNode(b,c,a)},getAllArrayItemStorageNodes:function(b){var a=[];for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){a.push(e)}}return a},getAllStoredStorageNames:function(f){var a=[];for(var c=0,b=f.childNodes.length;c<b;++c){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(d)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(d))}}}for(var c=0,b=f.attributes.length;c<b;++c){var e=f.attributes[c];if(this.getLocalName(e)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(e))}}return a},getChildStorageNode:function(b,f){var a=null;for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(e)==f){a=e}}}return a},isComplexStorageNode:function(a){return a.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)&&(a.attributes.length)&&(!this.getElemTextValue(a).trim())},isSimpleStorageNode:function(a){return a.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(a,b){a.setAttribute(this.TYPE_TAG_NAME,b)},getStorageNodeExplicitType:function(a){return a.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(b){var a=b.tagName;if(a==this.getDefaultArrayItemStorageName()){return null}else{return a}},doSaveSimpleObject:function($super,b,a){$super(b,a)},doSaveArray:function($super,a,b){$super(a,b)},doSaveSimpleValue:function(d,a,c,e,b){b.setAttribute(a,c)},doAppendArrayItemSimpleValue:function(c,e,a){var b=this.appendArrayItemStorageNode(a,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),false);var d=b.ownerDocument.createTextNode(c);b.appendChild(d)},doLoadSimpleStorageValue:function(a,b){return b.getAttribute(a)},doGetArrayItemSimpleStorageValue:function(a){return this.getElemTextValue(a)}});var ObjSerializerFactory={_serializerClasses:{},_defaultName:null,registerSerializer:function(a,c,b){var d=(typeof(c)=="string")?ClassEx.findClass(c):c;ObjSerializerFactory._serializerClasses[a]=d;if(b){ObjSerializerFactory._defaultName=a}},getSerializer:function(a){var b=a||ObjSerializerFactory._defaultName;if(b){var c=ObjSerializerFactory._serializerClasses[b];return c?new c():null}else{return null}}};(function(){ObjSerializerFactory.registerSerializer("json",JsonObjSerializer,true);ObjSerializerFactory.registerSerializer("xml",XmlObjSerializer)})();ClassEx.extend(ObjectEx,{saveObj:function(c,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(this,c,b)},loadObj:function(b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(this,b)}});var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.5.0",PROP_AUTO_TITLE:true};var $jsRoot=this;Kekule.LOCAL_RES=true;Kekule.ErrorMsg={NON_OWN_PROPERTY_CANNOT_BE_REPLACED:"Only directly owned property of object can be replaced",EMPTY_DOC:"Document is empty",ELEMENT_NOTSET:"Element not set",EMPTY_RESURI:"Resource URI is empty",CANNOT_LOAD_RES_OF_URI:"Can not load resource of URI: ",LIST_ITEM_CLASS_MISMATCH:"Mismatched item class, can not add to list",CANNOT_CLEAR_WEAKMAP:"Can not clear a weak map",CANNOT_GET_KEY_LIST_IN_WEAKMAP:"Can not get key array from a weak map",CANNOT_GET_VALUE_LIST_IN_WEAKMAP:"Can not get value array from a weak map",INVALID_CHEMELEMENT:"Invalid chemical element",INVALID_ISOTOPE:"Invalid isotope",UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector",UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector",CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class",SORT_FUNC_UNSET:"Sort function is not set",UNABLE_ADD_NONMOLECULE_MAP:"Unable to add non-molecule to reactants or products",CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER:"Can not add object other than node or connector to structure object container",REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND:"Can not find registered canonicalization executor",READER_ID_ALREADY_EXISTS:"Can not register reader: id already exists",WRITER_ID_ALREADY_EXISTS:"Can not register writer: id already exists",NO_SUITABLE_READER_FOR_FORMAT:"Can not read data of format: ",NO_SUITABLE_READER_FOR_MIMETYPE:"Can not read data of MIME type: ",NO_SUITABLE_READER_FOR_FILEEXT:"Can not read data of file extension: ",NO_SUITABLE_WRITER_FOR_FORMAT:"Can not write data of format: ",NO_SUITABLE_WRITER_FOR_MIMETYPE:"Can not write data of MIME type: ",NO_SUITABLE_WRITER_FOR_FILEEXT:"Can not write data of file extension: ",CML_ELEM_READER_NOT_FOUND:"Reader for element <{0}> not found",ATOMID_NOT_EXISTS:"Atom id not exists: ",BONDID_NOT_EXISTS:"Bond id not exists: ",CML_ELEM_WRITER_TYPE_INPROPER:"{0} is not a proper CML element writer for {1}",CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT:"Can not output content to empty element",UNABLE_TO_OUTPUT_AS_CML:"Unable to output object <{0}> to MDL data",MDL_CTAB_ATOM_CANNOT_CREATE:"Can not create atom from source MDL format data",MDL_CTAB_BOND_CANNOT_CREATE:"Can not create bond from source MDL format data",CAN_NOT_WRITE_NON_MOLECULE_TO_MOL:"Object is not a molecule and can not be output to connection table",MOLECULE_HAS_NO_CTAB_TO_OUTPUT:"Molecule has no connection table and can not be output to MDL format",NOT_MDL2000_FORMAT_DATA:"Data format wrong: not MDL 2000",NOT_MDL_RXN_DATA:"Not MDL Reaction(RXN) data",MALFORMED_MDL3000_COUNTLINE:"Malformed MDL 3000 count line",MDL3000_ATOMBLOCK_NOT_FOUND:"Atom block not found, malformed MDL 3000 data?",NOT_MDL_FORMAT_DATA:"Data format wrong: not MDL 2000 or 3000",NOT_MDL2000_RXN_DATA:"Not MDL RXN 2000 data",NOT_MDL3000_RXN_DATA:"Not MDL RXN 3000 data",NOT_MDL3000_RXN_COUNTLINE:"Error in reading RXN 3000 count line",MDL_OUTPUT_DATATYPE_NOT_TEXT:"MDL data can not be output to non text format",MDL_INPUT_DATATYPE_NOT_TEXT:"Non text format is not a legal MDL source data",UNABLE_TO_OUTPUT_AS_MDL:"Unable to output object <{0}> to MDL data",KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT:"Non text or JSON format data is not a legal KCJ source",KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT:"Can not output as non text or JSON data",KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT:"Non text or DOM data is not a legal KCX source",KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT:"Can not output as non text or DOM data",JSON_SERIALIZER_NOT_EXISTS:"Serializer for JSON not exists",XML_SERIALIZER_NOT_EXISTS:"Serializer for XML not exists",CAN_NOT_REMOVE_INDIVIDUAL_ELEM:"Unable to remove individual element on context",CAN_NOT_RENDER_MOL_WITHOUT_CTAB_IN_3D:"Can not render molecule without connection table in 3D mode",INAVAILABLE_AUTOSCALE_REF_LENGTH:"Can not determine the length for calculation of auto scale",FORMULA_RENDERER_3D_NOT_AVAILABLE:"3D renderer for molecule formula is not available",CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ:"Can not find suitable renderer for object"};Kekule.LOCAL_RES=true;Kekule.WidgetTexts={CAPTION_OK:"OK",CAPTION_CANCEL:"Cancel",CAPTION_YES:"Yes",CAPTION_NO:"No",CAPTION_BROWSE_COLOR:"Browse colors",HINT_BROWSE_COLOR:"Browse more colors",S_COLOR_UNSET:"(unset)",S_COLOR_DEFAULT:"(default)",S_COLOR_MIXED:"(mixed)",S_OBJECT_UNSET:"(none)",S_ITEMS:"item(s)",S_OBJECT:"object",S_VALUE_UNSET:"(Unset)",S_INSPECT_NONE:"(none)",S_INSPECT_OBJECTS:"({0} objects)",S_INSPECT_ID_OBJECT:"{0}: {1}",S_INSPECT_ANONYMOUS_OBJECT:"({0})",CAPTION_TOGGLE_TEXTWRAP:"Toggle text wrapping",CAPTION_INC_TEXT_SIZE:"Increase text size",CAPTION_DEC_TEXT_SIZE:"Decrease text size",HINT_TOGGLE_TEXTWRAP:"Toggle the state of text wrapping",HINT_INC_TEXT_SIZE:"Increase text size",HINT_DEC_TEXT_SIZE:"Decrease text size",HINT_CHOOSE_FONT_FAMILY:"Choose font family",CAPTION_CONFIG:"Settings...",HINT_CONFIG:"Change settings"};Kekule.ChemWidgetTexts={CAPTION_LOADFILE:"Load...",CAPTION_LOADDATA:"Load...",CAPTION_SAVEFILE:"Save...",CAPTION_ZOOMIN:"Zoom In",CAPTION_ZOOMOUT:"Zoom Out",CAPTION_RESETZOOM:"Reset Zoom",CAPTION_RESETVIEW:"Reset",CAPTION_ROTATELEFT:"Left Rotate",CAPTION_ROTATERIGHT:"Right Rotate",CAPTION_ROTATEX:"X Rotate",CAPTION_ROTATEY:"Y Rotate",CAPTION_ROTATEZ:"Z Rotate",CAPTION_MOL_DISPLAY_TYPE:"Molecule display style",CAPTION_SKELETAL:"Skeletal",CAPTION_CONDENSED:"Condensed",CAPTION_WIRE:"Wire Frame",CAPTION_STICKS:"Sticks",CAPTION_BALLSTICK:"Ball Stick",CAPTION_SPACEFILL:"Space Fill",CAPTION_HIDEHYDROGENS:"Show/hide hydrogens",CAPTION_OPENEDITOR:"Edit...",CAPTION_EDIT_OBJ:"Edit",HINT_LOADFILE:"Load from file",HINT_LOADDATA:"Load data",HINT_SAVEFILE:"Save to file",HINT_ZOOMIN:"Zoom in",HINT_ZOOMOUT:"Zoom out",HINT_RESETZOOM:"Reset zoom",HINT_RESETVIEW:"Reset zoom and rotation",HINT_ROTATELEFT:"Rotate in anticlockwise direction",HINT_ROTATERIGHT:"Rotate in clockwise direction",HINT_ROTATEX:"Rotate around X axis",HINT_ROTATEY:"Rotate around Y axis",HINT_ROTATEZ:"Rotate around Z axis",HINT_MOL_DISPLAY_TYPE:"Change molecule display style",HINT_SKELETAL:"Show molecule in skeletal style",HINT_CONDENSED:"Show molecule in condensed style",HINT_WIRE:"Show molecule in wire frame style",HINT_STICKS:"Show molecule in sticks style",HINT_BALLSTICK:"Show molecule in ball-stick style",HINT_SPACEFILL:"Show molecule in space-fill style",HINT_HIDEHYDROGENS:"Show/hide hydrogen atoms in model",HINT_OPENEDITOR:"Open an editor to modify displayed object",CAPTION_NEWDOC:"New",CAPTION_UNDO:"Undo",CAPTION_REDO:"Redo",CAPTION_COPY:"Copy",CAPTION_CUT:"Cut",CAPTION_PASTE:"Paste",CAPTION_CLONE_SELECTION:"Clone selection",CAPTION_TOGGLE_INSPECTOR:"Object inspector",CAPTION_MANIPULATE:"Select",CAPTION_ERASE:"Erase",CAPTION_MOL_BOND:"Bond",CAPTION_MOL_BOND_SINGLE:"Single bond",CAPTION_MOL_BOND_DOUBLE:"Double bond",CAPTION_MOL_BOND_TRIPLE:"Triple bond",CAPTION_MOL_BOND_WEDGEUP:"Wedge up bond",CAPTION_MOL_BOND_WEDGEDOWN:"Wedge down bond",CAPTION_MOL_BOND_WAVY:"Wavy bond",CAPTION_MOL_ATOM:"Atom",CAPTION_MOL_CHARGE:"Charge",CAPTION_MOL_CHARGE_CLEAR:"Charge clear",CAPTION_MOL_CHARGE_POSITIVE:"Positive charge",CAPTION_MOL_CHARGE_NEGATIVE:"Negative charge",CAPTION_MOL_CHARGE_SINGLET:"Singlet radical",CAPTION_MOL_CHARGE_DOUBLET:"Doublet radical",CAPTION_MOL_CHARGE_TRIPLET:"Triplet radical",CAPTION_TEXT_BLOCK:"Text Block",CAPTION_REPOSITORY_RING:"Rings",CAPTION_REPOSITORY_RING_3:"Cyclopropane",CAPTION_REPOSITORY_RING_4:"Cyclobutane",CAPTION_REPOSITORY_RING_5:"Cyclopentane",CAPTION_REPOSITORY_RING_6:"Cyclohexane",CAPTION_REPOSITORY_RING_7:"Cycloheptane",CAPTION_REPOSITORY_RING_8:"Cyclooctane",CAPTION_REPOSITORY_RING_AR_6:"Benzene",CAPTION_REPOSITORY_RING_AR_5:"Cyclopentadiene",CAPTION_REPOSITORY_ARROWLINE:"Arrows & lines",CAPTION_REPOSITORY_GLYPH:"Glyphs",CAPTION_REPOSITORY_GLYPH_LINE:"Line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",CAPTION_REPOSITORY_HEAT_SYMBOL:"Heat symbol",CAPTION_REPOSITORY_ADD_SYMBOL:"Add symbol",CAPTION_PICK_COLOR:"Color",CAPTION_TEXT_DIRECTION:"Text direction",CAPTION_TEXT_DIRECTION_DEFAULT:"Default",CAPTION_TEXT_DIRECTION_LTR:"Left to right",CAPTION_TEXT_DIRECTION_RTL:"Right to left",CAPTION_TEXT_DIRECTION_TTB:"Top to bottom",CAPTION_TEXT_DIRECTION_BTT:"Bottom to top",CAPTION_TEXT_HORIZONTAL_ALIGN:"Text horizontal alignment",CAPTION_TEXT_VERTICAL_ALIGN:"Text vertical alignment",CAPTION_TEXT_ALIGN_DEFAULT:"Default",CAPTION_TEXT_ALIGN_LEADING:"Leading",CAPTION_TEXT_ALIGN_TRAILING:"Trailing",CAPTION_TEXT_ALIGN_CENTER:"Center",CAPTION_TEXT_ALIGN_LEFT:"Left",CAPTION_TEXT_ALIGN_RIGHT:"Right",CAPTION_TEXT_ALIGN_TOP:"Top",CAPTION_TEXT_ALIGN_BOTTOM:"Bottom",HINT_NEWDOC:"Create new document",HINT_UNDO:"Undo",HINT_REDO:"Redo",HINT_COPY:"Copy selection to internal clipboard",HINT_CUT:"Cut selection to internal clipboard",HINT_PASTE:"Paste from internal clipboard",HINT_CLONE_SELECTION:"Clone selection",HINT_TOGGLE_INSPECTOR:"Show or hide object inspector panel",HINT_MANIPULATE:"Select tool",HINT_ERASE:"Erase tool",HINT_MOL_BOND:"Bond tool",HINT_MOL_BOND_SINGLE:"Single bond",HINT_MOL_BOND_DOUBLE:"Double bond",HINT_MOL_BOND_TRIPLE:"Triple bond",HINT_MOL_BOND_WEDGEUP:"Wedge up bond",HINT_MOL_BOND_WEDGEDOWN:"Wedge down bond",HINT_MOL_BOND_WAVY:"Wavy bond",HINT_MOL_ATOM:"Atom tool",HINT_MOL_CHARGE:"Charge tool",HINT_MOL_CHARGE_CLEAR:"Clear charge and radical",HINT_MOL_CHARGE_POSITIVE:"Positive charge",HINT_MOL_CHARGE_NEGATIVE:"Negative charge",HINT_MOL_CHARGE_SINGLET:"Singlet radical",HINT_MOL_CHARGE_DOUBLET:"Doublet radical",HINT_MOL_CHARGE_TRIPLET:"Triplet radical",HINT_TEXT_BLOCK:"Text Block tool",HINT_REPOSITORY_RING:"Ring structures",HINT_REPOSITORY_RING_3:"Cyclopropane",HINT_REPOSITORY_RING_4:"Cyclobutane",HINT_REPOSITORY_RING_5:"Cyclopentane",HINT_REPOSITORY_RING_6:"Cyclohexane",HINT_REPOSITORY_RING_7:"Cycloheptane",HINT_REPOSITORY_RING_8:"Cyclooctane",HINT_REPOSITORY_RING_AR_6:"Benzene",HINT_REPOSITORY_RING_AR_5:"Cyclopentadiene",HINT_REPOSITORY_ARROWLINE:"Arrows and lines",HINT_REPOSITORY_GLYPH:"Glyphs",HINT_REPOSITORY_GLYPH_LINE:"Line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE:"Open arrow line",HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE:"Triangle arrow line",HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE:"Bidirectional open arrow line",HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE:"Bidirectional triangle arrow line",HINT_REPOSITORY_GLYPH_REV_ARROW_LINE:"Reversible arrow line",HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE:"Open arrow double line",HINT_REPOSITORY_HEAT_SYMBOL:"Heat symbol",HINT_REPOSITORY_ADD_SYMBOL:"Add symbol",HINT_FONTNAME:"Set font name",HINT_FONTSIZE:"Set font size",HINT_PICK_COLOR:"Select color",HINT_TEXT_DIRECTION:"Set text direction",HINT_TEXT_HORIZONTAL_ALIGN:"Set text horizontal alignment",HINT_TEXT_VERTICAL_ALIGN:"Set text vertical alignment",CAPTION_LOADDATA:"Load data",CAPTION_DATA_FORMAT:"Data format:",CAPTION_DATA_SRC:"Input or paste data below:",CAPTION_LOADDATA_FROM_FILE:"Load from file",CAPTION_CHOOSEFILEFORMAT:"Choose file format",CAPTION_SELECT_FORMAT:"Select format:",CAPTION_PREVIEW_FILE_CONTENT:"Preview: ",S_DEF_SAVE_FILENAME:"Unnamed",CAPTION_ATOMLIST_PERIODIC_TABLE:"more...",CAPTION_RGROUP:"Sub group",CAPTION_VARIABLE_ATOM:"Variable Atom (list)",CAPTION_VARIABLE_NOT_ATOM:"Variable Atom (not list)",CAPTION_PSEUDOATOM:"Pseudoatom",CAPTION_DUMMY_ATOM:"Dummy Atom",CAPTION_HETERO_ATOM:"Hetero Atom",CAPTION_ANY_ATOM:"Any Atom",CAPTION_PERIODIC_TABLE_DIALOG:"Periodic table",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM:"Select element",CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS:"Select elements",CAPTION_TEXTBLOCK_INIT:"Enter text here",LEGEND_CAPTION:"Legend",LEGEND_ELEM_SYMBOL:"Symbol",LEGEND_ELEM_NAME:"name",LEGEND_ATOMIC_NUM:"atomic number",LEGEND_ATOMIC_WEIGHT:"atomic weight",S_VALUE_DEFAULT:"(Default)"};Object.extend(Kekule.ErrorMsg,{WIDGET_CAN_NOT_BIND_TO_ELEM:"Widget {0} can not be binded to element <{1}>",LOAD_CHEMDATA_FAILED:"Failed to load data",FILE_API_NOT_SUPPORTED:"File operations are not supported by your current web browser. Please update it.",DRAW_BRIDGE_NOT_SUPPORTED:"It seems that your web browser is not modern enough to support the drawing function.Please update it.",COMMAND_NOT_REVERSIBLE:"Command can not be undone",CAN_NOT_SET_COORD_OF_CLASS:"Can not set coordinate of instance of {0}.",CAN_NOT_SET_DIMENSION_OF_CLASS:"Can not set dimension of instance of {0}.",CAN_NOT_MERGE_CONNECTORS:"Specified connectors can not be merged.",NOT_A_VALID_ATOM:"Not a valid atom"});Kekule.LOCAL_RES=true;Kekule.OBJDEF_TEXTS={TITLE_PREFIX:"TITLE_",DESCRIPTION_PREFIX:"DES_",DES_ID:"Unique ID for object.",Render:{GeneralConfigs:{TITLE_drawOpacity:"Opacity",DES_drawOpacity:"Opacity (between 0-1) to draw objects"},Render2DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_displayLabelConfigs:"Display label settings",DES_displayLabelConfigs:"Settings of displayed label in molecule/chem object",TITLE_textFontConfigs:"Text and font settings",DES_textFontConfigs:"Settings about text and font of display",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule/chem object",TITLE_colorConfigs:"Color settings",DES_colorConfigs:"Color settings to display molecule/chem object"},MoleculeDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display mode",DES_defMoleculeDisplayType:"Default display type of molecule: in skeletal or in condensed mode",TITLE_defNodeDisplayMode:"Default atom display mode",DES_defNodeDisplayMode:"Default mode to display atom in molecule",TITLE_defHydrogenDisplayLevel:"Default hydrogen display level",DES_defHydrogenDisplayLevel:"How to display explicit or implicit hydrogens of atom",TITLE_defChargeMarkType:"Default charge mark type",DES_defChargeMarkType:null,TITLE_partialChargeDecimalsLength:"Decimal length of partial charge",DES_partialChargeDecimalsLength:"If an atom has a partical charge (e.g., +1.5), how many digits after decimal point should be displayed"},DisplayLabelConfigs:{TITLE_unsetElement:"Unset element",DES_unsetElement:"Label for unset or unknown element",TITLE_dummyAtom:"Dummy atom",DES_dummyAtom:"Label for dummy atom",TITLE_heteroAtom:"Hetero atom",DES_heteroAtom:"Label for general hetero atom",TITLE_anyAtom:"Any atom",DES_anyAtom:"Label for atom wildcard",TITLE_variableAtom:"Variable atom",DES_variableAtom:"Label for variable atom or atom list",TITLE_rgroup:"RGroup",DES_rgroup:"Label for RGroup",TITLE_isoListLeadingBracket:"Atom list leading bracket",TITLE_isoListTailingBracket:"Atom list tailing bracket",TITLE_isoListDelimiter:"Atom delimiter in list",TITLE_isoListDisallowPrefix:"Prefix of not-atom list"},TextFontConfigs:{TITLE_labelFontFamily:"Label font",DES_labelFontFamily:"Font to draw general label",TITLE_atomFontFamily:"Atom font",DES_atomFontFamily:"Font to draw atom label",TITLE_supFontSizeRatio:"Superscript font size ratio",DES_supFontSizeRatio:"Ratio of Superscript text size to normal text size",TITLE_subFontSizeRatio:"Subscript font size ratio",DES_subFontSizeRatio:"Ratio of Subscript text size to normal text size",TITLE_superscriptOverhang:"Superscript text overhang",DES_superscriptOverhang:null,TITLE_subscriptOversink:"Subscript text oversink",DES_subscriptOversink:null,TITLE_textCharDirection:"Text direction",DES_textCharDirection:"Default text direction",TITLE_textHorizontalAlign:"Horizontal text alignment",DES_textHorizontalAlign:"Default horizontal text alignment of label",TITLE_textVerticalAlign:"Vertical text alignment",DES_textVerticalAlign:"Default vertical text alignment of label"},LengthConfigs:{TITLE_labelFontSize:"Label text size",DES_labelFontSize:"Size of general label text",TITLE_atomFontSize:"Atom text size",DES_atomFontSize:"Size of atom label text",TITLE_chargeMarkFontSize:"Charge mark size",DES_chargeMarkFontSize:"Font size of charge mark",TITLE_chargeMarkMargin:"Charge mark margin",DES_chargeMarkMargin:"Margin between charge mark and atom",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default length of a chemical bond",TITLE_bondLineWidth:"Bond line width",DES_bondLineWidth:"Line width to draw a chemical bond",TITLE_hashSpacing:"Hash spacing",DES_hashSpacing:"Spacing between small lines in hash bond",TITLE_multipleBondSpacingRatio:"Multiple bond spacing ratio",DES_multipleBondSpacingRatio:"Ratio of spacing between two lines in double or triple bond to bond length.",TITLE_multipleBondMaxAbsSpacing:"Max multiple bond spacing",DES_multipleBondMaxAbsSpacing:"Maximum spacing between multiple bond",TITLE_bondArrowLength:"Bond arrow length",DES_bondArrowLength:"The length of end triangle in arrow bond",TITLE_bondArrowWidth:"Bond arrow width",DES_bondArrowWidth:"The width of end triangle in arrow bond",TITLE_bondWedgeWidth:"Bond wedge max width",DES_bondWedgeWidth:"The width of ending point in wedge bond",TITLE_bondWedgeHashMinWidth:"Bond wedge min width",DES_bondWedgeHashMinWidth:"The width of starting point in wedge bond",TITLE_bondWavyRadius:"Bond wavy radius",DES_bondWavyRadius:"Radius to draw arc of wavy bond",TITLE_glyphStrokeWidth:"Glyph stroke width",DES_glyphStrokeWidth:"The default width of glyph strokes",TITLE_autofitContextPadding:"Autofit context padding",DES_autofitContextPadding:"Padding of autofit widget edge and drawn object"},ColorConfigs:{TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element",TITLE_labelColor:"Label color",DES_labelColor:"Default color of general label",TITLE_atomColor:"Atom color",DES_atomColor:"Default color of atom label",TITLE_bondColor:"Bond color",DES_bondColor:"Default color of bond",TITLE_glyphStrokeColor:"Glyph stroke color",DES_glyphStrokeColor:"Default stroke color of glyph",TITLE_glyphFillColor:"Glyph fill color",DES_glyphFillColor:"Default fill color of glyph"},Render3DConfigs:{TITLE_generalConfigs:"General render settings",DES_generalConfigs:"General render settings",TITLE_moleculeDisplayConfigs:"Molecule display settings",DES_moleculeDisplayConfigs:"Settings about molecule display styles",TITLE_environmentConfigs:"3D environment settings",DES_environmentConfigs:"Settings of 3D environment",TITLE_modelConfigs:"3D model settings",DES_modelConfigs:"Settings to render a 3D molecule model",TITLE_lengthConfigs:"Lengths settings",DES_lengthConfigs:"Lengths to display molecule"},Render3DEnvironmentConfigs:{TITLE_graphicQuality:"Graphic quality",DES_graphicQuality:"Quality of 3D graphic"},Molecule3DDisplayConfigs:{TITLE_defMoleculeDisplayType:"Default molecule display type",DES_defMoleculeDisplayType:"Draw molecule in wire, stick, ball stick or space fill mode",TITLE_defBondSpliceMode:"Bond splice mode",DES_defBondSpliceMode:"How to draw a splice mode between two atoms with different color",TITLE_defDisplayMultipleBond:"Display multiple bond",DES_defDisplayMultipleBond:"Whether draw multiple bond lines for double or triple bond",TITLE_defBondColor:"Default bond color",DES_defBondColor:"Default bond color",TITLE_defAtomColor:"Default atom color",DES_defAtomColor:"Default atom color",TITLE_useAtomSpecifiedColor:"Use element specified color",DES_useAtomSpecifiedColor:"Whether use different color on different element"},Model3DConfigs:{TITLE_hideHydrogens:"Hide hydrogens",DES_hideHydrogens:"Whether hide all hydrogen atoms in 3D model",TITLE_useVdWRadius:"Use von dar Waals radius",DES_useVdWRadius:"Whether use atom's von dar Waals radius to draw 3D model",TITLE_multiConnectorRadiusRatio:"Multi-bond radius ratio",DES_multiConnectorRadiusRatio:"If use multi-cylinder for multibond, this value is the radius ratio between multi and single bond",TITLE_multiConnectorMarginRatio:"Multi-bond margin ratio",DES_multiConnectorMarginRatio:"If multi-cylinder is used for multibond, ratio of margin between cylinders and radius of cylinder"},Length3DConfigs:{TITLE_fixedNodeRadius:"Fixed atom radius",DES_fixedNodeRadius:"If vdW radius of atom is not used, this value will be used for all atom's radius",TITLE_connectorRadius:"Bond radius",DES_connectorRadius:"Bond will be draw based on this radius in stick or ball_stick mode",TITLE_connectorLineWidth:"Bond line width",DES_connectorLineWidth:"Bond will be draw on this width in wire mode"}},Widget:{BaseWidget:{TITLE_settingFacade:"General settings",DES_settingFacade:"General settings"}},ChemWidget:{ChemObjDisplayer:{TITLE_enableLoadNewFile:"Enable load data",DES_enableLoadNewFile:"Whether loading new data is enabled"},ChemObjDisplayerConfigs:{TITLE_ioConfigs:"I/O settings",DES_ioConfigs:"Settings of input/output"},ChemObjDisplayerIOConfigs:{TITLE_canonicalizeBeforeSave:"Canonicalize before save",DES_canonicalizeBeforeSave:"Whether canonicalize molecule before saving it"},Viewer:{TITLE_enableDirectInteraction:"Enable direct interaction",DES_enableDirectInteraction:"Whether interaction with chem object in viewer is enabled",TITLE_enableTouchInteraction:"Enable touch interaction",DES_enableTouchInteraction:"Whether touch interaction is enabled",TITLE_enableToolbar:"Enable toolbar",DES_enableToolbar:"Whether toolbar of viewer is displayed",TITLE_toolbarPos:"Toolbar Position",DES_toolbarPos:"Position of toolbar in viewer",TITLE_toolbarMarginHorizontal:"Toolbar horizontal margin",DES_toolbarMarginHorizontal:"Horizontal margin of toolbar to viewer edge",TITLE_toolbarMarginVertical:"Toolbar vertical margin",DES_toolbarMarginVertical:"Vertical margin of toolbar to viewer edge",TITLE_enableEdit:"Enable editing",DES_enableEdit:"Whether edit chem object in viewer is enabled",TITLE_modalEdit:"Modal editing",DES_modalEdit:"Using modal dialog or popup dialog to edit chem object"}},Editor:{BaseEditorConfigs:{TITLE_uiMarkerConfigs:"UI marker settings",DES_uiMarkerConfigs:"Settings of interaction marker",TITLE_interactionConfigs:"Interaction settings",DES_interactionConfigs:"Settings about interaction of editor",TITLE_structureConfigs:"Structure settings",DES_structureConfigs:"Settings about creating molecule structure"},ChemSpaceEditorConfigs:{TITLE_chemSpaceConfigs:"Chem space settings",DES_chemSpaceConfigs:"Settings about chem space/chem document",TITLE_styleSetterConfigs:"Style setter settings",DES_styleSetterConfigs:"Settings of style toolbar of editor"},InteractionConfigs:{TITLE_enableHotTrack:"Enable hot track",DES_enableHotTrack:"Whether highlighting objects under mouse position",TITLE_objBoundTrackInflation:"Object bound inflation",DES_objBoundTrackInflation:"Inflates the bound of object to make it easier to select",TITLE_selectionMarkerInflation:"Selection marker inflation",DES_selectionMarkerInflation:"Inflation of object selection mark, makes it easier to see the containing objects",TITLE_selectionMarkerEdgeInflation:"Selection edge inflation",DES_selectionMarkerEdgeInflation:"Inflation when judging if a coord is on selection mark edge",TITLE_constrainedRotateStep:"Constrained rotation step",DES_constrainedRotateStep:null,TITLE_rotationLocationPointDistanceThreshold:"Rotation starting min distance",DES_rotationLocationPointDistanceThreshold:"Rotation will occur only when mouse point distance (from rotation center) larger than this value",TITLE_directedMoveDistanceThreshold:"Direct move min distance",DES_directedMoveDistanceThreshold:"Direct moving will only be done if moved distance large than this value",TITLE_enablePartialAreaSelecting:"Enable partial selecting",DES_enablePartialAreaSelecting:"If this value is true, when drag a selecting rubber band, object partly in the band will be totally selected",TITLE_atomSetterFontSize:"Atom setter font size",DES_atomSetterFontSize:"Font size of atom setter",TITLE_clonedObjectScreenOffset:"Copied object coord offset",DES_clonedObjectScreenOffset:"The distance between copied objects and origin objects when doing paste selection action in editor"},UiMarkerConfigs:{TITLE_hotTrackerColor:"Hot track mark color",DES_hotTrackerColor:"Color of hot track mark",TITLE_hotTrackerOpacity:"Hot track mark opacity",DES_hotTrackerOpacity:"Opacity of hot track marker, value from 0 to 1",TITLE_selectionMarkerStrokeColor:"Selection mark stroke color",DES_selectionMarkerStrokeColor:"Stroke color of selection mark",TITLE_selectionMarkerStrokeWidth:"Selection mark stroke width",DES_selectionMarkerStrokeWidth:"Width of selection mark stroke",TITLE_selectionMarkerFillColor:"Selection mark fill color",DES_selectionMarkerFillColor:"Fill color of selection mark.",TITLE_selectionMarkerOpacity:"Selection mark opacity",DES_selectionMarkerOpacity:"Opacity of selection mark, value from 0 to 1",TITLE_selectingMarkerStrokeColor:"Selecting mark stroke color",DES_selectingMarkerStrokeColor:"Stroke color of selecting rubber band mark",TITLE_selectingMarkerStrokeWidth:"Selecting mark stroke width",DES_selectingMarkerStrokeWidth:"Stroke width of selection rubber band",TITLE_selectingMarkerStrokeDash:"Selecting mark dash style",DES_selectingMarkerStrokeDash:"Dash style of selecting rubber band",TITLE_selectingMarkerFillColor:"Selecting mark fill color",DES_selectingMarkerFillColor:"Fill color of selecting mark. Usually this value should be left blank (not filled)",TITLE_selectingMarkerOpacity:"Selecting mark opacity",DES_selectingMarkerOpacity:"Opacity of selecting mark, value from 0 to 1",},StructureConfigs:{TITLE_defBondType:"Default bond type",DES_defBondType:"Default type of bond",TITLE_defBondOrder:"Default bond order",DES_defBondOrder:"Default bond order",TITLE_defBondLength:"Default bond length",DES_defBondLength:"Default bond length",TITLE_defIsotopeId:"Default isotope",DES_defIsotopeId:"Default isotope when adding a new atom"},ChemSpaceConfigs:{TITLE_defScreenSize2D:"Default 2D screen size",TITLE_defScreenSize3D:"Default 3D screen size",TITLE_defPadding:"Default padding",DES_defPadding:"Padding on top when adding an unpositioned object to container chem space"},BaseEditor:{TITLE_enableCreateNewDoc:"Enable create new document",DES_enableCreateNewDoc:"Whether creating a new document is allowed",TITLE_initOnNewDoc:"Starts with a new document",DES_initOnNewDoc:"Whether create a new document automatically when composer is initialized",TITLE_enableOperHistory:"Enable undo",DES_enableOperHistory:"Whether undo/redo is enabled"},Composer:{TITLE_enableStyleToolbar:"Enable style toolbar",DES_enableStyleToolbar:"Whether display style toolbar to set color, font and size of objects",TITLE_allowCreateNewChild:"Enable create new child object",DES_allowCreateNewChild:"Whether new direct child of document can be created"}}};Kekule.LOCAL_RES=true;Object.extend(Kekule.ErrorMsg,{OpenBabel:{CHEM_NODE_TYPE_NOT_SUITABLE:"Unsuitable node type",CHEM_CONNECTOR_TYPE_NOT_SUITABLE:"Unsuitable connector type",ONLY_STR_INPUT_DATA_ALLOWED:"Input data must be text",ONLY_STR_OUTPUT_DATA_ALLOWED:"Output data must be text"}});"use strict";(function(){var b=Kekule.OBJDEF_TEXTS;if(Kekule.PROP_AUTO_TITLE){var c=ClassEx.getPrototype(ObjectEx).defineProp;var a=function(i,f){if(!f.title&&!f.description){var g=this.getClassName();if(g.startsWith("Kekule.")){g=g.substr(7)}var d=Object.getCascadeFieldValue(g,b);if(d){var e=b.TITLE_PREFIX+i;var h=b.DESCRIPTION_PREFIX+i;f.title=d[e];f.description=d[h]}}return c.apply(this,[i,f])};ClassEx.getPrototype(ObjectEx).defineProp=a}Kekule.ExceptionLevel={ERROR:-1,WARNING:-2,NOTE:-3,LOG:-4};Kekule.throwException=function(g,d){if(Kekule.exceptionHandler){return Kekule.exceptionHandler.throwException(g,d)}else{var f=Kekule.ExceptionLevel;if((!d)||(d===f.ERROR)){if(typeof(g)==="string"){g=new Kekule.Exception(g)}throw g}else{if(typeof(console)!=="undefined"){if(typeof(g)!=="string"){g=g.message}var h=(d===f.WARNING)?console.warn:(d===f.NOTE)?console.info:console.log;if(h){h(g)}else{console.log(g)}}}}};Kekule.getExceptionMsg=function(d){if(typeof(d)==="string"){return d}else{if(typeof(d)==="object"){return d.message}else{return""}}};Kekule.raise=Kekule.throwException;Kekule.error=function(d){return Kekule.raise(d,Kekule.ExceptionLevel.ERROR)};Kekule.chemError=function(d){if(typeof(d)=="string"){d=new Kekule.ChemError(d)}return Kekule.error(d)};Kekule.warn=function(d){return Kekule.raise(d,Kekule.ExceptionLevel.WARNING)};Kekule.notify=function(d){return Kekule.raise(d,Kekule.ExceptionLevel.NOTE)};Kekule.log=function(d){return Kekule.raise(d,Kekule.ExceptionLevel.LOG)};Kekule.hasLocalRes=function(){return !!Kekule.LOCAL_RES};Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(d){return this.PROP_NAME_PREFIX+d},has:function(d){return this._map.hasOwnProperty(this.keyToPropName(d))},set:function(d,e){this._map[this.keyToPropName(d)]=e;return this},get:function(e,d){var f=this.keyToPropName(e);if(this._map.hasOwnProperty(f)){return this._map[f]}else{return d}},remove:function(d){var e=this.keyToPropName(d);if(this._map.hasOwnProperty(e)){delete this._map[e]}return this},clear:function(){this._map={}}});Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(d){this.isWeak=!d;if(!Kekule.MapEx._inited){Kekule.MapEx._init()}if((!Kekule.MapEx._implementation)||(!this.isWeak)){this.keys=[];this.values=[]}else{this._implementation=new Kekule.MapEx._implementation()}},finalize:function($super){if(!this._implementation){this.keys=null;this.values=null}},set:function(e,f){if(this._implementation){this._implementation.set(e,f)}else{var d=this.keys.indexOf(e);if(d>=0){this.values[d]=f}else{this.keys.push(e);this.values.push(f)}}return this},get:function(f,d){if(this._implementation){return this._implementation.get(f,d)}else{var e=this.keys.indexOf(f);if(e>=0){return this.values[e]}else{return d}}},has:function(e){if(this._implementation){return this._implementation.has(e)}else{var d=this.keys.indexOf(e);return d>=0}},remove:function(e){if(this._implementation){return this._implementation["delete"](e)}else{var d=this.keys.indexOf(e);if(d>=0){this.keys.splice(d,1);this.values.splice(d,1)}}return this},clear:function(){if(!this._implementation){this.keys=[];this.values=[]}else{Kekule.error(Kekule.ErrorMsg.CANNOT_CLEAR_WEAKMAP)}return this},getKeys:function(){if(!this._implementation){return[].concat(this.keys)}else{Kekule.error(Kekule.ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP);return[]}},getValues:function(){if(!this._implementation){return this.values}else{Kekule.error(Kekule.ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP);return[]}}});Kekule.MapEx._init=function(){if($jsRoot.WeakMap){Kekule.MapEx._implementation=$jsRoot.WeakMap}else{Kekule.MapEx._implementation=null}Kekule.MapEx._inited=true};Kekule.MapEx._inited=false;Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(d){this.nonWeak=d;this.map=new Kekule.MapEx(d)},finalize:function(){this.map.finalize()},getSecondLevelMap:function(e,f){var d=this.map.get(e);if((!d)&&f){d=new Kekule.MapEx(this.nonWeak);this.map.set(e,d)}return d},set:function(e,d,f){var g=this.getSecondLevelMap(e,true);g.set(d,f);return this},get:function(f,e,d){var g=this.getSecondLevelMap(f,false);if(g){return g.get(e,d)}else{return d}},has:function(e,d){var f=this.getSecondLevelMap(e,false);if(f){return f.has(d)}else{return false}},remove:function(e,d){var f=this.getSecondLevelMap(e,false);if(f){return f.remove(d)}},clear:function(){this.map.clear()}});Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3};Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(e,d){if(e===Kekule.CoordMode.COORD3D){return this.getSize3D(d)}else{return this.getSize2D(d)}},setSizeOfMode:function(e,d){if(d===Kekule.CoordMode.COORD3D){return this.setSize3D(e)}else{return this.setSize2D(e)}},getBoxOfMode:function(e,d){if(e===Kekule.CoordMode.COORD3D){return this.getBox3D(d)}else{return this.getBox2D(d)}}},Size2DMethods:{fetchSize2D:function(){var d=this.getPropStoreFieldValue("size2D");if(!d){d={};this.setPropStoreFieldValue("size2D",d)}return d},notifySize2DChanged:function(d){this.notifyPropSet("size2D",d)},hasSize2D:function(e){var f=this.getPropStoreFieldValue("size2D");var d=(f)&&((typeof(f.x)!="undefined")||(typeof(f.y)!="undefined"));if((!d)&&e){d=this.hasSize3D?this.hasSize3D():false}return d},getBox2D:function(d){var g=this.getCoord2D(d)||{x:0,y:0};var e=this.getSize2D(d);if(e&&(e.x||e.y)){var h={x:e.x,y:-e.y};var f=Kekule.CoordUtils.add(g,h);return{x1:g.x,y1:g.y,x2:f.x,y2:f.y}}else{return{x1:g.x,y1:g.y,x2:g.x,y2:g.y}}},get2DSizeX:function(d){var e=this.getSize2D(d);return e?e.x||0:0},set2DSizeX:function(d){var e=fetchSize2D();if(e.x!=d){e.x=d;notifySize2DChanged(e)}},get2DSizeY:function(d){var e=this.getSize2D(d);return e?e.y||0:0},set2DSizeY:function(e){var d=fetchSize2D();if(d.y!=e){d.y=e;notifySize2DChanged(d)}}},Size3DMethods:{fetchSize3D:function(){var d=this.getPropStoreFieldValue("size3D");if(!d){d={};this.setPropStoreFieldValue("size3D",d)}return d},notifySize3DChanged:function(d){this.notifyPropSet("size3D",d)},hasSize3D:function(e){var f=this.getPropStoreFieldValue("size3D");var d=(f)&&((typeof(f.x)!=="undefined")||(typeof(f.y)!=="undefined")||(typeof(f.z)!=="undefined"));if((!d)&&e){d=this.hasSize2D?this.hasSize2D():false}return d},getBox3D:function(d){var g=this.getCoord3D(d);var e=this.getSize3D(d);if(g&&e){var f=Kekule.CoordUtils.add(g,e);return{x1:g.x,y1:g.y,z1:g.z,x2:f.x,y2:f.y,z2:f.z}}},get3DSizeX:function(d){var e=this.getSize3D(d);return e?e.x||0:0},set3DSizeX:function(d){var e=fetchSize3D();if(e.x!=d){e.x=d;notifySize3DChanged(e)}},get3DSizeY:function(d){var e=this.getSize3D(d);return e?e.y||0:0},set3DSizeY:function(e){var d=fetchSize3D();if(d.y!=e){d.y=e;notifySize3DChanged(d)}},get3DSizeZ:function(d){var e=this.getSize3D(d);return e?e.z||0:0},set3DSizeZ:function(d){var e=fetchSize3D();if(e.z!=d){e.z=d;notifySize3DChanged(e)}}},addStandardSizeSupport:function(e,d){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonSizeMethods);if((!d)||(d.indexOf("size2D")>=0)){ClassEx.defineProp(e,"size2D",{dataType:DataType.HASH,getter:function(g,h){var i=this.getPropStoreFieldValue("size2D");if((!i)&&g){if(this.hasSize3D()){i=this.getSize3D()}}if((!i)&&h){i={x:0,y:0};this.setPropStoreFieldValue("size2D",i)}var f=i?{x:i.x,y:i.y}:undefined;return f},setter:function(f){var g=this.fetchSize2D();if(f.x!==undefined){g.x=f.x}if(f.y!==undefined){g.y=f.y}this.notifySize2DChanged(g)}});ClassEx.extend(e,Kekule.ClassDefineUtils.Size2DMethods)}if((!d)||(d.indexOf("size3D")>=0)){ClassEx.defineProp(e,"size3D",{dataType:DataType.HASH,getter:function(g,h){var i=this.getPropStoreFieldValue("size3D");if((!i)&&g){if(this.hasSize2D()){i=this.getSize2D();i.z=0}}if((!i)&&h){i={x:0,y:0,z:0};this.setPropStoreFieldValue("size3D",i)}var f=i?{x:i.x,y:i.y,z:i.z}:undefined;return f},setter:function(f){var g=this.fetchSize3D();if(f.x!==undefined){g.x=f.x}if(f.y!==undefined){g.y=f.y}if(f.z!==undefined){g.z=f.z}this.notifySize3DChanged(g)}});ClassEx.extend(e,Kekule.ClassDefineUtils.Size3DMethods)}},CommonCoordMethods:{getCoordOfMode:function(e,d){if(e===Kekule.CoordMode.COORD3D){return this.getCoord3D(d)}else{return this.getCoord2D(d)}},setCoordOfMode:function(e,d){if(d===Kekule.CoordMode.COORD3D){return this.setCoord3D(e)}else{return this.setCoord2D(e)}},getAbsCoordOfMode:function(e,d){if(e===Kekule.CoordMode.COORD3D){return this.getAbsCoord3D(d)}else{return this.getAbsCoord2D(d)}},setAbsCoordOfMode:function(e,d){if(d===Kekule.CoordMode.COORD3D){return this.setAbsCoord3D(e)}else{return this.setAbsCoord2D(e)}}},Coord2DMethods:{fetchCoord2D:function(){var d=this.getPropStoreFieldValue("coord2D");if(!d){d={};this.setPropStoreFieldValue("coord2D",d)}return d},notifyCoord2DChanged:function(d){this.notifyPropSet("coord2D",d)},hasCoord2D:function(e){var f=this.getPropStoreFieldValue("coord2D");var d=(f)&&((typeof(f.x)!="undefined")||(typeof(f.y)!="undefined"));if((!d)&&e){d=this.hasCoord3D?this.hasCoord3D():false}return d},get2DX:function(d){var e=this.getCoord2D(d);return e?e.x||0:0},set2DX:function(d){var e=fetchCoord2D();if(e.x!=d){e.x=d;notifyCoord2DChanged(e)}},get2DY:function(d){var e=this.getCoord2D(d);return e?e.y||0:0},set2DY:function(e){var d=fetchCoord2D();if(d.y!=e){d.y=e;notifyCoord2DChanged(d)}}},Coord3DMethods:{fetchCoord3D:function(){var d=this.getPropStoreFieldValue("coord3D");if(!d){d={};this.setPropStoreFieldValue("coord3D",d)}return d},notifyCoord3DChanged:function(d){this.notifyPropSet("coord3D",d)},hasCoord3D:function(e){var f=this.getPropStoreFieldValue("coord3D");var d=(f)&&((typeof(f.x)!="undefined")||(typeof(f.y)!="undefined")||(typeof(f.z)!="undefined"));if((!d)&&e){d=this.hasCoord2D?this.hasCoord2D():false}return d},get3DX:function(d){var e=this.getCoord3D(d);return e?e.x||0:0},set3DX:function(d){var e=fetchCoord3D();if(e.x!=d){e.x=d;notifyCoord3DChanged(e)}},get3DY:function(d){var e=this.getCoord3D(d);return e?e.y||0:0},set3DY:function(e){var d=fetchCoord3D();if(d.y!=e){d.y=e;notifyCoord3DChanged(d)}},get3DZ:function(d){var e=this.getCoord3D(d);return e?e.z||0:0},set3DZ:function(d){var e=fetchCoord3D();if(e.z!=d){e.z=d;notifyCoord3DChanged(e)}}},addStandardCoordSupport:function(e,d){ClassEx.extend(e,Kekule.ClassDefineUtils.CommonCoordMethods);if((!d)||(d.indexOf("coord2D")>=0)){ClassEx.defineProp(e,"coord2D",{dataType:DataType.HASH,getter:function(g,h){var i=this.getPropStoreFieldValue("coord2D");if((!i)&&g){if(this.hasCoord3D()){i=this.getCoord3D()}}if((!i)&&h){i={x:0,y:0};this.setPropStoreFieldValue("coord2D",i)}var f=i?{x:i.x,y:i.y}:undefined;return f},setter:function(f){var g=this.fetchCoord2D();if(f.x!==undefined){g.x=f.x}if(f.y!==undefined){g.y=f.y}this.notifyCoord2DChanged(g)}});ClassEx.extend(e,Kekule.ClassDefineUtils.Coord2DMethods)}if((!d)||(d.indexOf("coord3D")>=0)){ClassEx.defineProp(e,"coord3D",{dataType:DataType.HASH,getter:function(g,h){var i=this.getPropStoreFieldValue("coord3D");if((!i)&&g){if(this.hasCoord2D()){i=this.getCoord2D();i.z=0}}if((!i)&&h){i={x:0,y:0,z:0};this.setPropStoreFieldValue("coord3D",i)}var f=i?{x:i.x,y:i.y,z:i.z}:undefined;return f},setter:function(f){var g=this.fetchCoord3D();if(f.x!==undefined){g.x=f.x}if(f.y!==undefined){g.y=f.y}if(f.z!==undefined){g.z=f.z}this.notifyCoord3DChanged(g)}});ClassEx.extend(e,Kekule.ClassDefineUtils.Coord3DMethods)}if((!d)||(d.indexOf("absCoord2D")>=0)){ClassEx.defineProp(e,"absCoord2D",{dataType:DataType.HASH,serializable:false,getter:function(g){var i=this.getCoord2D(g)||{};var h=this.getParent?this.getParent():null;var f;if(h&&h.getAbsCoord2D){return Kekule.CoordUtils.add(i,h.getAbsCoord2D(g)||{})}else{return Object.extend({},i)}},setter:function(f){var g=f;if(this.getParent&&this.getParent()&&this.getParent().getAbsCoord2D){g=Kekule.CoordUtils.substract(f,this.getParent().getAbsCoord2D())}this.setCoord2D(g)}})}if((!d)||(d.indexOf("absCoord3D")>=0)){ClassEx.defineProp(e,"absCoord3D",{dataType:DataType.HASH,serializable:false,getter:function(f){var h=this.getCoord3D(f)||{};var g=this.getParent?this.getParent():null;if(g&&g.getAbsCoord3D){return Kekule.CoordUtils.add(h,g.getAbsCoord3D(f)||{})}else{return Object.extend({},h)}},setter:function(f){var g=f;if(this.getParent&&this.getParent()){g=Kekule.CoordUtils.substract(f,this.getParent().getAbsCoord3D())}this.setCoord3D(g)}})}},ExtraObjMapMethods:{getExtraProp:function(f,d){var e=this.getExtraObjMap().get(f);if(e){return d?e[d]:e}else{return undefined}},setExtraProp:function(f,d,g){var e=this.getExtraProp(f);if(e){e[d]=g}else{var e={};e[d]=g;this.getExtraObjMap().set(f,e)}},removeExtraProp:function(f,d){if(d){var e=this.getExtraProp(f);e[d]=undefined;delete e[d]}else{this.getExtraObjMap().remove(f)}}},addExtraObjMapSupport:function(e){var d="extraObjMap";ClassEx.defineProp(e,d,{dataType:"Kekule.MapEx",serializable:false,getter:function(){var f=this.getPropStoreFieldValue(d);if(!f){f=new Kekule.MapEx(true);this.setPropStoreFieldValue(d,f)}return f}});ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(g,f,d){var e=this.getExtraTwoTupleObjMap().get(g,f);if(e){return d?e[d]:e}else{return undefined}},setExtraProp2:function(h,f,d,g){var e=this.getExtraProp2(h,f);if(e){e[d]=g}else{var e={};e[d]=g;this.getExtraTwoTupleObjMap().set(h,f,e)}},removeExtraProp2:function(g,f,d){if(d){var e=this.getExtraProp2(g,f);e[d]=undefined;delete e[d]}else{this.getExtraTwoTupleObjMap().remove(g,f)}}},addExtraTwoTupleObjMapSupport:function(e){var d="extraTwoTupleObjMap";ClassEx.defineProp(e,d,{dataType:"Kekule.TwoTupleMapEx",serializable:false,getter:function(){var f=this.getPropStoreFieldValue(d);if(!f){f=new Kekule.TwoTupleMapEx(true);this.setPropStoreFieldValue(d,f)}return f}});ClassEx.extend(e,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}};Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(true),register:function(d,e){Kekule.ObjPropSettingManager._items.set(d,e)},unregister:function(d){Kekule.ObjPropSettingManager._items.remove(d)},getSetting:function(d){return Kekule.ObjPropSettingManager._items.get(d)}};ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(h){var e=this.getClass();var g=null;var d="";while(e&&!g){var f=ClassEx.getClassName(e);var d=f+"."+h;var g=Kekule.ObjPropSettingManager.getSetting(d);e=ClassEx.getSuperClass(e)}if(!g){g=Kekule.ObjPropSettingManager.getSetting(h);d=h}if(g){this.setPropValues(g);this.setPropStoreFieldValue("predefinedSetting",d)}}});Kekule.ChemObjInteractMode={DEFAULT:0,HIDDEN:-1};Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function($super,d){$super();if(d){this.setId(d)}this.setBubbleEvent(true)},doFinalize:function($super){this.removeSelf();$super()},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING});this.defineProp("interactMode",{dataType:DataType.INT});this.defineProp("info",{dataType:DataType.HASH,getter:function(e){var d=this.getPropStoreFieldValue("info");if((!d)&&e){d={};this.setPropStoreFieldValue("info",d)}return d}});this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null});this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(e){var d=this.getParent();if(d===e){return}if(d&&d._removeChildObj){d._removeChildObj(this)}this.setPropStoreFieldValue("parent",e);if(e&&e._appendChildObj){e._appendChildObj(this)}this.parentChanged(e)}});this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(e){var d=this.getOwner();if(d===e){return}if(d){d._removeOwnedObj(this)}this.setPropStoreFieldValue("owner",e);if(e){e._appendOwnedObj(this)}this.ownerChanged(e)}});this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLISHED,getter:function(){var d=this.getPropStoreFieldValue("srcInfo");if(!d){d={};this.setPropStoreFieldValue("srcInfo",d)}return d}})},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},isSelectable:function(){return this.getInteractMode()!==Kekule.ChemObjInteractMode.HIDDEN},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},removeSelf:function(){this.setParent(null);this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},ownerChanged:function(e){for(var f=0,d=this.getScalarAttribCount();f<d;++f){this.getScalarAttribAt(f).setOwner(e)}},parentChanged:function(d){},isChildOf:function(e){var d=this.getParent();while(d&&(d!==e)){d=d.getParent?d.getParent():null}return(!!d)},getNextSibling:function(){var d=this.getParent();if(d&&d.getNextSiblingOfChild){return d.getNextSiblingOfChild(this)}else{return null}},getChildCount:function(){return 0},getChildAt:function(d){return null},indexOfChild:function(d){return -1},isEmpty:function(){return false},clearIds:function(){this.setId(null);for(var e=0,d=this.getChildCount();e<d;++e){var f=this.getChildAt(e);if(f.clearIds){f.clearIds()}}},assignTo:function($super,f,e){var d=$super(f);if(!e&&f.clearIds){f.clearIds()}return d},assign:function(e,d){return e.assignTo(this,d)},clone:function(e){var f=this.getClass();var d=new f();this.assignTo(d,e);return d},getScalarAttribCount:function(){var d=this.getScalarAttribs();return d?d.length:0},getScalarAttribAt:function(e){var d=this.getScalarAttribs();return d?d[e]:null},appendScalarAttrib:function(d){if(!this.getScalarAttribs()){this.setPropStoreFieldValue("scalarAttribs",[])}var e=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),d);if(e.isPushed){d.setParent(this);this.notifyScalarAttribsChange()}return e.index},removeScalarAttribAt:function(d){if(!this.getScalarAttribs()){return null}else{var e=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),d);if(e){e.setParent(null);this.notifyScalarAttribsChange()}return e}},removeScalarAttrib:function(d){if(!this.getScalarAttribs()){return null}else{var e=Kekule.ArrayUtils.remove(this.getScalarAttribs(),d);if(e){e.setParent(null);this.notifyScalarAttribsChange()}return e}},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(d){return this.getInfo()?this.getInfo()[d]:null},setInfoValue:function(d,e){this.doGetInfo(true)[d]=e;this.notifyInfoChange()}});Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function($super,g,d,f,e){$super(g);if(d){this.setName(d)}if(typeof(f)!=="undefined"){this.setValue(f)}if(e){this.setUnit(e)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING});this.defineProp("value",{dataType:DataType.PRIMARY});this.defineProp("errorValue",{dataType:DataType.PRIMARY});this.defineProp("unit",{dataType:DataType.STRING});this.defineProp("title",{dataType:DataType.STRING})}});Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function($super,e,d){$super(e);this.setPropStoreFieldValue("itemBaseClass",d)},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(e){var d=this.getPropStoreFieldValue("items");if((!d)&&e){d=[];this.setPropStoreFieldValue("items",d)}return d}})},loaded:function($super){this.ownerChanged(this.getOwner());this.parentChanged(this.getParent())},ownerChanged:function($super,d){this.changeAllItemsOwner();$super(d)},parentChanged:function($super,d){this.changeAllItemsParent();$super(d)},isEmpty:function(){return result&&(this.getItemCount()<=0)},checkItemType:function(e){var f=this.getItemBaseClass();var d=f?e instanceof f:true;if(!d){Kekule.raise(Kekule.ErrorMsg.LIST_ITEM_CLASS_MISMATCH)}return d},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var f=this.getItems();if(f){var d=this.getItemOwner();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h&&h.setOwner){h.setOwner(d)}}}},getItemParent:function(){return this.getParent()||this},changeAllItemsParent:function(){var e=this.getItems();if(e){var g=this.getItemParent();for(var f=0,d=e.length;f<d;++f){var h=e[f];if(h&&h.setParent){h.setParent(g)}}}},getItemCount:function(){var d=this.getPropStoreFieldValue("items");return d?d.length:0},getItemAt:function(e){var d=this.getPropStoreFieldValue("items");return d?d[e]:null},indexOf:function(e){var d=this.getPropStoreFieldValue("items");return d?d.indexOf(e):-1},getNextSiblingOfChild:function(e){var d=this.indexOf(e);return(d>=0)?this.getItemAt(d+1):null},append:function(e){this.checkItemType(e);if(e){var d=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(true),e);if(d.isPushed){this.notifyItemsChange();if(e.setOwner){e.setOwner(this.getItemOwner())}if(e.setParent){e.setParent(this.getItemParent())}}return d.index}else{return -1}},insert:function(f,d){this.checkItemType(f);if(f){var e=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(true),f,d);if(e.isInserted){this.notifyItemsChange();if(f.setOwner){f.setOwner(this.getItemOwner())}if(f.setParent){f.setParent(this.getItemParent())}}return e.index}else{return -1}},insertBefore:function(f,d){if(!d){return this.append(f)}else{var e=this.indexOf(d);return(e>=0)?this.insert(f,e):this.append(f)}},removeAt:function(d){if(this.getItems()){var e=Kekule.ArrayUtils.removeAt(this.getItems(),d);if(e){if(e.setOwner){e.setOwner(null)}if(e.setParent){e.setParent(null)}this.notifyItemsChange()}return e}},remove:function(e){if(this.getItems()){var d=Kekule.ArrayUtils.remove(this.getItems(),e);if(d){if(d.setOwner){d.setOwner(null)}if(d.setParent){d.setParent(null)}this.notifyItemsChange()}return d}},removeChild:function(d){return this.remove(d)},toArray:function(){return this.getItems()}});Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function($super,e){$super(e);var d=new Kekule.ChemObjList(null,Kekule.ChemObject);d.setParent(this);d.addEventListener("change",function(){this.objectChange(["children"])},this);this.setPropStoreFieldValue("children",d)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(e){var d=this.getChildren();if(d){d.finalize()}if(e){e.setParent(this);e.setOwner(this.getOwner())}this.setPropStoreFieldValue("children",e)}})},ownerChanged:function($super,d){this.getChildren().setOwner(d)},_removeChildObj:function(e){var d=this.indexOfChild(e);if(d>=0){this.removeChildAt(d)}},getChildCount:function(){return this.getChildren().getItemCount()},getChildAt:function(d){return this.getChildren().getItemAt(d)},indexOfChild:function(d){return this.getChildren().indexOf(d)},getNextSiblingOfChild:function(d){return this.getChildren().getNextSiblingOfChild(d)},appendChild:function(d){return this.getChildren().append(d)},insertChild:function(e,d){return this.getChildren().insert(e,d)},insertBefore:function(e,d){return this.getChildren().insertBefore(e,d)},removeChildAt:function(d){return this.getChildren().removeChildAt(d)},removeChild:function(d){return this.getChildren().removeChild(d)}});Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function($super,e){$super(e);this._autoIdMap={};this.setPropStoreFieldValue("enableAutoId",true);this.setPropStoreFieldValue("ownedObjs",[]);var d=new Kekule.ChemSpaceElement();this.setPropStoreFieldValue("root",d);d.setParent(this);d.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null});this.defineProp("enableAutoId",{dataType:DataType.BOOL});this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var d=this.getPropStoreFieldValue("screenSize")||{};return{x:d.x,y:d.y}},setter:function(d){var e=this.getPropStoreFieldValue("screenSize");if(!e){e={};this.setPropStoreFieldValue("screenSize",e)}e.x=d.x;e.y=d.y}})},loaded:function($super){$super();var d=this.getRoot();if(d){d.setParent(this);d.setOwner(this)}},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildCount:function(){return this.getRoot().getChildCount()},getChildAt:function(d){return this.getRoot().getChildAt(d)},indexOfChild:function(d){return this.getRoot().indexOfChild(d)},getNextSiblingOfChild:function(d){return this.getRoot().getNextSiblingOfChild(d)},appendChild:function(d){return this.getRoot().appendChild(d)},insertChild:function(e,d){return this.getRoot().insertChild(e,d)},insertBefore:function(e,d){return this.getRoot().insertBefore(e,d)},removeChildAt:function(d){return this.getRoot().removeChildAt(d)},removeChild:function(d){return this.getRoot().removeChild(d)},getObjById:function(g){for(var e=0,d=this.getOwnedObjCount();e<d;++e){var f=this.getOwnedObjAt(e);if(f.getId){if(f.getId()==g){return f}}}return null},getAutoId:function(g,e){var f;if(g){f=g.getAutoIdPrefix?g.getAutoIdPrefix():"o"}else{f="o"}var f=g.getAutoIdPrefix?g.getAutoIdPrefix():"o";var d;if(Kekule.ObjUtils.notUnset(e)){d=e}else{d=this._autoIdMap[f]||0;++d}var d=this._getAutoIdIndex(f,d);this._autoIdMap[f]=d;return f+Number(d).toString()},_getAutoIdIndex:function(f,e){var h=e||0;var d=h;var g=f+Number(d).toString();while(this.getObjById(g)){++d;g=f+Number(d).toString()}return d},assignAutoIdToObj:function(d){if(d.setId){var e=this.getAutoId(d);d.setId(e)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(d){return this.getOwnedObjs()[d]},indexOfOwnedObj:function(d){return this.getOwnedObjs().indexOf(d)},_appendOwnedObj:function(d){if(this.indexOfOwnedObj(d)>=0){return}else{if(this.getEnableAutoId()){if(d.getId&&!d.getId()){this.assignAutoIdToObj(d)}}this.getOwnedObjs().push(d);this.notifyOwnedObjsChange()}},_removeOwnedObjAt:function(d){var e=this.getOwnedObjAt(d);if(e){this.getOwnedObjs().splice(d,1);this.notifyOwnedObjsChange()}},_removeOwnedObj:function(e){var d=this.getOwnedObjs().indexOf(e);if(d>=0){this._removeOwnedObjAt(d)}}});Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace);Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){}})})();Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(b,a){var c={exception:b,level:a};this.invokeEvent("exceptionThrown",c);return c},throwException:function(d,b){var c=Kekule.ExceptionLevel;if(!b){b=c.ERROR}var g=this.notifyExceptionThrown(d,b||c.ERROR);if(!g.stop){if((!b)||(b===c.ERROR)){var a=d;if(typeof(d)==="string"){a=new Kekule.Exception(d)}throw a}else{if(typeof(console)!=="undefined"){if(typeof(d)!=="string"){d=d.message}var f=(b===c.WARNING)?"warn":(b===c.NOTE)?"info":"log";if(f){console[f](d)}else{console.log(d)}}}}},raise:function(b,a){return this.throwException(b,a||Kekule.ExceptionLevel.ERROR)}});Kekule.ExceptionHandler.getInstance=function(){if(!this.instance){this.instance=new Kekule.ExceptionHandler()}return this.instance};Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance();Kekule.Exception=function(b,a){this.message=b;this.name=a};Kekule.Exception.prototype=new Error();Kekule.Exception.prototype.constructor=Kekule.Exception;Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}});Kekule.Error=function(b,a){this.message=b;this.name=a};Kekule.Error.prototype=Kekule.Exception.prototype;Kekule.Error.prototype.constructor=Kekule.Error;Kekule.ChemError=function(b,a){this.message=b;this.name=a};Kekule.ChemError.prototype=Kekule.Error.prototype;Kekule.ChemError.prototype.constructor=Kekule.ChemError;if(typeof(console)=="undefined"){console={log:function(){},warn:function(){},info:function(){},error:function(){}}}Kekule.AbstractConfigs=Class.create(ObjectEx,{CLASS_NAME:"Kekule.AbstractConfigs",CONFIG_PROP_FLAG:"__$config_prop__",initialize:function($super,a){$super();if(typeof(a)=="undefined"){a=true}if(a){this.initPropDefValues()}},addConfigProp:function(e,c,b,f){var d={dataType:c};if(f){d=Object.extend(d,f)}if(typeof(b)!="undefined"){d.defaultValue=b}var a=this.defineProp(e,d);a[this.CONFIG_PROP_FLAG]=true;return a},addHashConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.HASH,a,c)},addStrConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.STRING,a,c)},addNumConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.NUM,a,c)},addIntConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.INT,a,c)},addFloatConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.FLOAT,a,c)},addBoolConfigProp:function(b,a,c){return this.addConfigProp(b,DataType.BOOL,a,c)},initPropDefValues:function(){this.beginUpdate();try{var c=this.getAllPropList();for(var b=0,a=c.getLength();b<a;++b){var f=c.getPropInfoAt(b);var e=f.name;var d=f.defaultValue;if(typeof(d)!="undefined"){this.setPropValue(e,d)}}}finally{this.endUpdate()}},assign:function(a){a.copyPropsTo(this)},toHash:function(){var b={};var a=this.CONFIG_PROP_FLAG;this.saveObj(b,"json",{saveDefaultValues:true,propFilter:function(d,c){return d[a]}});return b}});Kekule.ConfigPresetMap=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ConfigPresetMap",initialize:function($super){$super();this.map=new Kekule.MapEx(true)},doFinalize:function($super){this.map=null;$super()},set:function(a,b){this.map.set(a,b)},get:function(a){return this.map.get(a)},getHash:function(a){var b=this.get(a);if(b){if(b.toHash){return b.toHash()}else{return b}}else{return null}},remove:function(a){this.map.remove(a)},has:function(a){return this.map.has(a)},clear:function(){this.map.clear()}});Kekule.ElementSeries={NONMETAL:"Nonmetals",METAL:"Metals",ALKALI_METAL:"Alkali Metals",ALKALI_EARTH_METAL:"Alkali Earth Metals",TRANSITION_METAL:"Transition Metals",METALLOID:"Metalloids",HALOGEN:"Halogens",NOBLE_GAS:"Noble Gases",LANTHANIDE:"Lanthanides",ACTINIDE:"Actinides"};Kekule.Element=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Element",initialize:function($super,a){$super();if(a!=Kekule.Element.UNSET_ELEMENT){var b=this.getElementInfo(a);if(b){this.setPropStoreFieldValue("symbol",b.symbol);this.setPropStoreFieldValue("atomicNumber",b.atomicNumber);this.setPropStoreFieldValue("group",b.group);this.setPropStoreFieldValue("period",b.period);this.setPropStoreFieldValue("series",b.chemicalSerie);if(b.name){this.setPropStoreFieldValue("name",b.name)}}else{Kekule.chemError(Kekule.hasLocalRes()?Kekule.ErrorMsg.INVALID_CHEMELEMENT+": "+a:"Invalid chemical element: "+a)}}else{this.setPropStoreFieldValue("symbol",Kekule.Element.UNSET_ELEMENT);this.setPropStoreFieldValue("atomicNumber",Kekule.Element.UNSET_ELEMENT)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("atomicNumber",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("symbol",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("group",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("period",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("series",{dataType:DataType.STRING,serializable:false,setter:null})},getElementInfo:function(a){if(a==Kekule.Element.UNSET_ELEMENT){return{symbol:Kekule.Element.UNSET_ELEMENT,atomicNumber:Kekule.Element.UNSET_ELEMENT}}if(Kekule.Element.isDummyElement(a)){return{symbol:Kekule.Element.DUMMY_ELEMENT,atomicNumber:Kekule.Element.DUMMY_ELEMENT_ATOMICNUM}}else{if(Kekule.Element.isRGroup(a)){return{symbol:Kekule.Element.RGROUP_ELEMENT,atomicNumber:Kekule.Element.RGROUP_ELEMENT_ATMOICNUM}}else{return Kekule.ChemicalElementsDataUtil.getElementInfo(a)}}},getTheoreticValence:function(){if(this.getGroup()){return Kekule.Element.getTheoreticValenceOfGroup(this.getGroup())}else{return null}},isDummyElement:function(){return this.getAtomicNumber()==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM},isRGroupElement:function(){return this.getAtomicNumber()==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM},isNormalElement:function(){return Kekule.Element.isNormalElement(this.getAtomicNumber())},isSameElement:function(a){if(a==Kekule.Element.UNSET_ELEMENT){return this.getAtomicNumber()==Kekule.Element.UNSET_ELEMENT}else{if(typeof(a)=="number"){return this.getAtomicNumber()==a}else{return this.getSymbol()==a}}},isHetero:function(){return((this.getSeries()===Kekule.ElementSeries.NONMETAL)||(this.getSeries()===Kekule.ElementSeries.HALOGEN))&&(this.getAtomicNumber()!==6)&&(this.getAtomicNumber()!==1)}});Kekule.Element.UNSET_ELEMENT=undefined;Kekule.Element.DUMMY_ELEMENT="DU";Kekule.Element.DUMMY_ELEMENT_ATOMICNUM=-1;Kekule.Element.RGROUP_ELEMENT="R";Kekule.Element.RGROUP_ELEMENT_ATOMICNUM=-2;Kekule.Element.isNormalElement=function(a){return(a!=Kekule.Element.UNSET_ELEMENT)&&(!Kekule.Element.isPseudoElement(a))};Kekule.Element.isPseudoElement=function(a){if(typeof(a)=="string"){return(a==Kekule.Element.DUMMY_ELEMENT)||(a==Kekule.Element.RGROUP_ELEMENT)}else{return(a==Kekule.Element.DUMMY_ELEMENT_ATOMICNUM)||(a==Kekule.Element.RGROUP_ELEMENT_ATMOICNUM)}};Kekule.Element.isDummyElement=function(a){return(a===Kekule.Element.DUMMY_ELEMENT)||(a===Kekule.Element.DUMMY_ELEMENT_ATOMICNUM)};Kekule.Element.isRGroup=function(a){return(a===Kekule.Element.RGROUP_ELEMENT)||(a===Kekule.Element.RGROUP_ELEMENT_ATOMICNUM)};Kekule.Element.getTheoreticValenceOfGroup=function(a){if(a<=2){return a}else{if(a<=12){return null}else{if(a<=17){return a-10}else{return 0}}}};Kekule.Element.getTheoreticValence=function(a){var b=Kekule.ChemicalElementsDataUtil.getElementInfo(a);return b.group?Kekule.Element.getTheoreticValenceOfGroup(b.group):null};Object.extend(Kekule.Element,{isAtomicNumberAvailable:function(a){return Kekule.ChemicalElementsDataUtil.isAtomicNumberAvailable(a)},isElementSymbolAvailable:function(a){return Kekule.ChemicalElementsDataUtil.isElementSymbolAvailable(a)}});Kekule.Isotope=Class.create(Kekule.Element,{CLASS_NAME:"Kekule.Isotope",initialize:function($super,a,b){$super(a);this.setPropStoreFieldValue("massNumber",b);if(Kekule.Element.isNormalElement(a)&&(b!=Kekule.Isotope.UNSET_MASSNUMBER)){var c=Kekule.IsotopesDataUtil.getIsotopeInfo(this.getAtomicNumber(),b);if(c){this.setPropStoreFieldValue("exactMass",c.exactMass);this.setPropStoreFieldValue("naturalAbundance",c.naturalAbundance)}else{Kekule.chemError((Kekule.hasLocalRes()?Kekule.ErrorMsg.INVALID_ISOTOPE:"Invalid isotope")+": "+this.getSymbol()+"/"+b)}}},initProperties:function(){this.defineProp("massNumber",{dataType:DataType.INTEGER,serializable:false,setter:null});this.defineProp("exactMass",{dataType:DataType.FLOAT,serializable:false,setter:null});this.defineProp("naturalAbundance",{dataType:DataType.FLOAT,serializable:false,setter:null})},isSame:function(a){if(a instanceof Kekule.Isotope){return(a===this)||((a.getAtomicNumber()==this.getAtomicNumber())&&(a.getMassNumber()==this.getMassNumber()))}return false},getIsotopeId:function(){return Kekule.IsotopesDataUtil.getIsotopeId(this.getAtomicNumber(),this.getMassNumber())}});Kekule.Isotope.UNSET_MASSNUMBER=undefined;Kekule.Isotope.getIsotopeId=function(a,b){return Kekule.IsotopesDataUtil.getIsotopeId(a,b)};Object.extend(Kekule.Isotope,{isMassNumberAvailable:function(a,b){return Kekule.IsotopesDataUtil.isMassNumberAvailable(a,b)}});Kekule.IsotopeFactory={GENERIC_ELEMENT_ID:"__GENERIC__",_isotopes:{},getIsotopeId:function(a,b){if(!a){return Kekule.IsotopeFactory.GENERIC_ELEMENT_ID}else{return Kekule.IsotopesDataUtil.getIsotopeId(a,b)}},getIsotope:function(a,b){var d=Kekule.IsotopeFactory.getIsotopeId(a,b);if(!Kekule.IsotopeFactory._isotopes[d]){var c=new Kekule.Isotope(a,b);Kekule.IsotopeFactory._isotopes[d]=c}return Kekule.IsotopeFactory._isotopes[d]},getIsotopeById:function(b){if(Kekule.IsotopeFactory._isotopes[b]){return Kekule.IsotopeFactory._isotopes[b]}else{var a=Kekule.IsotopesDataUtil.getIsotopeIdDetail(b);if(a){return Kekule.IsotopeFactory.getIsotope(a.symbol,a.massNumber)}else{return null}}}};Kekule.AtomType={UNSET_ATOMTYPE:undefined};Kekule.ElectronSet=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ElectronSet",initialize:function($super,a){$super();this.setElectronCount(a||Kekule.ElectronSet.UNSET_ELECTRONCOUNT)},initProperties:function(){this.defineProp("electronCount",{dataType:DataType.FLOAT})}});Kekule.ElectronSet.UNSET_ELECTRONCOUNT=null;Kekule.UnbondedElectronSet=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.UnBondedElectronSet",initialize:function($super,a){$super(a)},initProperties:function(){}});Kekule.BondType={COVALENT:"covalent",IONIC:"ionic",COORDINATE:"coordinate",METALLIC:"metallic",HYDROGEN:"hydrogen",UNKNOWN:null,DEFAULT:"covalent"};Kekule.BondOrder={SINGLE:1,DOUBLE:2,TRIPLE:3,QUAD:4,EXPLICIT_AROMATIC:10,OTHER:20,UNSET:null,DEFAULT:1,getBondValence:function(a){if(a===Kekule.BondOrder.UNSET){return 0}else{if(a==Kekule.BondOrder.EXPLICIT_AROMATIC){return 1.5}else{return a}}}};Kekule.BondForm=Class.create(Kekule.ElectronSet,{CLASS_NAME:"Kekule.BondForm",initialize:function($super,b,c,a){$super(c);this.setBondOrder(b||Kekule.BondOrder.DEFAULT);if(Kekule.ObjUtils.notUnset(a)){this.setBondType(a)}if(Kekule.ObjUtils.notUnset(c)){this.setElectronCount(c)}},initProperties:function(){this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var a=this.getPropStoreFieldValue("bondType");return(a?a:Kekule.BondType.DEFAULT)}});this.defineProp("bondOrder",{dataType:DataType.FLOAT,enumSource:Kekule.BondOrder,setter:function(a){if(this.getPropStoreFieldValue("bondOrder")!=a){this.setPropStoreFieldValue("bondOrder",a);if(a){if(this.getBondType()==Kekule.BondType.COVALENT){this.setElectronCount(this.getBondValence()*2)}}else{if(a===Kekule.BondOrder.UNSET){this.setElectronCount(Kekule.ElectronSet.UNSET_ELECTRONCOUNT)}}}}});this.defineProp("electronCount",{dataType:DataType.FLOAT});this.defineProp("bondValence",{dataType:DataType.FLOAT,serializable:false,getter:function(){return Kekule.BondOrder.getBondValence(this.getBondOrder())},setter:null})}});Kekule.BondFormFactory={_bondForms:{},getBondFormId:function(c,d,b){var a="";if(b){a+=b+"_"}if(c){a+=Number(c).toString()}if(d){a+="_"+Number(d).toString()}return a},getBondForm:function(b,d,a){if((!b)&&(!d)&&(!a)){return undefined}if(!a){a=Kekule.BondType.DEFAULT}if((!d)&&(b)&&(a===Kekule.BondType.COVALENT)){var c=Kekule.BondOrder.getBondValence(b);d=c*2}var e=Kekule.BondFormFactory.getBondFormId(b,d,a);if(!Kekule.BondFormFactory._bondForms[e]){Kekule.BondFormFactory._bondForms[e]=new Kekule.BondForm(b,d,a)}return Kekule.BondFormFactory._bondForms[e]}};Kekule.RadicalOrder={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3,DEFAULT:0,getRadicalElectronCount:function(a){var b=Kekule.RadicalOrder;if(Kekule.ObjUtils.isUnset(a)||(a===b.NONE)){return 0}else{if(a===b.DOUBLET){return 1}else{return 2}}}};Kekule.HybridizationType={UNKNOWN:null,SP:1,SP2:2,SP3:3,NONE:0};Kekule.ValenceUtils={getImplicitMdlValence:function(a,b,e){var c=b;var d=e;switch(a){case 1:case 3:case 11:case 19:case 37:case 55:case 87:if(c==0&&d<=1){return 1}break;case 4:case 12:case 20:case 38:case 56:case 88:switch(c){case 0:if(d<=2){return 2}break;case 1:if(d<=1){return 1}break}break;case 5:switch(c){case -4:if(d<=1){return 1}break;case -3:if(d<=2){return 2}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 1:if(d<=2){return 2}break;case 2:if(d<=1){return 1}break}break;case 6:switch(c){case -3:if(d<=1){return 1}break;case -2:if(d<=2){return 2}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 2:if(d<=2){return 2}break;case 3:if(d<=1){return 1}break}break;case 7:switch(c){case -2:if(d<=1){return 1}break;case -1:if(d<=2){return 2}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 3:if(d<=2){return 2}break;case 4:if(d<=1){return 1}break}break;case 8:switch(c){case -1:if(d<=1){return 1}break;case 0:if(d<=2){return 2}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 4:if(d<=2){return 2}break;case 5:if(d<=1){return 1}break}break;case 9:switch(c){case 0:if(d<=1){return 1}break;case 1:if(d<=2){return 2}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 5:if(d<=2){return 2}break;case 6:if(d<=1){return 1}break}break;case 13:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 1:if(d<=2){return 2}break;case 2:if(d<=1){return 1}break}break;case 14:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 2:if(d<=2){return 2}break;case 3:if(d<=1){return 1}break}break;case 15:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 3:if(d<=2){return 2}break;case 4:if(d<=1){return 1}break}break;case 16:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 4:if(d<=2){return 2}break;case 5:if(d<=1){return 1}break}break;case 17:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 5:if(d<=2){return 2}break;case 6:if(d<=1){return 1}break}break;case 31:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 2:if(d<=1){return 1}break}break;case 32:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 3:if(d<=1){return 1}break}break;case 33:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 4:if(d<=1){return 1}break}break;case 34:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 5:if(d<=1){return 1}break}break;case 35:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 6:if(d<=1){return 1}break}break;case 49:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=2){return 2}if(d<=4){return 4}break;case 0:if(d<=3){return 3}break;case 2:if(d<=1){return 1}break}break;case 50:case 82:switch(c){case -3:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -2:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -1:if(d<=3){return 3}if(d<=5){return 5}break;case 0:if(d<=2){return 2}if(d<=4){return 4}break;case 1:if(d<=3){return 3}break;case 3:if(d<=1){return 1}break}break;case 51:case 83:switch(c){case -2:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 0:if(d<=3){return 3}if(d<=5){return 5}break;case 1:if(d<=2){return 2}if(d<=4){return 4}break;case 2:if(d<=3){return 3}break;case 4:if(d<=1){return 1}break}break;case 52:case 84:switch(c){case -1:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 0:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 1:if(d<=3){return 3}if(d<=5){return 5}break;case 2:if(d<=2){return 2}if(d<=4){return 4}break;case 3:if(d<=3){return 3}break;case 5:if(d<=1){return 1}break}break;case 53:case 85:switch(c){case 0:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case 1:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case 2:if(d<=3){return 3}if(d<=5){return 5}break;case 3:if(d<=2){return 2}if(d<=4){return 4}break;case 4:if(d<=3){return 3}break;case 6:if(d<=1){return 1}break}break;case 81:switch(c){case -4:if(d<=1){return 1}if(d<=3){return 3}if(d<=5){return 5}if(d<=7){return 7}break;case -3:if(d<=2){return 2}if(d<=4){return 4}if(d<=6){return 6}break;case -2:if(d<=3){return 3}if(d<=5){return 5}break;case -1:if(d<=2){return 2}if(d<=4){return 4}break;case 0:if(d<=1){return 1}if(d<=3){return 3}break}break}return d},getImplicitHydValence:function(a,c,g){var d=a;var e=c;var f=g;var b=0;if(d==6){b=4-abs(e)}else{if(d==7||d==15){b=3+e}else{if(d==8||d==16){b=2+e}}}if(b<0){b=0}if(f>b){b=f}return b}};Kekule.ValenceUtils.getImplicitValence=Kekule.ValenceUtils.getImplicitMdlValence;Kekule.ChemStructureObject=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemStructureObject",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){if(!this.getPropStoreFieldValue("linkedConnectors")){this.setPropStoreFieldValue("linkedConnectors",[])}return this.getPropStoreFieldValue("linkedConnectors")}});this.defineProp("linkedObjs",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var a=[];for(var f=0,c=this.getLinkedConnectorCount();f<c;++f){var b=this.getLinkedConnectorAt(f);var g=b.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){if(g[e]!==this){Kekule.ArrayUtils.pushUnique(a,g[e])}}}return a}});this.defineProp("linkedSiblings",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var m=[];var h=this.getParent();for(var f=0,a=this.getLinkedConnectorCount();f<a;++f){var b=this.getLinkedConnectorAt(f);var g=b.getConnectedObjs();for(var d=0,c=g.length;d<c;++d){var e=g[d];if(e!==this){if(m.indexOf(e)<0){if(e.getParent()!==h){e=h.getDirectChildOfNestedNode(e)}if(e){m.push(e)}}}}}return m}})},initPropValues:function(){this.setPropStoreFieldValue("linkedConnectors",[])},getAutoIdPrefix:function(){return"o"},getParentFragment:function(){var a=this.getParent();return(a instanceof Kekule.StructureFragment)?a:null},notifyLinkedConnectorsChanged:function(){this.notifyPropSet("linkedConnectors",this.getPropStoreFieldValue("linkedConnectors"))},getLinkedConnectorCount:function(){return this.getLinkedConnectors().length},getLinkedConnectorAt:function(a){return this.getLinkedConnectors()[a]},indexOfLinkedConnector:function(a){return this.getLinkedConnectors().indexOf(a)},appendLinkedConnector:function(b){var a=this._doAppendLinkedConnector(b);if(b){b._doAppendConnectedObj(this)}return a},_doAppendLinkedConnector:function(a){if(!a){return -1}var c=this.getPropStoreFieldValue("linkedConnectors");var b=Kekule.ArrayUtils.pushUniqueEx(c,a);if(b.isPushed){this.notifyLinkedConnectorsChanged()}return b.index},removeLinkedConnectorAt:function(b){var a=this.getLinkedConnectorAt(b);if(a){a._doRemoveConnectedObjAt(a.indexOfConnectedObj(this))}return this._doRemoveLinkedConnectorAt(b)},_doRemoveLinkedConnectorAt:function(a){var b=Kekule.ArrayUtils.removeAt(this.getLinkedConnectors(),a);if(b){this.notifyLinkedConnectorsChanged()}return b},removeLinkedConnector:function(a){var b=this.getLinkedConnectors().indexOf(a);if(b>=0){this.removeLinkedConnectorAt(b)}},getConnectorTo:function(d){for(var b=0,a=this.getLinkedConnectorCount();b<a;++b){var e=this.getLinkedConnectorAt(b);if(e.hasConnectedObj(d)){return e}}return null},removeThisFromLinkedConnector:function(){for(var a=this.getLinkedConnectorCount()-1;a>=0;--a){var b=this.getLinkedConnectorAt(a);b.removeConnectedObj(this)}},getLinkedObjs:function(){var a=[];for(var f=0,c=this.getLinkedConnectorCount();f<c;++f){var b=this.getLinkedConnectorAt(f);var g=b.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){if(g[e]!==this){Kekule.ArrayUtils.pushUnique(a,g[e])}}}return a},getLinkedObjsOnConnector:function(b){var a=[];var e=b.getConnectedObjs();for(var d=0,c=e.length;d<c;++d){if(e[d]!==this){Kekule.ArrayUtils.pushUnique(a,e[d])}}return a}});Kekule.BaseStructureNode=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureNode",initialize:function($super,c,a,b){$super(c);if(a){this.setCoord2D(a)}if(b){this.setCoord3D(b)}},getAutoIdPrefix:function(){return"n"},getContainerBox:function(b,a){var c=this.getAbsCoordOfMode(b,a);return Kekule.BoxUtils.createBox(c,c)},getContainerBox2D:function(a){return this.getContainerBox(Kekule.CoordMode.COORD2D,a)},getContainerBox3D:function(a){return this.getContainerBox(Kekule.CoordMode.COORD3D,a)}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.BaseStructureNode);Kekule.ChemStructureNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.ChemStructureNode",initialize:function($super,c,a,b){$super(c);if(a){this.setCoord2D(a)}if(b){this.setCoord3D(b)}},initProperties:function(){this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}});this.defineProp("radical",{dataType:DataType.INT})},getPrimaryIsotope:function(){return null},getLinkedBonds:function(b){var a=[];for(var e=0,d=this.getLinkedConnectorCount();e<d;++e){var f=this.getLinkedConnectorAt(e);if((f instanceof Kekule.Bond)&&(!b||f.getBondType()===b)){a.push(f)}}return a},getLinkedMultipleBonds:function(){var f=Kekule.BondOrder;var b=[];for(var e=0,d=this.getLinkedConnectorCount();e<d;++e){var g=this.getLinkedConnectorAt(e);if((g instanceof Kekule.Bond)&&(g.getBondType()===Kekule.BondType.COVALENT)){var a=g.getBondOrder();if((a===f.DOUBLE)||(a===f.TRIPLE)||(a===f.QUAD)||(a===f.EXPLICIT_AROMATIC)){b.push(g)}}}return b},getLinkedDoubleBonds:function(){var f=Kekule.BondOrder;var b=[];for(var e=0,d=this.getLinkedConnectorCount();e<d;++e){var g=this.getLinkedConnectorAt(e);if((g instanceof Kekule.Bond)&&(g.getBondType()===Kekule.BondType.COVALENT)){var a=g.getBondOrder();if(a===f.DOUBLE){b.push(g)}}}return b}});Kekule.RadicalType={NONE:0,SINGLET:1,DOUBLET:2,TRIPLET:3};Kekule.AbstractAtom=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.AbstractAtom",initialize:function($super,a,b){$super(a,b)},initProperties:function(){this.defineProp("explicitHydrogenCount",{dataType:DataType.INT})},getAutoIdPrefix:function(){return"a"},getHydrogenCount:function(){return this.getExplicitHydrogenCount()},setHydrogenCount:function(a){return this.setExplicitHydrogenCount(a)},isSaturated:function(){return !this.getLinkedMultipleBonds().length}});Kekule.Atom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Atom",initialize:function($super,e,a,b,c,d){$super(e,c,d);if(a||b){this.changeIsotope(a,b)}},initProperties:function(){this.defineProp("isotope",{dataType:"Kekule.Isotope",serializable:false});this.defineProp("isotopeId",{dataType:DataType.STRING,serializable:true,getter:function(){var a=this.getIsotope();return a?a.getIsotopeId():Kekule.Element.UNSET_ELEMENT},setter:function(b){var a=Kekule.IsotopeFactory.getIsotopeById(b);if(a){this.setIsotope(a)}}});this.defineProp("symbol",{dataType:DataType.STRING,serializable:false,getter:function(){var a=this.getIsotope();return a?a.getSymbol():Kekule.Element.UNSET_ELEMENT},setter:function(a){this.changeElement(a)}});this.defineProp("atomicNumber",{dataType:DataType.INTEGER,serializable:false,getter:function(){var a=this.getIsotope();return a?a.getAtomicNumber():0},setter:function(a){this.changeElement(a)}});this.defineProp("massNumber",{dataType:DataType.INTEGER,getter:function(){var a=this.getIsotope();return a?a.getMassNumber():Kekule.Isotope.UNSET_MASSNUMBER},setter:function(a){this.changeMassNumber(a)}});this.defineProp("atomType",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("atomTypeId",{dataType:DataType.STRING,getter:function(){var a=this.getPropStoreFieldValue("atomType");return a?a.id:Kekule.AtomType.UNSET_ATOMTYPE},setter:function(b){if(this.isNormalAtom()){var a=Kekule.AtomTypeDataUtil.getAtomTypeFromId(this.getAtomicNumber(),b);this.setAtomType(a)}}});this.defineProp("hybridizationType",{dataType:DataType.INT,enumSource:Kekule.HybridizationType})},getAutoIdPrefix:function(){return"a"},getPrimaryIsotope:function(){return this.getIsotope()},changeIsotope:function(a,b){if(a===Kekule.Element.UNSET_ELEMENT){b=Kekule.Isotope.UNSET_MASSNUMBER}else{if(!a){a=this.getAtomicNumber()}}if(!b){b=Kekule.Isotope.UNSET_MASSNUMBER}if(this.getAtomicNumber()!==a){this.setAtomType(Kekule.AtomType.UNSET_ATOMTYPE)}var c=Kekule.IsotopeFactory.getIsotope(a,b);this.setPropStoreFieldValue("isotope",c)},changeElement:function(a){return this.changeIsotope(a,Kekule.Isotope.UNSET_MASSNUMBER)},changeMassNumber:function(a){return this.changeIsotope(null,a)},isElement:function(a){return(this.getSymbol()===a)||(this.getAtomicNumber()===a)},isNormalAtom:function(){var a=this.getIsotope();return a?a.isNormalElement():false},_getCurrCovalentBondsInfo:function(){var f=0;var e=0;for(var d=0,b=this.getLinkedConnectorCount();d<b;++d){var a=this.getLinkedConnectorAt(d);if((a instanceof Kekule.Bond)&&(a.getBondType()==Kekule.BondType.COVALENT)){var c=a.getBondValence();f+=c;if(c>e){e=c}}}return{valenceSum:f,maxValence:e}},guessAtomType:function(){if(this.isNormalAtom()){var c=null,g=null;var f=this._getCurrCovalentBondsInfo();var e=Kekule.AtomTypeDataUtil.getAllAtomTypes(this.getAtomicNumber());if(e){for(var d=0,a=e.length;d<a;++d){var b=e[d];g=b;if(b.bondOrderSum>=f.valenceSum){c=b;if(b.maxBondOrder>=f.maxValence){return b}}}return c?c:g}}return null},getProximalAtomType:function(){return this.getAtomType()||this.guessAtomType()},getImplicitValence:function(){if(this.isNormalAtom()){var c=this._getCurrCovalentBondsInfo();var d=c.valenceSum;var b=Math.round(this.getCharge()||0);var a=Kekule.ValenceUtils.getImplicitValence(this.getAtomicNumber(),b,d);return a}else{return 0}},getImplicitHydrogenCount:function(){if(this.isNormalAtom()){var b=this._getCurrCovalentBondsInfo();var c=this.getImplicitValence();var a=Kekule.RadicalOrder.getRadicalElectronCount(this.getRadical());c-=a;return Math.max(c-b.valenceSum,0)}else{return 0}},getHydrogenCount:function(){if(Kekule.ObjUtils.isUnset(this.getExplicitHydrogenCount())){return this.getImplicitHydrogenCount()}else{return this.getExplicitHydrogenCount()}}});Kekule.PseudoatomType={DUMMY:"dummy",ANY:"any",HETERO:"hetero",CUSTOM:"custom"};Kekule.Pseudoatom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.Pseudoatom",initialize:function($super,e,a,d,b,c){$super(e,b,c);if(a){this.setAtomType(a)}if(d&&(a==Kekule.PseudoatomType.CUSTOM)){this.setSymbol(d)}},initProperties:function(){this.defineProp("atomType",{dataType:DataType.STRING,enumSource:Kekule.PseudoatomType});this.defineProp("symbol",{dataType:DataType.STRING})},getPrimaryIsotope:function(){return null}});Kekule.VariableAtom=Class.create(Kekule.AbstractAtom,{CLASS_NAME:"Kekule.VariableAtom",initProperties:function(){this.defineProp("allowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(b){var a=this.getPropStoreFieldValue("allowedIsotopeIds");if((!a)&&b){a=[];this.setPropStoreFieldValue("allowedIsotopeIds",a)}return a}});this.defineProp("disallowedIsotopeIds",{dataType:DataType.ARRAY,getter:function(b){var a=this.getPropStoreFieldValue("disallowedIsotopeIds");if((!a)&&b){a=[];this.setPropStoreFieldValue("disallowedIsotopeIds",a)}return a}})},getPrimaryIsotope:function(){if(this.isDisallowedList()){return null}else{var a=this.getAllowedIsotopeIds();var b=a?a[0]:null;return b?Kekule.IsotopeFactory.getIsotopeById(b):null}},isDisallowedList:function(){return this.getDisallowedIsotopeIds()&&(!this.getAllowedIsotopeIds())},isListEmpty:function(){var b=this.getAllowedIsotopeIds();var a=!b||!b.length;if(a){b=this.getDisallowedIsotopeIds();a=!b||!b.length}return a},fetchAllowedIsotopeIds:function(){return this.doGetAllowedIsotopeIds(true)},fetchDisallowedIsotopeIds:function(){return this.doGetDisallowedIsotopeIds(true)}});Kekule.MolecularFormula=Class.create(ObjectEx,{CLASS_NAME:"Kekule.MolecularFormula",initialize:function($super,a){$super();this.setPropStoreFieldValue("sections",[]);if(a){this.setPropStoreFieldValue("parent",a)}},initProperties:function(){this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("sections",{dataType:DataType.ARRAY,setter:null});this.defineProp("charge",{dataType:DataType.FLOAT,getter:function(){return this.getPropStoreFieldValue("charge")||0}});this.defineProp("radical",{dataType:DataType.INT,getter:function(){return this.getPropStoreFieldValue("radical")||0}})},notifySectionsChanged:function(){this.notifyPropSet("sections",this.getPropStoreFieldValue("sections"))},createSectionItem:function(b,d,c){var a={obj:b,count:d||1};if(c){b.setCharge(c)}return a},getTotalCharge:function(){var a=0;var d=this.getSections();for(var c=0,b=d.length;c<b;++c){if(d[c].obj.getCharge){a+=d[c].obj.getCharge()*(section.count||1)}}if(this.getCharge()){a+=this.getCharge()}return a},indexOfObj:function(b){var d=this.getSections();for(var c=0,a=d.length;c<a;++c){if(d[c].obj==b){return c}}return -1},getSectionCount:function(){return this.getSections().length},getSectionAt:function(a){return this.getSections()[a]},getSectionCharge:function(a){var b;if(typeof(a)!="object"){b=this.getSectionAt(a)}else{b=a}if(b.obj.getCharge){return b.obj.getCharge()}else{return 0}},appendSection:function(b,d,c){var a=this.createSectionItem(b,d,c);this.getSections().push(a);this.notifySectionsChanged();return a},insertSection:function(c,b,e,d){var a=this.createSectionItem(b,e,d);this.getSections().splice(c,0,a);this.notifySectionsChanged();return a},removeSectionAt:function(a){var b=this.getSections().splice(a,1);if(b){this.notifySectionsChanged()}return b},removeObj:function(a){var b=this.indexOfObj(a);if(b>=0){var c=this.removeSectionAt(b);this.notifySectionsChanged()}else{return null}},getSimpleIsotopeMaps:function(){}});Kekule.StructureConnectionTable=Class.create(ObjectEx,{CLASS_NAME:"Kekule.StructureConnectionTable",initialize:function($super,a,b){$super();if(a){this.setOwner(a)}if(b){this.setPropStoreFieldValue("parent",b)}},initProperties:function(){this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(a){if(a!=this.getPropStoreFieldValue("owner")){this.setPropStoreFieldValue("owner",a);this.ownerChanged(a)}}});this.defineProp("parent",{dataType:"Kekule.StructureFragment",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(a){if(a!=this.getPropStoreFieldValue("parent")){this.setPropStoreFieldValue("parent",a);this.parentChanged(a)}}});this.defineProp("nodes",{dataType:DataType.ARRAY});this.defineProp("anchorNodes",{dataType:DataType.ARRAY,setter:null});this.defineProp("connectors",{dataType:DataType.ARRAY})},initPropValues:function(){this.setPropStoreFieldValue("nodes",[]);this.setPropStoreFieldValue("anchorNodes",[]);this.setPropStoreFieldValue("connectors",[])},doSaveProp:function(o,c,m,y){var p=c.name;switch(p){case"anchorNodes":var d=[];for(var w=0,s=o.getAnchorNodeCount();w<s;++w){var r=o.getAnchorNodeAt(w);var e=o.indexOfNode(r);d.push(e)}var f=y.createChildStorageNode(m,y.propNameToStorageName(p),true);y.save(d,f);return true;break;case"connectors":var f=y.createChildStorageNode(m,y.propNameToStorageName(p),true);for(var w=0,s=o.getConnectorCount();w<s;++w){var z=o.getConnectorAt(w);var a=y.getNameForArrayItemStorageNode(z);var n=y.appendArrayItemStorageNode(f,y.propNameToStorageName(a),y.isArray(z));y.setStorageNodeExplicitType(n,y.getValueExplicitType(z));y.save(z,n);var g=[];var x=[];for(var u=0,t=z.getConnectedObjCount();u<t;++u){var v=z.getConnectedObjAt(u);var e=o.indexOfNode(v);if(e>=0){g.push(e)}else{e=o.indexOfConnector(v);if(e>=0){x.push(e)}else{var b=o.indexStackOfNode(v);if((b!==null)&&(typeof(b)!=="undefined")){g.push(b)}}}}if(g.length){var q=y.createChildStorageNode(n,y.propNameToStorageName("connectedNodes"),true);y.save(g,q)}if(x.length){var h=y.createChildStorageNode(n,y.propNameToStorageName("connectedConnectors"),true);y.save(x,h)}}return true;break;default:return false}},doLoadProp:function(g,a,b,q){var m=a.name;switch(m){case"anchorNodes":var n=[];var h=q.getChildStorageNode(b,q.propNameToStorageName(m));q.load(n,h);g.__load_anchorNodes_indexes=n;return true;break;case"connectors":var h=q.getChildStorageNode(b,q.propNameToStorageName(m));var o=q.getAllArrayItemStorageNodes(h);for(var f=0,d=o.length;f<d;++f){var c=o[f];var e=q.getStorageNodeExplicitType(c)||q.getStorageNodeName(c);if(e){connector=DataType.createInstance(e);q.load(connector,c);var s=q.getChildStorageNode(c,q.propNameToStorageName("connectedNodes"));if(s){var r=[];q.load(r,s);connector.__load_connectedNode_indexes=r}var p=q.getChildStorageNode(c,q.propNameToStorageName("connectedConnectors"));if(p){var t=[];q.load(t,p);connector.__load_connectedConnector_indexes=t}g.appendConnector(connector)}}return true;break;default:return false}},loaded:function($super){if(this.__load_anchorNodes_indexes){for(var f=0,b=this.__load_anchorNodes_indexes.length;f<b;++f){var e=this.__load_anchorNodes_indexes[f];this.appendAnchorNode(this.getNodeAt(e))}delete this.__load_anchorNodes_indexes}for(var f=0,b=this.getConnectorCount();f<b;++f){var a=this.getConnectorAt(f);if(a.__load_connectedNode_indexes){for(var d=0,c=a.__load_connectedNode_indexes.length;d<c;++d){var e=a.__load_connectedNode_indexes[d];if(typeof(e)=="object"){a.appendConnectedObj(this.getNodeAtIndexStack(e))}else{a.appendConnectedObj(this.getNodeAt(e))}}delete a.__load_connectedNode_indexes}if(a.__load_connectedConnector_indexes){for(var d=0,c=a.__load_connectedConnector_indexes.length;d<c;++d){var e=a.__load_connectedConnector_indexes[d];a.appendConnectedObj(this.getConnectorAt(e))}delete a.__load_connectedConnector_indexes}}this.ownerChanged(this.getOwner());this.parentChanged(this.getParent());$super()},notifyNodesChanged:function(){this.notifyPropSet("nodes",this.getPropStoreFieldValue("nodes"))},notifyAnchorNodesChanged:function(){this.notifyPropSet("anchorNodes",this.getPropStoreFieldValue("anchorNodes"))},notifyConnectorsChanged:function(){this.notifyPropSet("connectors",this.getPropStoreFieldValue("connectors"))},ownerChanged:function(b){for(var c=0,a=this.getNodeCount();c<a;++c){this.getNodeAt(c).setOwner(b)}for(var c=0,a=this.getConnectorCount();c<a;++c){this.getConnectorAt(c).setOwner(b)}},parentChanged:function(c){for(var b=0,a=this.getNodeCount();b<a;++b){this.getNodeAt(b).setParent(c)}for(var b=0,a=this.getConnectorCount();b<a;++b){this.getConnectorAt(b).setParent(c)}},isEmpty:function(){return(this.getNodeCount()<=0)&&(this.getConnectorCount()<=0)},getNodeById:function(d){var b=this.getNodes();for(var c=0,a=b.length;c<a;++c){if(b[c].getId()==d){return b[c]}}return null},getConnectorById:function(d){var b=this.getConnectors();for(var c=0,a=b.length;c<a;++c){if(b[c].getId()==d){return b[c]}}return null},getObjectById:function(b){var a=this.getNodeById(b);return a?a:this.getConnectorById(b)},getNodeCount:function(){return this.getNodes().length},getNodeAt:function(a){return this.getNodes()[a]},indexOfNode:function(a){return this.getNodes().indexOf(a)},hasNode:function(d,b){var e=this.indexOfNode(d)>=0;if((!e)&&b){for(var c=0,a=this.getNodeCount();c<a;++c){var f=this.getNodeAt(c);if(f.hasNode){e=f.hasNode(d,true)}if(e){break}}}return e},indexStackOfNode:function(e){var c=this.indexOfNode(e);if(c>=0){return c}else{var a=null;for(var d=0,b=this.getNodeCount();d<b;++d){var f=this.getNodeAt(d);if(f.indexStackOfNode){a=f.indexStackOfNode(e);if(!Kekule.ObjUtils.isUnset(a)){if(typeof(a)!="object"){a=[a]}a.unshift(d);return a}}}return a}},getNodeAtIndexStack:function(c){if(c.length<=0){return null}else{var d=this.getNodeAt(c[0]);for(var b=1,a=c.length;b<a;++b){if(d.getNodeAt){d=d.getNodeAt(c[b])}else{return null}}return d}},appendNode:function(b){var a=Kekule.ArrayUtils.pushUniqueEx(this.getNodes(),b);if(a.isPushed){if(b.setOwner){b.setOwner(this.getOwner())}if(b.setParent){b.setParent(this.getParent())}this.notifyNodesChanged()}return a.index},insertNodeAt:function(d,b){var c=this.indexOfNode(d);var a=this.getNodes();if(Kekule.ObjUtils.isUnset(b)||(b<0)){b=a.length}if(c>=0){a.splice(c,1);a.splice(b,0,d)}else{a.splice(b,0,d);if(d.setOwner){d.setOwner(this.getOwner())}if(d.setParent){d.setParent(this.getParent())}}this.notifyNodesChanged()},setNodeIndex:function(d,b){var a=this.getNodes();var c=this.indexOfNode(d);if(c>=0){a.splice(c,1);a.splice(b,0,d)}},removeNodeAt:function(b,a){var c=this.getNodes()[b];if(c){if(!a){c.removeThisFromLinkedConnector()}this.getNodes().splice(b,1);if(c.setOwner){c.setOwner(null)}if(c.setParent){c.setParent(null)}this.notifyNodesChanged()}},removeNode:function(c,a){var b=this.getNodes().indexOf(c);if(b>=0){this.removeNodeAt(b,a)}},replaceNode:function(g,f){if(!this.hasNode(g)){return this}else{this.insertBefore(f,g);var h=this.getAnchorNodes();var a=h.indexOf(g);if(a>=0){h.splice(a,1,[f])}var d=Kekule.ArrayUtils.clone(g.getLinkedConnectors());for(var e=0,c=d.length;e<c;++e){var b=d[e];b.replaceConnectedObj(g,f)}this.removeNode(g)}},clearNodes:function(){this.clearAnchorNodes();this.setPropStoreFieldValue("nodes",[]);this.notifyAnchorNodesChanged();this.notifyNodesChanged()},sortNodes:function(a){if(a){this.getNodes().sort(a);this.notifyNodesChanged()}else{Kekule.error(Kekule.ErrorMsg.SORT_FUNC_UNSET)}},nodesHasCoord2D:function(c){var b=this.getNodes();for(var d=0,a=b.length;d<a;++d){if(b[d].hasCoord2D(c)){return true}}return false},nodesHasCoord3D:function(c){var b=this.getNodes();for(var d=0,a=b.length;d<a;++d){if(b[d].hasCoord3D(c)){return true}}return false},getAnchorNodeCount:function(){return this.getAnchorNodes().length},indexOfAnchorNode:function(a){return this.getAnchorNodes().indexOf(a)},getAnchorNodeAt:function(a){return this.getAnchorNodes()[a]},appendAnchorNode:function(b){if(!b){return -1}if(this.getNodes().indexOf(b)>=0){var a=Kekule.ArrayUtils.pushUniqueEx(this.getAnchorNodes(),b);if(a.isPushed){this.notifyAnchorNodesChanged()}return a.index}else{return -1}},removeAnchorNodeAt:function(a){var b=this.getAnchorNodes()[a];if(b){this.getAnchorNodes().splice(a,1);this.notifyAnchorNodesChanged()}},removeAnchorNode:function(b){var a=this.getAnchorNodes().indexOf(b);if(a>=0){this.removeAnchorNodeAt(a)}},clearAnchorNodes:function(){this.setPropStoreFieldValue("anchorNodes",[]);notifyAnchorNodesChanged()},getConnectorCount:function(){return this.getConnectors().length},indexOfConnector:function(a){return this.getConnectors().indexOf(a)},getConnectorAt:function(a){return this.getConnectors()[a]},appendConnector:function(a){var b=Kekule.ArrayUtils.pushUniqueEx(this.getConnectors(),a);if(b.isPushed){if(a.setOwner){a.setOwner(this.getOwner())}if(a.setParent){a.setParent(this.getParent())}this.notifyConnectorsChanged()}return b.index},insertConnectorAt:function(b,c){var d=this.indexOfConnector(b);var a=this.getConnectors();if(Kekule.ObjUtils.isUnset(c)||(c<0)){c=a.length}if(d>=0){a.splice(d,1);a.splice(c,0,b)}else{a.splice(c,0,b);if(b.setOwner){b.setOwner(this.getOwner())}if(b.setParent){b.setParent(this.getParent())}}this.notifyConnectorsChanged()},setConnectorIndex:function(b,c){var a=this.getConnectors();var d=this.indexOfConnector(b);if(d>=0){a.splice(d,1);a.splice(c,0,b)}},removeConnectorAt:function(c,a){var b=this.getConnectors()[c];if(b){if(!a){b.removeThisFromConnectedObjs()}this.getConnectors().splice(c,1);if(b.setOwner){b.setOwner(null)}if(b.setParent){b.setParent(null)}this.notifyConnectorsChanged()}},removeConnector:function(b,a){var c=this.getConnectors().indexOf(b);if(c>=0){this.removeConnectorAt(c,a)}},clearConnectors:function(){this.setPropStoreFieldValue("connectors",[]);this.notifyConnectorsChanged()},hasConnector:function(b,c){var e=this.indexOfConnector(b)>=0;if((!e)&&c){for(var d=0,a=this.getNodeCount();d<a;++d){var f=this.getNodeAt(d);if(f.hasConnector){e=f.hasConnector(b,true)}if(e){break}}}return e},sortConnectors:function(a){if(a){this.getConnectors().sort(a);this.notifyConnectorsChanged()}else{Kekule.error(Kekule.ErrorMsg.SORT_FUNC_UNSET)}},_getObjsNeedToBeCascadeRemoved:function(n,m){var p=[];var o=n.getLinkedConnectors?n.getLinkedConnectors():[];for(var f=0,b=o.length;f<b;++f){var c=o[f];if((!m)||(m.indexOf(c)<0)){if(c.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(p,c)}}}if(n instanceof Kekule.ChemStructureNode){}else{if(n instanceof Kekule.ChemStructureConnector){var g=n.getConnectedObjs();for(var f=0,b=g.length;f<b;++f){var e=g[f];if((!m)||(m.indexOf(e)<0)){if(e instanceof Kekule.ChemStructureNode){if(e.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(p,e)}}}}}else{}}var d=[].concat(p);d.push(n);var h=[];for(var f=0,b=p.length;f<b;++f){var e=p[f];if(e!==n){var a=this._getObjsNeedToBeCascadeRemoved(e,d)}Kekule.ArrayUtils.pushUnique(h,a)}Kekule.ArrayUtils.pushUnique(p,h);return p},removeChildObj:function(g,d,b){var f;if(d){f=this._getObjsNeedToBeCascadeRemoved(g);Kekule.ArrayUtils.pushUnique(f,g)}else{f=[g]}for(var c=0,a=f.length;c<a;++c){var e=f[c];if(e instanceof Kekule.BaseStructureConnector){this.removeConnector(e)}else{if(e instanceof Kekule.BaseStructureNode){this.removeNode(e)}}}if(b){for(var c=f.length-1;c>=0;--c){var e=f[c];if(e.finalize){e.finalize()}}}},removeChild:function(a){return this.removeChildObj(a)},deleteChildObj:function(b,a){return this.removeChildObj(b,a,true)},hasChildObj:function(a){return this.hasNode(a)||this.hasConnector(a)},getNextSiblingOfChild:function(b){if(b instanceof Kekule.ChemStructureNode){var a=this.indexOfNode(b);if(a>=0){return this.getNodeAt(a+1)}}else{if(b instanceof Kekule.ChemStructureConnector){var a=this.indexOfConnector(b);if(a>=0){return this.getConnectorAt(a+1)}}}return null},insertBefore:function(c,a){if(c instanceof Kekule.BaseStructureNode){var b=this.indexOfNode(a);return this.insertNodeAt(c,b)}else{if(c instanceof Kekule.BaseStructureConnector){var b=this.indexOfConnector(a);return this.insertConnectorAt(c,b)}}},clear:function(){this.clearNodes();this.clearConnectors()},getChildCount:function(){return this.getNodeCount()+this.getConnectorCount()},getChildAt:function(b){var a=this.getNodeCount();if(b<a){return this.getNodeAt(b)}else{return this.getConnectorAt(b-a)}},indexOfChild:function(c){var a;if(c instanceof Kekule.ChemStructureNode){a=this.indexOfNode(c)}else{if(c instanceof Kekule.ChemStructureConnector){a=this.indexOfConnector(c);if(a>=0){var b=this.getNodeCount();a+=b}}else{a=-1}}return a},isSubFragment:function(a){return(a.getNodeCount&&(a.getNodeCount()>0))},getSubFragments:function(){var a=[];for(var c=0,b=this.getNodeCount();c<b;++c){var d=this.getNodeAt(c);if(this.isSubFragment(d)){a.push(d)}}return a},getLeafNodes:function(){var a=[];for(var d=0,c=this.getNodeCount();d<c;++d){var e=this.getNodeAt(d);if(!this.isSubFragment(e)){a.push(e)}else{if(e.getLeafNodes){var b=e.getLeafNodes();a=a.concat(b)}}}return a},getAllChildConnectors:function(){var a=[].concat(this.getConnectors());var d=this.getSubFragments();for(var c=0,b=d.length;c<b;++c){if(d[c].getAllChildConnectors){a=a.concat(d[c].getAllChildConnectors())}}return a},getAllContainingConnectors:function(){return this.getAllChildConnectors()},getIsotopeMaps:function(){var a=this.getNodes();if(a.length<=0){return[]}else{var g=function(s,o,r,p){var t=false;for(var l=0,i=s.length;l<i;++l){if(o.isSame(s[l].isotope)){t=true;s[l].count+=r;s[l].charge+=p||0}}if(!t){var q={isotope:o,count:r,charge:c.getCharge()||0};s.push(q)}return s};var n=[];for(var e=0,d=a.length;e<d;++e){var c=a[e];if(c instanceof Kekule.StructureFragment){var h=c.getIsotopeMaps();for(var e=0,d=h.length;e<d;++e){n=g(n,h[e].isotope,h[e].count,h[e].charge||0)}}else{if(c instanceof Kekule.Atom){var m=c.getIsotope();n=g(n,c.getIsotope(),1,c.getCharge()||0);var f=c.getHydrogenCount();if(f>0){var b=Kekule.IsotopeFactory.getIsotope(1);n=g(n,b,f,0)}}}}}return n},calcFormula:function(){var d=this.getIsotopeMaps();if(d.length<=0){return null}var a=new Kekule.MolecularFormula();for(var c=0,b=d.length;c<b;++c){a.appendSection(d[c].isotope,d[c].count,d[c].charge)}return a},getNodesContainBox:function(a,e,c){var h=(e===Kekule.CoordMode.COORD3D);var m={};for(var f=0,d=a.length;f<d;++f){var b=a[f];var g=b.getAbsCoordOfMode(e,c);if(f==0){m.x1=m.x2=g.x;m.y1=m.y2=g.y;if(h){m.z1=m.z2=g.z}}else{(g.x<m.x1)?m.x1=g.x:((g.x>m.x2)?m.x2=g.x:null);(g.y<m.y1)?m.y1=g.y:((g.y>m.y2)?m.y2=g.y:null);if(h){(g.z<m.z1)?m.z1=g.z:((g.z>m.z2)?m.z2=g.z:null)}}}return m},getContainerBox:function(b,a){return this.getNodesContainBox(this.getNodes(),b,a)},getContainerBox2D:function(b){var a=this.getContainerBox(Kekule.CoordMode.COORD2D,b);a.width=a.x2-a.x1;a.height=a.y2-a.y1;return a},getContainerBox3D:function(b){var a=this.getContainerBox(Kekule.CoordMode.COORD3D,b);a.deltaX=a.x2-a.x1;a.deltaY=a.y2-a.y1;a.deltaZ=a.z2-a.z1;return a}});Kekule.StructureFragment=Class.create(Kekule.ChemStructureNode,{CLASS_NAME:"Kekule.StructureFragment",initialize:function($super,c,a,b){$super(c,a,b)},doFinalize:function($super){if(this.hasFormula()){this.getFormula().finalize()}if(this.hasCtab()){this.getCtab().finalize()}$super();this.addEventListener("change",function(b){var a=b.target;if(a instanceof Kekule.ChemStructureObject){this.setPropStoreFieldValue("aromaticRings",[])}})},initProperties:function(){this.defineProp("formula",{dataType:"Kekule.MolecularFormula",getter:function(a){if(!this.getPropStoreFieldValue("formula")){if(a){this.setPropStoreFieldValue("formula",new Kekule.MolecularFormula(this))}}return this.getPropStoreFieldValue("formula")},setter:function(b){var a=this.getPropStoreFieldValue("formula");if(a){a.finalize();a=null}if(b){b.setPropValue("parent",this,true)}this.setPropStoreFieldValue("formula",b)}});this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",getter:function(a){if(!this.getPropStoreFieldValue("ctab")){if(a){this.createCtab()}}return this.getPropStoreFieldValue("ctab")},setter:function(b){var a=this.getPropStoreFieldValue("ctab");if(a){a.finalize();a=null}if(b){b.setPropValue("parent",this,true);b.setOwner(this.getOwner())}this.setPropStoreFieldValue("ctab",b)}});this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}});this.defineProp("anchorNodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getAnchorNodes():[]}});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}});this.defineProp("crossConnectors",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var a=[].concat(this.getPropStoreFieldValue("linkedConnectors"));for(var f=0,c=this.getAnchorNodeCount();f<c;++f){var b=this.getAnchorNodeAt(f).getLinkedConnectors();for(var e=0,d=b.length;e<d;++e){if(this.indexOfConnector(b[e])<0){Kekule.ArrayUtils.pushUnique(a,b[e])}}}return a}});this.defineProp("aromaticRings",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var a=this.getPropStoreFieldValue("aromaticRings");if(!a){a=[];this.setPropStoreFieldValue("aromaticRings",a)}return a}})},getAutoIdPrefix:function(){return"f"},ownerChanged:function($super,a){if(this.hasCtab()){this.getCtab().setOwner(a)}$super(a)},_removeChildObj:function(b){if(this.hasFormula()){var c=this.getFormula();if(c===b){this.removeFormula()}}else{if(this.hasCtab()){var a=this.getCtab();if(a===b){this.removeCtab()}else{if(a.hasChildObj(b)){a.removeChildObj(b)}}}}},isEmpty:function(){var a;a=!this.hasFormula();if(a){a=!this.hasCtab();if(!a){a=this.getCtab().isEmpty()}}return a},isCtabEmpty:function(){return !this.hasCtab()||this.getCtab().isEmpty()},doGetLinkedConnectors:function(){return this.getCrossConnectors()},createCtab:function(){var a=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",a);a.addEventListener("propValueSet",function(b){if((b.propName=="nodes")||(b.propName=="anchorNodes")||(b.propName=="connectors")){this.notifyPropSet(b.propName,b.propValue)}},this);a.setEnablePropValueSetEvent(true)},hasCtab:function(){return(!!this.getPropStoreFieldValue("ctab"))},hasFormula:function(){return(!!this.getPropStoreFieldValue("formula"))},removeFormula:function(){var a=this.getPropStoreFieldValue("formula");if(a){a.finalize();a=null;this.setPropStoreFieldValue("formula",null)}return this},removeCtab:function(){var a=this.getPropStoreFieldValue("ctab");if(a){a.finalize();a=null;this.setPropStoreFieldValue("ctab",null)}return this},getContainerBox:function($super,b,a){if(this.hasCtab()){return this.getCtab().getContainerBox(b,a)}else{return $super(b)}},getNodeById:function(a){return this.hasCtab()?this.getCtab().getNodeById(a):null},getConnectorById:function(a){return this.hasCtab()?this.getCtab().getConnectorById(a):null},getObjectById:function(b){var a=this.getNodeById(b);return a?a:this.getConnectorById(b)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(a){return this.hasCtab()?this.getCtab().getNodeAt(a):null},indexOfNode:function(a){return this.hasCtab()?this.getCtab().indexOfNode(a):-1},hasNode:function(b,a){return this.hasCtab()?the.getCtab().hasNode(b,a):null},indexStackOfNode:function(a){return this.hasCtab()?this.getCtab().indexStackOfNode(a):-1},getNodeAtIndexStack:function(a){return this.hasCtab()?this.getCtab().getNodeAtIndexStack(a):null},getDirectChildOfNestedNode:function(a){var c=a.getParent();if(!c){return null}else{if(c===this){return c}else{var b=a;while(c&&(c.getParent)&&(c!==this)){b=c;c=c.getParent()}if(c===this){return b}else{return null}}}},appendNode:function(a){return this.doGetCtab(true).appendNode(a)},insertNodeAt:function(b,a){return this.doGetCtab(true).insertNodeAt(b,a)},removeNodeAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNodeAt(b,a)},removeNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNode(b,a)},replaceNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().replaceNode(b,a)},clearNodes:function(){if(this.hasCtab()){return this.getCtab().clearNodes()}},sortNodes:function(a){if(this.hasCtab()){return this.getCtab().sortNodes(a)}},nodesHasCoord2D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord2D(a)},nodesHasCoord3D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord3D(a)},isNodeInAromaticRing:function(d){var e=this.getAromaticRings();for(var c=0,a=e.length;c<a;++c){var b=e[c].nodes;if(b.indexOf(d)>=0){return true}}return false},getAnchorNodeCount:function(){return this.hasCtab()?this.getCtab().getAnchorNodeCount():0},getAnchorNodeAt:function(a){return this.hasCtab()?this.getCtab().getAnchorNodeAt(a):null},indexOfAnchorNode:function(a){return this.hasCtab()?this.getCtab().indexOfAnchorNode(a):-1},appendAnchorNode:function(a){return this.doGetCtab(true).appendAnchorNode(a)},removeAnchorNodeAt:function(a){if(!this.hasCtab()){return null}return this.getCtab().removeAnchorNodeAt(a)},removeAnchorNode:function(a){if(!this.hasCtab()){return null}return this.getCtab().removeAnchorNode(a)},clearAnchorNodes:function(){if(this.hasCtab()){return this.getCtab().clearAnchorNodes()}},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(a){return this.hasCtab()?this.getCtab().getConnectorAt(a):null},indexOfConnector:function(a){return this.hasCtab()?this.getCtab().indexOfConnector(a):-1},hasConnector:function(a,b){return this.hasCtab()?this.getCtab().hasConnector(a,b):null},appendConnector:function(a){return this.doGetCtab(true).appendConnector(a)},insertConnectorAt:function(a,b){return this.doGetCtab(true).insertConnectorAt(a,b)},removeConnectorAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnectorAt(b,a)},removeConnector:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnector(b,a)},clearConnectors:function(){if(this.hasCtab()){return this.getCtab().clearConnectors()}},sortConnectors:function(a){if(this.hasCtab()){return this.getCtab().sortConnectors(a)}},isConnectorInAromaticRing:function(c){var e=this.getAromaticRings();for(var d=0,b=e.length;d<b;++d){var a=e[d].connectors;if(a.indexOf(c)>=0){return true}}return false},insertBefore:function(b,a){if(this.hasCtab()){return this.getCtab().insertBefore(b,a)}},_getObjsNeedToBeCascadeRemoved:function(b,a){if(this.hasCtab()){return this.getCtab()._getObjsNeedToBeCascadeRemoved(b,a)}else{return[]}},removeChildObj:function(c,b,a){if(this.hasCtab()){this.getCtab().removeChildObj(c,b,a)}},removeChild:function(a){return this.removeChildObj(a)},hasChildObj:function(a){if(this.hasCtab()){return this.getCtab().hasChildObj(a)}else{return false}},getNextSiblingOfChild:function(a){if(this.hasCtab()){return this.getCtab().getNextSiblingOfChild(a)}else{return null}},getChildCount:function(){if(this.hasCtab()){return this.getCtab().getChildCount()}else{return 0}},getChildAt:function(a){if(this.hasCtab()){return this.getCtab().getChildAt(a)}else{return null}},indexOfChild:function(a){if(this.hasCtab()){return this.getCtab().indexOfChild(a)}else{return -1}},isSubFragment:function(a){return(a.getNodeCount&&(a.getNodeCount()>0))},getSubFragments:function(){return this.hasCtab()?this.getCtab().getSubFragments():[]},getLeafNodes:function(){return this.hasCtab()?this.getCtab().getLeafNodes():[]},getAllChildConnectors:function(){return this.hasCtab()?this.getCtab().getAllChildConnectors():[]},getAllContainingConnectors:function(){return this.hasCtab()?this.getCtab().getAllContainingConnectors():[]},clear:function(){if(this.hasCtab()){this.setCtab(undefined)}if(this.hasFormula()){this.setFormula(undefined)}},calcFormula:function(){if(this.hasCtab()){return this.getCtab().calcFormula()}else{if(this.hasFormula()){return this.getFormula()}else{return null}}},marshalSubFragment:function(r,v){if(this.hasCtab()){this.beginUpdate();try{this.appendNode(v);var c=[];var b=[];var h=[];var w=[];for(var t=0,p=r.length;t<p;++t){var g=r[t];if(this.indexOfNode(g)<0){continue}var a=false;var d=g.getLinkedConnectors();for(j=0,k=d.length;j<k;++j){var o=d[j];var q=false;var u=o.getConnectedObjs();for(var f=0,e=u.length;f<e;++f){var s=u[f];if(s!=g){if(r.indexOf(s)<0){a=true;q=true}}}if(q){Kekule.ArrayUtils.pushUnique(w,o)}else{Kekule.ArrayUtils.pushUnique(h,o)}}Kekule.ArrayUtils.pushUnique(c,g);if(a){Kekule.ArrayUtils.pushUnique(b,g)}}for(var t=h.length-1;t>=0;--t){this.removeConnector(h[t],true)}for(var t=c.length-1;t>=0;--t){this.removeNode(c[t],true)}v.beginUpdate();try{for(var t=0,p=c.length;t<p;++t){v.appendNode(c[t])}for(var t=0,p=b.length;t<p;++t){v.appendAnchorNode(b[t])}for(var t=0,p=h.length;t<p;++t){v.appendConnector(h[t])}}finally{v.endUpdate()}}finally{this.endUpdate()}return v}else{return null}},unmarshalSubFragment:function(c,a){if(this.hasCtab()){this.beginUpdate();try{c.beginUpdate();try{if(a&&c.unmarshalAllSubFragments){c.unmarshalAllSubFragments(a)}var b=this.getCtab();Kekule.StructureFragment.moveChildBetweenStructFragment(c,this,c.getNodes(),c.getConnectors(),true);c.clear();b.removeNode(c)}finally{c.endUpdate();c.finalize()}}finally{this.endUpdate()}}},unmarshalAllSubFragments:function(c){var b=this.getSubFragments();if(b){for(var d=0,a=b.length;d<a;++d){this.unmarshalSubFragment(b[d],c)}}},recalcCoords:function(){if(this.hasCtab()){this.beginUpdate();try{var m={};var e={};var g=this.getAnchorNodeCount();for(var f=0,d=g;f<d;++f){var b=this.getAnchorNodeAt(f);m=Kekule.CoordUtils.add(m,b.getCoord2D()||{});e=Kekule.CoordUtils.add(e,b.getCoord3D()||{})}var h=Kekule.ObjUtils.notUnset;var c=(h(m.x)||h(m.y));var o=(h(e.x)||h(e.y)||h(e.z));if(c){var a=Kekule.CoordUtils.substract({},m);this.setCoord2D(Kekule.CoordUtils.substract(this.fetchCoord2D(),a))}if(o){var n=Kekule.CoordUtils.substract({},e);this.setCoord3D(Kekule.CoordUtils.substract(this.fetchCoord3D(),n))}for(var f=0,d=this.getNodeCount();f<d;++f){var b=this.getNodeAt(f);if(c){b.setCoord2D(Kekule.CoordUtils.add(b.fetchCoord2D(),a))}if(o){b.setCoord3D(Kekule.CoordUtils.add(b.fetchCoord3D(),n))}}}finally{this.endUpdate()}}}});Kekule.StructureFragment.moveChildBetweenStructFragment=function(y,n,B,e,c){var z=Kekule.CoordUtils;y.beginUpdate();n.beginUpdate();var a=y.getAnchorNodes();try{var m=y.getAbsCoord2D();var u=y.getAbsCoord3D();var A=n.getAbsCoord2D();var h=n.getAbsCoord3D();var p=z.substract(m,A);var x=z.substract(u,h);var q=Kekule.ArrayUtils.clone(B);var t=Kekule.ArrayUtils.clone(e);for(var v=0,s=q.length;v<s;++v){var r=q[v];var g=y.indexOfNode(r);if(g>=0){y.removeNodeAt(g,true);var w=r.getCoord2D();if(w){var d=z.add(w,p);r.setCoord2D(d)}var f=r.getCoord3D();if(f){var o=z.add(f,x);r.setCoord2D(o)}n.appendNode(r);if(a.indexOf(r)>=0){y.removeAnchorNode(r);if(!c){n.appendAnchorNode(r)}}}}for(var v=0,s=t.length;v<s;++v){var b=t[v];var g=y.indexOfConnector(b);if(g>=0){y.removeConnectorAt(g,true);n.appendConnector(b)}}}finally{n.endUpdate();y.endUpdate()}};Kekule.SubGroup=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.SubGroup",initialize:function($super,e,b,a,c,d){$super(e,c,d);this.setPropStoreFieldValue("abbr",b);this.setPropStoreFieldValue("name",a)},initProperties:function(){this.defineProp("abbr",{dataType:DataType.STRING});this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"g"},doPropChanged:function($super,a,b){if(a=="anchorNodes"){this.recalcCoords()}return $super(a,b)}});Kekule.RGroup=Kekule.SubGroup;Kekule.Molecule=Class.create(Kekule.StructureFragment,{CLASS_NAME:"Kekule.Molecule",initialize:function($super,c,a,b){$super(c);this.setPropStoreFieldValue("name",a);if(b){this.setCtab(new Kekule.StructureConnectionTable())}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"m"}});Kekule.BaseStructureConnector=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.BaseStructureConnector",initialize:function($super,b,a){$super(b);this.setConnectedObjs(a||[])},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:function(c){var d=this.getPropStoreFieldValue("connectedObjs");if(!d){this.setPropStoreFieldValue("connectedObjs",[]);d=this.getPropStoreFieldValue("connectedObjs")}for(var b=0,a=d.length;b<a;++b){d[b].removeLinkedConnector(this)}if(c){for(var b=0,a=c.length;b<a;++b){this.assertConnectedObjLegal(c[b])}for(var b=0,a=c.length;b<a;++b){Kekule.ArrayUtils.pushUnique(d,c[b])}}else{this.setPropStoreFieldValue("connectedObjs",[])}d=this.getPropStoreFieldValue("connectedObjs");for(var b=0,a=d.length;b<a;++b){d[b].appendLinkedConnector(this)}this.notifyConnectedObjsChanged()}})},getAutoIdPrefix:function(){return"c"},notifyConnectedObjsChanged:function(){this.notifyPropSet("connectedObjs",this.getPropStoreFieldValue("connectedObjs"))},assertConnectedObjLegal:function(a){if((!a)||(!a.getOwner)){Kekule.chemError(Kekule.hasLocalRes()?Kekule.ErrorMsg.UNABLE_ADD_MISTYPED_NODE:"Unable to link mistyped node to connector")}else{if(a.getOwner()!=this.getOwner()){Kekule.chemError(Kekule.hasLocalRes()?Kekule.ErrorMsg.UNABLE_ADD_DIFF_OWNER_OBJ:"Object with different owner can not be linked to connector");return false}else{return true}}},connectedObjAdded:function(a){this.notifyConnectedObjsChanged()},getConnectedObjCount:function(){return this.getConnectedObjs().length},indexOfConnectedObj:function(a){return this.getConnectedObjs().indexOf(a)},getConnectedObjAt:function(a){return this.getConnectedObjs()[a]},setConnectedObjAt:function(a,c){this.assertConnectedObjLegal(c);var b=this.getConnectedObjs()[a];if(b){b.removeLinkedConnector(this)}this.insertConnectedObjAt(c,a);this.connectedObjAdded(c)},appendConnectedObj:function(b){this.assertConnectedObjLegal(b);var a=this._doAppendConnectedObj(b);if(b){b.appendLinkedConnector(this)}return a},_doAppendConnectedObj:function(b){var a=Kekule.ArrayUtils.pushUniqueEx(this.getConnectedObjs(),b);if(a.isPushed){this.connectedObjAdded(b)}return a.index},insertConnectedObjAt:function(c,a){this.assertConnectedObjLegal(c);var b=this.indexOfConnectedObj(c);var d=this.getConnectedObjs();if(b>=0){d.splice(b,1);d.splice(a,0,c);this.notifyConnectedObjsChanged()}else{d.splice(a,0,c);if(c){c.appendLinkedConnector(this)}this.connectedObjAdded(c)}},removeConnectedObjAt:function(a){var b=this.getConnectedObjs()[a];if(b){this._doRemoveConnectedObjAt(a);b._doRemoveLinkedConnectorAt(b.indexOfLinkedConnector(this));this.notifyConnectedObjsChanged()}},_doRemoveConnectedObjAt:function(a){this.getConnectedObjs().splice(a,1)},removeConnectedObj:function(b){var a=this.getConnectedObjs().indexOf(b);if(a>=0){this.removeConnectedObjAt(a)}},replaceConnectedObj:function(a,b){var c=this.indexOfConnectedObj(a);if(c>=0){this.setConnectedObjAt(c,b)}},clearConnectedObjs:function(){this.setConnectedObjs([])},hasConnectedObj:function(a){return(this.getConnectedObjs().indexOf(a)>=0)},isConnectingWithObj:function(a){return this.hasConnectedObj(a)},reverseConnectedObjOrder:function(){this.setPropStoreFieldValue("connectedObjs",Kekule.ArrayUtils.reverse(this.getConnectedObjs()));this.notifyConnectedObjsChanged()},removeThisFromConnectedObjs:function(){for(var a=this.getConnectedObjCount()-1;a>=0;--a){var b=this.getConnectedObjAt(a);b.removeLinkedConnector(this)}},getConnectedSiblings:function(){var h=this.getConnectedObjs();var a=[];var e=this.getParent();var d=function(l){if(l.getParent){var i=l.getParent();if(i===e){return i}else{return d(i)}}else{return l}};for(var c=0,b=h.length;c<b;++c){var f=h[c];if(!f.getParent||(f.getParent()===e)){a.push(f)}else{var g=d(f);if(g){a.push(g)}}}return a},isConnectingConnector:function(){for(var b=0,a=this.getConnectedObjCount();b<a;++b){var c=this.getConnectedObjAt(b);if(c instanceof Kekule.ChemStructureConnector){return true}}return false}});Kekule.ChemStructureConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.ChemStructureConnector"});Kekule.BondStereo={NONE:0,UP:1,UP_INVERTED:2,DOWN:3,DOWN_INVERTED:4,UP_OR_DOWN:8,UP_OR_DOWN_INVERTED:9,E_OR_Z:20,E:21,Z:22,E_Z_BY_COORDINATES:23,CIS_OR_TRANS:30,CIS:31,TRANS:32,getInvertedDirection:function(b){var a=Kekule.BondStereo;switch(b){case a.UP:return a.UP_INVERTED;case a.UP_INVERTED:return a.UP;case a.DOWN:return a.DOWN_INVERTED;case a.DOWN_INVERTED:return a.DOWN;case a.UP_OR_DOWN:return a.UP_OR_DOWN_INVERTED;default:return b}}};Kekule.Bond=Class.create(Kekule.ChemStructureConnector,{CLASS_NAME:"Kekule.Bond",initialize:function($super,e,c,b,d,a){$super(e,c||[]);if(b||d){this.setBondForm(Kekule.BondFormFactory.getBondForm(b,d))}},initProperties:function(){this.defineProp("bondForm",{dataType:"Kekule.BondForm",serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bondType",{dataType:DataType.STRING,enumSource:Kekule.BondType,getter:function(){var a=this.getBondForm();return a?a.getBondType():Kekule.BondType.DEFAULT},setter:function(a){this.changeBondForm(this.getBondOrder(),Kekule.ElectronSet.UNSET_ELECTRONCOUNT,a)}});this.defineProp("bondOrder",{dataType:DataType.INT,enumSource:Kekule.BondOrder,getter:function(){var a=this.getBondForm();return a?a.getBondOrder():Kekule.BondOrder.UNSET},setter:function(a){this.changeBondForm(a,Kekule.ElectronSet.UNSET_ELECTRONCOUNT)}});this.defineProp("bondValence",{dataType:DataType.INT,serializable:false,getter:function(){var a=this.getBondForm();return a?a.getBondValence():0},setter:null});this.defineProp("electronCount",{dataType:DataType.FLOAT,getter:function(){if(this.isAromatic()){return 3}var a=this.getBondForm();return a?a.getElectronCount():Kekule.ElectronSet.UNSET_ELECTRONCOUNT},setter:function(b){var a=this.getBondOrder();this.changeBondForm(a,b)}});this.defineProp("stereo",{dataType:DataType.INT,enumSource:Kekule.BondStereo,defaultValue:Kekule.BondStereo.NONE});this.defineProp("isInAromaticRing",{dataType:DataType.BOOL,setter:null,getter:function(){var a=false;var b=this.getParent();if(b&&b.isConnectorInAromaticRing){return b.isConnectorInAromaticRing(this)}else{return false}}})},initPropValues:function(){this.setPropStoreFieldValue("stereo",Kekule.BondStereo.NONE)},getAutoIdPrefix:function(){return"b"},changeBondForm:function(b,c,a){this.setBondForm(Kekule.BondFormFactory.getBondForm(b,c,a))},invertBondDirection:function(){this.setStereo(Kekule.BondStereo.getInvertedStereo(this.getStereo()))},reverseConnectedObjOrder:function($super){$super();this.invertBondDirection()},normalizeDirection:function(){var b=Kekule.BondStereo;var a=[b.UP_INVERTED,b.DOWN_INVERTED,b.UP_OR_DOWN_INVERTED];var c=this.getBondStereo();if(a.indexOf(c)>=0){this.reverseConnectedObjOrder()}},isAromatic:function(){return(!!this.getIsInAromaticRing()||(this.getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC))&&(this.getBondType()===Kekule.BondType.COVALENT)},isBondBetween:function(e,d){var h=this.getConnectedObjs();if(h.length!==2){return false}var c,b;for(var f=0,a=h.length;f<a;++f){var g=h[f];if(g instanceof Kekule.Atom){if(g.isElement(e)){c=true}else{if(g.isElement(d)){b=true}}if(c&&b){return true}}}return false}});Kekule.ChemStructureObjectGroup=Class.create(Kekule.ChemStructureObject,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.ChemStructureObject","Kekule.ChemStructureObjectGroup"],initialize:function($super,a){$super(a);this.setPropStoreFieldValue("items",[]);this.setPropStoreFieldValue("raiseExceptionOnTypeMismatch",[])},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY});this.defineProp("raiseExceptionOnTypeMismatch",{dataType:DataType.BOOL,defaultValue:true,scope:Class.PropertyScope.PUBLIC})},getAutoIdPrefix:function(){return"sg"},ownerChanged:function($super,b){var c=this.getItems();for(var d=0,a=c.length;d<a;++d){var e=c[d].obj;if(e&&e.setOwner){e.setOwner(b)}}$super(b)},_removeChildObj:function(b){var a=this.indexOfObj(b);if(a<0){a=this.indexOfItem(b)}if(a>=0){this.removeObjAt(a)}},getObjectBaseClasses:function(){return this.getPrototype().ITEM_BASE_CLASSES},ensureItemClass:function(obj){var classes=this.getObjectBaseClasses();if(classes.length>0){for(var i=0,l=classes.length;i<l;++i){if(obj instanceof eval(classes[i])){return true}}if(this.getRaiseExceptionOnTypeMismatch()){var msg=Kekule.hasLocalRes()?Kekule.ErrorMsg.CHEMSTRUCTUREOBJECTGROUP_ITEMCLASS_MISMATCH:"Mismatched group item class";Kekule.raise(msg)}return false}else{return true}},notifyItemsChanged:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},indexOfItem:function(a){return this.getItems().indexOf(a)},indexOfObj:function(d){var b=this.getItems();for(var c=0,a=b.length;c<a;++c){if(b[c].obj==d){return c}}return -1},hasObj:function(a){return this.indexOfObj(a)>=0},setAttributesAt:function(c,b){var f=this.getItems()[c];if(f){var e=Kekule.ObjUtils.getOwnedFieldNames(b);for(var d=0,a=e.length;d<a;++d){f[e[d]]=b[e[d]]}}},getItemCount:function(){return this.getItems().length},getItemAt:function(a){return this.getItems()[a]},appendItem:function(a){this.getItems().push(a);return this},insertItem:function(b,a){return Kekule.ArrayUtils.insertUniqueEx(this.getItems(),b,a).index},removeItemAt:function(a){var b=this.getItems()[a];if(b){this.getItems().splice(a,1);this.notifyItemsChanged()}},removeItem:function(b){var a=this.getItems().indexOf(b);if(a>=0){this.removeItemAt(a)}},getObjAt:function(a){var b=this.getItemAt(a);return b?b.obj:null},insertObj:function(e,b,d){if(!e){return}if(this.indexOfObj(e)>=0){}else{if(this.ensureItemClass(e)){var c={obj:e};this.beginUpdate();try{var a=this.insertItem(c,b);if(attributes){this.setAttributesAt(a,attributes)}this.notifyItemsChanged()}finally{this.endUpdate()}return a}}},appendObj:function(b,a){return this.insertObj(b,null,a)},removeObjAt:function(a){var b=this.getItems()[a];if(b){this.getItems().splice(a,1);this.notifyItemsChanged()}},removeObj:function(b){var a=this.indexOfObj(b);if(a>=0){this.removeObjAt(a)}},getAllObjs:function(){var a=[];for(var c=0,b=this.getItemCount();c<b;++c){a.push(this.getObjAt(c))}return a},getChildCount:function(){return this.getItemCount()},getChildAt:function(a){return this.getObjAt(a)},indexOfChild:function(b){var a=this.indexOfObj(b);if(a<0){a=this.indexOfItem(b)}return a},getNextSiblingOfChild:function(b){var a=this.indexOfItem(b);if(a<0){a=this.indexOfObj(b)}return(a>=0)?this.getChildAt(index+1):null},appendChild:function(a){if(a instanceof Kekule.ChemObject){return this.appendObj(a)}else{return this.appendItem(a)}},insertChild:function(b,a){if(b instanceof Kekule.ChemObject){return this.insertObj(b,a)}else{return this.insertItem(b)}},insertBefore:function(b,a){var c=this.indexOfItem(a);if(c<0){c=this.indexOfObj(a)}return this.insertChild(b,a)},removeChildAt:function(a){return this.removeItemAt(a)},removeChild:function(b){var a=this.indexOfItem(b);if(a<=0){a=this.indexOfObj(b)}if(a>=0){this.removeItemAt(a)}}});Kekule.StructureFragmentGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.ChemStructureObjectGroup",ITEM_BASE_CLASSES:["Kekule.StructureFragment","Kekule.StructureFragmentGroup"]});Kekule.MoleculeGroup=Class.create(Kekule.ChemStructureObjectGroup,{CLASS_NAME:"Kekule.MoleculeGroup",ITEM_BASE_CLASSES:["Kekule.Molecule","Kekule.MoleculeGroup"]});Kekule.CompositeMolecule=Class.create(Kekule.Molecule,{CLASS_NAME:"Kekule.CompositeMolecule",initialize:function($super,b,a){$super(b,a)},initProperties:function(){this.defineProp("subMolecules",{dataType:"Kekule.MoleculeGroup",getter:function(){if(!this.getPropStoreFieldValue("subMolecules")){this.setPropStoreFieldValue("subMolecules",new Kekule.MoleculeGroup())}return this.getPropStoreFieldValue("subMolecules")}})},ownerChanged:function($super,a){var b=this.getPropStoreFieldValue("subMolecules");if(b){b.setOwner(a)}$super(a)},getSubMoleculeCount:function(){var a=this.getPropStoreFieldValue("subMolecules");return a?a.length:0},hasCtab:function(){return false},hasFormula:function(){return false},getAllContainingConnectors:function(){var g=this.getSubMolecules();var c=[];for(var f=0,e=g.getItemCount();f<e;++f){var b=g.getObjAt(f);if(b.getAllContainingConnectors){var d=b.getAllContainingConnectors();if(d&&d.length){c=c.concat(d)}}}return c},getContainerBox:function(f){var a=null;var d=this.getPropStoreFieldValue("subMolecules");if(d){for(var c=0,b=d.getItemCount();c<b;++c){var g=d.getObjAt(c);var e=g.getContainerBox(f);if(e){if(!a){a=Object.extend({},e)}else{a=Kekule.BoxUtils.getContainerBox(a,e)}}}}return a},doGetCtab:function(){return null},doSetCtab:function(){},doGetFormula:function(){return null},doSetFormula:function(){},getChildCount:function(){return this.getSubMolecules().getChildCount()},getChildAt:function(a){return this.getSubMolecules().getChildAt(a)},indexOfChild:function(a){return this.getSubMolecules().indexOfChild(a)},getNextSiblingOfChild:function(a){return this.getSubMolecules().getNextSiblingOfChild(a)},appendChild:function(a){return this.getSubMolecules().appendChild(a)},insertChild:function(b,a){return this.getSubMolecules().insertChild(b,a)},insertBefore:function(b,a){return this.getSubMolecules().insertBefore(b,a)},removeChildAt:function(a){return this.getSubMolecules().removeChildAt(a)},removeChild:function(a){return this.getSubMolecules().removeChild(a)}});Kekule.MoleculeList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.MoleculeList",initialize:function($super,a){$super(a,Kekule.Molecule)}});Kekule.ChemStructureBuilder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructureBuilder",initialize:function($super,a){$super();if(a){this.setTarget(a)}},initProperties:function(){this.defineProp("target",{dataType:"Kekule.StructureFragment"})},setNodeCoord:function(){var c=Array.prototype.slice.call(arguments);var e=c.shift();var f=c;for(var d=0,b=f.length;(d<b)&&(d<2);++d){var g=f[d];if(g.z!==undefined){e.setCoordOfMode(g,Kekule.CoordMode.COORD3D)}else{e.setCoordOfMode(g,Kekule.CoordMode.COORD2D)}}},createNode:function(){var c=Array.prototype.slice.call(arguments);var d=c.shift();var f=c.shift();var e=c;var b=new d(f);this.setNodeCoord(b,e);this.appendNode(b);return b},createConnector:function(b,d,c){var a=new b(d);a.setConnectedObjs(c);return a},appendNode:function(a){if(a&&this.getTarget()){return this.getTarget().appendNode(a)}else{return null}},appendConnector:function(a){if(a&&this.getTarget()){return this.getTarget().appendConnector(a)}else{return null}},createAtom:function(){var e=Array.prototype.slice.call(arguments);var f=e.shift();var c=e.shift();var d=e.shift();var b=new Kekule.Atom(f,c,d);e.unshift(b);this.setNodeCoord.apply(this,e);this.appendNode(b);return b},createBond:function(f,e,c,d,b){var a=new Kekule.Bond(f,e,c);a.changeBondForm(c,null,b);if(d){a.setStereo(d)}this.appendConnector(a);return a},deleteNode:function(){},marshalSubGroup:function(a,d){var c=this.getTarget();if(c&&c.hasCtab()){var b=new Kekule.SubGroup(d);c.marshalSubFragment(a,b);return b}else{return null}}});Kekule.ReactionComponent={REACTANT:"reactant",PRODUCT:"product",SUBSTANCE:"substance",CONDITION:"condition"};Kekule.ReactionRole={REAGENT:"reagent",CATALYST:"catalyst",SOLVENT:"solvent",TEMPERATURE:"temperature",DURATION:"duration"};Kekule.ReactionDirection={FORWARD:1,BACKWARD:-1,BIDIRECTION:0};Kekule.Reaction=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Reaction",initialize:function($super,a){$super(a);this.setDirection(Kekule.ReactionDirection.FORWARD)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING});this.defineProp("title",{dataType:DataType.STRING});this.defineProp("reactionType",{dataType:DataType.STRING});this.defineProp("yield",{dataType:DataType.FLOAT});this.defineProp("direction",{dataType:DataType.INT,defaultValue:Kekule.ReactionDirection.FORWARD,enumSource:Kekule.ReactionDirection});this.defineProp("reactants",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("reactants");if((!a)&&b){a=[];this.setPropStoreFieldValue("reactants",a)}return a}});this.defineProp("products",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("products");if((!a)&&b){a=[];this.setPropStoreFieldValue("products",a)}return a}});this.defineProp("substances",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("substances");if((!a)&&b){a=[];this.setPropStoreFieldValue("substances",a)}return a}});this.defineProp("conditions",{dataType:DataType.ARRAY,setter:null,getter:function(b){var a=this.getPropStoreFieldValue("conditions");if((!a)&&b){a=[];this.setPropStoreFieldValue("conditions",a)}return a}})},ownerChanged:function($super,f){var g=["reactants","products","substances","conditions"];for(var e=0,b=g.length;e<b;++e){var h=g[e];var m=this.getComponentArray(h);if(m){for(var d=0,c=m.length;d<c;++d){var n=m[d].item;if(n.setOwner){n.setOwner(f)}}}}$super(f)},assertAddingMolecule:function(a){if(!(a instanceof Kekule.Molecule)){Kekule.chemError(Kekule.ErrorMsg.UNABLE_ADD_NONMOLECULE_MAP)}},notifyReactantsChange:function(){this.notifyPropSet("reactants",this.getPropStoreFieldValue("reactants"))},notifyProductsChange:function(){this.notifyPropSet("products",this.getPropStoreFieldValue("products"))},notifySubstancesChange:function(){this.notifyPropSet("substances",this.getPropStoreFieldValue("substances"))},notifyConditionsChange:function(){this.notifyPropSet("conditions",this.getPropStoreFieldValue("conditions"))},notifyComponentChange:function(a){var b=this.componentToPropName(a);if(b){this.notifyPropSet(b,this.getPropStoreFieldValue(b))}},componentToPropName:function(a){return a+"s"},getComponentArray:function(a,c){var b=this.componentToPropName(a);if(b){switch(b){case"reactants":return this.doGetReactants(c);break;case"products":return this.doGetProducts(c);break;case"substances":return this.doGetSubstances(c);break;case"conditions":return this.doGetConditions(c);break;default:return null}}else{return null}},getComponentItemCount:function(c){var b=this.getComponentArray(c);return b?b.length:0},getMapAt:function(d,c){var b=this.getComponentArray(d);return b?b[c]:null},getMapItemAt:function(b,a){var c=this.getMapAt(b,a);return c?c.item:null},indexOfMap:function(c,d){var b=this.getComponentArray(c);return b?b.indexOf(d):-1},indexOfItem:function(d,f,g){var c=this.getComponentArray(d);if(c){for(var e=0,b=c.length;e<b;++e){if(c[e].item==f){if(typeof(g)==="undefined"){return e}else{if(g===c[e].role){return e}}}}}return -1},appendMap:function(a,c){if((a==Kekule.ReactionComponent.PRODUCT)||(a==Kekule.ReactionComponent.REACTANT)){this.assertAddingMolecule(c.item)}var b=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(a,true),c);if(b.isPushed){this.notifyComponentChange(a)}return b.index},appendItem:function(b,e,g,c){var a=this.indexOfItem(b,e,g);if(a<0){if((b==Kekule.ReactionComponent.PRODUCT)||(b==Kekule.ReactionComponent.REACTANT)){this.assertAddingMolecule(e)}var f=Kekule.RoleMapUtils.createMap(e,g);if(c){Object.extend(f,c)}var d=Kekule.ArrayUtils.pushUniqueEx(this.getComponentArray(b,true),f);this.notifyComponentChange(b);return d.index}else{return a}},removeMapAt:function(d,c){var e=null;var b=this.getComponentArray(d);if(b){e=Kekule.ArrayUtils.removeAt(b,c);if(e){this.notifyComponentChange(d)}}return e},removeMap:function(c,e){var d=null;var b=this.getComponentArray(c);if(b){d=Kekule.ArrayUtils.remove(b,e);if(d){this.notifyComponentChange(c)}}return d},removeItem:function(b,c,d){var a=this.indexOfItem(b,c,d);if(a>=0){return this.removeMapAt(b,a)}else{return null}},clearComponent:function(c){var b=this.getComponentArray(c);b=[];this.notifyComponentChange(c)},getReactantCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.REACTANT)},getProductCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.PRODUCT)},getSubstancesCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.SUBSTANCE)},getConditionCount:function(){return this.getComponentItemCount(Kekule.ReactionComponent.CONDITION)},getReactantMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.REACTANT,a)},getProductMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.PRODUCT,a)},getSubstanceMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.SUBSTANCE,a)},getConditionMapAt:function(a){return this.getMapAt(Kekule.ReactionComponent.CONDITION,a)},getReactantItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,a)},getReactantAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.REACTANT,a)},getProductItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,a)},getProductAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.PRODUCT,a)},getSubstanceItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,a)},getSubstanceAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.SUBSTANCE,a)},getConditionItemAt:function(a){return this.getMapItemAt(Kekule.ReactionComponent.CONDITION,a)},indexOfReactantMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.REACTANT,a)},indexOfProductMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.PRODUCT,a)},indexOfSubstanceMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.SUBSTANCE,a)},indexOfConditionMap:function(a){return this.indexOfMap(Kekule.ReactionComponent.CONDITION,a)},indexOfReactant:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.REACTANT,a,b)},indexOfProduct:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.PRODUCT,a,b)},indexOfSubstance:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.SUBSTANCE,a,b)},indexOfCondition:function(a,b){return this.indexOfItem(Kekule.ReactionComponent.CONDITION,a,b)},appendReactantMap:function(a){return this.appendMap(Kekule.ReactionComponent.REACTANT,a)},appendProductMap:function(a){return this.appendMap(Kekule.ReactionComponent.PRODUCT,a)},appendSubstanceMap:function(a){return this.appendMap(Kekule.ReactionComponent.SUBSTANCE,a)},appendConditionMap:function(a){return this.appendMap(Kekule.ReactionComponent.CONDITION,a)},appendReactant:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.REACTANT,c,e,d)},appendProduct:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.PRODUCT,c,e,d)},appendSubstance:function(c,e,a,b){var d=b||{};if(a){d.amount=a}return this.appendItem(Kekule.ReactionComponent.SUBSTANCE,c,e,d)},appendCondition:function(b,c,a){return this.appendItem(Kekule.ReactionComponent.CONDITION,b,c,info)},removeReactantAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.REACTANT,a)},removeProductAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.PRODUCT,a)},removeSubstanceAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.SUBSTANCE,a)},removeConditionAt:function(a){return this.removeMapAt(Kekule.ReactionComponent.CONDITION,a)},removeReactantMap:function(a){return this.removeMap(Kekule.ReactionComponent.REACTANT,a)},removeProductMap:function(a){return this.removeMap(Kekule.ReactionComponent.PRODUCT,a)},removeSubstanceMap:function(a){return this.removeMap(Kekule.ReactionComponent.SUBSTANCE,a)},removeConditionMap:function(a){return this.removeMap(Kekule.ReactionComponent.CONDITION,a)},removeReactant:function(a,b){return this.removeItem(Kekule.ReactionComponent.REACTANT,a,b)},removeProduct:function(a,b){return this.removeItem(Kekule.ReactionComponent.PRODUCT,a,b)},removeSubstance:function(a,b){return this.removeItem(Kekule.ReactionComponent.SUBSTANCE,a,b)},removeCondition:function(a,b){return this.removeItem(Kekule.ReactionComponent.CONDITION,a,b)},clearReactants:function(){return this.clearComponent(Kekule.ReactionComponent.REACTANT)},clearProducts:function(){return this.clearComponent(Kekule.ReactionComponent.PRODUCT)},clearSubstance:function(){return this.clearComponent(Kekule.ReactionComponent.SUBSTANCE)},clearConditions:function(){return this.clearComponent(Kekule.ReactionComponent.CONDITION)},clearAll:function(){this.clearProducts();this.clearProducts();this.clearSubstance();this.clearConditions()},getAllContainingConnectors:function(){var b=Kekule.ReactionComponent;var c=[b.REACTANT,b.PRODUCT,b.SUBSTANCE];var o=[];for(var g=0,d=c.length;g<d;++g){var h=c[g];for(var f=0,e=this.getComponentItemCount(h);f<e;++f){var n=this.getMapItemAt(h,f);if(n.getAllContainingConnectors){var m=mols[g].getAllContainingConnectors();if(m&&m.length){o=o.concat(m)}}}}return o}});Kekule.ReactionList=Class.create(Kekule.ChemObjList,{CLASS_NAME:"Kekule.ReactionList",initialize:function($super,a){$super(a,Kekule.Reaction)}});(function(){Kekule.ChemStructureUtils={getConnectorLengthMedian:function(b,g,c){var d=[];for(var h=0,e=b.length;h<e;++h){var f=b[h];if(f&&f.getLength){var a=f.getLength(g,c);if(a){d.push(a)}}}if(e===0){return 1}if(e<=1){return d[0]}else{d.sort();var m=d.length;return(m%2)?d[(m+1)>>1]:(d[m>>1]+d[(m>>1)+1])/2}},getChildStructureObjs:function(h,e){var b;if(h instanceof Kekule.CompositeMolecule){b=h.getSubMolecules().getAllObjs()}else{if(h instanceof Kekule.ChemStructureObjectGroup){b=h.getAllObjs()}else{if(h instanceof Kekule.ChemObjList){b=h.getItems()}else{if(h instanceof Kekule.ChemSpaceElement){b=h.getChildren().getItems()}else{if(h instanceof Kekule.ChemSpace){b=h.getChildren()}else{return[h]}}}}}b=[].concat(b);if(e){var d=[];for(var f=0,c=b.length;f<c;++f){var g=b[f];var a=Kekule.ChemStructureUtils.getChildStructureObjs(g,e);if(a.length<=1){Kekule.ArrayUtils.pushUnique(d,g)}else{Kekule.ArrayUtils.pushUnique(d,a)}}b=d}return b},getAllStructFragments:function(f,c){if(f instanceof Kekule.StructureFragment){return[f]}var e=Kekule.ChemStructureUtils.getChildStructureObjs(f,c);var a=[];for(var d=0,b=e.length;d<b;++d){if(e[d] instanceof Kekule.StructureFragment){Kekule.ArrayUtils.pushUnique(a,e[d])}}return a},getTotalStructFragment:function(d,b){var a=Kekule.ChemStructureUtils.getAllStructFragments(d,true);var c=a.length;if(c<=0){return null}else{if(c===1){return a[0]}else{return Kekule.ChemStructureUtils.mergeStructFragments(a,b)}}},getCascadeDeleteObjs:function(f){var m=[];var g=f.getLinkedConnectors?f.getLinkedConnectors():[];for(var d=0,a=g.length;d<a;++d){var b=g[d];if(b.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(m,b);var h=Kekule.ChemStructureUtils.getCascadeDeleteObjs(b);Kekule.ArrayUtils.pushUnique(m,h)}}if(f instanceof Kekule.ChemStructureNode){}else{if(f instanceof Kekule.ChemStructureConnector){var e=f.getConnectedObjs();for(var d=0,a=e.length;d<a;++d){var c=e[d];if(c instanceof Kekule.ChemStructureNode){if(c.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(m,c)}}}}else{}}return m},moveChildBetweenStructFragment:function(e,a,b,d,c){return Kekule.StructureFragment.moveChildBetweenStructFragment(e,a,b,d,c)},_getCascadeConnectedNodesAndConnectors:function(b){var a=[];var d=[];var h=b.getConnectedObjs();for(var e=0,c=h.length;e<c;++e){var g=h[e];if(g!==b){if(g instanceof Kekule.ChemStructureNode){Kekule.ArrayUtils.pushUnique(d,g)}else{if(g instanceof Kekule.ChemStructureConnector){Kekule.ArrayUtils.pushUnique(a,g);var f=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(g);Kekule.ArrayUtils.pushUnique(a,f.connectors);Kekule.ArrayUtils.pushUnique(d,f.nodes)}}}}return{connectors:a,nodes:d}},mergeStructFragments:function(b,e){if(b.length<=1){return b[0]}else{var f=e||Kekule.Molecule;var a=new f();for(var d=0,c=b.length;d<c;++d){var g=b[d].clone();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(g,a,g.getNodes(),g.getConnectors())}return a}},splitStructFragment:function(s){if(!s.hasCtab()){return[s]}var c=s.getNodes();if(c.length<=0){return[s]}var n=s.getConnectors();var t=[];var r=[c[0]];var g=[];var b=0;do{var f=r[b];var e=f.getLinkedConnectors();Kekule.ArrayUtils.pushUnique(g,e);for(var q=0,h=e.length;q<h;++q){var p=Kekule.ChemStructureUtils._getCascadeConnectedNodesAndConnectors(e[q]);Kekule.ArrayUtils.pushUnique(g,p.connectors);Kekule.ArrayUtils.pushUnique(r,p.nodes)}++b}while(b<r.length);t.push(s);var d=Kekule.ArrayUtils.exclude(c,r);var m=Kekule.ArrayUtils.exclude(n,g);if(d.length>0){var a=s.getClass();var o=new a();Kekule.ChemStructureUtils.moveChildBetweenStructFragment(s,o,d,m);var u=Kekule.ChemStructureUtils.splitStructFragment(o);t=t.concat(u)}return t},getAbsCoordVectorBetweenObjs:function(f,e,c,a){var d=f.getAbsCoordOfMode(c,a);var b=e.getAbsCoordOfMode(c,a);return Kekule.CoordUtils.substract(b,d)}}})();if(!this.Kekule){Kekule={}}Kekule.oneOf=function(){var b=arguments;var d=Kekule.ObjUtils.notUnset;for(var c=0,a=b.length;c<a;++c){if(d(b[c])){return b[c]}}return null};Kekule.ClassUtils={getShortClassName:function(a){var b=a.indexOf(".");if(b>=0){return a.substring(b+1)}else{return a}},getLastClassName:function(a){var b=a.lastIndexOf(".");return(b>=0)?a.substring(b+1):a},makeSingleton:function(a){return Object.extend(a,{_instance:null,getInstance:function(m,l,i,h,g,f,e,d,c,b){if(!a._instance){a._instance=new a(m,l,i,h,g,f,e,d,c,b)}return a._instance}})}};Kekule.NumUtils={isInteger:function(a){return(typeof(a)==="number")&&(parseInt(a,10)===parseFloat(a))},toDecimals:function(a,e){if(Kekule.NumUtils.isInteger(a)){return a.toString()}var g=Math.pow(10,e);var h=Math.round(a*g);h=h/g;var b=parseInt(h);var d=h-b;var c=d.toString();if(c.length>e+2){c=c.substr(2,e);return b.toString()+"."+c}else{return h.toString()}},isFloatEqual:function(b,c,a){if(Kekule.ObjUtils.isUnset(a)){a=1e-100}return Math.abs(b-c)<=a}};Kekule.ObjUtils={getPrototypeOf:function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):(a.prototype||a.__proto__)},getOwnedFieldNames:function(b){var a=[];for(var c in b){if(b.hasOwnProperty(c)&&(typeof(b[c])!="function")){a.push(c)}}return a},replacePropName:function(c,b,a){if(c[b]!==undefined){if(c.hasOwnProperty(b)){c[a]=c[b];delete c[b]}else{Kekule.raise(Kekule.ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED)}}return c},isUnset:function(a){return(a===null)||(typeof(a)=="undefined")},notUnset:function(a){return(a!==null)&&(typeof(a)!=="undefined")},equal:function(c,a,b){for(var d in c){if(b&&(b.indexOf(d)>=0)){continue}if(c[d]!==a[d]){return false}}return true},match:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!==c[b]){return false}}}return true},isInstanceOf:function(d,c){if(!DataType.isArrayValue(c)){return(d instanceof c)}else{for(var b=0,a=c.length;b<a;++b){if(d instanceof c[b]){return true}}return false}}};Kekule.ArrayUtils={isArray:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},toArray:function(a){if(Kekule.ArrayUtils.isArray(a)){return a}else{return[a]}},clone:function(a){return a.slice(0)},pushUnique:function(c,b){var a=Kekule.ArrayUtils.pushUniqueEx(c,b);return a?a.index:null},pushUniqueEx:function(f,e){if(DataType.isArrayValue(e)){var d;for(var c=0,a=e.length;c<a;++c){if(Kekule.ObjUtils.isUnset(d)){d=Kekule.ArrayUtils.pushUniqueEx(f,e[c])}else{Kekule.ArrayUtils.pushUniqueEx(f,e[c])}}return d}else{if(!e){return{index:-1,isPushed:false}}var b=f.indexOf(e);if(b<0){return{index:f.push(e),isPushed:true}}else{return{index:b,isPushed:false}}}},insertUnique:function(c,b,a){return Kekule.ArrayUtils.insertUniqueEx(c,b,a).index},insertUniqueEx:function(d,c,a){if(!c){return{index:-1,isInserted:false}}if(Kekule.ObjUtils.isUnset(a)||(a<0)){a=d.length}var b=d.indexOf(c);if(b<0){d.splice(a,0,c);return{index:a,isInserted:true}}else{if(b!=a){d.splice(b,1);d.splice(a,0,c);return{index:a,isInserted:false}}}},removeAt:function(c,a){var b=c[a];if(typeof(b)!="undefined"){c.splice(a,1);return b}else{return null}},remove:function(c,b){var a=c.indexOf(b);if(a>=0){return Kekule.ArrayUtils.removeAt(c,a)}else{return null}},changeIndex:function(c,d,a){if((d>=0)&&(d<=c.length)){var b=c[d];c.splice(d,1);c.splice(a,0,b);return b}else{return null}},changeItemIndex:function(d,c,b){var a=d.indexOf(c);return Kekule.ArrayUtils.changeIndex(d,a,b)},toUnique:function(f){var c=[];for(var g=0,d=f.length;g<d;++g){var h=f[g];if(c.indexOf(h)<0){c.push(h)}}return c},getUniqueElemCount:function(d){var c=Kekule.ArrayUtils.toUnique(d);return c.length},reverse:function(d){var b=[];for(var e=0,c=d.length;e<c;++e){if(Kekule.ObjUtils.notUnset(d[e])){b[c-e-1]=d[e]}}return b},exclude:function(f,g){var a=[];var e=Kekule.ArrayUtils.toArray(g);for(var c=0,b=f.length;c<b;++c){var d=f[c];if(e.indexOf(d)<0){a.push(d)}}return a},intersect:function(d,b){var a=[];for(var e=0,c=d.length;e<c;++e){if(b.indexOf(d[e])>=0){a.push(d[e])}}return a},compareNestedArray:function(c,b,a){var d=Math.min(c.length,b.length);if(!a){a=function(o,l){return o-l}}for(var e=0;e<d;++e){var n=0;var g=c[e];var f=b[e];var m=DataType.isArrayValue(g);var h=DataType.isArrayValue(f);if(m&&h){n=Kekule.ArrayUtils.compareNestedArray(g,f,a)}else{if(m){n=1}else{if(h){n=-1}else{n=a(g,f)}}}if(n!=0){return n}}if(c.length>d){return 1}else{if(b.length>d){return -1}else{return 0}}},getMedian:function(b){var d=[].concat(b);var c=d.length;if(c===0){return null}if(c<=1){return d[0]}else{d.sort();return(c%2)?d[(c+1)>>1]:(d[c>>1]+d[(c>>1)+1])/2}}};Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(a){return a.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(a){return a.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(a){return""+a},convertToType:function(a,b){if(typeof(a)!="string"){return a}switch(b){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(a);break;case DataType.INT:return parseInt(a);break;case DataType.BOOL:return Kekule.StrUtils.strToBool(a);break;default:return a}},boolToStr:function(a){if(a){return Kekule.StrUtils.STR_TRUES[0]}else{return Kekule.StrUtils.STR_FALSES[0]}},strToBool:function(d){var b=d.toLowerCase();for(var c=0,a=Kekule.StrUtils.STR_FALSES.length;c<a;++c){if(b==Kekule.StrUtils.STR_FALSES[c]){return false}}return !!d},removeAroundPair:function(c,b,a){if(c.startsWith(b)&&c.endsWith(a)){return c.substring(b.length,c.length-b.length-a.length+1)}else{return c}},unquote:function(c){var b=Kekule.StrUtils.removeAroundPair;var a=c;a=b(a,"'","'");a=b(a,'"','"');return a},splitTokens:function(b,a){if(!b){return[]}if(DataType.isArrayValue(b)){return b}else{return b.replace(a||/\s+/g," ").split(" ")}},hasToken:function(d,a,c){var b=Kekule.StrUtils.splitTokens(d,c);return(b.indexOf(a)>=0)},addTokens:function(g,e,d){var c=Kekule.StrUtils.splitTokens(g,d);var f=Kekule.StrUtils.splitTokens(e,d);for(var b=0,a=f.length;b<a;++b){if(c.indexOf(f[b])<0){c.push(f[b])}}return c.join(d||" ")},removeTokens:function(h,g,f){var e=Kekule.StrUtils.splitTokens(h,f);var d=Kekule.StrUtils.splitTokens(g,f);for(var c=0,a=d.length;c<a;++c){var b=e.indexOf(d[c]);if(b>=0){e.splice(b,1)}}return e.join(f||" ")},toggleTokens:function(g,h,d){var f=Kekule.StrUtils.splitTokens(g,d);var a=Kekule.StrUtils.splitTokens(h,d);var m=[];for(var c=0,b=a.length;c<b;++c){var e=f.indexOf(a[c]);if(e>=0){f.splice(e,1)}else{m.push(a[c])}}f=f.concat(m);return f.join(d||" ")},getLineCount:function(c,b){if(!b){b="\n"}var a=c.split(b);return a.length},getMaxLineCharCount:function(g,f){if(!f){f="\n"}var d=g.split(f);var a=0;for(var e=0,c=d.length;e<c;++e){var b=d[e];a=Math.max(b.length,a)}return a}};Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(b,c){var a={};c=c||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE;a[Kekule.RoleMapUtils.KEY_ITEM]=b;a[Kekule.RoleMapUtils.KEY_ROLE]=c;return a},getItem:function(a){return a[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(b,a){b[Kekule.RoleMapUtils.KEY_ITEM]=a},getRole:function(a){return a[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(a,b){a[Kekule.RoleMapUtils.KEY_ROLE]=b}};Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(b){var c=Kekule.FactoryUtils;var a={_items:new Kekule.MapEx(true),_matchMethod:b||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(d,e){a._items.set(d,e)},unregister:function(d){a._items.remove(d)},getClass:function(d){if(a._matchMethod===c.MATCH_EXACTLY){return a._items.get(d)}else{if(a._matchMethod===c.MATCH_BY_CLASS){var f=a._items.get(d);if(!f){var e=ClassEx.getSuperClass(d);if(e){f=a.getClass(e)}}return f}}},getInstance:function(o,p,n,l,i,h,g,f,e,d){var m=a.getClass(o);if(m){return new m(p,n,l,i,h,g,f,e,d)}}};return a}};Kekule.UrlUtils={EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",extractFileName:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);if(b>=0){return a.substr(b+1)}else{return a}},extractFileExt:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(b+1)}else{return""}}else{return null}},extractSearch:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);if(b>=0){return a.substr(b)}else{return null}},analysisSearch:function(b,e){var m=Kekule.UrlUtils.extractSearch(b);m=m.substr(1);var c=m.split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER);var n=e?{}:[];for(var g=0,d=c.length;g<d;++g){var f=c[g];var h=f.split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);if(h[0]){if(e){n[h[0]]=h[1]}else{n.push({key:h[0],value:h[1]})}}}return n}};Kekule.MatrixUtils={create:function(n,q,h){var s=false;var p=false;var o=Kekule.ObjUtils;if(o.notUnset(h)){s=true;if(Kekule.ArrayUtils.isArray(h)){p=true}}var g=0;var b=new Array(n);for(var f=0,c=b.length;f<c;++f){var a=new Array(q);if(s){for(var e=0,d=a.length;e<d;++e){if(p&&o.notUnset(h[g])){a[e]=h[g];++g}else{a[e]=h}}}b[f]=a}return b},createIdentity:function(b){var a=Kekule.MatrixUtils.create(b,b,0);for(var c=0;c<b-1;++c){a[c][c]=1}return a},getRowCount:function(a){return a.length},getColCount:function(a){return(Kekule.MatrixUtils.getRowCount(a)>0)?a[0].length:0},getValue:function(a,c,b){return a[c-1][b-1]||0},setValue:function(a,d,b,c){a[d-1][b-1]=c},transpose:function(b){var h=Kekule.MatrixUtils;var c=h.getColCount(b);var g=h.getRowCount(b);var a=h.create(c,g);for(var e=1;e<=c;++e){var f=a[e-1];for(var d=1;d<=g;++d){f[d-1]=h.getValue(b,d,e)}}return a},minus:function(g){var e=Kekule.MatrixUtils;var f=e.getRowCount(g);var h=e.getColCount(g);var l=this.create(f,h);for(var d=0;d<f;++d){var a=l[d];var b=g[d];for(var c=0;c<h;++c){a[c]=-(b[c]||0)}}},add:function(e,c){var h=Kekule.MatrixUtils;var b=h.getRowCount(e);var g=h.getColCount(e);var a=this.create(b,g);for(var f=1;f<=b;++f){for(var d=1;d<=g;++d){h.setValue(a,f,d,h.getValue(e,f,d)+h.getValue(c,f,d))}}return a},substract:function(b,a){var c=Kekule.MatrixUtils;return c.add(b,c.minus(a))},multiply:function(l,h){var e=Kekule.MatrixUtils;var f=e.getRowCount(l);var g=e.getColCount(h);var m=e.create(f,g);for(var c=1;c<=f;++c){for(var b=1;b<=g;++b){var d=0;for(var a=1;a<=f;++a){d+=e.getValue(l,c,a)*e.getValue(h,a,b)}e.setValue(m,c,b,d)}}return m}};Kekule.CoordUtils={create:function(b,d,c){var a={x:b,y:d};if(c||(c===0)){a.z=c}return a},is3D:function(a){return(a.z||(a.z===0))},isEqual:function(c,b){var a=(c.x===b.x)&&(c.y===b.y);var d=Kekule.ObjUtils;if(a&&(d.notUnset(c.z)||d.notUnset(b.z))){a=(c.z===b.z)}return a},add:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)+(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)+(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)+(b.z||0)}return a},substract:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)-(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)-(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)-(b.z||0)}return a},multiply:function(c,b){var a={};if(!Kekule.ObjUtils.isUnset(c.x)){a.x=c.x*b}if(!Kekule.ObjUtils.isUnset(c.y)){a.y=c.y*b}if(!Kekule.ObjUtils.isUnset(c.z)){a.z=c.z*b}return a},divide:function(b,a){return Kekule.CoordUtils.multiply(b,1/a)},standardize:function(b){var a=Math.sqrt(Math.sqr(b.x||0)+Math.sqr(b.y||0)+Math.sqr(b.z||0));return Kekule.CoordUtils.divide(b,a)},toArray:function(b){var a=[];a.push(b.x,b.y);if(Kekule.CoordUtils.is3D(b)){a.push(b.z)}},transform2D:function(d,c){var b=Kekule.CoordUtils.calcTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},inverseTransform2D:function(d,c){var b=Kekule.CoordUtils.calcInverseTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},transform2DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(3,1,[d.x||0,d.y||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0]}},calcTransform2DMatrix:function(c,d){var i=Kekule.MatrixUtils;var l=c||{};var r=l.center;if(r){var s=i.create(3,3,[1,0,-(r.x||0),0,1,-(r.y||0),0,0,1]);var h=i.create(3,3,[1,0,(r.x||0),0,1,(r.y||0),0,0,1])}if(l.rotateAngle){var t=l.rotateAngle;var q=Math.cos(t);var f=Math.sin(t);var b=i.create(3,3,[q,-f,0,f,q,0,0,0,1])}var v=l.scale;var p=l.scaleX;var o=l.scaleY;var n=v||1;if(v||p||o){var e=i.create(3,3);i.setValue(e,1,1,p||n);i.setValue(e,2,2,o||n);i.setValue(e,3,3,1)}var w=l.translateX;var u=l.translateY;if(w||u){var m=i.create(3,3);i.setValue(m,1,1,1);i.setValue(m,2,2,1);i.setValue(m,3,3,1);i.setValue(m,1,3,(w||0));i.setValue(m,2,3,(u||0))}var g=i.create(3,3,[1,0,0,0,1,0,0,0,1]);if(!d){if(s){g=i.multiply(s,g)}if(b){g=i.multiply(b,g)}if(e){g=i.multiply(e,g)}if(m){g=i.multiply(m,g)}if(h){g=i.multiply(h,g)}}else{if(s){g=i.multiply(s,g)}if(m){g=i.multiply(m,g)}if(e){g=i.multiply(e,g)}if(b){g=i.multiply(b,g)}if(h){g=i.multiply(h,g)}}return g},calcInverseTransform2DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}return Kekule.CoordUtils.calcTransform2DMatrix(b,true)},transform3D:function(c,b){var a=Kekule.CoordUtils.calcTransform3DMatrix(b);return Kekule.CoordUtils.transform3DByMatrix(c,a)},transform3DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(4,1,[d.x||0,d.y||0,d.z||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0],z:a[2][0]}},_calcRotateXYZ3DMatrixCore:function(b){var m=Kekule.MatrixUtils;var o=m.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var q=[];if(b.rotateAngle&&b.rotateAxisVector){var n=Kekule.CoordUtils.standardize(b.rotateAxisVector);q.push({vector:[n.x,n.y,n.z],angle:-b.rotateAngle})}else{var f=b.rotateX;var e=b.rotateY;var d=b.rotateZ;if(f){q.push({vector:[1,0,0],angle:-f})}if(e){q.push({vector:[0,1,0],angle:-e})}if(d){q.push({vector:[0,0,1],angle:-d})}}for(var u=0,r=q.length;u<r;++u){var a=m.create(4,4);var w=q[u].angle;var g=q[u].vector;var x=Math.cos(w);var c=Math.sin(w);var p;for(var u=1;u<=4;++u){for(var t=1;t<=4;++t){if((u<4)&&(t<4)){for(var s=1;s<=3;++s){if((s!==u)&&(s!==t)){break}}var h=g[u-1]*g[t-1];p=(u<t)?h*(1-x)-Math.pow(-1,u+t)*g[s-1]*c:(u>t)?h*(1-x)+Math.pow(-1,u+t)*g[s-1]*c:h+(1-h)*x}else{if(u===t){p=1}else{p=0}}m.setValue(a,u,t,p)}}o=m.multiply(a,o)}return o},calcRotate3DMatrix:function(d){var g=Kekule.MatrixUtils;var f=Object.extend({},d||{});var e;if(f.rotateMatrix){e=f.rotateMatrix}else{var a=f.center;if(a){var b=g.create(4,4,[1,0,0,-(a.x||0),0,1,0,-(a.y||0),0,0,1,-(a.z||0),0,0,0,1]);var c=g.create(4,4,[1,0,0,(a.x||0),0,1,0,(a.y||0),0,0,1,(a.z||0),0,0,0,1])}var e=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(d);if(b){e=g.multiply(b,e)}if(c){e=g.multiply(c,e)}}return e},calcTransform3DMatrix:function(b){var g=Kekule.MatrixUtils;var h=b||{};var q=h.center;if(q){var r=g.create(4,4,[1,0,0,-(q.x||0),0,1,0,-(q.y||0),0,0,1,-(q.z||0),0,0,0,1]);var e=g.create(4,4,[1,0,0,(q.x||0),0,1,0,(q.y||0),0,0,1,(q.z||0),0,0,0,1])}var f=["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"];var m=Object.copyValues({},h,f);var a=Kekule.CoordUtils.calcRotate3DMatrix(m);var t=h.scale;var p=h.scaleX;var o=h.scaleY;var n=h.scaleZ;if(t||p||o||n){var l=t||1;var c=g.create(4,4);g.setValue(c,1,1,p||l);g.setValue(c,2,2,o||l);g.setValue(c,3,3,n||l);g.setValue(c,4,4,1)}var v=h.translateX;var u=h.translateY;var s=h.translateZ;if(v||u||s){var i=g.create(4,4);g.setValue(i,1,1,1);g.setValue(i,2,2,1);g.setValue(i,3,3,1);g.setValue(i,4,4,1);g.setValue(i,1,4,v||0);g.setValue(i,2,4,u||0);g.setValue(i,3,4,s||0)}var d=g.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(r){d=g.multiply(r,d)}if(a){d=g.multiply(a,d)}if(c){d=g.multiply(c,d)}if(i){d=g.multiply(i,d)}if(e){d=g.multiply(e,d)}return d},calcInverseTransform3DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y,z:a.center.z}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.scaleZ){b.scaleZ=1/b.scaleZ}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.translateZ){b.translateZ=-b.translateZ}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}if(b.rotateX){b.rotateX=-b.rotateX}if(b.rotateX){b.rotateY=-b.rotateY}if(b.rotateZ){b.rotateZ=-b.rotateZ}return Kekule.CoordUtils.calcTransform3DMatrix(b,true)},calcCoordGroup2DTransformParams:function(e,c,n,m){var o=Kekule.CoordUtils;var d=o.getDistance(e,c);var i=o.substract(c,e);var g=Math.atan2(i.y,i.x);var f=o.getDistance(n,m);var b=o.substract(m,n);var h=Math.atan2(b.y,b.x);var a=o.substract(n,e);var l={translateX:a.x,translateY:a.y,scale:f/d,rotateAngle:h-g,center:e};return l},getDistance:function(c,b){if(!b){b={x:0,y:0,z:0}}var a=Math.sqr(b.x-c.x)+Math.sqr(b.y-c.y);if(Kekule.ObjUtils.notUnset(c.z)&&Kekule.ObjUtils.notUnset(b.z)){a+=Math.sqr(b.z-c.z)}return Math.sqrt(a)},getCenter:function(d){var c=d.length;if(c<=0){return null}var b=Object.extend(d[0]);for(var a=1;a<c;++a){b=Kekule.CoordUtils.add(b,d[a])}return Kekule.CoordUtils.divide(b,c)},insideRect:function(c,a,b){return((c.x-a.x)*(c.x-b.x)<=0)&&((c.y-a.y)*(c.y-b.y)<=0)},isInsideBox:function(e,d){var c=d;var a=(Math.sign(e.x-c.x1)*Math.sign(e.x-c.x2)<=0)&&(Math.sign(e.y-c.y1)*Math.sign(e.y-c.y2)<=0);if(Kekule.ObjUtils.notUnset(e.z)){a&=(Math.sign(e.z-c.z1)*Math.sign(e.z-c.z2)<=0)}return a},getContainerBox:function(d){var f={};var a={};var b=d.length;if(b>0){f=Object.extend({},d[0]);a=Object.extend({},d[0])}else{return null}for(var c=1;c<b;++c){var e=d[c];f.x=Math.min(f.x,e.x);f.y=Math.min(f.y,e.y);a.x=Math.max(a.x,e.x);a.y=Math.max(a.y,e.y);if(Kekule.ObjUtils.notUnset(f.z)){f.z=Math.min(f.z,e.z);a.z=Math.max(a.z,e.z)}}return Kekule.BoxUtils.createBox(f,a)}};Kekule.BoxUtils={createBox:function(g,f){var a={};var c=g.x||0;var e=g.y||0;var b=f.x||0;var d=f.y||0;(c<=b)?(a.x1=c,a.x2=b):(a.x1=b,a.x2=c);(e<=d)?(a.y1=e,a.y2=d):(a.y1=d,a.y2=e);if(Kekule.ObjUtils.notUnset(g.z)&&Kekule.ObjUtils.notUnset(f.z)){(g.z<=f.z)?(a.z1=g.z,a.z2=f.z):(a.z1=f.z,a.z2=g.z)}return a},convertToRect:function(c){var a=Kekule.BoxUtils.normalize(c);return Kekule.RectUtils.createRect(a.x1,a.y1,a.x2-a.x1,a.y2-a.y1)},normalize:function(b){var a={x1:Math.min(b.x1,b.x2),y1:Math.min(b.y1,b.y2),x2:Math.max(b.x1,b.x2),y2:Math.max(b.y1,b.y2)};if(Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){a.z1=Math.min(b.z1,b.z2);a.z2=Math.max(b.z1,b.z2)}return a},shiftBox:function(d,c,b,a){var l=c||0;var h=b||0;var g=a||0;var f={x:d.x1+l,y:d.y1+h};var e={x:d.x2+l,y:d.y2+h};if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)){f.z=d.z1+g;e.z=d.z2+g}var i=Kekule.BoxUtils.createBox(f,e);return i},inflateBox:function(c,e,d,b){if(Kekule.ObjUtils.isUnset(d)){d=e}if(Kekule.ObjUtils.isUnset(b)){b=e}var a=Kekule.BoxUtils.normalize(c);var a={x1:a.x1-e,y1:a.y1-d,x2:a.x2+e,y2:a.y2+d};if(Kekule.ObjUtils.notUnset(a.z1)&&Kekule.ObjUtils.notUnset(a.z2)){a.z1=a.z1-b;a.z2=a.z2+b}return a},getContainerBox:function(d,b){if(!d){return Object.extend({},b)}else{if(!b){return Object.extend({},d)}}var e=Kekule.BoxUtils.normalize(d);var c=Kekule.BoxUtils.normalize(b);var a={x1:Math.min(e.x1,c.x1),y1:Math.min(e.y1,c.y1),x2:Math.max(e.x2,c.x2),y2:Math.max(e.y2,c.y2)};if(Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&Kekule.ObjUtils.notUnset(c.z1)&&Kekule.ObjUtils.notUnset(c.z2)){a.z1=Math.min(e.z1,c.z1);a.z2=Math.max(e.z2,c.z2)}return a},getIntersection:function(c,a){var d=Kekule.BoxUtils.normalize(c);var b=Kekule.BoxUtils.normalize(a);var e={x1:Math.max(d.x1,b.x1),y1:Math.max(d.y1,b.y1),x2:Math.min(d.x2,b.x2),y2:Math.max(d.y2,b.y2)};if((e.x1>=e.x2)||(e.y1>=e.y2)){return null}if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)&&Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){e.z1=Math.max(d.z1,b.z1);e.z2=Math.min(d.z2,b.z2);if(e.z1>=e.z2){return null}}return e},hasIntersection:function(b,a){return !!Kekule.BoxUtils.getIntersection(b,a)},isEqual:function(b,a){return(Math.min(b.x1,b.x2)===Math.min(a.x1,a.x2))&&(Math.max(b.x1,b.x2)===Math.max(a.x1,a.x2))&&(Math.min(b.y1,b.y2)===Math.min(a.y1,a.y2))&&(Math.max(b.y1,b.y2)===Math.max(a.y1,a.y2))},isInside:function(a,c){var d=a;var b=c;return(Math.min(d.x1,d.x2)>=Math.min(b.x1,b.x2))&&(Math.max(d.x1,d.x2)<=Math.max(b.x1,b.x2))&&(Math.min(d.y1,d.y2)>=Math.min(b.y1,b.y2))&&(Math.max(d.y1,d.y2)<=Math.max(b.y1,b.y2))},getCenterCoord:function(b){var a={x:(b.x1||0+b.x2||0)/2,y:(b.y1||0+b.y2||0)/2};if(Kekule.ObjUtils.notUnset(b.z1)||Kekule.ObjUtils.notUnset(b.z2)){a.z=(b.z1||0+b.z2||0)/2}return a},getMinMaxCoords:function(d){var c=Kekule.BoxUtils.normalize(d);var a={min:{x:c.x1,y:c.y1},max:{x:c.x2,y:c.y2}};if(Kekule.ObjUtils.notUnset(c.z1)){a.min.z=c.z1;a.max.z=c.z2}return a},getCornerCoords:function(c){var a=Kekule.BoxUtils.normalize(c);if(Kekule.ObjUtils.isUnset(a.z1)){return[{x:a.x1,y:a.y1},{x:a.x1,y:a.y2},{x:a.x2,y:a.y1},{x:a.x2,y:a.y2}]}else{return[{x:a.x1,y:a.y1,z:a.z1},{x:a.x1,y:a.y2,z:a.z1},{x:a.x2,y:a.y1,z:a.z1},{x:a.x2,y:a.y2,z:a.z1},{x:a.x1,y:a.y1,z:a.z2},{x:a.x1,y:a.y2,z:a.z2},{x:a.x2,y:a.y1,z:a.z2},{x:a.x2,y:a.y2,z:a.z2}]}},transform2D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform2D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)},transform3D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform3D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)}};Kekule.RectUtils={createRect:function(e,d,c,b){var a={left:e,top:d,width:c,height:b};return a},convertToBox:function(b){var c=Kekule.CoordUtils.create(b.left,b.top);var a=Kekule.CoordUtils.create(b.left+b.width,b.top+b.height);return Kekule.BoxUtils.createBox(c,a)},inflateRect:function(d,c,b){if(Kekule.ObjUtils.isUnset(b)){b=c}var a=Kekule.RectUtils.createRect(d.left,d.top,d.width+c,d.height+b);return a},shiftRect:function(f,d,b){var e=d||0;var c=b||0;var a=Kekule.RectUtils.createRect(f.left+e,f.top+c,f.width,f.height);return a},getContainerRect:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getContainerBox(e,c);return Kekule.BoxUtils.convertToRect(a)},getIntersection:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getIntersection(e,c);return a?Kekule.BoxUtils.convertToRect(a):null},hasIntersection:function(b,a){return !!Kekule.RectUtils.getIntersection(b,a)}};Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[0.1,0.3,0.5,0.66,0.8,0.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],getNextZoomInRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b<c[a-1]){for(var d=0;d<a;++d){if(c[d]>b){return c[Math.min(d+e,a)-1]}}}return b},getNextZoomOutRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b>c[0]){for(var d=a-1;d>=0;--d){if(c[d]<b){return c[Math.max(d-e+1,0)]}}}return b}};(function(){Kekule.DomUtils={namespaceMatched:function(b,a,c){if(c===undefined){c=true}return((b.namespaceURI==a)||(c&&(!b.namespaceURI)))},isElement:function(a){return(a&&a.tagName&&a.nodeType)},getElementText:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){a+=d.childNodes[c].nodeValue}}return a},setElementText:function(d,f){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){d.childNodes[c].nodeValue=f;return f}}var e=d.ownerDocument.createTextNode(f);d.appendChild(e);return f},getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getChildNodesOfTypes:function(f,b){var a=[];var e=Kekule.ArrayUtils.toArray(b);for(var d=0,c=f.childNodes.length;d<c;++d){var g=f.childNodes[d];if(!b||(e.indexOf(g.nodeType)>=0)){a.push(g)}}return a},getFirstChildElem:function(g,e,b,c){for(var d=0,a=g.childNodes.length;d<a;++d){var f=g.childNodes[d];if(f.nodeType===Node.ELEMENT_NODE){if((e&&(e.toLowerCase()===f.tagName.toLowerCase()))||(b&&(b.toLowerCase()===Kekule.DomUtils.getLocalName(f).toLowerCase()))||((!e)&&(!b))){if((!c)||Kekule.DomUtils.namespaceMatched(f,c)){return f}}}}},getDirectChildElems:function(h,f,c,d){var a=[];for(var e=0,b=h.childNodes.length;e<b;++e){var g=h.childNodes[e];if(g.nodeType===Node.ELEMENT_NODE){if((f&&(f.toLowerCase()===g.tagName.toLowerCase()))||(c&&(c.toLowerCase()===Kekule.DomUtils.getLocalName(g).toLowerCase()))||((!f)&&(!c))){if((!d)||Kekule.DomUtils.namespaceMatched(g,d)){a.push(g)}}}}return a},getDirectChildElemsOfAttribValues:function(e,p,c,g,b){var a=Kekule.DomUtils.getDirectChildElems(e,c,g,b);var q=[];for(var n=0,f=a.length;n<f;++n){var o=true;for(var m=0,h=p.length;m<h;++m){var d=Kekule.ObjUtils.getOwnedFieldNames(p[m])[0];if(a[n].getAttribute(d)!=p[m][d]){o=false;break}}if(o){q.push(a[n])}}},isDescendantOf:function(b,a){try{if(b&&a){if(b.documentElement){return false}if(b.ownerDocument===a){return true}var c=b.parentNode;while(c){if(c===a){return true}c=c.parentNode}}return false}catch(d){return false}},getNearestAncestorByTagName:function(e,d,c){var b=d.toLowerCase();if(c&&(e.tagName.toLowerCase()===b)){return e}var a=e.parentNode;while(a&&a.tagName){if(a.tagName.toLowerCase()===b){return a}a=a.parentNode}return null},getSameNSAttributeValue:function(d,c,b){var a=d.getAttribute(c);return a},setSameNSAttributeValue:function(c,b,d,a){result=c.setAttribute(b,d);return result},fetchAttributeValuesToArray:function(c,b,d){var n=[];for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(m){a=g.name}}else{a=g.name}n.push({name:a,value:g.value})}return n},fetchAttributeValuesToJson:function(c,b,d){var n={};for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(m){a=g.name}}else{a=g.name}n[a]=g.value}return n},hasAttribute:function(b,a){if(b.hasAttribute){return b.hasAttribute(a)}else{var c=b.getAttribute(a);return !!c}},getDataAttrib:function(b,a){if(b.dataset){return b.dataset[a]}else{return b.getAttribute("data-"+a.toString().hyphenize())}},setDataAttrib:function(b,a,c){if(b.dataset){b.dataset[a]=c}else{b.setAttribute("data-"+a.toString().hyphenize(),c)}},getDataset:function(e){if(e.dataset){return e.dataset}else{var a={};var g=e.attributes;for(var d=0,b=g.length;d<b;++d){var f=g[d];var c=f.name;if(c.toLowerCase().indexOf("data-")===0){var h=c.substring(5).camelize();a[h]=f.value}}return a}},clearChildContent:function(a){var c=Kekule.ArrayUtils.toArray(a.childNodes);for(var b=c.length-1;b>=0;--b){var d=c[b];if(d.nodeType===Node.ATTRIBUTE_NODE){continue}a.removeChild(d)}return a},replaceTagName:function(c,d){if(c.tagName.toLowerCase()!==d.toLowerCase()){var h=c.ownerDocument.createElement(d);var a=Kekule.DomUtils.fetchAttributeValuesToArray(c);for(var f=0,e=a.length;f<e;++f){h.setAttribute(a[f].name,a[f].value)}var b=Kekule.DomUtils.getDirectChildElems(c);for(var f=0,e=b.length;f<e;++f){h.appendChild(b[f])}var g=c.parentNode;var m=c.nextSibling;g.removeChild(c);if(m){g.insertBefore(h,m)}else{g.appendChild(h)}return h}else{return c}},isInDomTree:function(b,c){if(!b){return false}if(!c){c=b.ownerDocument}if(c){var a=c.documentElement;return Kekule.DomUtils.isDescendantOf(b,a)||b===a}else{return false}}};Kekule.StyleUtils={removeStyleProperty:function(a,b){if(a.removeProperty){a.removeProperty(b)}else{if(a.removeAttribute){a.removeAttribute(b)}else{a[b]=null}}},analysisUnitsValue:function(e){var d={};d.total=e;d.value=parseFloat(e);var a;if((d.value!==undefined)&&(d.value!==NaN)){a="";for(var b=e.length-1;b>=0;--b){var g=e.charAt(b);var f=(g>="0")&&(g<="9");if((!f)&&(g!==".")&&(g!=="-")){a=g+a}}}d.units=a;return d},multiplyUnitsValue:function(b,c){var a=Kekule.StyleUtils.analysisUnitsValue(b);a.value*=c;return""+a.value+a.units},colorStrToValue:function(f){var b=f.length>4;var d=b?f.substr(1,2):f.substr(1,1);var c=b?f.substr(3,2):f.substr(2,1);var e=b?f.substr(5,2):f.substr(3,1);if(!b){d+=d;c+=c;e+=e}var a=(parseInt(d,16)<<16)+(parseInt(c,16)<<8)+parseInt(e,16);return a},getComputedStyle:function(c,d){var b;var a=c.ownerDocument.defaultView;if(a&&a.getComputedStyle){b=a.getComputedStyle(c,null)}else{if(c.currentStyle){b=c.currentStyle}}if(b){return d?b[d]:b}else{return null}},isShown:function(b){var a=Kekule.StyleUtils;return(a.isDisplayed(b)&&a.isVisible(b))},isDisplayed:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"display")||"").toLowerCase()!=="none"},getDisplayed:function(a){return Kekule.StyleUtils.getComputedStyle(a,"display")},setDisplay:function(a,b){if(typeof(b)==="string"){a.style.display=b}else{a.style.display=(!!b)?"":"none"}},isVisible:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"visibility")||"").toLowerCase()!=="hidden"},getVisibility:function(a){return Kekule.StyleUtils.getComputedStyle(a,"visibility")},setVisibility:function(a,b){if(typeof(b)==="string"){a.style.visibility=b}else{a.style.visibility=(!!b)?"":"hidden"}}};Kekule.HtmlElementUtils={getClassNames:function(a){return Kekule.StrUtils.splitTokens(a.className)},hasClass:function(b,a){var c=Kekule.HtmlElementUtils.getClassNames(b);return(c.indexOf(a)>=0)},addClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(!b.hasClass(e,f[c])){e.className+=" "+f[c]}}return b},removeClass:function(e,d){var a=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);var g=a.getClassNames(e);for(var c=g.length;c>=0;--c){var b=f.indexOf(g[c]);if(b>=0){g.splice(c,1)}}e.className=g.join(" ");return a},toggleClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(b.hasClass(e,f[c])){b.removeClass(e,f[c])}else{b.addClass(e,f[c])}}return b},getInnerText:function(a){return a.innerText||a.textContent},resizeElem:function(d,b,a,c){d.style.width=b+(c||"px");d.style.height=a+(c||"px")},getElemClientDimension:function(a){return{width:a.clientWidth,height:a.clientHeight}},getElemScrollDimension:function(a){return{width:a.scrollWidth,height:a.scrollHeight}},getElemOffsetDimension:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},getViewportDimension:function(b){var a;if(b){if(b.ownerDocument){a=b.ownerDocument.defaultView}else{if(b.defaultView){a=b.defaultView}else{a=b}}}a=a||window;if(a.innerWidth!=null){return{width:a.innerWidth,height:a.innerHeight}}var c=a.document;if(c.compatMode=="CSS1Compat"){return{width:c.documentElement.clientWidth,height:c.documentElement.clientHeight}}return{width:c.body.clientWidth,height:c.body.clientHeight}},getElemBoundingClientRect:function(c,b){var a=Object.extend({},c.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(a.width)){a.width=a.right-a.left}if(Kekule.ObjUtils.isUnset(a.height)){a.height=a.bottom-a.top}if(b){var e=c.ownerDocument;var d=e.documentElement.scrollTop||e.body.scrollTop||0;var f=e.documentElement.scrollLeft||e.body.scrollLeft||0;a.left+=f;a.right+=f;a.top+=d;a.bottom+=d}result=a;result.x=result.left;result.y=result.top;return result},getElemPagePos:function(c){var a=0;var f=0;if(c.getBoundingClientRect){var e=c.getBoundingClientRect();var i=c.ownerDocument;var g=i.body;var b=i.documentElement;var d=b.clientTop||g.clientTop||0;var h=b.clientLeft||g.clientLeft||0;f=e.top+(window&&window.pageYOffset||b&&b.scrollTop||g.scrollTop)-d,a=e.left+(window&&window.pageXOffset||b&&b.scrollLeft||g.scrollLeft)-h}else{while(c){a+=(c.offsetLeft-c.scrollLeft+c.clientLeft);f+=(c.offsetTop-c.scrollTop+c.clientTop);c=c.offsetParent}}return{x:a,y:f}},getElemViewportPos:function(b){var a=Kekule.HtmlElementUtils.getElemBoundingClientRect(b);return{x:a.left,y:left.top}},makePositioned:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"position");if(!b||b.toLowerCase()==="static"){a.style.position="relative"}},isFormCtrlElement:function(b){var c=["input","button","textarea","select"];var a=b.tagName.toLowerCase();return c.indexOf(a)>=0}};Kekule.DocumentUtils={getClientDimension:function(a){if(a.compatMode=="BackCompat"){return{width:a.body.clientWidth,height:a.body.clientHeight}}else{return{width:a.documentElement.clientWidth,height:a.documentElement.clientHeight}}}};Kekule.DataSrcAttribUtils={isUrlBasedValue:function(b){var a=b.toLowerCase().indexOf("url(");return(a===0)},getUrl:function(d){var a=d.trim();var c=a.toLowerCase().indexOf("url(");if(c===0){var b=a.lastIndexOf(")");a=a.substring(4,b);return a}else{return null}},getElementContent:function(b){if(!b){return null}var a=b.innerHTML;a=a.ltrim();return a},getElementMimeType:function(a){return a.getAttribute("type")}}})();Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function($super,a){$super();this._supportNsMethods=null;if(a){this.setDocument(a)}},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("document");if(!a){var b=this.getPropStoreFieldValue("rootElement");a=b?b.ownerDocument:null}return a},setter:function(a){if(a!=this.getPropStoreFieldValue("document")){this.setPropStoreFieldValue("document",a);this.analysisRootElem()}}});this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("rootElement");if(!a){var b=this.getPropStoreFieldValue("document");a=b?b.documentElement:null}return a},setter:function(a){this.setPropStoreFieldValue("rootElement",a);this.analysisRootElem()}});this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:false,getter:function(){if(!this.getPropStoreFieldValue("namespaces")){this.setPropStoreFieldValue("namespaces",[])}return this.getPropStoreFieldValue("namespaces")}});this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:false});this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]);this.setDefNamespaceURI(null);var b=this.getRootElement();if(!b){return}var m=b.ownerDocument;this._supportNsMethods=!!m.getElementsByTagNameNS;if((!this._supportNsMethods)||(this.getForceAnalysisDoc())){for(var f=0,d=b.attributes.length;f<d;++f){var e=b.attributes[f];var c=e.name;if(c&&c.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var h=e.value;var a=c.indexOf(this.NAMESPACE_DELIMITER);var g=(a>=0)?c.substring(a+1):null;this.getNamespaces().push({namespaceURI:h,prefix:g});if(!g){this.setDefNamespaceURI(h)}}}}},_getEmptyDocErrorMsg:function(){return Kekule.hasLocalRes()?this.ERR_EMPTY_DOC:Kekule.ErrorMsg.EMPTY_DOC},_getElementNotSetErrorMsg:function(){return Kekule.hasLocalRes()?this.ELEMENT_NOTSET:Kekule.ErrorMsg.ELEMENT_NOTSET},assertDocAvailable:function(a){if(!a){Kekule.raise(this._getEmptyDocErrorMsg());return false}else{return true}},assertElementAvailable:function(a){if(!a){Kekule.raise(this._getElementNotSetErrorMsg());return false}else{return true}},getNsPrefix:function(b){if(b==this.getDefNamespaceURI()){return""}var d=this.getNamespaces();for(var c=0,a=d.length;c<a;++c){if(d[c].namespaceURI==b){return d[c].prefix}}return null},getQualifiedName:function(b,a){var c=this.getNsPrefix(b);if(c===null){return null}else{return c?c+this.NAMESPACE_DELIMITER+a:a}},createElementNS:function(a,c){var b=this.getDocument();if(!this.assertDocAvailable(b)){return null}if(this._supportNsMethods){return b.createElementNS(a,c)}else{return b.createElement(c)}},getElementsByTagNameNS:function(c,b,d){var a=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement");var f=this.getDocument();if(!this.assertDocAvailable(f)){return null}if(this._supportNsMethods){if(d){return d.getElementsByTagNameNS(c,b)}else{return a.getElementsByTagNameNS(c,b)}}else{var e=this.getQualifiedName(c,b);if(e===null){return[]}else{if(d){return d.getElementsByTagName(e)}else{return a.getElementsByTagName(e)}}}},getAttributeNodeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNodeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttributeNode(d)}}},getAttributeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttribute(d)}}},setAttributeNS:function(b,a,d,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.setAttributeNS(b,a,d)}else{var e=this.getQualifiedName(b,a);if(e===null){return null}else{return c.setAttribute(e,d)}}}});Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function($super,a){$super();this.setPropStoreFieldValue("lines",[]);if(a){if(typeof(a)=="string"){this.setText(a)}else{this.setLines(a)}}this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:false});this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(a){this.setPropStoreFieldValue("lines",[]);this.reset();this.appendText(a)}});this.defineProp("currLineNo",{dataType:DataType.INT,serializable:false})},getUnreadLines:function(){var a=[].concat(this.getLines());a.splice(0,this.getCurrLineNo());return a},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(b){var a=b.split(this.LINEBREAK);this.appendLines(a)},appendLines:function(a){this.setPropStoreFieldValue("lines",this.getLines().concat(a));this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]);this.setCurrLineNo(0)},incCurrLineNo:function(b){if((b===null)||(typeof(b)=="undefined")){b=1}var a=this.getCurrLineNo();a+=b;this.setCurrLineNo(a)},getLineAt:function(a){var b=this.getLines()[a];if(b&&b.length&&(b.charAt(b.length-1)==="\r")){b=b.substring(0,b.length-1)}return b},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var a=this.getLineAt(this.getCurrLineNo());this.incCurrLineNo();return a},writeLine:function(b){var a=this.getLines();a.splice(this.getCurrLineNo(),0,b);this.incCurrLineNo()},writeLines:function(b){for(var c=0,a=b.length;c<a;++c){this.writeLine(b[c])}},writeText:function(b){var a=b.split(this.LINEBREAK);this.writeLines(a)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}});(function(){var g=window;if(!g.Kekule){Kekule={}}Kekule.Browser={IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)};Kekule.BrowserFeature={typedArray:(typeof(ArrayBuffer)!=="undefined"),svg:!!window.SVGSVGElement,canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{var n=document.createElement("canvas");return !!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(o){return false}})(),workers:!!window.Worker,fileapi:!!(window.File&&window.FileReader&&window.FileList&&window.Blob),sessionStorage:!!window.sessionStorage,localStorage:!!window.localStorage,cssTransition:(function(n){return"transition" in n||"WebkitTransition" in n||"MozTransition" in n||"msTransition" in n||"OTransition" in n})(document.createElement("div").style),html5Form:{placeholder:(function(n){return"placeholder" in n})(document.createElement("input")),supportType:function(o){var p=document.createElement("input");p.setAttribute("type",o);var n=p.type===o;var r=["text","url","search"];if(n&&(r.indexOf(o.toLowerCase())<0)){var q=":)";p.value=q;n=p.value!==q}return n}},mutationObserver:window.MutationObserver||window.MozMutationObserver||window.WebkitMutationObserver};Kekule.X={};var a=Kekule.X;var i=function(n){return((n===null)||(typeof(n)==="undefined"))};var h=function(n){return !i(n)};var l=function(n){var o=window.getComputedStyle?window.getComputedStyle(n,null).position:n.currentStyle?n.currentStyle.position:null;if(!o){return false}else{if(!o){return false}else{o=o.toString().toLowerCase();return(o==="relative")||(o==="absolute")}}};a.MutationObserver=window.MutationObserver||window.MozMutationObserver||window.WebkitMutationObserver;a.Event={MOUSE_BTN_LEFT:0,MOUSE_BTN_RIGHT:2,MOUSE_BTN_MID:1,MOUSE_BTN_LR:3};a.Event.MouseButton={LEFT:0,RIGHT:2,MID:1,LR:3};a.Event.KeyCode={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRTSC:44,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145};a.Event.isSupported=(function(){var n={};return function(p){var r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img",unload:"win",resize:"win"},s=p.replace(/^on/,"");if(n[s]){return n[s]}var q=r[s]=="win"?window:document.createElement(r[s]||"div");p="on"+s;var o=(p in q);if(!o){q.setAttribute(p,"return;");o=typeof q[p]=="function"}q=null;n[s]=o;return o}})();a.Event.Methods={getType:function(n){return n.__$type__||n.type},getTarget:function(n){var o=n.target||n.srcElement;if(o.nodeType==3){o=o.parentNode}return o},getCurrentTarget:function(n){return n.currentTarget},getEventPhase:function(n){return n.eventPhase},getAltKey:function(n){return n.altKey},getCtrlKey:function(n){return n.ctrlKey},getShiftKey:function(n){return n.shiftKey},getCharCode:function(n){return h(n.charCode)?n.charCode:n.keyCode},getKeyCode:function(n){return n.keyCode},getClientX:function(n){return n.clientX},getClientY:function(n){return n.clientY},getScreenX:function(n){return n.screenX},getScreenY:function(n){return n.screenY},getPageX:function(o){if(h(o.pageX)){return o.pageX}else{var p=a.Event.getTarget(o).ownerDocument;var n=p?p.body:null;return o.clientX+(p&&p.scrollLeft||n&&n.scrollLeft||0)-(p&&p.clientLeft||n&&n.clientLeft||0)}},getPageY:function(o){if(h(o.pageY)){return o.pageY}else{var p=a.Event.getTarget(o).ownerDocument;var n=p?p.body:null;return o.clientY+(p&&p.scrollTop||n&&n.scrollTop||0)-(p&&p.clientTop||n&&n.clientTop||0)}},getOffsetX:function(p){if(h(p.offsetX)){return p.offsetX}else{var o=a.Event.getTarget(p);if(h(p.layerX)&&l(o)){return p.layerX}else{var n=a.Event.getClientX(p);return Math.round(n-o.getBoundingClientRect().left)}}},getOffsetY:function(p){if(h(p.offsetY)){return p.offsetY}else{var o=a.Event.getTarget(p);if(h(p.layerY)&&l(o)){return p.layerY}else{var n=a.Event.getClientY(p);return Math.round(n-o.getBoundingClientRect().top)}}},getRelXToCurrTarget:function(p){var o=a.Event.getCurrentTarget(p);var n=a.Event.getClientX(p);return Math.round(n-o.getBoundingClientRect().left)},getRelYToCurrTarget:function(p){var o=a.Event.getCurrentTarget(p);var n=a.Event.getClientY(p);return Math.round(n-o.getBoundingClientRect().top)}};a.Event._MouseEventEx={isMouseEnterLeaveEvent:function(n){return(n==="mouseenter")||(n==="mouseleave")},addMouseEnterLeaveListener:function(r,q,s,n){var p=((q==="mouseenter")&&a.Event.isSupported("mouseenter"))||((q==="mouseleave")&&a.Event.isSupported("mouseleave"));if(p){return r.addEventListener(q,s,n)}else{var t=function(y){var x=y.getTarget?y.getTarget():y.target;var u=y.getCurrentTarget?y.getCurrentTarget():y.currentTarget;if((x===u)||(Kekule.DomUtils.isDescendantOf(x,u))){var w=y.getRelatedTarget?y.getRelatedTarget():y.relatedTarget;if((!w)||(!Kekule.DomUtils.isDescendantOf(w,u))){var v=new MouseEvent(q,{view:window,bubbles:false,cancelable:true,target:u,currentTarget:u,relatedTarget:w});s.call(u,v)}}};s.__$mouseExListenerWrapper__=t;var o=(q==="mouseenter")?"mouseover":"mouseout";return r.addEventListener(o,t,n)}},removeMouseEnterLeaveListener:function(q,p,r){var o=((p==="mouseenter")&&a.Event.isSupported("mouseenter"))||((p==="mouseleave")&&a.Event.isSupported("mouseleave"));if(o){return q.removeEventListener(p,r,useCapture)}else{var n=(p==="mouseenter")?"mouseover":"mouseout";return q.removeEventListener(n,r.__$mouseExListenerWrapper__||r)}}};a.Event._W3C={addListener:function(p,o,q,n){if(a.Event._MouseEventEx.isMouseEnterLeaveEvent(o)){return a.Event._MouseEventEx.addMouseEnterLeaveListener(p,o,q,n)}else{return p.addEventListener(o,q,n)}},removeListener:function(p,o,q,n){if(a.Event._MouseEventEx.isMouseEnterLeaveEvent(o)&&q.__$listenerWrapper__){return a.Event._MouseEventEx.removeMouseEnterLeaveListener(p,o,q.__$listenerWrapper__)}else{return p.removeEventListener(o,q,n)}},stopPropagation:function(n){n.stopPropagation()},preventDefault:function(n){n.preventDefault()}};a.Event._W3CMethods={getRelatedTarget:function(n){return n.relatedTarget},getButton:function(n){return n.button}};a.Event._Gecko={addListener:function(p,o,q,n){if(a.Event._MouseEventEx.isMouseEnterLeaveEvent(o)){return a.Event._MouseEventEx.addMouseEnterLeaveListener(p,o,q,n)}if((o==="mousewheel")){var r=function(s){s.wheelDeltaY=s.wheelDelta=-s.detail*40;s.__$type__="mousewheel";q.call(p,s)};q.__$mousewheelListenerWrapper__=r;p.addEventListener("DOMMouseScroll",r,n)}else{p.addEventListener(o,q,n)}},removeListener:function(p,o,q,n){if((o==="mousewheel")&&q.__$mousewheelListenerWrapper__){p.removeEventListener("DOMMouseScroll",q.__$mousewheelListenerWrapper__,n)}else{p.removeEventListener(o,q,n)}}};a.Event._IE={_handlers:{},WIN_UNLOAD_FLAG_FIELD:"__$win_unload_linked__",addListener:function(p,o,q,n){if(a.Event.findHandlerIndex(p,o,q)>=0){return}var s=(function(t){if(!t){t=window.event}t.currentTarget=p;t.eventPhase=(t.srcElement===p)?2:3;if(!c){Object.extend(t,f)}q.call(p,t)});p.attachEvent(a.Event.getEventName(o),s);a.Event.registerHandler(p,o,q,s);var r=p.ownerDocument||p;a.Event._linkUnloadEvent(r.parentWindow)},removeListener:function(q,p,r,n){var o=a.Event.findHandlerIndex(q,p,r);if(o>=0){var s=a.Event._handlers[p][o].wrapper;q.detachEvent(a.Event.getEventName(p),s);a.Event._handlers[p].splice(o,1)}},stopPropagation:function(n){n.cancelBubble=true},preventDefault:function(n){n.returnValue=false},removeAllListeners:function(r){var s=a.Event._handlers;if(!s){return}for(propName in s){if(s.hasOwnProperty(propName)){var p=s[propName];if(p&&p.length){var n=a.Event.getEventName(propName);for(var o=p.length-1;o>=0;--o){var q=p[o];if((!r)||(q.element.ownerDocument===r)){q.element.detachEvent(n,q.wrapper);p.splice(o,1)}}}}}},getEventName:function(n){return"on"+n},registerHandler:function(q,p,r,s){var n=a.Event._handlers;if(!n[p]){n[p]=[]}var o=n[p];o.push({element:q,handler:r,wrapper:s})},unregisterHandler:function(q,p,r){if(!handlers[p]){return}var o=handlers[p];var n=a.Event.findHandlerIndex(q,p,r);if(n>=0){o.splice(n,1)}},findHandlerIndex:function(r,q,t){var p=a.Event._handlers[q];if(!p){return -1}for(var o=0,n=p.length;o<n;++o){var s=p[o];if((s.element===r)&&(s.handler===t)){return o}}return -1},_linkUnloadEvent:function(n){var o=a.Event.WIN_UNLOAD_FLAG_FIELD;if(n[o]){return}else{n.attachEvent("onunload",a.Event.reactWinUnload);n[o]=true}},reactWinUnload:function(){var n=this.ownerDocument;a.Event.removeAllListeners(n)}};a.Event._IEMethods={getRelatedTarget:function(n){return n.fromElement||n.toElement},getButton:function(n){switch(n.button){case 1:return 0;case 2:return 2;case 4:return 1;case 3:return 3;default:return n.button}},stopPropagation:function(n){n.cancelBubble=true},preventDefault:function(n){n.returnValue=false}};if(document.addEventListener){a.Event=Object.extend(a.Event,a.Event._W3C);a.Event.Methods=Object.extend(a.Event.Methods,a.Event._W3CMethods);if(Kekule.Browser.Gecko){a.Event=Object.extend(a.Event,a.Event._Gecko)}}else{if(document.attachEvent){a.Event=Object.extend(a.Event,a.Event._IE);a.Event.Methods=Object.extend(a.Event.Methods,a.Event._IEMethods);if(window.Element){var e=window.Element.prototype;e.addEventListener=a.Event.addListener.methodize();e.removeEventListener=a.Event.removeListener.methodize()}}}Object.extend(a.Event,a.Event.Methods);var d=null;if(window.Event){d=window.Event.prototype}if(!d){if(document.createEvent){d=document.createEvent("HTMLEvents").__proto__}}var c=!!d;var f={};var b=a.Event.Methods;for(name in b){if(b.hasOwnProperty(name)&&(typeof(b[name])==="function")){f[name]=b[name].methodize()}}if(d){Object.extend(d,f)}a.Ajax={XMLHttpFactories:[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],_availableFactoryIndex:-1,createXMLHTTPObject:function(){var p=false;var q=a.Ajax.XMLHttpFactories;var n=a.Ajax._availableFactoryIndex;if(n>=0){p=q[n]()}else{for(var o=0;o<q.length;o++){try{p=q[o]();a.Ajax._availableFactoryIndex=o}catch(r){continue}break}}return p},sendRequest:function(p,w,r,t,q){var o=false;var s=true;var v=a.Ajax.createXMLHTTPObject();if(!v){return}var n=(r)?"POST":"GET";v.open(n,p,true);v.setRequestHeader("User-Agent","XMLHTTP/1.0");if(r){v.setRequestHeader("Content-type","application/x-www-form-urlencoded")}if(t){try{v.responseType=t}catch(u){}if((t==="arraybuffer")||(t==="blob")){o=true}if(v.responseType!==t){s=false}}if(o&&(!s)&v.overwriteMimeType){v.overrideMimeType("text/plain; charset=x-user-defined")}if(q&&v.overwriteMimeType){v.overwriteMimeType(q)}v.onreadystatechange=function(){if(v.readyState!=4){return}if(v.status!=200&&v.status!=304){w(null,v,false);throw"HTTP error "+v.status;return}w(v.response||v.responseText,v,true)};if(v.readyState==4){return}v.send(r)},getResponseMimeType:function(n){return n.getResponseHeader("content-type")||""}};Kekule.Ajax=Kekule.X.Ajax;Kekule.X.DomReady={isReady:false,funcs:[],domReady:function(o){m.initReady();if(!m.isReady){var n=document&&document.readyState;if(n==="complete"||n==="loaded"){m.isReady=true}}if(m.isReady){o()}else{m.funcs.push(o)}},fireReady:function(){if(m.isReady){return}m.isReady=true;for(var o=0,n=m.funcs.length;o<n;++o){var p=m.funcs[o];p()}m.funcs.length=0},initReady:function(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);m.fireReady()},false)}else{if(document.getElementById){document.write('<script id="ie-domReady" defer="defer" src="//:"><\/script>');document.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){m.fireReady();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}};var m=Kekule.X.DomReady;Kekule.X.domReady=m.domReady})();(function(){Kekule.Glyph={};Kekule.Glyph.Base=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Glyph.Base",initialize:function($super,c,a,b){$super(c);if(a){this.setCoord2D(a)}if(b){this.setCoord3D(b)}},initProperties:function(){},getAutoIdPrefix:function(){return"g"}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.Glyph.Base)})();(function(){Kekule.TextBlock=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.TextBlock",initialize:function($super,c,a,b){$super(c);if(a){this.setCoord2D(a)}if(b){this.setCoord3D(b)}this.setText("")},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},getAutoIdPrefix:function(){return"t"}});Kekule.ClassDefineUtils.addStandardCoordSupport(Kekule.TextBlock);Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.TextBlock)})();(function(){Kekule.Glyph.PathGlyphNode=Class.create(Kekule.BaseStructureNode,{CLASS_NAME:"Kekule.Glyph.PathGlyphNode",initialize:function($super,d,a,b,c){$super(d);if(b){this.setCoord2D(b)}if(c){this.setCoord3D(c)}this.setNodeType(a||Kekule.Glyph.NodeType.LOCATION)},initProperties:function(){this.defineProp("nodeType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC})}});Kekule.Glyph.NodeType={LOCATION:"location",HIDDEN:"hidden"};Kekule.Glyph.PathGlyphConnector=Class.create(Kekule.BaseStructureConnector,{CLASS_NAME:"Kekule.Glyph.PathGlyphConnector",initialize:function($super,c,a,b){$super(c,b);this.setPathType(a)},initProperties:function(){this.defineProp("pathType",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLISHED,enumSource:Kekule.Glyph.PathType});this.defineProp("pathParams",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLISHED,getter:function(){var a=this.getPropStoreFieldValue("pathParams");if(!a){a={};this.setPropStoreFieldValue("pathParams",a)}return a},setter:function(a){if(!a){this.setPropStoreFieldValue("pathParams",null)}else{this.setPropStoreFieldValue("pathParams",Object.extend({},a,true))}}})}});Kekule.Glyph.PathType={LINE:"L"};Kekule.Glyph.ArrowType={NONE:null,OPEN:"open",TRIANGLE:"triangle"};Kekule.Glyph.ArrowSide={BOTH:0,SINGLE:1,REVERSED:-1};Kekule.Glyph.PathGlyph=Class.create(Kekule.Glyph.Base,{CLASS_NAME:"Kekule.Glyph.PathGlyph",initialize:function($super,e,a,b,c,d){$super(e,c,d);this.createDefaultStructure(a||1,b||{})},doFinalize:function($super){if(this.hasCtab()){this.getCtab().finalize()}$super()},initProperties:function(){this.defineProp("ctab",{dataType:"Kekule.StructureConnectionTable",scope:Class.PropertyScope.PUBLIC,getter:function(a){if(!this.getPropStoreFieldValue("ctab")){if(a){this.createCtab()}}return this.getPropStoreFieldValue("ctab")},setter:function(b){var a=this.getPropStoreFieldValue("ctab");if(a){a.finalize();a=null}if(b){b.setPropValue("parent",this,true);b.setOwner(this.getOwner())}this.setPropStoreFieldValue("ctab",b)}});this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getNodes():[]}});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.hasCtab()?this.getCtab().getConnectors():[]}})},createDefaultStructure:function(a,b){if(!a){a=1}var e={};var c=["lineGap","startArrowLength","startArrowWidth","endArrowLength","endArrowWidth"];for(var d in b){if(c.indexOf(d)>=0){e[d]=b[d]*a}else{e[d]=b[d]}}return this.doCreateDefaultStructure(a,e)},doCreateDefaultStructure:function(a,b){},getAutoIdPrefix:function(){return"p"},ownerChanged:function($super,a){if(this.hasCtab()){this.getCtab().setOwner(a)}$super(a)},_removeChildObj:function(b){if(this.hasCtab()){var a=this.getCtab();if(a===b){this.removeCtab()}else{if(a.hasChildObj(b)){a.removeChildObj(b)}}}},isEmpty:function(){return this.getCtab().isEmpty()},createCtab:function(){var a=new Kekule.StructureConnectionTable(this.getOwner(),this);this.setPropStoreFieldValue("ctab",a);a.addEventListener("propValueSet",function(b){if(b.propName=="nodes"){this.notifyPropSet(b.propName,b.propValue)}},this);a.setEnablePropValueSetEvent(true)},hasCtab:function(){return(!!this.getPropStoreFieldValue("ctab"))},getContainerBox:function($super,b,a){if(this.hasCtab()){return this.getCtab().getContainerBox(b,a)}else{return $super(b)}},getNodeById:function(a){return this.hasCtab()?this.getCtab().getNodeById(a):null},getConnectorById:function(a){return this.hasCtab()?this.getCtab().getConnectorById(a):null},getObjectById:function(b){var a=this.getNodeById(b);return a?a:this.getConnectorById(b)},getNodeCount:function(){return this.hasCtab()?this.getCtab().getNodeCount():0},getNodeAt:function(a){return this.hasCtab()?this.getCtab().getNodeAt(a):null},indexOfNode:function(a){return this.hasCtab()?this.getCtab().indexOfNode(a):-1},hasNode:function(b,a){return this.hasCtab()?the.getCtab().hasNode(b,a):null},appendNode:function(a){return this.doGetCtab(true).appendNode(a)},insertNodeAt:function(b,a){return this.doGetCtab(true).insertNodeAt(b,a)},removeNodeAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNodeAt(b,a)},removeNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeNode(b,a)},replaceNode:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().replaceNode(b,a)},clearNodes:function(){if(this.hasCtab()){return this.getCtab().clearNodes()}},nodesHasCoord2D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord2D(a)},nodesHasCoord3D:function(a){if(!this.hasCtab()){return false}return this.getCtab().nodesHasCoord3D(a)},getConnectorCount:function(){return this.hasCtab()?this.getCtab().getConnectorCount():0},getConnectorAt:function(a){return this.hasCtab()?this.getCtab().getConnectorAt(a):null},indexOfConnector:function(a){return this.hasCtab()?this.getCtab().indexOfConnector(a):-1},hasConnector:function(a,b){return this.hasCtab()?this.getCtab().hasConnector(a,b):null},appendConnector:function(a){return this.doGetCtab(true).appendConnector(a)},insertConnectorAt:function(a,b){return this.doGetCtab(true).insertConnectorAt(a,b)},removeConnectorAt:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnectorAt(b,a)},removeConnector:function(b,a){if(!this.hasCtab()){return null}return this.getCtab().removeConnector(b,a)},clearConnectors:function(){if(this.hasCtab()){return this.getCtab().clearConnectors()}},insertBefore:function(b,a){if(this.hasCtab()){return this.getCtab().insertBefore(b,a)}else{console.log("no ctab")}},_getObjsNeedToBeCascadeRemoved:function(b,a){if(this.hasCtab()){return this.getCtab()._getObjsNeedToBeCascadeRemoved(b,a)}else{return[]}},removeChildObj:function(c,b,a){if(this.hasCtab()){this.getCtab().removeChildObj(c,b,a)}},removeChild:function(a){return this.removeChildObj(a)},hasChildObj:function(a){if(this.hasCtab()){return this.getCtab().hasChildObj(a)}else{return false}},getNextSiblingOfChild:function(a){if(this.hasCtab()){return this.getCtab().getNextSiblingOfChild(a)}else{return null}},getChildCount:function(){if(this.hasCtab()){return this.getCtab().getChildCount()}else{return 0}},getChildAt:function(a){if(this.hasCtab()){return this.getCtab().getChildAt(a)}else{return null}},indexOfChild:function(a){if(this.hasCtab()){return this.getCtab().indexOfChild(a)}else{return -1}}})})();(function(){var a=Kekule.Glyph.NodeType;var b=Kekule.Glyph.PathType;Kekule.Glyph.StraightLine=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.StraightLine",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f)},doCreateDefaultStructure:function(i,c){var d=Kekule.CoordUtils;var g={x:0,y:0};var f={x:0,y:0,z:0};var h={x:i*(c.lineLength||1)};var m=new Kekule.Glyph.PathGlyphNode(null,null,g,f);var l=new Kekule.Glyph.PathGlyphNode(null,null,d.add(g,h),d.add(f,h));var e=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[m,l]);this._applyParamsToConnector(e,c);this.appendNode(m);this.appendNode(l);this.appendConnector(e)},_applyParamsToConnector:function(c,d){c.setPathParams(d)}});Kekule.Glyph.Polygon=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.Polygon",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f)},getRefLengthRatio:function(){return 1},doCreateDefaultStructure:function(h,y){var p=Kekule.CoordUtils;var e={x:0,y:0};var l={x:0,y:0,z:0};var s=y.nodeProps;var n=y.connectorProps;var q=h*(y.lineLength||1)*this.getRefLengthRatio();var w=y.edgeCount||3;var o=Math.PI*2/w;var m=(w%2)?0:-o/2;var f=m;var u,g;for(var v=0;v<w;++v){var x={x:q*Math.sin(f),y:q*Math.cos(f)};var t=new Kekule.Glyph.PathGlyphNode(null,null,p.add(e,x),p.add(l,x));if(s){t.setPropValues(s)}this.appendNode(t);if(v===0){u=t}if(g){var d=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[g,t]);if(n){d.setPropValues(n)}this._applyParamsToConnector(d,y);this.appendConnector(d)}g=t;f+=o}var d=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[t,u]);if(n){d.setPropValues(n)}this._applyParamsToConnector(d,y);this.appendConnector(d)},_applyParamsToConnector:function(c,d){c.setPathParams(d)}})})();(function(){var a=Kekule.Glyph.NodeType;var b=Kekule.Glyph.PathType;Kekule.Glyph.HeatSymbol=Class.create(Kekule.Glyph.Polygon,{CLASS_NAME:"Kekule.Glyph.HeatSymbol",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f);this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return 0.25},doCreateDefaultStructure:function($super,c,d){d.edgeCount=3;d.nodeProps=Object.extend(d.nodeProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN});d.connectorProps=Object.extend(d.connectorProps||{},{interactMode:Kekule.ChemObjInteractMode.HIDDEN});return $super(c,d)},_applyParamsToConnector:function($super,c,d){return $super(c,d)}});Kekule.Glyph.AddSymbol=Class.create(Kekule.Glyph.PathGlyph,{CLASS_NAME:"Kekule.Glyph.AddSymbol",initialize:function($super,g,c,d,e,f){$super(g,c,d,e,f);this.setRenderOption("strokeWidth",1.5)},getRefLengthRatio:function(){return 0.5},doCreateDefaultStructure:function(u,c){var q={interactMode:Kekule.ChemObjInteractMode.HIDDEN};var n={interactMode:Kekule.ChemObjInteractMode.HIDDEN};var d=Kekule.CoordUtils;var s={x:0,y:0};var p={x:0,y:0,z:0};var e=u*this.getRefLengthRatio()*(c.lineLength||1)/2;var f=new Kekule.Glyph.PathGlyphNode(null,null,s,p);f.setPropValues(q);this.appendNode(f);var r=[{x:-e,y:0},{x:0,y:-e},{x:e,y:0},{x:0,y:e}];for(var o=0,m=r.length;o<m;++o){var t=r[o];var g=new Kekule.Glyph.PathGlyphNode(null,null,d.add(s,t),d.add(p,t));g.setPropValues(q);var h=new Kekule.Glyph.PathGlyphConnector(null,b.LINE,[f,g]);h.setPropValues(n);this._applyParamsToConnector(h,c);this.appendNode(g);this.appendConnector(h)}},_applyParamsToConnector:function(c,d){c.setPathParams(d)}})})();(function(){Kekule.IO={};Kekule.IO.ChemDataType={TEXT:"text",DOM:"dom",JSON:"json",BINARY:"bin",OTHER:"other",UNKNOWN:"unknown",isBinaryType:function(b){var c=Kekule.IO.ChemDataType;return(!b)||(b===c.BINARY)||(b===c.OTHER)||(b===c.UNKNOWN)}};Kekule.IO.MimeType={TEXT:"text/plain",HTML:"text/html",XML:"text/xml",JSON:"application/json",JAVASCRIPT:"application/javascript",GIF:"image/gif",JPEG:"image/jpeg",PNG:"image/png",XPNG:"image/x-png"};Kekule.IO.DataFormatsManager={_formats:{},register:function(b,c,e,g,f,h,i){var l=null;if(!l){l=a._formats[b]}if(!l){l={id:b};a._formats[b]=l}l.mimeType=c;var d=DataType.isArrayValue(e)?e:[e];if(!l.fileExts){l.fileExts=d}else{Kekule.ArrayUtils.pushUnique(l.fileExts,d)}if(g&&(g!==Kekule.IO.ChemDataType.UNKNOWN)){l.dataType=g}l.title=f;l.description=h;if(i){l=Object.extend(l,i)}return l},unregister:function(b){if(a._formats[b]){delete a._formats[b]}},getAllIds:function(){return Kekule.ObjUtils.getOwnedFieldNames(a._formats)},getFormatInfo:function(b){return a._formats[b]||null},getMimeType:function(c){var b=a.getFormatInfo(c);return b?b.mimeType:null},getFileExts:function(c){var b=a.getFormatInfo(c);return b?b.fileExts:null},findFormat:function(h,d){if(!h&&!d){return null}var f=a.getAllIds();var b=false;for(var e=0,c=f.length;e<c;++e){var g=a.getFormatInfo(f[e]);b=(h&&(h===g.mimeType));if(!b){b=(d&&(g.fileExts.indexOf(d)>=0))}if(b){return g}}return null},findFormatId:function(d,b){var c=Kekule.IO.DataFormatsManager.findFormat(d,b);return c?c.id:null}};var a=Kekule.IO.DataFormatsManager;Kekule.IO.dataFormatsManager=Kekule.IO.DataFormatsManager;Kekule.IO.ChemDataReader=Class.create(ObjectEx,{initialize:function($super,b){$super()},CLASS_NAME:"Kekule.IO.ChemDataReader",readData:function(f,d,h){if(!d){var e=Kekule.IO.DataFormatsManager.getFormatInfo(h);d=e?e.dataType:null;if(!d){d=(typeof(f)==="string")?Kekule.IO.ChemDataType.TEXT:(f.getElementsByTagName?Kekule.IO.ChemDataType.DOM:Kekule.IO.ChemDataType.BINARY)}}var b=this.doReadData(f,d,h);if((b instanceof Kekule.ChemObject)&&(b.getSrcInfo)){var g=b.getSrcInfo();g.data=f;g.dataType=d;var c=Kekule.IO.DataFormatsManager.getFormatInfo(h);if(c){g.format=h;g.mimeType=c.mimeType;g.possibleFileExts=c.fileExts}}return b},doReadData:function(c,b,d){}});Kekule.IO.ChemDataWriter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.ChemDataWriter",initialize:function($super,b){$super()},writeData:function(e,b,d){if(!b){var c=Kekule.IO.DataFormatsManager.getFormatInfo(d);b=c?c.dataType:null}return this.doWriteData(e,b,d)},doWriteData:function(d,b,c){}});Kekule.IO.ChemDataReaderManager={_readers:[],register:function(f,d,e,b){if(Kekule.IO.ChemDataReaderManager.getReaderInfoById(f)){Kekule.raise(Kekule.ErrorMsg.READER_ID_ALREADY_EXISTS);return null}var c={id:f,readerClass:d,formatId:DataType.isArrayValue(e)?e:[e]};c=Object.extend(c,b);Kekule.IO.ChemDataReaderManager._readers.push(c);return c},getAvailableReaderInfos:function(e){var b=[];var c=Kekule.IO.ChemDataReaderManager._readers;for(var d=c.length-1;d>=0;--d){if(Kekule.ObjUtils.match(c[d],e)){b.push(c[d])}}return b},getReaderInfo:function(d){var b=Kekule.IO.ChemDataReaderManager._readers;for(var c=b.length-1;c>=0;--c){if(Kekule.ObjUtils.match(b[c],d)){return b[c]}}return null},getReaderInfoById:function(b){return Kekule.IO.ChemDataReaderManager.getReaderInfo({id:b})},getReaderInfoByFormat:function(e,b){var c=Kekule.IO.ChemDataReaderManager._readers;for(var d=c.length-1;d>=0;--d){if((!b)||Kekule.ObjUtils.match(c[d],b)){if(c[d].formatId.indexOf(e)>=0){return c[d]}}}return null},getReaderInfoByFileExt:function(c,b){var d=Kekule.IO.DataFormatsManager.findFormatId(null,c);return d?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b):null},createReaderOfInfo:function(b){return new b.readerClass(b.createOptions)},getReaderOfInfo:function(b){if(!b.instance){b.instance=Kekule.IO.ChemDataReaderManager.createReaderOfInfo(b)}return b.instance},createReader:function(c){var b=Kekule.IO.ChemDataReaderManager.getReaderInfo(c);if(b){return Kekule.IO.ChemDataReaderManager.createReaderOfInfo(b)}},getReader:function(c){var b=Kekule.IO.ChemDataReaderManager.getReaderInfo(c);if(b){return Kekule.IO.ChemDataReaderManager.getReaderOfInfo(b)}},createReaderById:function(b){return Kekule.IO.ChemDataReaderManager.createReader({id:b})},getReaderById:function(b){return Kekule.IO.ChemDataReaderManager.getReader({id:b})},createReaderByFormat:function(d,b){var c=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b);return c?IO.ChemDataReaderManager.createReaderOfInfo(c):null},getReaderByFormat:function(d,b){var c=Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(d,b);return c?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(c):null},createReaderByFileExt:function(c,b){var d=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(c,b);return d?Kekule.IO.ChemDataReaderManager.createReaderOfInfo(d):null},getReaderByFileExt:function(c,b){var d=Kekule.IO.ChemDataReaderManager.getReaderInfoByFileExt(c,b);return d?Kekule.IO.ChemDataReaderManager.getReaderOfInfo(d):null},createReaderByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataReaderManager.createReaderByFormat(b):null},getReaderByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataReaderManager.getReaderByFormat(b):null}};Kekule.IO.ChemDataWriterManager={_writers:[],register:function(g,b,c,f,d){if(Kekule.IO.ChemDataWriterManager.getWriterInfoById(g)){Kekule.raise(Kekule.ErrorMsg.WRITER_ID_ALREADY_EXISTS);return null}var e={id:g,writerClass:b,srcClasses:c,formatId:DataType.isArrayValue(f)?f:[f]};e=Object.extend(e,d);Kekule.IO.ChemDataWriterManager._writers.push(e);return e},getAvailableWriterInfos:function(l,g){var b=[];var h=ClassEx.isClass(g)?g:g.getClass?g.getClass():g?null:undefined;var c=Kekule.IO.ChemDataWriterManager._writers;for(var f=c.length-1;f>=0;--f){if(Kekule.ObjUtils.match(c[f],l)){if(h!==undefined){if(h){for(var e=0,d=c[f].srcClasses.length;e<d;++e){if(ClassEx.isOrIsDescendantOf(h,c[f].srcClasses[e])){b.push(c[f])}}}}else{b.push(c[f])}}}return b},getWriterInfo:function(g,e){var b=Kekule.IO.ChemDataWriterManager._writers;for(var f=b.length-1;f>=0;--f){if(Kekule.ObjUtils.match(b[f],g)){if(e){for(var d=0,c=b[f].srcClasses.length;d<c;++d){if(e instanceof b[f].srcClasses[d]){return b[f]}}return null}else{return b[f]}}}return null},getWriterInfoById:function(c,b){return Kekule.IO.ChemDataWriterManager.getWriterInfo({id:c},b)},getWriterInfoByFormat:function(h,b,f){var c=Kekule.IO.ChemDataWriterManager._writers;for(var g=c.length-1;g>=0;--g){if((!b)||Kekule.ObjUtils.match(c[g],b)){if(c[g].formatId.indexOf(h)>=0){if(f){for(var e=0,d=c[g].srcClasses.length;e<d;++e){if(f instanceof c[g].srcClasses[e]){return c[g]}}return null}return c[g]}}}return null},getWriterInfoByFileExt:function(d,b,c){var e=Kekule.IO.DataFormatsManager.findFormatId(null,d);return e?Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c):null},createWriterOfInfo:function(b){return new b.writerClass(b.createOptions)},getWriterOfInfo:function(b){if(!b.instance){b.instance=Kekule.IO.ChemDataWriterManager.createWriterOfInfo(b)}return b.instance},createWriter:function(d,b){var c=Kekule.IO.ChemDataWriterManager.getWriterInfo(d,b);if(c){return Kekule.IO.ChemDataWriterManager.createWriterOfInfo(c)}else{return null}},getWriter:function(d,b){var c=Kekule.IO.ChemDataWriterManager.getWriterInfo(d,b);if(c){return Kekule.IO.ChemDataWriterManager.getWriterOfInfo(c)}else{return null}},createWriterById:function(c,b){return Kekule.IO.ChemDataWriterManager.createWriter({id:c},b)},getWriterById:function(c,b){return Kekule.IO.ChemDataWriterManager.getWriter({id:c},b)},createWriterByFormat:function(e,b,c){var d=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c);return d?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(d):null},getWriterByFormat:function(e,b,c){var d=Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e,b,c);return d?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(d):null},createWriterByFileExt:function(d,b,c){var e=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(d,b,c);return e?Kekule.IO.ChemDataWriterManager.createWriterOfInfo(e):null},getWriterByFileExt:function(d,b,c){var e=Kekule.IO.ChemDataWriterManager.getWriterInfoByFileExt(d,b,c);return e?Kekule.IO.ChemDataWriterManager.getWriterOfInfo(e):null},createWriterByMimeType:function(d,b){var c=Kekule.IO.DataFormatsManager.findFormatId(d,null);return c?Kekule.IO.ChemDataWriterManager.createWriterByFormat(c,null,b):null},getWriterByMimeType:function(c){var b=Kekule.IO.DataFormatsManager.findFormatId(c,null);return b?Kekule.IO.ChemDataWriterManager.getWriterByFormat(b,null,srcObj):null}};Kekule.IO.loadFormatData=function(d,f){var c=Kekule.IO.ChemDataReaderManager.getReaderByFormat(f);if(c){var b=c.readData(d,null,f);return b}else{var e=Kekule.ErrorMsg.NO_SUITABLE_READER_FOR_FORMAT+f;Kekule.raise(e);return null}};Kekule.IO.loadMimeData=function(b,c){return Kekule.IO.loadTypedData(b,c,null)};Kekule.IO.loadTypedData=function(e,i,d){var c;if(d){c=Kekule.UrlUtils.extractFileExt(d)}var h=Kekule.IO.DataFormatsManager.findFormatId(i,i?null:c);var b=Kekule.IO.loadFormatData(e,h);if(b){if((b instanceof Kekule.ChemObject)&&(b.getSrcInfo)){var f=b.getSrcInfo();if(i){f.mimeType=i}if(c){f.fileExt=c}if(d){f.url=d}}return b}else{var g=i?(Kekule.ErrorMsg.NO_SUITABLE_READER_FOR_MIMETYPE+i):(Kekule.ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT+c);Kekule.raise(g);return null}};Kekule.IO.loadFileData=function(e,i,h){if(Kekule.BrowserFeature.fileapi){var f=e.name;var c=Kekule.UrlUtils.extractFileExt(f);var l;if(!h){l=Kekule.IO.DataFormatsManager.findFormat(null,c)}else{l=Kekule.IO.DataFormatsManager.getFormatInfo(h)}if(!l){var d=Kekule.ErrorMsg.NO_SUITABLE_READER_FOR_FILEEXT+c;Kekule.raise(d)}var b=Kekule.IO.ChemDataType.isBinaryType(l.dataType);var g=new FileReader();g.onload=function(n){var m=g.result;var p=Kekule.IO.loadFormatData(m,l.id);var o=!!p;i(p,o)};if(b){g.readAsArrayBuffer(e)}else{g.readAsText(e)}}else{Kekule.error(Kekule.ErrorMsg.FILE_API_NOT_SUPPORTED)}};Kekule.IO.saveFormatData=function(f,e){var c=Kekule.IO.ChemDataWriterManager.getWriterByFormat(e,null,f);if(c){var b=c.writeData(f,null,e);return b}else{var d=Kekule.ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT+e;Kekule.raise(d);return null}};Kekule.IO.saveMimeData=function(c,b){return Kekule.IO.saveTypedData(c,b,null)};Kekule.IO.saveTypedData=function(h,g,d){var c;if(d){c=Kekule.UrlUtils.extractFileExt(d);if(!c){c=d}}var f=Kekule.IO.DataFormatsManager.findFormatId(g,g?null:c);var b=Kekule.IO.saveFormatData(h,f);if(Kekule.ObjUtils.isUnset(b)){var e=g?(Kekule.ErrorMsg.NO_SUITABLE_WRITER_FOR_MIMETYPE+g):(Kekule.ErrorMsg.NO_SUITABLE_WRITER_FOR_FILEEXT+c);Kekule.raise(e);return null}else{return b}}})();Kekule.IO.CML={CML2CORE_NAMESPACE_URI:"http://www.xml-cml.org/schema/cml2/core",CML3_SCHEMA_NAMESPACE_URI:"http://www.xml-cml.org/schema",ARRAY_VALUE_DELIMITER:" ",TYPED_ELEM_NAMES:["string","integer","float"],TYPED_ARRAY_ELEM_NAMES:["stringArray","integerArray","floatArray"],ATOMS_REF_ATTRIBS:["atomRef","atomRefs2","atomRefs3","atomRefs4","atomRefs","atomRefArray"],BONDS_REF_ATTRIBS:["bondRef","bondRefs","bondRefArray"]};Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS=[Kekule.IO.CML.CML2CORE_NAMESPACE_URI,Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI];Kekule.IO.CmlUtils={cmlBondOrderToKekule:function(b){var a=parseInt(b);if(a!==a){switch(b.toUpperCase()){case"A":a=Kekule.BondOrder.EXPLICIT_AROMATIC;break;case"D":a=Kekule.BondOrder.DOUBLE;break;case"T":a=Kekule.BondOrder.TRIPLE;break;case"S":default:a=Kekule.BondOrder.SINGLE;break}}return a},kekuleBondOrderToCml:function(a){switch(a){case Kekule.BondOrder.EXPLICIT_AROMATIC:return"A";case Kekule.BondOrder.QUAD:return"4";case Kekule.BondOrder.DOUBLE:return"D";case Kekule.BondOrder.TRIPLE:return"T";default:return"S"}},cmlBondStereoToKekule:function(b){var a;switch(b.toUpperCase()){case"E":a=Kekule.BondStereo.E;break;case"Z":a=Kekule.BondStereo.Z;break;case"C":a=Kekule.BondStereo.CIS;break;case"T":a=Kekule.BondStereo.TRANS;break;case"W":a=Kekule.BondStereo.UP;break;case"H":a=Kekule.BondStereo.DOWN;break;default:a=Kekule.BondStereo.NONE;break}return a},kekuleBondStereoToCml:function(a){switch(a){case Kekule.BondStereo.UP:return{value:"W"};case Kekule.BondStereo.UP_INVERTED:return{value:"W",invert:true};case Kekule.BondStereo.DOWN:return{value:"H"};case Kekule.BondStereo.DOWN_INVERTED:return{value:"H",invert:true};case Kekule.BondStereo.E:return{value:"E"};case Kekule.BondStereo.Z:return{value:"Z"};case Kekule.BondStereo.CIS:return{value:"C"};case Kekule.BondStereo.TRANS:return{value:"T"};default:return{value:null}}},reagentRoleToKekule:function(a){var b=Kekule.ReactionRole;switch(a){case"reagent":return b.REAGENT;case"catalyst":return b.CATALYST;case"solvent":return b.CATALYST;default:return a}},kekuleReagentRoleToCml:function(a){var b=Kekule.ReactionRole;switch(a){case b.REAGENT:return"reagent";case b.CATALYST:return"catalyst";case b.CATALYST:return"solvent";default:return a}},isDummyElementType:function(a){return((a=="Du")||(a=="Dummy"))},isRGroupElementType:function(a){return(a=="R")},isAtomListElementType:function(a){return(a=="L")},getNodeElementType:function(a){if(a instanceof Kekule.Atom){return a.getSymbol()}else{if(a instanceof Kekule.Pseudoatom){console.log(a);switch(a.getAtomType()){case Kekule.PseudoatomType.DUMMY:return"Du";case Kekule.PseudoatomType.ANY:return"A";case Kekule.PseudoatomType.HETERO:return"Q";case Kekule.PseudoatomType.CUSTOM:default:return a.getSymbol()}}else{if(a instanceof Kekule.VariableAtom){return"R"}else{if(a instanceof Kekule.StructureFragment){return"R"}else{if(a.getSymbol){return a.getSymbol()}else{return"*"}}}}}},createNodeByCmdElementType:function(c,b,a){if(Kekule.IO.CmlUtils.isDummyElementType(b)){result=new Kekule.Pseudoatom(c,Kekule.PseudoatomType.DUMMY)}else{if(Kekule.IO.CmlUtils.isRGroupElementType(b)){result=new Kekule.RGroup(c)}else{if(Kekule.IO.CmlUtils.isAtomListElementType(b)){result=new Kekule.VariableAtom(c)}else{if(Kekule.Element.isElementSymbolAvailable(b)||(b==Kekule.Element.UNSET_ELEMENT)){result=new Kekule.Atom(c,b,Math.round(a))}else{result=new Kekule.Pseudoatom(c,Kekule.PseudoatomType.CUSTOM,b)}}}}return result}};Kekule.IO.CmlDomUtils={splitCmlArrayValue:function(b){if((typeof(b)=="object")&&(b.length)){return b}var a=Kekule.StrUtils.normalizeSpace(Kekule.StrUtils.trim(b));return a.split(Kekule.IO.CML.ARRAY_VALUE_DELIMITER)},mergeToCmlArrayValue:function(a){return a.join(" ")},analysisCmlFormulaConciseValue:function(h){var f=Kekule.IO.CmlDomUtils.splitCmlArrayValue(h);var d=0;var c=f.length;var m=[];var g=null;var a;while(d<c){var b=f[d];var e=parseFloat(b);if(e!=e){if(g){m.push(g)}g={elementType:b}}else{if(g){g.count=e;m.push(g);g=null}else{if(d==c-1){a=e}}}++d}return{isotopes:m,formalCharge:a}},getCmlBuiltinElemInfo:function(c,b,a){var d;d=c.getAttribute("builtin");if((!d)&&b){if(c.getAttributeNS){d=c.getAttributeNS(b,"builtin")}else{if(a){d=a.getAttributeNS(b,"builtin",c)}}}if(d){var e=Kekule.DomUtils.getElementText(node);return{name:d,value:e}}else{return null}},readCmlTypedPropertyElem:function(c,b,a){var d;d=c.getAttribute("builtin");if((!d)&&b){if(c.getAttributeNS){d=c.getAttributeNS(b,"builtin")}else{if(a){d=a.getAttributeNS(b,"builtin",c)}}}if(d){var e=Kekule.DomUtils.getElementText(c);switch(Kekule.DomUtils.getLocalName(c)){case"float":e=parseFloat(e);break;case"integer":e=parseInt(e);break;default:}return{name:d,value:e}}else{return null}},readCmlTypedPropertyArrayElem:function(f,d,c){var g;g=f.getAttribute("builtin");if((!g)&&d){if(f.getAttributeNS){g=f.getAttributeNS(d,"builtin")}else{if(c){g=c.getAttributeNS(d,"builtin",f)}}}if(g){var h=Kekule.DomUtils.getElementText(node);var b=Kekule.IO.CmlDomUtils.splitCmlArrayValue(h);switch(Kekule.DomUtils.getLocalName(f)){case"float":for(var e=0,a=b.length;e<a;++e){b[e]=parseFloat(b[e])}break;case"integer":for(var e=0,a=b.length;e<a;++e){b[e]=parseInt(b[e])}break;default:}return{name:g,values:b}}else{return null}},hasDirectCmlTypedElemChildren:function(f,c){for(var e=0,a=Kekule.IO.CML.TYPED_ELEM_NAMES.length;e<a;++e){var b=Kekule.IO.CML.TYPED_ELEM_NAMES[e];var d=Kekule.DomUtils.getDirectChildElems(f,null,b,c);if(d.length>0){return true}}return false},hasDirectCmlTypedArrayElemChildren:function(f,c){for(var e=0,a=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.length;e<a;++e){var b=Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES[e];var d=Kekule.DomUtils.getDirectChildElems(f,null,b,c);if(d.length>0){return true}}return false},isCmlTypedElem:function(c,b){var a=(Kekule.IO.CML.TYPED_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(c))>=0);if(b){a=a&&(c.namespaceURI==b)}return a},isCmlTypedArrayElem:function(c,b){var a=(Kekule.IO.CML.TYPED_ARRAY_ELEM_NAMES.indexOf(Kekule.DomUtils.getLocalName(c))>=0);if(b){a=a&&(c.namespaceURI==b)}return a},FILTER_TYPED_ELEM:1,FILTER_TYPEDARRAY_ELEM:2,FILTER_ALL:3,getCmlTypedElem:function(e,d,c){var f=e.namespaceURI;var a=Kekule.DomUtils.getDirectChildElemsOfAttribValues(e,[{builtin:d}],null,null,f);if(a&&(a.length>0)){for(var b=a.length-1;b>=0;--b){if((c&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedElem(a[b],f)){return a[b]}else{if((c&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(a[b],f)){return a[b]}}}}return null},getCmlTypedElemValue:function(d,c,b,a){if(!b){b=Kekule.IO.CmlDomUtils.FILTER_ALL}var e=Kekule.IO.CmlDomUtils.getCmlTypedElem(d,c,b);if(e){return Kekule.DomUtils.getElementText(e)}},getCmlElemAttribute:function(e,d,c,b){if(!c){c=Kekule.IO.CmlDomUtils.FILTER_ALL}var a=Kekule.DomUtils.getSameNSAttributeValue(e,d,b);if((a===null)||(a===undefined)){a=Kekule.IO.CmlDomUtils.getCmlTypedElemValue(e,d,c,b)}return a},setCmlElemAttribute:function(c,b,d,a){return Kekule.DomUtils.setSameNSAttributeValue(c,b,d,a)},fetchCmlElemAttributeValuesToJson:function(d,b,n,h){if(!b){b=Kekule.IO.CmlDomUtils.FILTER_ALL}var c=d.namespaceURI;var o=Kekule.DomUtils.fetchAttributeValuesToJson(d,c,true);var m=Kekule.DomUtils.getDirectChildElems(d,null,null,c);for(var g=0,e=m.length;g<e;++g){var a=m[g];if((b&Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedElem(a,c)){var f=Kekule.IO.CmlDomUtils.readCmlTypedPropertyElem(a,c,h);if(o[f.name]&&n){o[f.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+f.value}else{o[f.name]=f.value}}else{if((b&Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM)&&Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(a,c)){var f=Kekule.IO.CmlDomUtils.getCmlBuiltinElemInfo(a,c,h);if(o[f.name]&&n){o[f.name]+=Kekule.IO.CML.ARRAY_VALUE_DELIMITER+f.value}else{o[f.name]=f.value}}}}return o},isScalarElem:function(c,b){var a=(Kekule.DomUtils.getLocalName(c)=="scalar");if(b){a=a&&(c.namespaceURI==b)}return a},getCmlId:function(b,a){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,"id",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a)},setCmlId:function(b,c,a){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(b,"id",c,a)},getCmlTitle:function(b,a){return Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,"title",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a)},setCmlTitle:function(b,c,a){return Kekule.IO.CmlDomUtils.setCmlElemAttribute(b,"title",c,a)}};Kekule.IO.CmlElementReaderFactory={_readers:{},register:function(a,d){if(Kekule.ArrayUtils.isArray(a)){for(var c=0,b=a.length;c<b;++c){Kekule.IO.CmlElementReaderFactory.register(a[c],d)}}else{Kekule.IO.CmlElementReaderFactory._readers[a]=d}},getReader:function(c){var a;if(typeof(c)!="string"){a=Kekule.DomUtils.getLocalName(c)}else{a=c}var b=Kekule.IO.CmlElementReaderFactory._readers[a];if(b){return new b()}else{return null}}};Kekule.IO.CmlElementWriterFactory={_writers:{},register:function(d,a){if(Kekule.ArrayUtils.isArray(d)){for(var c=0,b=d.length;c<b;++c){Kekule.IO.CmlElementWriterFactory.register(d[c],a)}}else{Kekule.IO.CmlElementWriterFactory._writers[d]=a}},getWriter:function(objOrTypeName){var name;if(typeof(objOrTypeName)!="string"){name=DataType.getType(objOrTypeName)}else{name=objOrTypeName}var writerClass=Kekule.IO.CmlElementWriterFactory._writers[name];if((!writerClass)&&(objOrTypeName.getClassName)){var obj=objOrTypeName;var typeNames=Kekule.ObjUtils.getOwnedFieldNames(Kekule.IO.CmlElementWriterFactory._writers);for(var i=typeNames.length-1;i>=0;--i){if(obj instanceof eval(typeNames[i])){writerClass=Kekule.IO.CmlElementWriterFactory._writers[typeNames[i]];break}}}if(writerClass){return new writerClass()}else{return null}}};Kekule.IO.CmlElementHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.CmlElementHandler",initProperties:function(){this.defineProp("domHelper",{dataType:"Kekule.DomHelper",serializable:false,getter:function(){if(!this.getPropStoreFieldValue("domHelper")){this.setPropStoreFieldValue("domHelper",new Kekule.DomHelper())}return this.getPropStoreFieldValue("domHelper")}});this.defineProp("coreNamespaceURI",{dataType:DataType.STRING,serializable:false})},matchCoreNamespace:function(a){var b;if(!a){b=""}else{if(typeof(a)!="string"){b=a.namespaceURI}else{b=a}}return((!this.getCoreNamespaceURI())&&(!b)||(this.getCoreNamespaceURI()&&(this.getCoreNamespaceURI()==b)))},copySettingsToChildHandler:function(a){a.setDomHelper(this.getDomHelper());a.setCoreNamespaceURI(this.getCoreNamespaceURI())}});Kekule.IO.CmlElementReader=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementReader",readElement:function(b,c){var a=this.doReadElement(b,c);if(a&&a.getId&&(!a.getId())){if(a.setId){var d=Kekule.IO.CmlDomUtils.getCmlId(b,this.getDomHelper);if(d){a.setId(d)}}}return a},doReadElement:function(a,b){},readChildElement:function(a,b){return this.doReadChildElement(a,b)},doReadChildElement:function(a,b){return this.doReadChildElementDef(a,b)},readChildElementDef:function(a,b){return this.doReadChildElementDef(a,b)},doReadChildElementDef:function(b,c){var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);return a.readElement(b,c)}else{return null}},iterateChildElements:function(d,e){var c=Kekule.DomUtils.getDirectChildElems(d,null,null,this.getCoreNamespaceURI());for(var b=0,a=c.length;b<a;++b){this.readChildElement(c[b],e)}}});Kekule.IO.CmlElementWriter=Class.create(Kekule.IO.CmlElementHandler,{CLASS_NAME:"Kekule.IO.CmlElementWriter",writeObject:function(e,b,d){if(!(b)&&(!d)){Kekule.error(Kekule.ErrorMsg.CML_CAN_NOT_OUTPUT_TO_EMPTY_ELEMENT);return null}if((!b)&&d){b=d.documentElement}else{if(!d){d=b.ownerDocument}}if(this.getDomHelper().getDocument!=d){this.getDomHelper().setDocument(d)}var c=this.doCreateElem(e,b,d);if(c){b.appendChild(c)}else{c=b}var a=this.doWriteObject(e,c)||c;if(a&&e){this.writeObjId(e,a);this.writeObjAdditionalInfo(e,a)}return a},writeObjId:function(b,a){if(b.getId&&b.getId()){Kekule.IO.CmlDomUtils.setCmlId(a,b.getId(),this.getDomHelper())}},writeScalarAttribs:function(e,c){if(e.getScalarAttribs){var d=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.Scalar");if(d){this.copySettingsToChildHandler(d);for(var b=0,a=e.getScalarAttribCount();b<a;++b){d.writeObject(e.getScalarAttribAt(b),c)}}}},writeObjInfoValues:function(c,a){if(c.getInfo){var m=c.getInfoKeys();var e;for(var d=0,b=m.length;d<b;++d){var g=m[d];var f=c.getInfoValue(m[d]);if(g&&f&&(!Kekule.IO.CmlDomUtils.getCmlElemAttribute(a,g,this.getDomHelper()))){if(!e){e=this.createChildElem("metaDataList",a)}var h=this.createChildElem("metaData",e);Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"name",g,this.getDomHelper());Kekule.IO.CmlDomUtils.setCmlElemAttribute(h,"content",StringUtils.serializeValue(f),this.getDomHelper())}}}},writeObjAdditionalInfo:function(b,a){this.writeScalarAttribs(b,a);this.writeObjInfoValues(b,a)},doCreateElem:function(b,a){},createChildElem:function(e,b,c){var d=c||this.getCoreNamespaceURI();var a=this.getDomHelper().createElementNS(d,e);if(b){b.appendChild(a)}return a},doWriteObject:function(b,a){},reportTypeMismatchError:function(a){Kekule.error(Kekule.ErrorMsg.CML_ELEM_WRITER_TYPE_INPROPER.format(this.getClassName(),DataType.getType(a)))}});Kekule.IO.CmlNameReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlNameReader",initialize:function($super){$super()},doReadElement:function(d,e){var c=Kekule.DomUtils.getElementText(d);var b=Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"convention");if(c){var a={};a.name=c;if(b){a.convention=b}else{if(e.setName){e.setName(c)}}return a}return null}});Kekule.IO.CmlScalarReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlScalarReader",doReadElement:function(b,c){var a=this.readScalar(b);if(c&&c.appendScalarAttrib){c.appendScalarAttrib(a)}else{}return a},readScalar:function(f){var h=Kekule.DomUtils.fetchAttributeValuesToJson(f,this.getCoreNamespaceURI(),true);var g=Kekule.DomUtils.getElementText(f);if(g){h.value=g}if(h.value){if(h.dataType){switch(h.dataType){case"xsd:boolean":h.value=Kekule.StrUtils.strToBool(h.value);break;case"xsd:float":case"xsd:double":case"xsd:duration":case"xsd:decimal":case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:long":case"xsd:int":case"xsd:short":case"xsd:byte":case"xsd:nonNegativeInteger":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":case"xsd:positiveInteger":h.value=parseFloat(h.value);if(h.errorValue){h.errorValue=parseFloat(h.errorValue)}break}}}var a;if(h){a=new Kekule.Scalar();var e=Kekule.ObjUtils.getOwnedFieldNames(h);for(var d=0,b=e.length;d<b;++d){var c=e[d];var g=h[c];switch(c){case"value":a.setValue(g);break;case"errorValue":a.setErrorValue(g);break;case"units":a.setUnit(g);break;case"title":a.setTitle(g);break;case"dictRef":a.setName(g);break;default:a.setInfoValue(c,g)}}}return a}});Kekule.IO.CmlScalarWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlScalarWriter",doCreateElem:function(b,a){return this.createChildElem("scalar",a)},doWriteObject:function(d,c){if(!(d instanceof Kekule.Scalar)){this.reportTypeMismatchError(d);return null}var b;if(!Kekule.ObjUtils.isUnset(d.getValue())){Kekule.DomUtils.setElementText(c,d.getValue());b=DataType.getType(d.getValue())}if(d.getName()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"dictRef",d.getName(),this.getDomHelper())}if(d.getErrorValue()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"errorValue",d.getErrorValue(),this.getDomHelper())}if(d.getUnit()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"units",d.getUnit(),this.getDomHelper())}if(d.getTitle()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"title",d.getTitle(),this.getDomHelper())}if(b){var a=(b==DataType.INT)?"xsd:integer":(b==DataType.FLOAT)?"xsd:float":(b==DataType.BOOL)?"xsd:boolean":null;if(a){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"datatype",a,this.getDomHelper())}}}});Kekule.IO.CmlMetaDataReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaReader",doReadElement:function(a,b){var c=this.readMeta(a);if(b&&b.setInfoValue){if(c.key&&c.value){b.setInfoValue(c.key,c.value)}}else{}return c},readMeta:function(b){var c=Kekule.DomUtils.fetchAttributeValuesToJson(b,this.getCoreNamespaceURI(),true);var a={key:c.name,value:StringUtils.deserializeValue(c.content)};console.log(a);return a}});Kekule.IO.CmlMetaDataListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlMetaListReader",doReadElement:function(e,g){var f=Kekule.DomUtils.getDirectChildElems(e,null,"metaData",this.getCoreNamespaceURI());for(var d=0,c=f.length;d<c;++d){var b=f[d];var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);a.readElement(b,g)}}}});Kekule.IO.CmlChemStructureReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlChemStructureReader",initialize:function($super){$super()},hasAtomChildren:function(c,a){var b=a.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",c);return b.length},getAtomChildren:function(c,a){var b=a.getElementsByTagNameNS(this.getCoreNamespaceURI(),"atom",c);return b},atomInfoToJSON:function(c,b){var a;var d={};d=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,true,b);return d},arrayedAtomInfosToJSON:function(b,n){var c=["atomID","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"];var g=["id","elementType","isotope","hydrogenCount","formalCharge","count","xFract","yFract","zFract","x2","y2","x3","y3","z3"];var h=[];for(var m=0,d=c.length;m<d;++m){var a;var o=[];a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,c[m],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,n);if(a){o=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a)}for(var f=0,e=o.length;f<e;++f){if(!h[f]){h[f]={}}if(o[f]){h[f][g[m]]=o[f]}}}return h}});Kekule.IO.CmlFormulaReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlFormulaReader",doReadElement:function(a,b){return this.readFormula(a,this.getDomHelper())},readFormula:function(g,d){var b=new Kekule.MolecularFormula();var f=Kekule.IO.CmlDomUtils.getCmlElemAttribute(g,"formalCharge",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,d);if(f){b.setCharge(parseFloat(f))}var a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(g,"concise",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,d);if(a){this.setConcise(b,a)}else{var h=Kekule.DomUtils.getDirectChildElems(g,null,null,this.getCoreNamespaceURI());for(var e=0,c=h.length;e<c;++e){switch(Kekule.DomUtils.getLocalName(h[e])){case"formula":this.readSubFormula(b,h[e],d);break;case"atomArray":this.readAtomArray(b,h[e],d);break;default:if(Kekule.IO.CmlDomUtils.isCmlTypedElem(node)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(node)){}else{this.readChildElementDef(node,b)}}}}return b},readConsice:function(b){var a=null;if(b){a=new Kekule.MolecularFormula();this.setConcise(a,b)}return a},setConcise:function(c,a){var b=Kekule.IO.CmlDomUtils.analysisCmlFormulaConciseValue(a);if(b.isotopes&&b.isotopes.length){this.createSectionsFromAtomAttribs(c,b.isotopes)}if(b.formalCharge){c.setCharge(b.formalCharge)}return c},readAtomArray:function(a,b,g){var d=[];var f=this.getAtomChildren(b,g);if(f.length>0){for(var e=0,c=f.length;e<c;++e){var m=f[e];var h=this.atomInfoToJSON(m,g);d.push(h)}}else{d=this.arrayedAtomInfosToJSON(b,g)}this.createSectionsFromAtomAttribs(a,d);return a},createSectionsFromAtomAttribs:function(g,f){for(var b=0,a=f.length;b<a;++b){var e=f[b].elementType;if(e){var d=Kekule.IO.CmlUtils.createNodeByCmdElementType(null,e);if(f[b].formalCharge){d.setCharge(f[b].formalCharge)}var c=f[b].count;g.appendSection(d,c)}}},readSubFormula:function(d,c,a){var e=this.readElement(c,a);var b=Kekule.IO.CmlDomUtils.getCmlElemAttribute(c,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,a);d.appendSection(e,parseFloat(b)||1)}});Kekule.IO.CmlFormulaWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlFormulaWriter",doCreateElem:function(b,a){return this.createChildElem("formula",a)},doWriteObject:function(b,f){if(!(b instanceof Kekule.MolecularFormula)){this.reportTypeMismatchError(b);return null}var e=[];var h=[];var g=[];for(var c=0,a=b.getSectionCount();c<a;++c){var m=b.getSectionAt(c);if(m.obj instanceof Kekule.MolecularFormula){this.createAtomArrayElem(e,h,g,f);e=[];h=[];g=[];var d=this.writeSubFormula(m.obj,m.count||1,f)}else{e.push(Kekule.IO.CmlUtils.getNodeElementType(m.obj));h.push(m.count||1);g.push(m.obj.getCharge?(m.obj.getCharge()||0):0);if(c==a-1){this.createAtomArrayElem(e,h,g,f)}}}if(b.getCharge()){Kekule.IO.CmlDomUtils.setCmlElemAttribute(f,"formalCharge",b.getCharge(),this.getDomHelper())}},writeSubFormula:function(d,c,b){var a=this.createChildElem("formula",b);this.doWriteObject(d,a);if(c>1){Kekule.IO.CmlDomUtils.setCmlElemAttribute(a,"count",c,this.getDomHelper())}return a},createAtomArrayElem:function(e,h,g,f){if(e.length<=0){return}var o=this.createChildElem("atomArray",f);var b=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(e);var a=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h);Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"elementType",b,this.getDomHelper());Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"count",a,this.getDomHelper());var m=false;for(var d=0,c=g.length;d<c;++d){if(g[d]){m=true;break}}if(m){var n=Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(h);Kekule.IO.CmlDomUtils.setCmlElemAttribute(o,"formalCharge",n,this.getDomHelper())}return o}});Kekule.IO.CmlMoleculeReader=Class.create(Kekule.IO.CmlChemStructureReader,{CLASS_NAME:"Kekule.IO.CmlMoleculeReader",initialize:function($super){$super()},initProperties:function(){this.defineProp("structureBuilder",{dataType:"Kekule.ChemStructureBuilder",serializable:false,getter:function(){if(!this.getPropStoreFieldValue("structureBuilder")){this.setPropStoreFieldValue("structureBuilder",new Kekule.ChemStructureBuilder())}return this.getPropStoreFieldValue("structureBuilder")},setter:null})},doReadElement:function(a,b){return this.readMolecule(a,this.getDomHelper())},doReadChildElement:function($super,d,e){if((Kekule.DomUtils.getLocalName(d)=="molecule")&&(this.matchCoreNamespace(d))){if(e.getSubMolecules){var a=this.readElement(d,e);if(a){var c=Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"amount",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM)||Kekule.IO.CmlDomUtils.getCmlElemAttribute(d,"count",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM);var b=c?{amount:parseFloat(c)}:null;e.getSubMolecules().appendObj(a,b)}return a}else{return null}}else{return $super(d,e)}},hasSubMolecule:function(b){var a=Kekule.DomUtils.getDirectChildElems(b,null,"molecule",this.getCoreNamespaceURI());return(a.length>0)},readMolecule:function(c,b){var a;if(this.hasSubMolecule(c)){a=new Kekule.CompositeMolecule();this.iterateChildElements(c,a)}else{a=this.readMoleculeCore(c,b)}this.readMoleculeAttribs(a,c,b);return a},readMoleculeAttribs:function(f,c,g){var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,null,true,g);var b=Kekule.ObjUtils.getOwnedFieldNames(a);for(var e=0,d=b.length;e<d;++e){var m=b[e];var h=a[m];switch(m){case"id":f.setId(h);break;case"title":f.setInfoValue("title",h);break;case"formalCharge":if(h){f.setCharge(parseFloat(h))}break;case"formula":this.readFormulaAttrib(f,h);break;case"amount":case"count":break;default:f.setInfoValue(m,h)}}},readMoleculeCore:function(d,b){var a=new Kekule.Molecule();this.getStructureBuilder().setTarget(a);var c=d.firstChild;while(c){if(c.nodeType!=Node.ELEMENT_NODE){}else{if(!this.matchCoreNamespace(c)){}else{switch(Kekule.DomUtils.getLocalName(c)){case"atomArray":this.readMoleculeAtomArray(a,c,this.getStructureBuilder(),b);break;case"bondArray":this.readMoleculeBondArray(a,c,this.getStructureBuilder(),b);break;case"formula":this.readFormula(a,c,b);break;case"molecule":break;default:if(Kekule.IO.CmlDomUtils.isCmlTypedElem(c)||Kekule.IO.CmlDomUtils.isCmlTypedArrayElem(c)){}else{this.readChildElementDef(c,a)}}}}c=c.nextSibling}if(a.hasCtab()){this.connectUpBondAndAtom(a)}return a},connectUpBondAndAtom:function(e){var f=e.getConnectors();for(var d=0,c=f.length;d<c;++d){var m=f[d];var b=m[this._BOND_ATOM_REF_TEMP_FIELD];if(b&&b.length){for(j=0,k=b.length;j<k;++j){var g=e.getNodeById(b[j]);if(g){m.appendConnectedObj(g)}else{Kekule.raise((Kekule.hasLocalRes()?Kekule.ErrorMsg.ATOMID_NOT_EXISTS:"Atom id not exists: ")+b[j])}}}delete m[this._BOND_ATOM_REF_TEMP_FIELD];var h=m[this._BOND_BOND_REF_TEMP_FIELD];if(h&&h.length){for(j=0,k=h.length;j<k;++j){var a=e.getConnectorById(h[j]);if(a){m.appendConnectedObj(a)}else{Kekule.raise((Kekule.hasLocalRes()?Kekule.ErrorMsg.BONDID_NOT_EXISTS:"Bond id not exists: ")+h[j])}}}delete m[this._BOND_BOND_REF_TEMP_FIELD]}},readMoleculeAtomArray:function(f,a,m,g){m.setTarget(f);var e=this.getAtomChildren(a,g);if(e.length>0){for(var c=0,b=e.length;c<b;++c){var h=e[c];var n=this.readAtom(h,g);m.appendNode(n)}}else{var d=this.readArrayedAtoms(a,g);for(var c=0,b=d.length;c<b;++c){m.appendNode(d[c])}}},readAtom:function(f,c){var a;hasChildInfoElems=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(f,this.getCoreNamespaceURI());var g=this.atomInfoToJSON(f,c);a=this.createStructureNodeOfAttribs(g);if(hasChildInfoElems){var e=Kekule.DomUtils.getDirectChildElems(f,null,null,this.getCoreNamespaceURI());for(var d=0,b=e.length;d<b;++d){var f=e[d];this.readChildElementDef(f,a)}}return a},readArrayedAtoms:function(f,c){var g=this.arrayedAtomInfosToJSON(f,c);var a=[];for(var d=0,b=g.length;d<b;++d){var e=this.createStructureNodeOfAttribs(g[d]);if(e){a.push(e)}}return a},createStructureNodeOfAttribs:function(b){var i;if(!b.elementType){b.elementType=Kekule.Element.UNSET_ELEMENT}var c=null;if(b.id!==undefined){c=b.id}delete b.id;var a=b.isotope?Math.round(b.isotope):null;i=Kekule.IO.CmlUtils.createNodeByCmdElementType(c,b.elementType,a);delete b.elementType;if(b.hydrogenCount!==undefined){if(i.setExplicitHydrogenCount){i.setExplicitHydrogenCount(parseInt(b.hydrogenCount,10))}}delete b.hydrogenCount;if(b.formalCharge){i.setCharge(parseInt(b.formalCharge))}delete b.formalCharge;if(b.title){i.setInfoValue("title",b.title)}delete b.title;if(b.role){i.setInfoValue("role",b.role)}delete b.role;var f,d;if((b.x2!==undefined)&&(b.y2!==undefined)){f={x:parseFloat(b.x2),y:parseFloat(b.y2)}}else{if(b.xy2){var h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(b.xy2);if(h.length==2){f={x:h[0],y:h[1]}}}}delete b.x2;delete b.y2;delete b.xy2;if((b.x3!==undefined)&&(b.y3!==undefined)&&(b.z3!==undefined)){d={x:parseFloat(b.x3),y:parseFloat(b.y3),z:parseFloat(b.z3)}}else{if(b.xyz3){var e=Kekule.IO.CmlDomUtils.splitCmlArrayValue(b.xyz3);if(e.length==3){f={x:e[0],y:e[1],z:e[2]}}}}delete b.x3;delete b.y3;delete b.z3;delete b.xyz3;if(f){i.setCoord2D(f)}if(d){i.setCoord3D(d)}for(var g in b){if(b.hasOwnProperty(g)&&(typeof(b[g])=="string")){i.setInfoValue(g,b[g])}}return i},_BOND_ATOM_REF_TEMP_FIELD:"__cml_atomRefs",_BOND_BOND_REF_TEMP_FIELD:"__cml_bondRefs",readMoleculeBondArray:function(f,b,n,h){n.setTarget(f);var m=h.getElementsByTagNameNS(this.getCoreNamespaceURI(),"bond",b);if(m.length>0){for(var e=0,d=m.length;e<d;++e){var a=m[e];var c=this.readBond(f,a,h);n.appendConnector(c)}}else{var g=this.readArrayedBonds(f,b,h);for(var e=0,d=g.length;e<d;++e){n.appendConnector(g[e])}}},readBond:function(h,c,m){var o;var a=[];var f=false;f=!Kekule.IO.CmlDomUtils.hasDirectCmlTypedElemChildren(c,this.getCoreNamespaceURI());a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlUtils.FILTER_TYPED_ELEM,true,m);o=this.createStructureConnectorOfAttribs(h,a);if(f){var b=Kekule.DomUtils.getDirectChildElems(c,null,null,this.getCoreNamespaceURI());for(var e=0,d=b.length;e<d;++e){var c=b[e];if(Kekule.DomUtils.getLocalName(c)=="bondStereo"){var g=Kekule.DomUtils.getElementText(c);if(!g){g=Kekule.IO.CmlDomUtils.getCmlElemAttribute(c,"conversionValue",Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,m)}var n=Kekule.IO.CmlUtils.cmlBondStereoToKekule(g);if((n!=Kekule.BondStereo.NONE)&&o.setStereo){o.setStereo(n)}}else{this.readChildElementDef(c,o)}}}return o},readArrayedBonds:function(n,b,o){var c=["bondID","atomRef1","atomRef2","order","bondStereo"];var h=["id","atomRefs2","atomRefs2","order","bondStereo"];var d=[];for(var m=0,e=c.length;m<e;++m){var a;var p=[];a=Kekule.IO.CmlDomUtils.getCmlElemAttribute(b,c[m],Kekule.IO.CmlDomUtils.FILTER_TYPEDARRAY_ELEM,o);if(a){p=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a)}for(var g=0,f=p.length;g<f;++g){if(!d[g]){d[g]={}}if(p[g]){if((c[m]=="atomRef1")||(c[m]=="atomRef2")){if(d[g]["atomRefs2"]==undefined){d[g]["atomRefs2"]=[]}if(c[m]=="atomRef1"){d[g]["atomRefs2"][0]=p[g]}else{d[g]["atomRefs2"][1]=p[g]}}else{d[g][h[m]]=p[g]}}}}var r=[];for(var m=0,e=d.length;m<e;++m){var q=this.createStructureConnectorOfAttribs(n,d[m]);if(q){r.push(q)}}return r},createStructureConnectorOfAttribs:function(g,a){var p;var b,m;if(a.id){b=a.id}delete a.id;if(a.order!==undefined){m=Kekule.IO.CmlUtils.cmlBondOrderToKekule(a.order)}delete a.order;p=new Kekule.Bond(b,null,m);if(a.bondStereo){var o=Kekule.IO.CmlUtils.cmlBondStereoToKekule(a.bondStereo);if((o!=Kekule.BondStereo.NONE)&&p.setStereo){p.setStereo(o)}}delete a.bondStereo;for(var f=0,e=Kekule.IO.CML.ATOMS_REF_ATTRIBS.length;f<e;++f){var d=Kekule.IO.CML.ATOMS_REF_ATTRIBS[f];if(a[d]!=undefined){var c=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a[d]);if(c.length>0){p[this._BOND_ATOM_REF_TEMP_FIELD]=c}delete a[d];break}}for(var f=0,e=Kekule.IO.CML.BONDS_REF_ATTRIBS.length;f<e;++f){var d=Kekule.IO.CML.BONDS_REF_ATTRIBS[f];if(a[d]!=undefined){var h=Kekule.IO.CmlDomUtils.splitCmlArrayValue(a[d]);if(h.length>0){p[this._BOND_BOND_REF_TEMP_FIELD]=h}delete a[d];break}}for(var n in a){if(a.hasOwnProperty(n)&&(typeof(a[n])=="string")){p.setInfoValue(n,a[n])}}return p},readFormula:function(b,d,c){var a=Kekule.IO.CmlElementReaderFactory.getReader(d);if(a){this.copySettingsToChildHandler(a);var e=a.readElement(d,b);if(e){b.setFormula(e)}}},readFormulaAttrib:function(c,b){var a=Kekule.IO.CmlElementReaderFactory.getReader("formula");if(a){var d=a.readConsice?a.readConsice(b):null;if(d){c.setFormula(d)}}}});Kekule.IO.CmlMoleculeWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlMoleculeWriter",initProperties:function(){this.defineProp("allowCascadeGroup",{dataType:DataType.BOOL})},doCreateElem:function(b,a){return this.createChildElem("molecule",a)},doWriteObject:function(b,a){return this.writeMolecule(b,a)},writeMolecule:function(b,c){var a;this.writeMoleculeAttribs(b,c);if(b instanceof Kekule.CompositeMolecule){a=this.writeCompositeMolecule(b,c)}else{a=this.writeMoleculeCore(b,c)}return a},writeMoleculeAttribs:function(a,g){var h=[];if(a.getCharge()){h.push({key:"formalCharge",value:a.getCharge()})}var e=["title","dictRef","chirality","ref","spinMultiplicity","symmetryOriented","role"];for(var d=0,b=e.length;d<b;++d){var c=e[d];var f=a.getInfoValue(c);if(!Kekule.ObjUtils.isUnset(f)){h.push({key:c,value:a.getInfoValue(c)})}}for(var d=0,b=h.length;d<b;++d){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,h[d].key,h[d].value,this.getDomHelper())}},writeCompositeMolecule:function(c,e){var h=c.getSubMolecules();for(var d=0,b=h.getItemCount();d<b;++d){var g=h.getItemAt(d);var a=g.obj;var f=this.writeObject(a,e);if(g.amount){Kekule.IO.CmlDomUtils.setCmlElemAttribute(f,"amount",g.amount,this.getDomHelper())}}return e},writeMoleculeCore:function(a,b){if(a.hasFormula()){var d=a.getFormula();var c=Kekule.IO.CmlElementWriterFactory.getWriter(d);this.copySettingsToChildHandler(c);c.writeObject(d,b)}if(a.hasCtab()){this.writeCtab(a.getCtab(),a,b)}},writeCtab:function(f,m,c){this.identifyObjsInCtab(f,m);var a=this.getAllowCascadeGroup()?f.getNodes():f.getLeafNodes();if(a.length>0){var d=this.createChildElem("atomArray",c);for(var h=0,e=a.length;h<e;++h){this.writeCtabNode(a[h],d)}}var b=this.getAllowCascadeGroup()?f.getConnectors():f.getAllChildConnectors();if(b.length>0){var g=this.createChildElem("bondArray",c);for(var h=0,e=b.length;h<e;++h){this.writeCtabConnector(b[h],g)}}},writeCtabNode:function(b,c){var t=this.createChildElem("atom",c);this.writeObjId(b,t);var n=Kekule.IO.CmlUtils.getNodeElementType(b);Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"elementType",n,this.getDomHelper());var a=b.getMassNumber?b.getMassNumber():null;if(a){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"isotope",a,this.getDomHelper())}var h=b.getExplicitHydrogenCount?b.getExplicitHydrogenCount():null;if(!Kekule.ObjUtils.isUnset(h)){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"hydrogenCount",h,this.getDomHelper())}var m=b.getCharge?b.getCharge():null;if(m){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"formalCharge",m,this.getDomHelper())}var p=b.getInfoValue?b.getInfoValue("title"):null;if(p){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"title",p,this.getDomHelper())}var g=b.getInfoValue?b.getInfoValue("role"):null;if(g){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"role",g,this.getDomHelper())}if(b.hasCoord2D&&b.hasCoord2D()){var o=b.getAbsCoord2D();Kekule.ObjUtils.isUnset(o.x)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"x2",o.x,this.getDomHelper());Kekule.ObjUtils.isUnset(o.y)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"y2",o.y,this.getDomHelper())}if(b.hasCoord3D&&b.hasCoord3D()){var f=b.getAbsCoord3D();Kekule.ObjUtils.isUnset(f.x)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"x3",f.x,this.getDomHelper());Kekule.ObjUtils.isUnset(f.y)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"y3",f.y,this.getDomHelper());Kekule.ObjUtils.isUnset(f.z)?null:Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,"z3",f.z,this.getDomHelper())}var s=["occupancy","xFract","xyzFract","yFract","convention","dictRef","ref"];for(var e=0,d=s.length;e<d;++e){var r=s[e];var q=b.getInfoValue(r);if(q){Kekule.IO.CmlDomUtils.setCmlElemAttribute(t,r,q,this.getDomHelper())}}this.writeObjAdditionalInfo(b,t);return t},writeCtabConnector:function(a,w){var q=false;var g=this.createChildElem("bond",w);this.writeObjId(a,g);var r=a.getBondOrder?a.getBondOrder():null;if(r){var n=Kekule.IO.CmlUtils.kekuleBondOrderToCml(r);if(n){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,"order",n,this.getDomHelper())}}var u=a.getStereo?a.getStereo():null;if(u){var e=Kekule.IO.CmlUtils.kekuleBondStereoToCml(u);if(e.value){var v=this.createChildElem("bondStereo",g);Kekule.DomUtils.setElementText(v,e.value);if(e.invert){q=true}}}var f=[];var d=[];for(var s=0,p=a.getConnectedObjCount();s<p;++s){var h=a.getConnectedObjAt(s);if(h.getId&&h.getId()){var m=h.getId();if(h instanceof Kekule.ChemStructureNode){if(q){f.unshift(m)}else{f.push(m)}}else{if(h instanceof Kekule.ChemStructureConnector){d.push(m)}}}}var c=f.length;if(c){var b=(c==1)?"atomRefs":((c>=2)&&(c<=4))?"atomRefs"+c:"atomRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,b,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(f),this.getDomHelper())}var c=d.length;if(c){var b="bondRefs";Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,b,Kekule.IO.CmlDomUtils.mergeToCmlArrayValue(d),this.getDomHelper())}var t=["convention","dictRef","ref"];for(var s=0,p=t.length;s<p;++s){var x=t[s];var o=a.getInfoValue(x);if(o){Kekule.IO.CmlDomUtils.setCmlElemAttribute(g,x,o,this.getDomHelper())}}this.writeObjAdditionalInfo(a,g);return g},identifyObjsInCtab:function(e,a){for(var d=0,c=e.getNodeCount();d<c;++d){var f=e.getNodeAt(d);if(!f.getId()){this.autoIdentifyForObj(f,a)}if(e.isSubFragment(f)&&f.hasCtab&&f.hasCtab()){this.identifyObjsInCtab(f.getCtab(),a)}}for(var d=0,c=e.getConnectorCount();d<c;++d){var b=e.getConnectorAt(d);if(!b.getId()){this.autoIdentifyForObj(b,a)}}},autoIdentifyForObj:function(b,a){if(!b.getId()){if(b.getOwner&&b.getOwner()&&b.getOwner().getAutoId){b.setId(b.getOwner().getAutoId(b))}else{b.setId(this.getAutoIdForObj(b,a))}}},getAutoIdForObj:function(e,a){var d=e.getAutoIdPrefix?e.getAutoIdPrefix():"obj";if(!Kekule.IO.CmlMoleculeWriter._UID_SEED){Kekule.IO.CmlMoleculeWriter._UID_SEED=(new Date()).getTime()}++Kekule.IO.CmlMoleculeWriter._UID_SEED;var b=Kekule.IO.CmlMoleculeWriter._UID_SEED.toString();var c=""+d+b;return c}});Kekule.IO.CmlMoleculeWriter._UID_SEED=null;Kekule.IO.CmlReactionReagentReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReagentReader",doReadElement:function(a,b){return this.readReagent(a,this.getDomHelper())},readReagent:function(e,d){var f=null;var g=Kekule.DomUtils.getDirectChildElems(e,null,"molecule",this.getCoreNamespaceURI());if(g&&g.length){var c=g[g.length-1];var b=Kekule.IO.CmlElementReaderFactory.getReader(c);this.copySettingsToChildHandler(b);var a=b.readElement(c,null);if(a){f={};Kekule.RoleMapUtils.setItem(f,a);this.readReagentAttribs(f,e,d)}}else{}return f},readReagentAttribs:function(b,c,f){var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(c,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,true,f);var m=Kekule.ObjUtils.getOwnedFieldNames(a);for(var e=0,d=m.length;e<d;++e){var h=m[e];var g=a[h];switch(h){case"role":b.role=Kekule.IO.CmlUtils.reagentRoleToKekule(g);break;case"amount":case"count":b.amount=parseFloat(g);break;default:b[h]=g}}return b}});Kekule.IO.CmlReactionReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlReactionReader",doReadElement:function(a,b){return this.readReaction(a,this.getDomHelper())},readReaction:function(d,g){var n=new Kekule.Reaction();var c=Kekule.DomUtils.getDirectChildElems(d,null,null,this.getCoreNamespaceURI());for(var f=0,e=c.length;f<e;++f){if(this.isComponentListElem(c[f])){this.readComponentList(n,c[f],g)}else{this.readChildElement(c[f],n)}}var a=Kekule.IO.CmlDomUtils.fetchCmlElemAttributeValuesToJson(d,Kekule.IO.CmlDomUtils.FILTER_TYPED_ELEM,null,this.getDomHelper());var b=Kekule.ObjUtils.getOwnedFieldNames(a);for(var f=0,e=b.length;f<e;++f){var m=b[f];var h=a[m];switch(m){case"name":n.setName(h);break;case"title":n.setTitle(h);break;case"type":n.setReactionType(h);break;case"yield":n.setYield(parseFloat(h));break;default:n.setInfoValue(m,h)}}return n},readComponentList:function(f,b,g){var e=this.getListElemComponentName(b);var m=f.getComponentArray(e,true);if(m){var a=Kekule.DomUtils.getDirectChildElems(b,null,null,this.getCoreNamespaceURI());for(var d=0,c=a.length;d<c;++d){var h=this.readChildElement(a[d],m);if(h){if((e==Kekule.ReactionComponent.CONDITION)&&(h instanceof ObjectEx)){f.appendItem(e,h)}else{f.appendMap(e,h)}}}}},isComponentListElem:function(a){return["reactantList","productList","substanceList","conditionList"].indexOf(Kekule.DomUtils.getLocalName(a))>=0},getListElemComponentName:function(a){switch(Kekule.DomUtils.getLocalName(a)){case"reactantList":return Kekule.ReactionComponent.REACTANT;case"productList":return Kekule.ReactionComponent.PRODUCT;case"conditionList":return Kekule.ReactionComponent.CONDITION;default:return Kekule.ReactionComponent.SUBSTANCE}}});Kekule.IO.CmlReactionWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlReactionWriter",doCreateElem:function(b,a){return this.createChildElem("reaction",a)},doWriteObject:function(b,a){return this.writeReaction(b,a)},writeReaction:function(c,d){var e=[Kekule.ReactionComponent.REACTANT,Kekule.ReactionComponent.PRODUCT,Kekule.ReactionComponent.SUBSTANCE,Kekule.ReactionComponent.CONDITION];for(var b=0,a=e.length;b<a;++b){this.writeCompList(c,e[b],d)}this.writeReactionAttribs(c,d);return d},writeReactionAttribs:function(d,e){var f=[];d.getName()?f.push({key:"name",value:d.getName()}):null;d.getTitle()?f.push({key:"title",value:d.getTitle()}):null;d.getReactionType()?f.push({key:"type",value:d.getReactionType()}):null;d.getYield()?f.push({key:"yield",value:d.getYield()}):null;var c=["dictRef","convention","format","ref","role","type","state","yield","atomMap","electronMap"];for(var b=0,a=c.length;b<a;++b){if(!Kekule.ObjUtils.isUnset(d.getInfoValue(c[b]))){f.push({key:c[b],value:d.getInfoValue(c[b])})}}for(var b=0,a=f.length;b<a;++b){Kekule.IO.CmlDomUtils.setCmlElemAttribute(e,f[b].key,f[b].value,this.getDomHelper())}},writeCompList:function(o,m,n){if(o.getComponentItemCount(m)<=0){return null}else{var a=this.getReactionComponentCmlName(m);var f=this.createChildElem(a+"List",n);for(var h=0,e=o.getComponentItemCount(m);h<e;++h){var b=o.getMapAt(m,h);var g=o.getMapItemAt(m,h);if(b&&g){var c;if(m!=Kekule.ReactionComponent.CONDITION){c=this.createChildElem(a,f);if(!Kekule.ObjUtils.isUnset(b.amount)){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"amount",b.amount,this.getDomHelper())}if(b.role){Kekule.IO.CmlDomUtils.setCmlElemAttribute(c,"role",Kekule.IO.CmlUtils.kekuleReagentRoleToCml(b.role),this.getDomHelper())}}else{c=f}var d=Kekule.IO.CmlElementWriterFactory.getWriter(g);if(d){this.copySettingsToChildHandler(d);d.writeObject(g,c)}}}}},getReactionComponentCmlName:function(a){switch(a){case Kekule.ReactionComponent.REACTANT:return"reactant";case Kekule.ReactionComponent.PRODUCT:return"product";case Kekule.ReactionComponent.CONDITION:return"condition";default:return"substance"}}});Kekule.IO.CmlListReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlListReader",doReadElement:function(b,c){var a=this.createList(b);a=this.readList(a,b,this.getDomHelper());return a},createList:function(a){switch(Kekule.DomUtils.getLocalName(a)){case"moleculeList":return new Kekule.MoleculeList();break;case"reactionList":return new Kekule.ReactionList();break;default:return new Kekule.ChemObjList()}},readList:function(h,c,m){var b=Kekule.DomUtils.getDirectChildElems(c,null,null,this.getCoreNamespaceURI());if(b){for(var f=0,d=b.length;f<d;++f){var a=b[f];var g=Kekule.IO.CmlElementReaderFactory.getReader(a);if(g){this.copySettingsToChildHandler(g);var e=g.readElement(a,null);if(e){h.append(e)}}}}return h}});Kekule.IO.CmlListWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlListWriter",doCreateElem:function(c,a){var b;switch(DataType.getType(c)){case"Kekule.MoleculeList":b="moleculeList";break;case"Kekule.ReactionList":b="reactionList";break;default:b="list"}return this.createChildElem(b,a)},doWriteObject:function(c,b){var a=Kekule.ChemStructureUtils.getChildStructureObjs(c,false);return this.writeList(a,b)},writeList:function(f,d){for(var b=0,a=f.length;b<a;++b){var c=f[b];if(c){var e=Kekule.IO.CmlElementWriterFactory.getWriter(c);if(e){this.copySettingsToChildHandler(e);e.writeObject(c,d)}}}return d}});Kekule.IO.CmlRootReader=Class.create(Kekule.IO.CmlElementReader,{CLASS_NAME:"Kekule.IO.CmlRootReader",doReadElement:function(e,f){this.analysisElem(e);var a;if(Kekule.DomUtils.getLocalName(e)!="cml"){a=this.getReader(e)}if(a){return a.readElement(e,null)}else{var d=Kekule.DomUtils.getDirectChildElems(e,null,null,this.getCoreNamespaceURI());if(d){for(var c=0,b=d.length;c<b;++c){a=this.getReader(d[c]);if(a){return a.readElement(d[c],null);break}}}}return null},getReader:function(b){var a=Kekule.IO.CmlElementReaderFactory.getReader(b);if(a){this.copySettingsToChildHandler(a);return a}return null},analysisElem:function(c){var d=this.getDomHelper();d.setForceAnalysisDoc(true);this.getDomHelper().setRootElement(c);var g=d.getNamespaces();var a=null;for(var e=0,b=g.length;e<b;++e){var f=g[e].namespaceURI;if(Kekule.IO.CML.LEGAL_CORE_NAMESPACE_URIS.indexOf(f)>=0){a=f;break}}this.setCoreNamespaceURI(f||null)}});Kekule.IO.CmlRootWriter=Class.create(Kekule.IO.CmlElementWriter,{CLASS_NAME:"Kekule.IO.CmlRootWriter",getWriter:function(b){var a=Kekule.IO.CmlElementWriterFactory.getWriter(b);if(a){this.copySettingsToChildHandler(a);return a}return null},writeObject:function(e,a,d){var b=this.getDomHelper();b.setForceAnalysisDoc(true);this.getDomHelper().setRootElement(a);var f;if(e instanceof Kekule.ChemSpace){f=e.getRoot()}else{f=e}var c=this.getWriter(f);if(c){return c.writeObject(f,a)}else{return null}}});Kekule.IO.CmlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.CmlReader",doReadData:function(d,c,f){var b;if(c!=Kekule.IO.ChemDataType.DOM){var e=XmlUtility.parse(d);b=e.documentElement}else{if(d.documentElement){b=d.documentElement}else{b=d}}var a=Kekule.IO.CmlElementReaderFactory.getReader("cml");return a.readElement(b,null)}});Kekule.IO.CmlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.CmlWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?true:b.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true})},doWriteData:function(f,b,e){var g=Kekule.IO.CML.CML3_SCHEMA_NAMESPACE_URI;var d=XmlUtility.newDocument("cml",g);var c=Kekule.IO.CmlElementWriterFactory.getWriter("Kekule.ChemDocument");if(c){c.setCoreNamespaceURI(g);var a=c.writeObject(f,d.documentElement);if(b==Kekule.IO.ChemDataType.TEXT){a=XmlUtility.serializeNode(d.documentElement,{prettyPrint:this.getPrettyPrint()})}return a}else{Kekule.error(Kekule.ErrorMsg.UNABLE_TO_OUTPUT_AS_CML.format(DataType.getType(f)));return null}}});(function(){var c=Kekule.IO.CmlElementReaderFactory;c.register("name",Kekule.IO.CmlNameReader);c.register("scalar",Kekule.IO.CmlScalarReader);c.register("metaData",Kekule.IO.CmlMetaDataReader);c.register("metaDataList",Kekule.IO.CmlMetaDataListReader);c.register("formula",Kekule.IO.CmlFormulaReader);c.register("molecule",Kekule.IO.CmlMoleculeReader);c.register(["reactant","product","substance"],Kekule.IO.CmlReactionReagentReader);c.register("reaction",Kekule.IO.CmlReactionReader);c.register(["list","moleculeList","reactionList"],Kekule.IO.CmlListReader);c.register("cml",Kekule.IO.CmlRootReader);var b=Kekule.IO.CmlElementWriterFactory;b.register("Kekule.Scalar",Kekule.IO.CmlScalarWriter);b.register("Kekule.MolecularFormula",Kekule.IO.CmlFormulaWriter);b.register(["Kekule.ChemStructureFragment","Kekule.Molecule","Kekule.CompositeMolecule"],Kekule.IO.CmlMoleculeWriter);b.register("Kekule.Reaction",Kekule.IO.CmlReactionWriter);b.register(["Kekule.ChemObjList","Kekule.ChemStructureObjectGroup","Kekule.ChemSpaceElement","Kekule.ChemSpace"],Kekule.IO.CmlListWriter);b.register("Kekule.ChemDocument",Kekule.IO.CmlRootWriter);Kekule.IO.DataFormatsManager.register("cml","chemical/x-cml","cml",Kekule.IO.ChemDataType.TEXT,"Chemical Markup Language");var a=Kekule.IO.DataFormatsManager.findFormatId("chemical/x-cml");Kekule.IO.ChemDataReaderManager.register("cml",Kekule.IO.CmlReader,[a]);Kekule.IO.ChemDataWriterManager.register("cml",Kekule.IO.CmlWriter,[Kekule.Scalar,Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemSpace],[a])})();Kekule.IO.MdlVersion={V2000:2,V3000:3};Kekule.IO.MDL={VER2000:"V2000",VER3000:"V3000",SYMBOL_ANYATOM:"A",SYMBOL_STARATOM:"*",SYMBOL_HETEROATOM:"Q",SYMBOL_RGROUP:"R",SYMBOL_RGROUP2:"R#",SYMBOL_LONEPAIR:"LP",SYMBOL_ATOMLIST:"L",SYMBOL_DUMMYATOM:"Du",SD_DATA_HEAD_PREFIX:">",MOL_DELIMITER:"$$$$"};Kekule.IO.MdlUtils={isUnspecifiedAtomSymbol:function(a){return((a===Kekule.IO.MDL.SYMBOL_ANYATOM)||(a===Kekule.IO.MDL.SYMBOL_STARATOM))},isHeteroAtomSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_HETEROATOM)},isRGroupSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_RGROUP)||((a===Kekule.IO.MDL.SYMBOL_RGROUP2))},isLonePairSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_LONEPAIR)},isAtomListSymbol:function(a){return(a===Kekule.IO.MDL.SYMBOL_ATOMLIST)},analysisMdlDateTimeStr:function(h,b){var c=new Date();var f=0,a=2;var g=(parseInt(h.substr(f,a).trim(),10)||1)-1;f+=a;var l=parseInt(h.substr(f,a).trim(),10)||0;f+=a;a=b?4:2;var i=parseInt(h.substr(f,a),10)||0;if(!b){if(i>=70){i+=1900}else{i+=2000}}c.setFullYear(i,g,l);f+=a;a=2;var e=parseInt(h.substr(f,a),10)||0;f+=a;var d=parseInt(h.substr(f,a),10)||0;c.setHours(e,d);return c},generateMdlDateTimeStr:function(b,a){var c="";c+=b.getMonth().toString().lpad(2,"0");c+=b.getDate().toString().lpad(2,"0");if(a){c+=b.getFullYear().toString().lpad(4,"0")}else{c+=(b.getFullYear()%100).toString().lpad(2,"0")}c+=b.getHours().toString().lpad(2,"0");c+=b.getMinutes().toString().lpad(2,"0");return c},mdlRadicalToKekule:function(a){return a},kekuleRadicalToMdl:function(a){return a},bondTypeToKekuleOrder:function(a){switch(a){case 1:return Kekule.BondOrder.SINGLE;break;case 2:return Kekule.BondOrder.DOUBLE;break;case 3:return Kekule.BondOrder.TRIPLE;break;case 4:return Kekule.BondOrder.EXPLICIT_AROMATIC;break;default:return Kekule.BondOrder.UNSET}},kekuleBondOrderToMdlType:function(a){switch(a){case Kekule.BondOrder.SINGLE:return 1;break;case Kekule.BondOrder.DOUBLE:return 2;break;case Kekule.BondOrder.TRIPLE:return 3;break;case Kekule.BondOrder.EXPLICIT_AROMATIC:return 4;break;default:return 1}},getRxnMarkVersion:function(a){var b=a.substr(0,4);if(b!="$RXN"){return null}else{b=a.substr(4).trim();return(b==Kekule.IO.MDL.VER3000)?Kekule.IO.MdlVersion.V3000:Kekule.IO.MdlVersion.V2000}},assertIlegalForCtabOutput:function(a){if(!(a instanceof Kekule.StructureFragment)){Kekule.error(Kekule.ErrorMsg.CAN_NOT_WRITE_NON_MOLECULE_TO_MOL);return false}else{if(!a.hasCtab()){Kekule.error(Kekule.ErrorMsg.MOLECULE_HAS_NO_CTAB_TO_OUTPUT);return false}else{return true}}}};Kekule.IO.MdlStructureUtils={fillFragment:function(g,m,c){g.clear();if(m){var n;if(c&&(c!=Kekule.CoordMode.UNKNOWN)){n=c==Kekule.CoordMode.COORD3D}else{n=m.atomInfos.isCoord3D}for(var d=0,b=m.atomInfos.length;d<b;++d){var a=m.atomInfos[d];if(a){var f=Kekule.IO.MdlStructureUtils.createStructureNode(g,a,n);if(f){g.appendNode(f)}else{Kekule.raise(Kekule.ErrorMsg.MDL_CTAB_ATOM_CANNOT_CREATE)}}}for(var d=0,b=m.bondInfos.length;d<b;++d){var a=m.bondInfos[d];if(a){var o=Kekule.IO.MdlStructureUtils.createStructureConnector(g,a);if(o){g.appendConnector(o)}else{Kekule.raise(Kekule.ErrorMsg.MDL_CTAB_BOND_CANNOT_CREATE)}}}if(m.sgInfos&&m.sgInfos.length){for(var d=0,b=m.sgInfos.length;d<b;++d){var a=m.sgInfos[d];if(a&&(a.sgType=="SUP")){var e=[];for(j=0,k=a.atomIndexes.length;j<k;++j){e.push(g.getNodeAt(a.atomIndexes[j]))}if(e.length){var h=g.marshalSubFragment(e,new Kekule.SubGroup());h.setAbbr(a.label)}}}}}return g},createStructureNode:function(f,g,h){var i;if(g.atomListInfo||Kekule.IO.MdlUtils.isAtomListSymbol(g.symbol)){i=new Kekule.VariableAtom();var e=[];if(g.atomListInfo&&g.atomListInfo.symbols){e=e.concat(g.atomListInfo.symbols);if(g.atomListInfo.isAllowList){i.setAllowedIsotopeIds(e)}else{i.setDisallowedIsotopeIds(e)}}}else{if(Kekule.IO.MdlUtils.isRGroupSymbol(g.symbol)){i=new Kekule.RGroup()}else{if(Kekule.IO.MdlUtils.isHeteroAtomSymbol(g.symbol)){i=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.HETERO)}else{if(Kekule.IO.MdlUtils.isUnspecifiedAtomSymbol(g.symbol)){i=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}else{var d=Kekule.ChemicalElementsDataUtil.getElementInfo(g.symbol);if(d){var a=null;if(g.massNumber){a=g.massNumber}else{if(g.massDiff){if(d){var c=d.naturalMass;var a=Math.round(c+g.massDiff);var b=Kekule.IsotopesDataUtil.getIsotopeInfo(d.atomicNumber,a);if(!b){a=Math.floor(c+g.massDiff);b=Kekule.IsotopesDataUtil.getIsotopeInfo(d.atomicNumber,a)}if(!b){a=Math.ceil(c+g.massDiff);b=Kekule.IsotopesDataUtil.getIsotopeInfo(d.atomicNumber,a)}if(!b){a=null}}}}i=new Kekule.Atom(null,g.symbol,a)}else{i=new Kekule.Pseudoatom(null,Kekule.PseudoatomType.ANY)}}}}}if(g.charge){i.setCharge(g.charge)}if(g.radical){i.setRadical(g.radical)}if(typeof(g.hydrongenCount)!="undefined"){if(i.setExplicitHydrogenCount){i.setExplicitHydrogenCount(g.hydrongenCount)}}if(h){i.setCoord3D({x:g.x,y:g.y,z:g.z})}else{i.setCoord2D({x:g.x,y:g.y})}return i},createStructureConnector:function(h,a){var d=h.getNodeAt(a.atomIndex1);var c=h.getNodeAt(a.atomIndex2);if(d&&c){var f=[d,c];if(a.endAtomIndexes){for(var e=0,b=a.endAtomIndexes.length;e<b;++e){var g=h.getNodeAt(a.endAtomIndexes[e]);if(g){f.push(g)}}}var m=new Kekule.Bond(null,f,a.order);if(typeof(a.stereo)!="undefined"){m.setStereo(a.stereo)}return m}else{return null}},isNodeVariableAtom:function(a){return a instanceof Kekule.VariableAtom},getAtomTypeStr:function(d,h){if(d instanceof Kekule.Atom){return d.getSymbol()}else{if(d instanceof Kekule.Pseudoatom){switch(d.getAtomType()){case Kekule.PseudoatomType.ANY:return Kekule.IO.MDL.SYMBOL_ANYATOM;case Kekule.PseudoatomType.HETERO:return Kekule.IO.MDL.SYMBOL_HETEROATOM;default:return Kekule.IO.MDL.SYMBOL_DUMMYATOM}}else{if(d instanceof Kekule.RGroup){return Kekule.IO.MDL.SYMBOL_RGROUP}else{if(d instanceof Kekule.VariableAtom){if(h){return Kekule.IO.MDL.SYMBOL_ATOMLIST}else{var m="[";var a=d.getAllowedIsotopeIds();if(a&&a.length){}else{m="NOT[";a=d.getDisallowedIsotopeIds()}if(a&&a.length){var b=[];for(var f=0,e=a.length;f<e;++f){var g=Kekule.IsotopesDataUtil.getIsotopeIdDetail(a[f]);if(g&&g.symbol){b.push(g.symbol)}}var c=b.join(",");m=m+c+"]";return m}else{return Kekule.IO.MDL.SYMBOL_ATOMLIST}}}else{return"?"}}}}},getMoleculeCtabStructureInfo:function(f){var a={};a.atoms=f.getLeafNodes();a.bonds=f.getAllChildConnectors();a.subGroups=f.getSubFragments();var c=0,d=0;for(var e=0,b=a.atoms.length;e<b;++e){if(a.atoms[e].hasCoord3D()){++d}if(a.atoms[e].hasCoord2D()){++c}}a.coordMode=(c>d)?Kekule.CoordMode.COORD2D:Kekule.CoordMode.COORD3D;return a},splitConnectedNodes:function(c){var a={primaryNodes:[]};var e=0;var f=c.getConnectedObjs();for(var d=0,b=f.length;d<b;++d){if(f[d] instanceof Kekule.ChemStructureNode){if(e<2){a.primaryNodes.push(f[d]);++e}else{if(!a.remainNodes){a.remainNodes=[]}a.remainNodes.push(f[d])}}}return a},generateClassicStyleCountLine:function(d,a){if(a==Kekule.IO.MdlVersion.V3000){return"  0  0  0     0  0              0 V3000"}else{var c="";c+=d.atoms.length.toString().lpad(3);c+=d.bonds.length.toString().lpad(3);c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);for(var b=0;b<4;++b){c+="0".lpad(3)}c+="999";c+=Kekule.IO.MDL.VER2000.lpad(6);return c}}};Kekule.IO.MdlBlockHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.IO.MdlBlockHandler",initProperties:function(){this.defineProp("textBuffer",{dataType:"Kekule.TextLinesBuffer",serializable:false,getter:function(){var a=this.getPropStoreFieldValue("textBuffer");if(!a){a=this.createTextBuffer();this.setPropStoreFieldValue("textBuffer",a)}return a},setter:null})},createTextBuffer:function(){return new Kekule.TextLinesBuffer()}});Kekule.IO.MdlBlockReader=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockReader",readBlock:function(a,b){if(typeof(a)=="string"){this.getTextBuffer().setText(a)}else{this.getTextBuffer().setLines(a)}this.getTextBuffer().reset();return this.doReadBlock(this.getTextBuffer())},doReadBlock:function(b,a){}});Kekule.IO.MdlBlockWriter=Class.create(Kekule.IO.MdlBlockHandler,{CLASS_NAME:"Kekule.IO.MdlBlockWriter",writeBlock:function(a){this.getTextBuffer().clear();this.doWriteBlock(a,this.getTextBuffer());return this.getTextBuffer().getText()},doWriteBlock:function(a,b){}});Kekule.IO.Mdl2kUtils={atomLineChargeToKekule:function(a){switch(a){case 1:return 3;break;case 2:return 2;break;case 3:return 1;break;case 5:return -1;break;case 6:return -2;break;case 7:return -3;break;default:return 0}},chargeToMdlAtomLineValue:function(a){switch(a){case 1:return 3;break;case 2:return 2;break;case 3:return 1;break;case -1:return 5;break;case -2:return 6;break;case -3:return 7;break;default:return 0}},atomLineChargeToRadical:function(a){if(a==4){return Kekule.RadicalType.DOUBLET}else{return 0}},radicalToMdlAtomLineValue:function(a){return(a==Kekule.RadicalType.DOUBLET)?4:0},chargeOrRadicalToMdlAtomLineValue:function(b,a){if(b){return Kekule.IO.Mdl2kUtils.chargeToMdlAtomLineValue(b)}else{if(a){return Kekule.IO.Mdl2kUtils.radicalToMdlAtomLineValue(b)}else{return 0}}},bondStereoToKekule:function(b,a){if(a==Kekule.BondOrder.SINGLE){switch(b){case 1:return Kekule.BondStereo.UP;break;case 4:return Kekule.BondStereo.UP_OR_DOWN;break;case 6:return Kekule.BondStereo.DOWN;break;default:return Kekule.BondStereo.NONE}}else{if(a==Kekule.BondOrder.DOUBLE){switch(b){case 3:return Kekule.BondStereo.E_Z_BY_COORDINATES;break;default:return Kekule.BondStereo.NONE}}else{return Kekule.BondStereo.NONE}}},bondStereoToMdlBondLineValue:function(b,a){if(a==Kekule.BondOrder.SINGLE){switch(b){case Kekule.BondStereo.UP:return 1;case Kekule.BondStereo.UP_OR_DOWN:return 4;case Kekule.BondStereo.DOWN:return 6;default:return 0}}else{if(a==Kekule.BondOrder.DOUBLE){switch(b){case Kekule.BondStereo.E_Z_BY_COORDINATES:return 3;default:return 0}}else{return 0}}},coordToStr:function(a){return(a||0).toFixed(4)},getMassDiff:function(b){var a=Kekule.ChemicalElementsDataUtil.getElementInfo(b.getAtomicNumber());var c=a.naturalMass;return Math.round(b.getMassNumber()-c)},getAtomListPropLineValue:function(h){var g="";var f=h.getAllowedIsotopeIds();if(f&&f.length){g=" F "}else{g=" T ";f=h.getDisallowedIsotopeIds()}if(f&&f.length){var c=[];for(var d=0,b=f.length;d<b;++d){var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(f[d]);if(e&&e.symbol){c.push(e.symbol.rpad(4))}}var a=c.join("");g=c.length.toString().lpad(3)+g+a;return g}else{return null}},getCtabPropLineTag:function(b,a){return(a||"M")+"  "+b},getCtabPropLineCountTag:function(d,a,c){var b=(c||"M")+"  "+d;if(a){b+=(a).toString().lpad(3)}return b},generateCtabPropLine:function(b,e,c,d){var a=Kekule.IO.Mdl2kUtils.getCtabPropLineCountTag(e,c,d);return a+" "+b.join(" ")}};Kekule.IO.Mdl2kCTabReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl2kCTabReader",doReadBlock:function(b,a){return this.analysisCTab(b)},analysisCTab:function(d){var p={};var o=d.readLine();var l=this.analysisCountLine(o);var e=[];e.isCoord3D=false;for(var h=0;h<l.atomCount;++h){o=d.readLine();var m=this.analysisAtomLine(o);if(m.z){e.isCoord3D=true}e.push(m)}var g=[];for(var h=0;h<l.bondCount;++h){o=d.readLine();var b=this.analysisBondLine(o);g.push(b)}for(var h=0;h<l.atomListCount;++h){o=d.readLine();var f=this.analysisAtomListInfoLine(o);if(e[f.atomIndex]){e[f.atomIndex].atomListInfo=f}}for(var h=0;h<l.stextCount;++h){o=d.readLine();o=d.readLine()}var n=[];while(!d.eof()){o=d.readLine();var c=this.analysisPropertyLine(o,e,n);if(c.prop==="END"){break}if(c.prop==="SKP"){for(var h=0;h<c.count;++h){if(d.eof()){break}o=d.readLine()}}else{if(c.leading==="A"){if(d.eof()){break}var a=c.atomIndex;o=d.readLine();e[a].symbol=o.trim()}}}p.countInfo=l;p.atomInfos=e;p.bondInfos=g;p.sgInfos=n;return p},analysisCountLine:function(b){var a={};var c=b.substr(33,6).trim();if(c!=Kekule.IO.MDL.VER2000){Kekule.error(Kekule.ErrorMsg.NOT_MDL2000_FORMAT_DATA);return null}c=b.substr(0,3);a.atomCount=parseInt(c,10);c=b.substr(3,3);a.bondCount=parseInt(c,10);c=b.substr(12,3);a.isChiral=(parseInt(c,10)!=0);c=b.substr(15,3);a.stextCount=parseInt(c,10);return a},analysisAtomLine:function(c){var b={};var e=c.substr(0,10);b.x=parseFloat(e);e=c.substr(10,10);b.y=parseFloat(e);e=c.substr(20,10);b.z=parseFloat(e);e=c.substr(31,3);b.symbol=e.trim();e=c.substr(34,2);b.massDiff=parseInt(e,10);e=c.substr(36,3);var d=parseInt(e,10);var a=Kekule.IO.Mdl2kUtils.atomLineChargeToRadical(d);if(a){b.radical=a}else{b.charge=Kekule.IO.Mdl2kUtils.atomLineChargeToKekule(d)}e=c.substr(42,3);var d=parseInt(e,10);if(d>0){b.hydrongenCount=d-1}return b},analysisBondLine:function(b){var a={};var d=b.substr(0,3);a.atomIndex1=parseInt(d,10)-1;d=b.substr(3,3);a.atomIndex2=parseInt(d,10)-1;d=b.substr(6,3);a.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(d,10));d=b.substr(9,3);var c=Kekule.IO.Mdl2kUtils.bondStereoToKekule(parseInt(d,10),a.order);if(c){a.stereo=c}return a},analysisAtomListInfoLine:function(b){var a={};var f=b.substr(0,3);a.atomIndex=parseInt(f,10)-1;f=b.substr(4,1);a.isAllowList=(f.toLowerCase()=="f");f=b.substr(9,1);var e=Math.min(parseInt(f,10),5);a.atomicNumbers=[];var g=11;for(var d=0;d<e;++d){g+=4*d;f=b.substr(g,3);var c=parseInt(f,10);if(c){a.atomicNumbers.push(c)}}return a},analysisPropertyLine:function(q,r,l){var p={};var y=q.substr(0,1);p.leading=y;if(y=="M"){var z=q.substr(3,3).trim();p.prop=z;var B,h,w;if(z==="END"){return p}if(["CHG","RAD","ISO"].indexOf(z)>=0){var e=parseInt(q.substr(6,3).trim());p.entryCount=e;p.entries=[];propName=(z==="CHG")?"charge":(z==="RAD")?"radical":"massNumber";var o=10;for(var x=0;x<e;++x){var B=parseInt(q.substr(o,3).trim(),10)-1;var n=parseInt(q.substr(o+4,3).trim(),10);o+=8;p.entries.push({atomIndex:B,propName:n});r[B][propName]=n}}else{if(["STY","SLB"].indexOf(z)>=0){h=parseInt(q.substr(10,3),10)-1;w=l[h]}else{if(["SAL","SBL","SMT","SCL","SAP","SBV"].indexOf(z)>=0){h=parseInt(q.substr(7,3),10)-1;w=l[h]}}}var d=14;switch(z){case"ALS":var v={};var a=q.substr(7,3).trim();v.atomIndex=parseInt(a,10)-1;p.atomIndex=v.atomIndex;var m=parseInt(Math.min(q.substr(10,3),16));var u=q.substr(14,1);v.isAllowList=(u.toLowerCase()=="f");v.symbols=[];for(var x=0;x<m;++x){u=q.substr(16+x*4,4).trim();v.symbols.push(u)}p.atomListInfo=v;r[v.atomIndex].atomListInfo=v;break;case"STY":var c=q.substr(14,3);if(c=="SUP"){l[h]={sgType:"SUP"}}break;case"SLB":if(w){w.labelId=q.substr(14).trim()}break;case"SAL":if(w){var A=parseInt(Math.min(q.substr(10,3),15));w.atomIndexes=[];for(var x=0;x<A;++x){var u=q.substr(14+x*4,3);var B=parseInt(u)-1;w.atomIndexes.push(B)}}break;case"SBL":if(w&&(w.sgType=="SUP")){var g=parseInt(Math.min(q.substr(10,3),15));w.crossBondIndexes=[];for(var x=0;x<g;++x){var u=q.substr(14+x*4,3);var f=parseInt(u)-1;w.crossBondIndexes.push(f)}}break;case"SMT":if(w){if(w.sgType=="SUP"){w.label=q.substr(11).trim()}else{w.subscript=q.substr(11).trim()}}break;case"SCL":if(w){w.sgClass=q.substr(11).trim()}break;case"SBV":if(w){var b=parseInt(q.substr(11,3),10)-1;vectorX=parseFloat(q.substr(14,10));vectorY=parseFloat(q.substr(24,10));if(!w.bondVectors){w.bondVectors=[]}w.bondVectors[b]={bondIndex:b,x:vectorX,y:vectorY};var t=q.substr(34,10).trim();if(t){vectorZ=parseFloat(t)||0;w.bondVectors[b].z=vectorZ}}break}}else{if(y==="A"){var o=3;var B=parseInt(q.substr(o,3).trim(),10)-1;p.atomIndex=B}else{if(y==="V"){}else{if(y==="G"){}else{if(y==="S"){var z=q.substr(3,3).trim();p.prop=z;p.count=parseInt(q.substr(6,3),10)}}}}}return p}});Kekule.IO.Mdl2kCTabWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl2kCTabWriter",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(a,b){Kekule.IO.MdlUtils.assertIlegalForCtabOutput(a);return this.outputCtab(a,b)},outputCtab:function(d,f){var e=[];var c=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(d);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN){c.coordMode=this.getCoordMode()}f.writeLine(this.generateCountLine(c));this.outputAtomBlock(d,c,f,e);this.outputBondBlock(d,c,f);if(e.length){for(var b=0,a=e.length;b<a;++b){f.writeLine(e[b])}}this.outputSubgroupsPropLines(d,c,f);f.writeLine(Kekule.IO.Mdl2kUtils.getCtabPropLineTag("END"))},generateCountLine:function(a){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,Kekule.IO.MdlVersion.V2000)},outputAtomBlock:function(f,d,h,g){for(var c=0,b=d.atoms.length;c<b;++c){var e=d.atoms[c];var a=this.generateAtomLine(c,d.coordMode,e,g);h.writeLine(a)}},generateAtomLine:function(h,b,g,p){var a=Kekule.IO.Mdl2kUtils.coordToStr;var r="";var m=(h+1).toString().lpad(3);var f=(b==Kekule.CoordMode.COORD3D)?g.getAbsCoord3D():g.getAbsCoord2D();r+=a(f.x).lpad(10)+a(f.y).lpad(10)+a(f.z).lpad(10);r+=" "+Kekule.IO.MdlStructureUtils.getAtomTypeStr(g,true).rpad(3);if(Kekule.IO.MdlStructureUtils.isNodeVariableAtom(g)){var o=Kekule.IO.Mdl2kUtils.getAtomListPropLineValue(g);if(o){var c=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("ALS")+" "+m+o;p.push(c)}}if(g.getMassNumber&&g.getMassNumber()){var l=Kekule.IO.Mdl2kUtils.getMassDiff(g.getIsotope())||0;r+=l.toString().lpad(2);var c=Kekule.IO.Mdl2kUtils.generateCtabPropLine([m,g.getMassNumber().toString().lpad(3)],"ISO",1);p.push(c)}else{r+="0".lpad(2)}r+=Kekule.IO.Mdl2kUtils.chargeOrRadicalToMdlAtomLineValue(g.getCharge?g.getCharge():null,g.getRadical?g.getRadical():null).toString().lpad(3);if(g.getCharge&&g.getCharge()){var c=Kekule.IO.Mdl2kUtils.generateCtabPropLine([m,g.getCharge().toString().lpad(3)],"CHG",1);p.push(c)}if(g.getRadical&&g.getRadical()){var c=Kekule.IO.Mdl2kUtils.generateCtabPropLine([m,Kekule.IO.MdlUtils.kekuleRadicalToMdl(g.getRadical()).toString().lpad(3)],"RAD",1);p.push(c)}r+="0".lpad(3);var e=g.getExplicitHydrogenCount?g.getExplicitHydrogenCount():null;var n=Kekule.ObjUtils.isUnset(e)?"0":(e+1).toString();r+=n.lpad(3);for(var d=0,q="0".lpad(3);d<8;++d){r+=q}return r},outputBondBlock:function(e,d,g){for(var c=0,b=d.bonds.length;c<b;++c){var f=d.bonds[c];var a=this.generateBondLine(c,f,d.atoms);g.writeLine(a)}},generateBondLine:function(a,e,d){var c="";var b=Kekule.IO.MdlStructureUtils.splitConnectedNodes(e);c+=(d.indexOf(b.primaryNodes[0])+1).toString().lpad(3);c+=(d.indexOf(b.primaryNodes[1])+1).toString().lpad(3);if(e.getBondOrder){c+=Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(e.getBondOrder()).toString().lpad(3)}else{c+="0".lpad(3)}if(e.getStereo&&e.getBondOrder){c+=Kekule.IO.Mdl2kUtils.bondStereoToMdlBondLineValue(e.getStereo(),e.getBondOrder()).toString().lpad(3)}else{c+="0".lpad(3)}c+="0".lpad(3);c+="0".lpad(3);c+="0".lpad(3);return c},outputSubgroupsPropLines:function(g,f,h){for(var e=0,b=f.subGroups.length;e<b;++e){var a=this.generateSgroupLines(e,f.subGroups[e],f);for(var d=0,c=a.length;d<c;++d){h.writeLine(a[d])}}},generateSgroupLines:function(e,y,t){var g=[];var p=(e+1).toString().lpad(3);var n=Kekule.IO.Mdl2kUtils.generateCtabPropLine([p,"SUP"],"STY",1);g.push(n);n=Kekule.IO.Mdl2kUtils.generateCtabPropLine([p,p],"SLB",1);g.push(n);var h=y.getAbbr?y.getAbbr():(y.getName?y.getName():null);if(h){n=Kekule.IO.Mdl2kUtils.generateCtabPropLine([p,h],"SMT");g.push(n)}var x=[];var c=y.getLeafNodes();for(var r=0,q=c.length;r<q;++r){var e=t.atoms.indexOf(c[r]);if(e>=0){x.push((e+1).toString().lpad(3))}}x=x.sort();n=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SAL")+" "+p+x.length.toString().lpad(3)+" "+x.join(" ");g.push(n);var d=y.getCrossConnectors();var a=[];var o=[];var m=Kekule.IO.Mdl2kUtils.coordToStr;for(var r=0,q=d.length;r<q;++r){var e=t.bonds.indexOf(d[r]);if(e>=0){a.push((e+1).toString().lpad(3));var w=[e+1];var v=Kekule.IO.MdlStructureUtils.splitConnectedNodes(d[r]);var c=v.primaryNodes;var b={};if(c.length==2){if(t.coordMode==Kekule.CoordMode.COORD2D){b=Kekule.CoordUtils.substract(c[0].getAbsCoord2D(),c[1].getAbsCoord2D());w=w.concat([m(b.x).lpad(10),m(b.y).lpad(10)])}else{b=Kekule.CoordUtils.substract(c[0].getAbsCoord3D(),c[1].getAbsCoord3D());w=w.concat([m(b.x),m(b.y),m(b.z)])}}o.push(w)}}a=a.sort();n=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBL")+" "+p+a.length.toString().lpad(3)+" "+a.join(" ");g.push(n);for(var r=0,q=o.length;r<q;++r){var u=o[r].shift();var f=o[r].join("");n=Kekule.IO.Mdl2kUtils.getCtabPropLineTag("SBV")+" "+p+" "+u.toString().lpad(3)+f;g.push(n)}return g}});Kekule.IO.Mdl3kUtils={get3kBlockStartTag:function(a){return"BEGIN "+a.toUpperCase()},get3kBlockEndTag:function(a){return"END "+a.toUpperCase()},isAtomList:function(b){var a=/\[.+\]/;return b.search(a)>=0},analysisAtomList:function(g){var e=/\[(.+)\]/g;var f=e.exec(g);if(f&&(f.length>=2)){var d=f[1];f=d.split(",");var a={};a.isAllowList=!(g.trim().indexOf("NOT")==0);a.symbols=[];for(var c=0,b=f.length;c<b;++c){a.symbols.push(f[c].trim())}return a}else{return null}},bondCfgToKekule:function(a){switch(a){case 0:return Kekule.BondStereo.NONE;case 1:return Kekule.BondStereo.UP;case 2:return Kekule.BondStereo.UP_OR_DOWN;case 3:return Kekule.BondStereo.DOWN;default:return Kekule.BondStereo.NONE}},bondStereoToMdlCfg:function(a){switch(a){case Kekule.BondStereo.UP:return 1;case Kekule.BondStereo.UP_OR_DOWN:return 2;case Kekule.BondStereo.DOWN:return 3;default:return 0}},coordToStr:function(a){return(a||0).toFixed(6)}};Kekule.IO.Mdl3kValueUtils={SEPARATOR:" ",KEYVALUE_CONNECTOR:"=",STR_QUOTE:'"',ESC_QUOTE:'""',VALUELIST_PATTERN:/\(.+\)/g,split:function(m,g){var p=g||Kekule.IO.Mdl3kValueUtils.SEPARATOR;var d=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var q=[];var f=false;var a=false;var n=false;var o="";for(var e=0,b=m.length;e<b;++e){var h=m.charAt(e);if(h==d){if(((!f)&&(m.charAt(e+1)==d))||(f&&(m.charAt(e-1)==d))){}else{f=!f}}else{if(h=="["){a=true}else{if(h=="]"){a=false}else{if(h=="("){n=true}else{if(h==")"){n=false}}}}}if(h==p){if((!f)&&(!a)&&(!n)&&o){q.push(o);o=""}else{o+=h}}else{o+=h}}if(o){q.push(o)}return q},merge:function(b,c){var a=c||Kekule.IO.Mdl3kValueUtils.SEPARATOR;return b.join(a)},isKeyValuePair:function(a){return a.indexOf(Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR)>=0},splitKeyValue:function(d){var a={};var b=Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR;var c=d.indexOf(b);if(c<0){a.value=d}else{a.key=d.substr(0,c);a.value=d.substr(c+b.length)}return a},mergeKeyValue:function(b,a){if(!a){return b}else{return""+a+Kekule.IO.Mdl3kValueUtils.KEYVALUE_CONNECTOR+b}},isValueList:function(b){var a=b.search(Kekule.IO.Mdl3kValueUtils.VALUELIST_PATTERN);return(a>=0)},splitValueList:function(e){var c=/\((.+)\)/;var d=c.exec(e);if(d&&(d.length>1)){var b=d[1];var a=Kekule.IO.Mdl3kValueUtils.split(b);a.shift();return a}else{return[e]}},mergeValueList:function(b){var d="("+b.length;for(var c=0,a=b.length;c<a;++c){d+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+b[c]}d+=")";return d},unquoteValue:function(d){var b=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var a=d.trim();if(a.substr(0,b.length)==b){a=a.substr(b.length)}if(a.substr(a.length-b.length)==b){a=a.substr(0,a.length-b.length)}var c=new RegExp(b+b,"g");a=a.replace(c,b);if(Kekule.IO.Mdl3kValueUtils.isValueList(a)){a=Kekule.IO.Mdl3kValueUtils.splitValueList(a)}return a},quoteValue:function(d){var b=Kekule.IO.Mdl3kValueUtils.STR_QUOTE;var a=""+d;var c=new RegExp(b,"g");a=a.replace(c,b+b);if(a.indexOf(Kekule.IO.Mdl3kValueUtils.SEPARATOR)>=0){a=b+a+b}return a},splitValues:function(f){var a=[];var d=Kekule.IO.Mdl3kValueUtils.split(f);for(var c=0,b=d.length;c<b;++c){var e=Kekule.IO.Mdl3kValueUtils.splitKeyValue(d[c]);if(e.value){e.value=Kekule.IO.Mdl3kValueUtils.unquoteValue(e.value)}a.push(e)}return a},mergeValues:function(g){var a;for(var d=0,b=g.length;d<b;++d){var h=g[d];var c,f;if((typeof(h)!="object")||Kekule.ArrayUtils.isArray(h)){f=h}else{c=h.key;f=h.value}var e;if(Kekule.ArrayUtils.isArray(f)){e=Kekule.IO.Mdl3kValueUtils.mergeValueList(f)}else{e=Kekule.IO.Mdl3kValueUtils.quoteValue(f)}if(c){e=Kekule.IO.Mdl3kValueUtils.mergeKeyValue(e,c)}a=Kekule.IO.Mdl3kValueUtils.appendToken(a,e)}return a},appendToken:function(a,c,e){var b=e||Kekule.IO.Mdl3kValueUtils.SEPARATOR;var d=a||"";if((!d)||(d.substr(d.length-b.length,b.length)==b)){d=c}else{d+=Kekule.IO.Mdl3kValueUtils.SEPARATOR+c}return d}};Kekule.IO.Mdl3kTextBuffer=Class.create(Kekule.TextLinesBuffer,{CLASS_NAME:"Kekule.Mdl3kTextBuffer",LEADING_TAG:"M  V30 ",LINE_CONTI_MARK:"-",MAX_COL_WIDTH:80,initialize:function($super,a){$super(a)},isStartWithLeadingTag:function(a){return(a.substr(0,this.LEADING_TAG.length)==this.LEADING_TAG)},isEndWithContinueMark:function(a){var b=a.trim();return(b.substr(b.length-this.LINE_CONTI_MARK.length)==this.LINE_CONTI_MARK)},getLineWithout3kTag:function(b){var a=this.LEADING_TAG.length;if(b.substr(0,a)==this.LEADING_TAG){return b.substr(a)}else{return b}},getLineAtEx:function(c){var b=this.getLineAt(c);var e=1;if(b&&this.isEndWithContinueMark(b)&&this.isStartWithLeadingTag(this.getLines()[c])){var f=b.lastIndexOf(this.LINE_CONTI_MARK);b=b.substr(0,f);var d=this.getLineAtEx(c+1);b+=d.line;e+=d.lineCount}var a={line:b,lineCount:e};return a},getLineAt:function($super,b){var a=$super(b);return this.getLineWithout3kTag(a)},readLine:function(){var a=this.getLineAtEx(this.getCurrLineNo());this.incCurrLineNo(a.lineCount);return a.line},writeLine:function($super,h,e){if(!e){var f=h;if(!this.isStartWithLeadingTag(h)){f=this.LEADING_TAG+f}var c;if(f.length>this.MAX_COL_WIDTH){var d=this.LINE_CONTI_MARK;var g=Kekule.IO.Mdl3kValueUtils.SEPARATOR;var b=this.MAX_COL_WIDTH-d.length;c=f.substr(b);f=f.substr(0,b);f+=d}var a=$super(f);if(c){a=this.writeLine(c,e)}return a}else{return $super(h)}},writeLines:function($super,b,d){for(var c=0,a=b.length;c<a;++c){this.writeLine(b[c],d)}},getBlockBuffer:function(d,f){var i;var e=Kekule.IO.Mdl3kUtils.get3kBlockStartTag(d);var b=Kekule.IO.Mdl3kUtils.get3kBlockEndTag(d);var a=this.getCurrLineNo();this.reset();var h=this.readLine().trim();while((h!=e)&&(!this.eof())){h=this.readLine().trim()}if(this.eof()){i=null}else{var c=this.getCurrLineNo();endPos=this.getCurrLineNo();h=this.readLine().trim();while((h!=b)&&(!this.eof())){endPos=this.getCurrLineNo();h=this.readLine().trim()}if(h==b){var g=this.getLines().slice(c,endPos)}else{var g=this.getLines().slice(c)}i=new Kekule.IO.Mdl3kTextBuffer(g)}if(f){this.setCurrLineNo(a)}return i}});Kekule.IO.Mdl3kBlockReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kBlockReader",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},doReadBlock:function(h,g){var c;var d=!(h instanceof Kekule.IO.Mdl3kTextBuffer);if(d){c=new Kekule.IO.Mdl3kTextBuffer();c.setLines(h.getUnreadLines());c.reset()}else{c=h}var b=c.getCurrLineNo();var a=this.doRead3kBlock(c,g);var f=c.getCurrLineNo();if(d){var e=f-b;h.incCurrLineNo(e)}return a},doRead3kBlock:function(b,a){}});Kekule.IO.Mdl3kBlockWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kBlockWriter",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},writeStartTag:function(a,b){b.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockStartTag(a))},writeEndTag:function(a,b){b.writeLine(Kekule.IO.Mdl3kUtils.get3kBlockEndTag(a))},doWriteBlock:function(d,e){var b;var c=!(e instanceof Kekule.IO.Mdl3kTextBuffer);if(c){b=new Kekule.IO.Mdl3kTextBuffer();b.setLines(e.getUnreadLines());b.reset()}else{b=e}var a=this.doWrite3kBlock(d,b);if(c){e.appendLines(c.getLines())}return a},doWrite3kBlock:function(a,b){}});Kekule.IO.Mdl3kCTabReader=Class.create(Kekule.IO.Mdl3kBlockReader,{CLASS_NAME:"Kekule.IO.Mdl3kCTabReader",doRead3kBlock:function(c,b){var a=c.getBlockBuffer("CTAB");if(!a){a=c}return this.analysisCTab(a)},analysisCTab:function(d){var m={};var l=d.readLine();var g=this.analysisCountLine(l);if(!g){return null}var f=[];var h;var i=d.getBlockBuffer("ATOM");if(i){h=this.analysisAtomBlock(i,f)}else{Kekule.raise(Kekule.ErrorMsg.MDL3000_ATOMBLOCK_NOT_FOUND);return null}var b;var e=d.getBlockBuffer("BOND");if(e){b=this.analysisBondBlock(e,f)}var c;var a=d.getBlockBuffer("SGROUP");if(a){c=this.analysisSGroupBlock(a,f)}m.countInfo=g;m.atomInfos=h;m.atomIndexMap=f;if(b){m.bondInfos=b}if(c){m.sgInfos=c}return m},analysisCountLine:function(c){var b={};var d=Kekule.IO.Mdl3kValueUtils.splitValues(c);var a=d.shift().value;if(a!="COUNTS"){Kekule.raise(Kekule.ErrorMsg.MALFORMED_MDL3000_COUNTLINE);return}var e=d.shift().value;b.atomCount=parseInt(e,10);e=d.shift().value;b.bondCount=parseInt(e,10);e=d.shift().value;b.sgroupCount=parseInt(e,10);e=d.shift().value;b.isChiral=(parseInt(e,10)!=0);return b},analysisAtomBlock:function(f,b){var e=Kekule.CoordMode.COORD2D;var a=[];while(!f.eof()){line=f.readLine();var d=this.analysisAtomLine(line);var c=a.push(d)-1;b[d.index]=c;if(d.z){e=Kekule.CoordMode.COORD3D}}a.coordMode=e;a.isCoord3D=(e==Kekule.CoordMode.COORD3D);return a},analysisAtomLine:function(p,e){var q={};var n=Kekule.IO.Mdl3kValueUtils.splitValues(p);q.index=parseInt(n.shift().value,10);var o=n.shift().value.trim();if(Kekule.IO.Mdl3kUtils.isAtomList(o)){var b=Kekule.IO.Mdl3kUtils.analysisAtomList(o);if(b){q.atomListInfo=b;q.symbol="L"}}else{q.symbol=o}q.x=parseFloat(n.shift().value);q.y=parseFloat(n.shift().value);q.z=parseFloat(n.shift().value);n.shift();for(var f=0,a=n.length;f<a;++f){var d=n[f];var m=d.key;var h=d.value;switch(m){case"CHG":var g=parseInt(h,10);if(g){q.charge=g}break;case"RAD":var g=parseInt(h,10);if(g){q.radical=g}break;case"CFG":break;case"MASS":q.massNumber=parseFloat(h);break;case"VAL":break;case"HCOUNT":var g=parseInt(h,10);if(g){q.hydrongenCount=(g==-1)?0:g-1}break;case"RGROUPS":var g=parseInt(h,10);if(g){q.rgroupCount=g}break}}return q},analysisBondBlock:function(d,b){var c=[];while(!d.eof()){line=d.readLine();var a=this.analysisBondLine(line,b);c[a.index]=a}return c},analysisBondLine:function(p,e){var q={};var n=Kekule.IO.Mdl3kValueUtils.splitValues(p);q.index=parseInt(n.shift().value,10);var o=n.shift().value;q.order=Kekule.IO.MdlUtils.bondTypeToKekuleOrder(parseInt(o,10));q.atomIndex1=e[parseInt(n.shift().value,10)];q.atomIndex2=e[parseInt(n.shift().value,10)];for(var f=0,a=n.length;f<a;++f){var m=n[f].key;var h=n[f].value;switch(m){case"CFG":var g=parseInt(h,10);q.stereo=Kekule.IO.Mdl3kUtils.bondCfgToKekule(g);break;case"ENDPTS":if(Kekule.ArrayUtils.isArray(h)){q.endAtomIndexes=[];for(var d=0,b=h.length;d<b;++d){q.endAtomIndexes.push(e[parseInt(h[d],10)])}}else{q.endAtomIndexes=[e[parseInt(h,10)]]}case"TOPO":case"RXCTR":case"STBOX":break}}return q},analysisSGroupBlock:function(g,d){var a=[];var e=null;var f=g.getCurrLineNo();line=g.readLine();var b=Kekule.IO.Mdl3kValueUtils.splitValues(line);if(b.shift().value=="DEFAULT"){e=this.fetchSGroupOptionalValues(line,d)}else{g.setCurrLineNo(f)}while(!g.eof()){line=g.readLine();var c=this.analysisSGroupLine(line,d,e);a[c.index]=c}return a},analysisSGroupLine:function(c,e,f){var b={};var d=Kekule.IO.Mdl3kValueUtils.splitValues(c);b.index=parseInt(d.shift().value,10);b.sgType=d.shift().value.trim();b.extIndex=parseInt(d.shift().value,10);var a=this.fetchSGroupOptionalValues(d,e);if(f){a=Object.extend(f,a)}b=Object.extend(b,a);return b},fetchSGroupOptionalValues:function(a,f){var q={};for(var g=0,c=a.length;g<c;++g){var p=a[g].key;var o=a[g].value;switch(p){case"ATOMS":q.atomIndexes=[];for(var e=0,d=o.length;e<d;e++){q.atomIndexes.push(f[o[e]])}break;case"XBONDS":q.crossBondIndexes=[].concat(o);break;case"SUBTYPE":q.subType=o;break;case"LABEL":q.label=o;break;case"CSTATE":if(!q.bondVectors){q.bondVectors=[]}var b=parseInt(o.shift(),10);var n=parseFloat(o.shift())||0;var m=parseFloat(o.shift())||0;var h=parseFloat(o.shift())||0;q.bondVectors[b]={bondIndex:b,x:n,y:m,z:h};break;case"CLASS":q.sgClass=o;break}}return q}});Kekule.IO.Mdl3kCTabWriter=Class.create(Kekule.IO.Mdl3kBlockWriter,{CLASS_NAME:"Kekule.IO.Mdl3kCTabWriter",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,deaultValue:Kekule.CoordMode.UNKNOWN})},doWrite3kBlock:function(a,b){Kekule.IO.MdlUtils.assertIlegalForCtabOutput(a);return this.outputCtab(a,b)},outputCtab:function(b,c){var a=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(b);this.writeStartTag("CTAB",c);if(this.getCoordMode()!=Kekule.CoordMode.UNKNOWN){a.coordMode=this.getCoordMode()}c.writeLine(this.generateCountLine(a));this.outputAtomBlock(b,a,c);this.outputBondBlock(b,a,c);this.outputSgroupBlock(b,a,c);this.writeEndTag("CTAB",c)},generateCompatibilityCountLine:function(a){return Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,Kekule.IO.MdlVersion.V3000)},generateCountLine:function(b){var a=["COUNTS"];a.push(b.atoms.length);a.push(b.bonds.length);a.push(b.subGroups.length);a.push(0);a.push(0);return Kekule.IO.Mdl3kValueUtils.mergeValues(a)},outputAtomBlock:function(f,d,g){this.writeStartTag("ATOM",g);for(var c=0,b=d.atoms.length;c<b;++c){var e=d.atoms[c];var a=this.generateAtomLine(c,d.coordMode,e);g.writeLine(a)}this.writeEndTag("ATOM",g)},generateAtomLine:function(b,d,c){var e=Kekule.IO.Mdl3kUtils.coordToStr;var a=[b+1,Kekule.IO.MdlStructureUtils.getAtomTypeStr(c)];if(d==Kekule.CoordMode.COORD2D){var f=c.getAbsCoord2D();a=a.concat([e(f.x),e(f.y),e(0)])}else{var f=c.getAbsCoord3D();a=a.concat([e(f.x),e(f.y),e(f.z)])}a.push(0);if(c.getCharge&&c.getCharge()){a.push({key:"CHG",value:c.getCharge()})}if(c.getRadical&&c.getRadical()){a.push({key:"RAD",value:c.getRadical()})}if(c.getMassNumber&&c.getMassNumber()){a.push({key:"MASS",value:c.getMassNumber()})}if(c.getExplicitHydrogenCount&&(!Kekule.ObjUtils.isUnset(c.getExplicitHydrogenCount()))){a.push({key:"HCOUNT",value:c.getExplicitHydrogenCount()})}return Kekule.IO.Mdl3kValueUtils.mergeValues(a)},outputBondBlock:function(e,d,g){if(d.bonds.length<=0){return}this.writeStartTag("BOND",g);for(var c=0,b=d.bonds.length;c<b;++c){var f=d.bonds[c];var a=this.generateBondLine(c,f,d.atoms);g.writeLine(a)}this.writeEndTag("BOND",g)},generateBondLine:function(g,n,a){var m=[g+1,Kekule.IO.MdlUtils.kekuleBondOrderToMdlType(n.getBondOrder?n.getBondOrder():Kekule.BondOrder.UNSET)];var f=0;var e=[];var b=[];var h=Kekule.IO.MdlStructureUtils.splitConnectedNodes(n);e=[a.indexOf(h.primaryNodes[0])+1,a.indexOf(h.primaryNodes[1])+1];if(h.remainNodes&&h.remainNodes.length){for(var d=0,c=h.remainNodes.length;d<c;++d){b.push(a.indexOf(h.remainNodes[d])+1)}}m=m.concat(e);if(n.getStereo&&n.getStereo()){m.push({key:"CFG",value:Kekule.IO.Mdl3kUtils.bondStereoToMdlCfg(n.getStereo())})}if(b.length>0){m.push({key:"ENDPTS",value:b});m.push({key:"ATTACH",value:"ALL"})}return Kekule.IO.Mdl3kValueUtils.mergeValues(m)},outputSgroupBlock:function(e,d,f){if(d.subGroups.length<=0){return}this.writeStartTag("SGROUP",f);for(var c=0,b=d.subGroups.length;c<b;++c){var a=this.generateSgroupLine(c,d.subGroups[c],d);f.writeLine(a)}this.writeEndTag("SGROUP",f)},generateSgroupLine:function(q,s,h){var d=h.atoms;var o=h.bonds;var u=[q+1,"SUP",q+1];var t=[];var p=s.getLeafNodes();for(var n=0,g=p.length;n<g;++n){var q=d.indexOf(p[n]);if(q>=0){t.push(q+1)}}t=t.sort();u.push({key:"ATOMS",value:t});if(s.getAbbr()||s.getName()){u.push({key:"LABEL",value:s.getAbbr()||s.getName()})}var m=s.getCrossConnectors();var c=[];var a=[];var b=Kekule.IO.Mdl3kUtils.coordToStr;for(var n=0,g=m.length;n<g;++n){var q=o.indexOf(m[n]);if(q>=0){c.push(q+1);var f=[q+1];var r=Kekule.IO.MdlStructureUtils.splitConnectedNodes(m[n]);var p=r.primaryNodes;var e={};if(p.length==2){if(h.coordMode==Kekule.CoordMode.COORD2D){e=Kekule.CoordUtils.substract(p[0].getAbsCoord2D(),p[1].getAbsCoord2D());f=f.concat([b(e.x),b(e.y),0])}else{e=Kekule.CoordUtils.substract(p[0].getAbsCoord3D(),p[1].getAbsCoord3D());f=f.concat([b(e.x),b(e.y),b(e.z)])}}a.push(f)}}c=c.sort();u.push({key:"XBONDS",value:c});for(var n=0,g=a.length;n<g;++n){u.push({key:"CSTATE",value:a[n]})}return Kekule.IO.Mdl3kValueUtils.mergeValues(u)}});Kekule.IO.MdlStructureFragmentReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentReader",initialize:function($super,a){$super();this.setCoordMode(a||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createFragment:function(a){},createCtabReader:function(a){if(a==Kekule.IO.MdlVersion.V3000){return new Kekule.IO.Mdl3kCTabReader()}else{return new Kekule.IO.Mdl2kCTabReader()}},getCtabVersion:function(d){var c=d.getCurrLineNo();var a=d.readLine();d.setCurrLineNo(c);var b=a.substr(33,6).trim();if(b=="V3000"){return Kekule.IO.MdlVersion.V3000}else{if(b=="V2000"){return Kekule.IO.MdlVersion.V2000}else{return Kekule.IO.MdlVersion.V2000}}},createStructureFromJson:function(c,b){var a=this.createFragment();if(a){Kekule.IO.MdlStructureUtils.fillFragment(a,c,this.getCoordMode())}return a},doReadBlock:function($super,f,d){var b=this.getCtabVersion(f);if(!b){return null}var e=this.createCtabReader(b);var c=e.doReadBlock(f,d);if(c.atomInfos.coordMode){this._forceCoordMode=c.atomInfos.coordMode}var a=this.createStructureFromJson(c,d);return a}});Kekule.IO.MdlStructureFragmentWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructureFragmentWriter",initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},createCtabWriter:function(a){if(a==Kekule.IO.MdlVersion.V3000){return new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode())}else{return new Kekule.IO.Mdl2kCTabWriter(this.getCoordMode())}},doWriteBlock:function($super,b,d){var a=this.createCtabWriter(this.getMdlVersion());var c=a.writeBlock(b);d.writeText(c)}});Kekule.IO.Mdl3kMoleculeCTabReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabReader",createFragment:function(a){return new Kekule.Molecule()},doReadBlock:function($super,d,b){var c=this.createCtabReader(Kekule.IO.MdlVersion.V3000);var a=c.doReadBlock(d,b);return this.createStructureFromJson(a,b)}});Kekule.IO.Mdl3kMoleculeCTabWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.Mdl3kMoleculeCTabWriter",initialize:function($super,a){$super(Kekule.IO.MdlVersion.V3000,a)},doWriteBlock:function($super,b,d){var a=new Kekule.IO.Mdl3kCTabWriter(this.getCoordMode());var c=a.writeBlock(b);d.writeText(c)}});Kekule.IO.MdlMoleculeReader=Class.create(Kekule.IO.MdlStructureFragmentReader,{CLASS_NAME:"Kekule.IO.MdlMoleculeReader",createFragment:function(b){var a=new Kekule.Molecule();return a},readHeaderInfo:function(g,d){var b={};var c=g.readLine();if(c){b.name=c}var a=g.readLine();var e=this.readInfoLine(a);if(e){b=Object.extend(b,e)}var f=g.readLine();if(f){b.comment=f}return b},readInfoLine:function(b){var a={};if(b.trim()){var c=b.substr(0,2).trim();if(c){a.userAbbr=c}c=b.substr(2,8).trim();if(c){a.programName=c}c=b.substr(10,10);if(c.trim()){a.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(c,false)}c=b.substr(20,2);a.coordMode=(c=="3D")?Kekule.CoordMode.COORD3D:((c=="2D")?Kekule.CoordMode.COORD2D:Kekule.CoordMode.UNKNOWN)}return a},doReadBlock:function($super,e,d){var b=this.readHeaderInfo(e,d);if(b&&(typeof(b.coordMode)!="undefined")){this.setCoordMode(b.coordMode)}var c=$super(e,d);if(c&&b){b.name?c.setName(b.name):null;b.userAbbr?c.setInfoValue("author",b.userAbbr):null;b.programName?c.setInfoValue("generator",b.programName):null;b.date?c.setInfoValue("date",b.date):null;b.comment?c.setInfoValue("comment",b.comment):null}if(!e.eof()){var a=e.getCurrLine();if(a.trim().toUpperCase()==="M  END"){e.readLine()}}return c}});Kekule.IO.MdlMoleculeWriter=Class.create(Kekule.IO.MdlStructureFragmentWriter,{CLASS_NAME:"Kekule.IO.MdlMoleculeWriter",writeHeaderInfo:function(b,d){d.writeLine(b.getName()||"");var a=this.generateInfoLine(b);d.writeLine(a);var c=b.getInfoValue("comment");d.writeLine(c||"")},generateInfoLine:function(d){var c="";var b=d.getInfoValue("author");c+=b?b.toString().substr(0,2).rpad(2):"  ";var e=d.getInfoValue("generator");c+=e?e.toString().substr(0,8).rpad(8):Kekule.LIBNAME_CORE.rpad(8);var a=d.getInfoValue("date")||new Date();c+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(a,false);c+=(this.getCoordMode()==Kekule.CoordMode.COORD3D)?"3D":"2D";return c},getMolecule:function(a){return Kekule.ChemStructureUtils.getTotalStructFragment(a)},doWriteBlock:function($super,c,d){var b=this.getMolecule(c);if(b){var a=Kekule.IO.MdlStructureUtils.getMoleculeCtabStructureInfo(b);this.writeHeaderInfo(b,d);if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){d.writeLine(Kekule.IO.MdlStructureUtils.generateClassicStyleCountLine(a,this.getMdlVersion()))}$super(b,d);if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){d.writeLine("M  END")}}else{}}});Kekule.IO.MdlStructDataReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlStructDataReader",DATA_HEAD_PREFIX:Kekule.IO.MDL.SD_DATA_HEAD_PREFIX,DATA_DBFIELD_PATTERN:/\bDT(\d+)\b/,DATA_KEY_NAME_PATTERN:/\<(.+)\>/,MOL_DELIMITER:Kekule.IO.MDL.MOL_DELIMITER,doReadBlock:function(c,g){var p=new Kekule.IO.MdlMoleculeReader();try{var q,f;var h;var b=[];while(!c.eof()){try{h=p.doReadBlock(c,null)}catch(o){h=null}if(h){b.push(h);q=null;f=null;while(!c.eof()){var a=this.analysisDataLine(c.readLine());if(a){var n=a.lineType;if(n==="dataheader"){q=a.key}else{if(n==="datavalue"){if(q){f=a.value;h.setInfoValue(q,f)}}else{if(n==="moldelimiter"){break}}}}}}else{break}}if(b.length>1){var r=new Kekule.ChemObjList();for(var m=0,d=b.length;m<d;++m){r.append(b[m])}return r}else{return b[0]}}finally{p.finalize()}},analysisDataLine:function(a){var e,b,d;var c=a.trim();if(c.startsWith(this.DATA_HEAD_PREFIX)){e="dataheader";b=this.getDataHeaderKey(a);if(b){return{lineType:e,key:b}}else{return null}}else{if(c.startsWith(this.MOL_DELIMITER)){return{lineType:"moldelimiter"}}else{if(!c){return null}else{return{lineType:"datavalue",value:a}}}}},getDataHeaderKey:function(b){var c=null;var a=this.DATA_KEY_NAME_PATTERN.exec(b);if(a&&(a.length>1)){c=a[1]}else{a=this.DATA_DBFIELD_PATTERN.exec(b);if(a&&(a.length>1)){c=a[1]}else{c=b}}return c},doReadDataBlock:function(c,b){var a=c.readLine()}});Kekule.IO.MdlStructDataWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlStructDataWriter",IGNORED_INFO_FIELDS:["generator","author","date","comment"],initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteBlock:function(h,b){var a=this.getChildMols(h);var d=new Kekule.IO.MdlMoleculeWriter();d.setMdlVersion(this.getMdlVersion());d.setCoordMode(this.getCoordMode());for(var g=0,c=a.length;g<c;++g){var e=a[g];var m=d.writeBlock(e);b.writeText(m);var f=this.getMolData(e);this.doWriteDataBlock(f,b);b.writeLine(Kekule.IO.MDL.MOL_DELIMITER)}},doWriteDataBlock:function(f,h){var d=Kekule.ObjUtils.getOwnedFieldNames(f);for(var c=0,a=d.length;c<a;++c){var b=d[c];if(this.IGNORED_INFO_FIELDS.indexOf(b)<0){var g=Kekule.IO.MDL.SD_DATA_HEAD_PREFIX+" <"+b+">";var e=f[b];if(g&&e){h.writeLine(g);h.writeLine(e);h.writeLine("")}}}},getChildMols:function(f){var d=Kekule.ChemStructureUtils.getChildStructureObjs(f,true);var a=[];for(var c=0,b=d.length;c<b;++c){var e=d[c];if(e instanceof Kekule.StructureFragment){a.push(e)}}return a},getMolData:function(a){var b=a.getInfo?a.getInfo()||{}:null;return b}});Kekule.IO.MdlBaseReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlBaseReactionReader",readHeaderBlock:function(e,d){var a={};var c;var b=e.readLine().trim();c=b.substr(0,4);if(c!="$RXN"){Kekule.error(Kekule.ErrorMsg.NOT_MDL_RXN_DATA);return null}else{c=b.substr(4).trim();if(c=="V3000"){a.version=Kekule.IO.MdlVersion.V3000}else{a.version=Kekule.IO.MdlVersion.V2000}}b=e.readLine().trim();if(b){a.name=b}b=e.readLine();c=b.substr(0,6).trim();if(c){a.userAbbr=c}c=b.substr(6,9).trim();if(c){a.programName=c}c=b.substr(15,10);if(c.trim()){a.date=Kekule.IO.MdlUtils.analysisMdlDateTimeStr(c,true)}b=e.readLine().trim();if(b){a.comment=b}return a},readSubstanceCountLine:function(a){},readMolBlock:function(a){},doReadBlock:function($super,a,c){var f=this.readHeaderBlock(a,null);var e=this.readSubstanceCountLine(a.readLine());var h=new Kekule.Reaction();var g="";for(var d=0;d<e.reactantCount;++d){var b=this.readMolBlock(a);if(b){h.appendReactant(b)}}for(var d=0;d<e.productCount;++d){var b=this.readMolBlock(a);if(b){h.appendProduct(b)}}if(h&&f){f.name?h.setName(f.name):null;f.userAbbr?h.setInfoValue("author",f.userAbbr):null;f.programName?h.setInfoValue("generator",f.programName):null;f.date?h.setInfoValue("date",f.date):null;f.comment?h.setInfoValue("comment",f.comment):null}return h}});Kekule.IO.Mdl2kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl2kReactionReader",readHeaderBlock:function($super,c,b){var a=$super(c,b);if(a.version!=Kekule.IO.MdlVersion.V2000){Kekule.error(Kekule.ErrorMsg.NOT_MDL2000_RXN_DATA);return null}else{return a}},readSubstanceCountLine:function(b){var a={};a.reactantCount=parseInt(b.substr(0,3),10)||0;a.productCount=parseInt(b.substr(3,3),10)||0;return a},readMolBlock:function(c){var b=c.readLine();while((b!=="$MOL")&&(!c.eof())){b=c.readLine()}if(c.eof()){return null}var a=[];var b=c.getCurrLine();while((b!=="$MOL")&&(!c.eof())){a.push(b);c.incCurrLineNo();b=c.getCurrLine()}return(new Kekule.IO.MdlMoleculeReader()).readBlock(a,null)}});Kekule.IO.Mdl3kReactionReader=Class.create(Kekule.IO.MdlBaseReactionReader,{CLASS_NAME:"Kekule.IO.Mdl3kReactionReader",createTextBuffer:function(){return(new Kekule.IO.Mdl3kTextBuffer())},readHeaderBlock:function($super,c,b){var a=$super(c,b);if(a.version!=Kekule.IO.MdlVersion.V3000){Kekule.error(Kekule.ErrorMsg.NOT_MDL3000_RXN_DATA);return null}else{return a}},readSubstanceCountLine:function(b){var a={};var c=Kekule.IO.Mdl3kValueUtils.splitValues(b);if(c.shift().value.trim()!="COUNTS"){Kekule.error(Kekule.ErrorMsg.NOT_MDL3000_RXN_COUNTLINE);return null}a.reactantCount=parseInt(c.shift().value,10)||0;a.productCount=parseInt(c.shift().value,10)||0;return a},readMolBlock:function(b){if(b.getBlockBuffer){var a=b.getBlockBuffer("CTAB");return(new Kekule.IO.Mdl3kMoleculeCTabReader()).doReadBlock(a)}else{return null}}});Kekule.IO.MdlReactionReader=Class.create(Kekule.IO.MdlBlockReader,{CLASS_NAME:"Kekule.IO.MdlReactionReader",doReadBlock:function(d,c){var a;var b=Kekule.IO.MdlUtils.getRxnMarkVersion(d.getCurrLine());if(b==Kekule.IO.MdlVersion.V3000){a=new Kekule.IO.Mdl3kReactionReader()}else{a=new Kekule.IO.Mdl2kReactionReader()}return a.readBlock(d.getUnreadLines(),c)}});Kekule.IO.MdlReactionWriter=Class.create(Kekule.IO.MdlBlockWriter,{CLASS_NAME:"Kekule.IO.MdlReactionWriter",initialize:function($super,a,b){$super();this.setMdlVersion(a||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},writeHeaderBlock:function(d,g){var c;c="$RXN"+((this.getMdlVersion()==Kekule.IO.MdlVersion.V3000)?" "+Kekule.IO.MDL.VER3000:"");g.writeLine(c);g.writeLine(d.getName()||"");var b=d.getInfoValue("author")||"";c=b.substr(0,6).rpad(6);var e=d.getInfoValue("generator")||"";c+=e.substr(0,9).rpad(9);var a=d.getInfoValue("date")||new Date();c+=Kekule.IO.MdlUtils.generateMdlDateTimeStr(a,true);g.writeLine(c);var f=d.getInfoValue("comment")||"";g.writeLine(f)},generateSubstanceCountLine:function(a){if(this.getMdlVersion()==Kekule.IO.MdlVersion.V3000){return"M  V30 COUNTS "+Kekule.IO.Mdl3kValueUtils.mergeValues([a.getReactantCount(),a.getProductCount()])}return a.getReactantCount().toString().lpad(3)+a.getProductCount().toString().lpad(3)},writeMolDelimiterLine:function(a){if(this.getMdlVersion()==Kekule.IO.MdlVersion.V2000){a.writeLine("$MOL")}},writeMolBlock:function(b,d){var a=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000?new Kekule.IO.Mdl3kMoleculeCTabWriter(this.getCoordMode()):new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode());var c=a.writeBlock(b);d.writeText(c)},doWriteBlock:function($super,c,e){var a=this.getMdlVersion()==Kekule.IO.MdlVersion.V3000;this.writeHeaderBlock(c,e);var d=this.generateSubstanceCountLine(c);e.writeLine(d);if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("REACTANT"))}for(var b=0;b<c.getReactantCount();++b){this.writeMolDelimiterLine(e);this.writeMolBlock(c.getReactantAt(b),e)}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("REACTANT"))}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockStartTag("PRODUCT"))}for(var b=0;b<c.getProductCount();++b){this.writeMolDelimiterLine(e);this.writeMolBlock(c.getProductAt(b),e)}if(a){e.writeLine("M  V30 "+Kekule.IO.Mdl3kUtils.get3kBlockEndTag("PRODUCT"));e.writeLine("M  END")}}});Kekule.IO.BaseMdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.BaseMdlReader",doReadData:function(b,a,c){if(a!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT);return null}else{return this.doReadMdlData(b)}},doReadMdlData:function(a){return null}});Kekule.IO.BaseMdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.BaseMdlWriter",initialize:function($super,a){$super(a);if(!a){a={}}this.setMdlVersion(a.mdlVersion||Kekule.IO.MdlVersion.V2000);this.setCoordMode(a.coordMode||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function($super,d,b,c){var a=b||Kekule.IO.ChemDataType.TEXT;if(a!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.ErrorMsg.MDL_OUTPUT_DATATYPE_NOT_TEXT);return null}else{return $super(d,a,c)}}});Kekule.IO.MdlMolReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlMolReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlMoleculeReader();return a.readBlock(b,null)}});Kekule.IO.MdlMolWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlMolWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlMoleculeWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlSdReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlSdReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlStructDataReader();return a.readBlock(b,null)}});Kekule.IO.MdlSdWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlSdWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlStructDataWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlRxnReader=Class.create(Kekule.IO.BaseMdlReader,{CLASS_NAME:"Kekule.IO.MdlRxnReader",doReadMdlData:function(b){var a=new Kekule.IO.MdlReactionReader();return a.readBlock(b,null)}});Kekule.IO.MdlRxnWriter=Class.create(Kekule.IO.BaseMdlWriter,{CLASS_NAME:"Kekule.IO.MdlRxnWriter",doWriteData:function(d,a,c){var b=new Kekule.IO.MdlReactionWriter(this.getMdlVersion(),this.getCoordMode());return b.writeBlock(d)}});Kekule.IO.MdlReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.MdlReader",doReadData:function(d,c,e){if(c!=Kekule.IO.ChemDataType.TEXT){Kekule.error(Kekule.ErrorMsg.MDL_INPUT_DATATYPE_NOT_TEXT);return null}else{var b;var a=d.substr(0,4);if(a=="$RXN"){b=new Kekule.IO.MdlReactionReader()}else{b=new Kekule.IO.MdlMoleculeReader()}return b.readBlock(d,null)}}});Kekule.IO.MdlWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.MdlWriter",initialize:function($super,a){$super(a);var b=a||{};this.setMdlVersion(b.mdlVersion||Kekule.IO.MdlVersion.V2000);this.setCoordMode(b.coordMode||Kekule.CoordMode.UNKNOWN)},initProperties:function(){this.defineProp("mdlVersion",{dataType:DataType.INT,defaultValue:Kekule.IO.MdlVersion.V2000});this.defineProp("coordMode",{dataType:DataType.INT,defaultValue:Kekule.CoordMode.UNKNOWN})},doWriteData:function(e,a,d){var c;if(e instanceof Kekule.Reaction){c=new Kekule.IO.MdlRxnWriter(this.getMdlVersion(),this.getCoordMode())}else{if(e instanceof Kekule.StructureFragment){c=new Kekule.IO.MdlMolWriter(this.getMdlVersion(),this.getCoordMode())}else{var b=(e&&e.getClassName)?e.getClassName():typeof(e);Kekule.error(Kekule.ErrorMsg.UNABLE_TO_OUTPUT_AS_MDL.format(b));return null}}if(c){return c.writeData(e)}}});(function(){var d="mol";var c="rxn";var f="sd";var b="mol3k";var a="rxn3k";Kekule.IO.DataFormatsManager.register(d,"chemical/x-mdl-molfile","mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 2000 format");Kekule.IO.DataFormatsManager.register(c,"chemical/x-mdl-rxnfile","rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 2000 format");Kekule.IO.DataFormatsManager.register(f,"chemical/x-mdl-sdfile",["sd","sdf"],Kekule.IO.ChemDataType.TEXT,"MDL Structure-Data format");Kekule.IO.DataFormatsManager.register(b,"chemical/x-mdl-molfile","mol",Kekule.IO.ChemDataType.TEXT,"MDL Mol 3000 format");Kekule.IO.DataFormatsManager.register(a,"chemical/x-mdl-rxnfile","rxn",Kekule.IO.ChemDataType.TEXT,"MDL Reaction 3000 format");Kekule.IO.ChemDataReaderManager.register("MDL-mol",Kekule.IO.MdlMolReader,[d,b]);Kekule.IO.ChemDataReaderManager.register("MDL-rxn",Kekule.IO.MdlRxnReader,[c,a]);Kekule.IO.ChemDataReaderManager.register("MDL-general",Kekule.IO.MdlReader,[d,b,c,a]);Kekule.IO.ChemDataReaderManager.register("MDL-sd",Kekule.IO.MdlSdReader,f);var e=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("MDL-mol",Kekule.IO.MdlMolWriter,e,d);Kekule.IO.ChemDataWriterManager.register("MDL-mol3k",Kekule.IO.MdlMolWriter,e,b,{createOptions:{mdlVersion:Kekule.IO.MdlVersion.V3000}});Kekule.IO.ChemDataWriterManager.register("MDL-rxn",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],c);Kekule.IO.ChemDataWriterManager.register("MDL-rxn3k",Kekule.IO.MdlRxnWriter,[Kekule.Reaction],a);Kekule.IO.ChemDataWriterManager.register("MDL-sd",Kekule.IO.MdlSdWriter,e,f)})();(function(){var a=Kekule.ArrayUtils;Kekule.IO.SMILES={ATOM_BRACKET_LEFT:"[",ATOM_BRACKET_RIGHT:"]",ATOM_WILDCARD:"*",ATOM_H:"H",ORGAN_SUBSET_ATOMS:["B","C","N","O","S","P","F","Cl","Br","I"],AROMATIC_SUBSET_ATOMS:["B","C","N","O","S","P"],BOND_SINGLE:"-",BOND_DOUBLE:"=",BOND_TRIPLE:"#",BOND_QUAD:"$",BOND_AROMATIC:":",BOND_FAKE:".",RING_BOND_TWO_DIGIT_NO_PREFIX:"%",BRANCH_BRACKET_LEFT:"(",BRANCH_BRACKET_RIGHT:")"};var b=Kekule.IO.SMILES;Kekule.IO.SmilesUtils={createGraphDepthSpanningTreesEx:function(o,e){var n="__$visitedEx__";var r=function(u){var D={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}};var z=u;if(!z.getData(n)){D.vertexes.push(z);z.setData(n,true)}var w=z.getEdges();var A=[];var B;for(var x=0,v=w.length;x<v;++x){var t=w[x];var C=z.getNeighborOnEdge(t);if(!C.getData(n)){D.vertexes.push(C);D.edges.push(t);C.setData(n,true);var y=r(C);D.vertexes=D.vertexes.concat(y.vertexes);D.edges=D.edges.concat(y.edges);if(y.longestPath.length>D.longestPath.length||!D.longestPath.length){D.longestPath.vertexes=y.longestPath.vertexes;D.longestPath.edges=y.longestPath.edges;D.longestPath.length=y.longestPath.length;B=t}}}if(B){D.longestPath.edges.unshift(B);D.longestPath.length=(D.longestPath.length||0)+1}D.longestPath.vertexes.unshift(z);return D};var m=a.clone(o.getVertexes());for(var h=0,f=m.length;h<f;++h){m[h].setData(n,false)}var s=[];while(m.length){var g;if(e&&(m.indexOf(e)>=0)){g=e}else{g=m[0]}var p={vertexes:[],edges:[],longestPath:{vertexes:[],edges:[],length:0}};var q=r(g);p.vertexes=p.vertexes.concat(q.vertexes);p.edges=p.edges.concat(q.edges);p.longestPath.length=(p.longestPath.length||0)+q.longestPath.length;p.longestPath.vertexes=p.longestPath.vertexes.concat(q.longestPath.vertexes);p.longestPath.edges=p.longestPath.edges.concat(q.longestPath.edges);m=a.exclude(m,q.vertexes);s.push(p)}return s}};Kekule.IO.SmilesMolWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.SmilesMolWriter",doWriteData:function(h,e,g){var f=this.getMolecule(h);return this.writeStructFragment(f)},getMolecule:function(e){return Kekule.ChemStructureUtils.getTotalStructFragment(e)},writeStructFragment:function(x){if(x.hasCtab()){var e=x.clone();e.canonicalize();var A=[];var t=[];var u=e.perceiveAromaticRings();for(var v=0,r=u.length;v<r;++v){var g=u[v];a.pushUnique(A,g.nodes);a.pushUnique(t,g.connectors)}var m=Kekule.GraphAdaptUtils.ctabToGraph(e.getCtab());var f=m.getVertexes();var w=m.getEdges();var z=f[f.length-1];var h=Kekule.IO.SmilesUtils.createGraphDepthSpanningTreesEx(m,z);var p=[];var n;for(var v=0,r=h.length;v<r;++v){var q=h[v];var s=q.longestPath;var y="";var o=s.vertexes[0];y=this._writeMolVertex(o,null,s.edges,q.edges,p,A,t);if(v===0){n=y}else{n+=b.BOND_FAKE+y}}return n}else{return""}},_writeMolVertex:function(B,n,e,t,v,C,x){var y=B.getData("object");var s=this._outputNodeStr(y,C.indexOf(y)>=0);if(n){var f=n.getData("object");s=this._outputConnectorStr(f,n.getVertexes()[0].getData("object"),n.getVertexes()[1].getData("object"),C,x)+s}var h=B.getEdges();var u;var r=[];var g=[];for(var A=h.length-1;A>=0;--A){var p=h[A];if(p===n){continue}if(t.indexOf(p)>=0){var o=B.getNeighborOnEdge(p);var w=this._writeMolVertex(o,p,e,t,v,C,x);if(e.indexOf(p)>=0){u=w}else{r.push(w)}}else{f=p.getData("object");var q=v.indexOf(p);if(q<0){q=v.length;v.push(p)}var m=this._outputConnectorStr(f,p.getVertexes()[0].getData("object"),p.getVertexes()[1].getData("object"),C,x);q=q+1;m+=(q<10)?q:b.RING_BOND_TWO_DIGIT_NO_PREFIX+q;g.push(m)}}for(var A=0,z=g.length;A<z;++A){s+=g[A]}if(!u&&r.length){u=r.shift()}for(var A=0,z=r.length;A<z;++A){s+=b.BRANCH_BRACKET_LEFT+r[A]+b.BRANCH_BRACKET_RIGHT}if(u){s+=u}return s},_outputNodeStr:function(f,l){var o;var g;if(f instanceof Kekule.Atom){g=f.getSymbol();o=g;if(l){o=o.toLowerCase()}}else{o=b.ATOM_WILDCARD}var h=f.getExplicitHydrogenCount?f.getExplicitHydrogenCount():0;if(!h&&l&&(g!=="C")&&f.getImplicitHydrogenCount){h=f.getImplicitHydrogenCount()}if(h){o+=b.ATOM_H+Math.round(h)}var m=Math.round(f.getCharge());if(m){var e=(m>0)?"+":"-";if(m>1||m<-1){e=Math.abs(m)+e}o+=e}var i=f.getMassNumber?f.getMassNumber():null;if(i){o=Math.abs(i)+o}var n=false;if(!h&&!m&&!i){if((!l&&b.ORGAN_SUBSET_ATOMS.indexOf(g)>=0)||(l&&b.AROMATIC_SUBSET_ATOMS.indexOf(g)>=0)){n=true}}if(!n){o=b.ATOM_BRACKET_LEFT+o+b.ATOM_BRACKET_RIGHT}return o},_outputConnectorStr:function(h,i,g,l,n){if(h instanceof Kekule.Bond){if(h.getBondType()===Kekule.BondType.COVALENT){if(n.indexOf(h)>=0){return""}else{var f=(l.indexOf(i)>=0)&&(l.indexOf(g)>=0);var e=h.getBondOrder();var m=Kekule.BondOrder;return(e===m.DOUBLE)?b.BOND_DOUBLE:(e===m.TRIPLE)?b.BOND_TRIPLE:(e===m.QUAD)?b.BOND_QUAD:f?b.BOND_SINGLE:""}}}return b.BOND_FAKE}});var d="smi";Kekule.IO.DataFormatsManager.register(d,"chemical/x-daylight-smiles","smi",Kekule.IO.ChemDataType.TEXT,"SMILES format");var c=[Kekule.StructureFragment,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.IO.ChemDataWriterManager.register("SMILES",Kekule.IO.SmilesMolWriter,c,[d])})();Kekule.IO.KcjReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcjReader",readData:function($super,c,b){var a=b||Kekule.IO.ChemDataType.TEXT;var d;if(a==Kekule.IO.ChemDataType.JSON){d=c}if(a==Kekule.IO.ChemDataType.TEXT){d=JsonUtility.parse(c)}else{Kekule.error(Kekule.ErrorMsg.KCJ_INPUT_DATATYPE_NOT_JSON_OR_TEXT);return null}return $super(d,Kekule.IO.ChemDataType.JSON)},doReadData:function(c,a){var b=ObjSerializerFactory.getSerializer("json");if(!b){Kekule.error(Kekule.ErrorMsg.JSON_SERIALIZER_NOT_EXISTS);return null}return b.load(null,c)}});Kekule.IO.KcjWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcjWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?true:b.prettyPrint)},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true})},writeData:function($super,d,c){var b=c||Kekule.IO.ChemDataType.TEXT;if((b!=Kekule.IO.ChemDataType.JSON)&&(b!=Kekule.IO.ChemDataType.TEXT)){Kekule.error(Kekule.ErrorMsg.KCJ_OUTPUT_DATATYPE_NOT_JSON_OR_TEXT);return null}var a=$super(d,Kekule.IO.ChemDataType.JSON);if(b==Kekule.IO.ChemDataType.JSON){return a}if(b==Kekule.IO.ChemDataType.TEXT){return JsonUtility.serializeToStr(a,{prettyPrint:this.getPrettyPrint()})}},doWriteData:function(c,a){var b=ObjSerializerFactory.getSerializer("json");if(!b){Kekule.error(Kekule.ErrorMsg.JSON_SERIALIZER_NOT_EXISTS);return null}var d={};b.save(c,d);return d}});Kekule.IO.KcxReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.KcxReader",readData:function($super,c,b){var a=b||Kekule.IO.ChemDataType.TEXT;var e;if(a==Kekule.IO.ChemDataType.DOM){e=c}if(a==Kekule.IO.ChemDataType.TEXT){var d=XmlUtility.parse(c);e=d.documentElement}else{Kekule.error(Kekule.ErrorMsg.KCX_INPUT_DATATYPE_NOT_DOM_OR_TEXT);return null}return $super(e,Kekule.IO.ChemDataType.DOM)},doReadData:function(c,a){var b=ObjSerializerFactory.getSerializer("xml");if(!b){Kekule.error(Kekule.ErrorMsg.XML_SERIALIZER_NOT_EXISTS);return null}return b.load(null,c)}});Kekule.IO.KcxWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.KcxWriter",initialize:function($super,a){$super(a);var b=a||{};this.setPrettyPrint(Kekule.ObjUtils.isUnset(b.prettyPrint)?true:b.prettyPrint);this.setRootTag(b.rootTag||"kcx")},initProperties:function(){this.defineProp("prettyPrint",{dataType:DataType.BOOL,defaultValue:true});this.defineProp("rootTag",{dataType:DataType.STRING})},writeData:function($super,e,c){var b=c||Kekule.IO.ChemDataType.TEXT;if((b!=Kekule.IO.ChemDataType.DOM)&&(b!=Kekule.IO.ChemDataType.TEXT)){Kekule.error(Kekule.ErrorMsg.KCX_OUTPUT_DATATYPE_NOT_DOM_OR_TEXT);return null}var a=$super(e,Kekule.IO.ChemDataType.DOM);if(b==Kekule.IO.ChemDataType.DOM){return a}if(b==Kekule.IO.ChemDataType.TEXT){var d={prettyPrint:this.getPrettyPrint()};return XmlUtility.serializeNode(a,d)}},doWriteData:function(d,a){var b=ObjSerializerFactory.getSerializer("xml");if(!b){Kekule.error(Kekule.ErrorMsg.XML_SERIALIZER_NOT_EXISTS);return null}var c=XmlUtility.newDocument(this.getRootTag());b.save(d,c.documentElement);return c.documentElement}});(function(){Kekule.IO.DataFormatsManager.register("JSON",Kekule.IO.MimeType.JSON,"json",Kekule.IO.ChemDataType.TEXT,"JSON format");Kekule.IO.DataFormatsManager.register("Kekule-JSON","chemical/x-kekule-json","kcj",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical JSON format");Kekule.IO.DataFormatsManager.register("Kekule-XML","chemical/x-kekule-xml","kcx",Kekule.IO.ChemDataType.TEXT,"Kekule Chemical XML format");var b=Kekule.IO.DataFormatsManager.findFormatId("chemical/x-kekule-json");var c=Kekule.IO.DataFormatsManager.findFormatId("chemical/x-kekule-json");var a=Kekule.IO.DataFormatsManager.findFormatId("chemical/x-kekule-xml");Kekule.IO.ChemDataReaderManager.register("json",Kekule.IO.KcjReader,b);Kekule.IO.ChemDataReaderManager.register("kcj",Kekule.IO.KcjReader,c);Kekule.IO.ChemDataReaderManager.register("kcx",Kekule.IO.KcxReader,a);Kekule.IO.ChemDataWriterManager.register("kcj",Kekule.IO.KcjWriter,[Kekule.ChemObject],c,{createOptions:{prettyPrint:!true}});Kekule.IO.ChemDataWriterManager.register("kcx",Kekule.IO.KcxWriter,[Kekule.ChemObject],a,{createOptions:{prettyPrint:true}})})();(function(){var a=Kekule;ClassEx.extend(Kekule.ChemObject,{getOverrideRenderOptions:function(f){if(f&&f.length){var c={};for(var e=0,d=f.length;e<d;++e){c=Object.extend(c,f[e])}return c}return null},_appendOverrideRenderOptionItem:function(e,c){var f=this.getPropStoreFieldValue(c);if(!f){f=[];this.setPropStoreFieldValue(c,f)}var d=f.indexOf(e);if(d>=0){f.splice(d,1)}f.push(e);this.notifyPropSet(c,f);return this},_deleteOverrideRenderOptionItem:function(e,c){var f=this.getPropStoreFieldValue(c);if(!f){return}var d=f.indexOf(e);if(d>=0){f.splice(d,1);this.notifyPropSet(c,f)}return this},addOverrideRenderOptionItem:function(c){return this._appendOverrideRenderOptionItem(c,"overrideRenderOptionItems")},addOverrideRender3DOptionItem:function(c){return this._appendOverrideRenderOptionItem(c,"overrideRender3DOptionItems")},removeOverrideRenderOptionItem:function(c){return this._deleteOverrideRenderOptionItem(c,"overrideRenderOptionItems")},removeOverrideRender3DOptionItem:function(c){return this._deleteOverrideRenderOptionItem(c,"overrideRender3DOptionItems")},getOverriddenRenderOptions:function(){var c=Object.create(this.getRenderOptions()||null);var d=this.getOverrideRenderOptions(this.getOverrideRenderOptionItems());if(d){c=Object.extend(c,d)}return c},getOverriddenRender3DOptions:function(){var c=Object.create(this.getRender3DOptions()||null);var d=this.getOverrideRenderOptions(this.getOverrideRender3DOptionItems());if(d){c=Object.extend(c,d)}return c},setRenderOption:function(e,c){var d=this.getRenderOptions();if(!d){this.setRenderOptions({})}var d=this.getRenderOptions();if(d[e]!==c){d[e]=c;this.notifyPropSet("renderOptions",d)}},setRender3DOption:function(e,c){var d=this.getRender3DOptions();if(!d){this.setRender3DOptions({})}var d=this.getRender3DOptions();if(d[e]!==c){d[e]=c;this.notifyPropSet("render3DOptions",d)}},getRenderOption:function(e){var d=this.getOverriddenRenderOptions();var c=(d?d[e]:undefined);return c},getRender3DOption:function(e){var d=this.getOverriddenRender3DOptions();var c=(d?d[e]:undefined);return c},getCascadedRenderOption:function(g){var f=this.getOverriddenRenderOptions();var c=(f?f[g]:undefined);if(Kekule.ObjUtils.isUnset(c)){var d=this.getParent?this.getParent():null;var e=d&&d.getCascadedRenderOption?d.getCascadedRenderOption(g):undefined;c=e}return c},getCascadedRender3DOption:function(g){var f=this.getOverriddenRender3DOptions();var c=(f?f[g]:undefined);if(Kekule.ObjUtils.isUnset(c)){var d=this.getParent?this.getParent():null;var e=d&&d.getCascadedRender3DOption?d.getCascadedRender3DOption(g):undefined;c=e}return c},getBaseCoord:function(d,c){return this.getCoordOfMode?this.getCoordOfMode(d,c):null},getBaseCoord2D:function(c){return this.getBaseCoord(Kekule.CoordMode.COORD2D,c)},getBaseCoord3D:function(c){return this.getBaseCoord(Kekule.CoordMode.COORD3D,c)},getAbsBaseCoord:function(d,c){return this.getAbsCoordOfMode?this.getAbsCoordOfMode(d,c):null},getAbsBaseCoord2D:function(c){return this.getAbsBaseCoord(Kekule.CoordMode.COORD2D,c)},getAbsBaseCoord3D:function(c){return this.getAbsBaseCoord(Kekule.CoordMode.COORD3D,c)},getExposedAncestor:function(){var c=this.getParent();if(!c){return this}else{if(c.isExpanded()){return this}else{return c.getExposedAncestor()}}},isExposed:function(){var c=this.getParent();return(!c)||(c.isExpanded())},isExpanded:function(){return true},setExpanded:function(c){},getLinkedExposedObjs:function(){var c=[];for(var h=0,e=this.getLinkedConnectorCount();h<e;++h){var d=this.getLinkedConnectorAt(h);if(!d.isExposed()){continue}var m=d.getConnectedExposedObjs();for(var g=0,f=m.length;g<f;++g){if(m[g]!==this){Kekule.ArrayUtils.pushUnique(c,m[g])}}}return c},getAllAutoScaleRefLengths:function(d,c){return[]},getAllContainingConnectors:function(){if(this.getAllChildConnectors){return this.getAllChildConnectors()}else{return[]}},getConnectorLengthMedian:function(e,d){var c=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(c,e,d)}});ClassEx.defineProps(Kekule.ChemObject,[{name:"renderOptions",dataType:DataType.OBJECT},{name:"render3DOptions",dataType:DataType.OBJECT},{name:"overrideRenderOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC},{name:"overrideRender3DOptionItems",dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemObjList,{getAllContainingConnectors:function(){var c=[];for(var e=0,d=this.getItemCount();e<d;++e){var f=this.getItemAt(e);if(f.getAllContainingConnectors){c=c.concat(f.getAllContainingConnectors())}}return c},getAllAutoScaleRefLengths:function(g,e){var c=[];for(var f=0,d=this.getItemCount();f<d;++f){var h=this.getItemAt(f);if(h.getAllAutoScaleRefLengths){c=c.concat(h.getAllAutoScaleRefLengths(g,e))}}return c}});ClassEx.extend(Kekule.ChemSpaceElement,{getAllContainingConnectors:function(){return this.getChildren().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(d,c){return this.getChildren().getAllAutoScaleRefLengths(d,c)}});ClassEx.extend(Kekule.ChemSpace,{getAllContainingConnectors:function(){return this.getRoot().getAllContainingConnectors()},getAllAutoScaleRefLengths:function(e,d){var c;if(this.getDefAutoScaleRefLength()){c=[this.getDefAutoScaleRefLength()]}else{c=this.getRoot().getAllAutoScaleRefLengths(e,d)}return c}});ClassEx.defineProps(Kekule.ChemObject,[{name:"defAutoScaleRefLength",dataType:DataType.NUMBER}]);ClassEx.extend(Kekule.BaseStructureConnector,{getBaseCoord:function(e,c){var n=Kekule.CoordMode;var p=null;var o=0;var m=(e===n.COORD2D)?{x:0,y:0}:{x:0,y:0,z:0};for(var g=0,d=this.getConnectedObjCount();g<d;++g){var f=this.getConnectedObjAt(g);var h=f.getBaseCoord?f.getBaseCoord(e,c):null;if(h){m=Kekule.CoordUtils.add(m,h);++o}}if(o){p=Kekule.CoordUtils.divide(m,o)}return p},getAbsBaseCoord:function(e,c){var n=Kekule.CoordMode;var p=null;var o=0;var m=(e===n.COORD2D)?{x:0,y:0}:{x:0,y:0,z:0};for(var g=0,d=this.getConnectedObjCount();g<d;++g){var f=this.getConnectedObjAt(g);var h=f.getAbsBaseCoord?f.getAbsBaseCoord(e,c):null;if(h){m=Kekule.CoordUtils.add(m,h);++o}}if(o){p=Kekule.CoordUtils.divide(m,o)}return p},getConnectedExposedObjs:function(){var g=this.getConnectedObjs();var c=[];for(var e=0,d=g.length;e<d;++e){var f=g[e].getExposedAncestor();if(c.indexOf(f)<0){c.push(f)}}return c},getLength:function(e,c){var g=this.getConnectedObjs();if(g.length!==2){return null}else{var f=g[0].getAbsBaseCoord?g[0].getAbsBaseCoord(e,c):null;var d=g[1].getAbsBaseCoord?g[1].getAbsBaseCoord(e,c):null;return Kekule.CoordUtils.getDistance(f,d)}},getLength2D:function(c){return this.getLength(Kekule.CoordMode.COORD2D,c)},getLength3D:function(c){return this.getLength(Kekule.CoordMode.COORD3D,c)}});ClassEx.extend(Kekule.ChemStructureConnector,{getAllAutoScaleRefLengths:function(d,c){return[this.getLength(d,c)]}});ClassEx.extend(Kekule.BaseStructureNode,{getBaseCoord:function(d,c){return this.getCoordOfMode(d,c)},getAbsBaseCoord:function(d,c){return this.getAbsCoordOfMode(d,c)},setAbsBaseCoord:function(d,c){this.setAbsCoordOfMode(d,c)},setAbsBaseCoord2D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD3D)},getExposedContainerBox:function(e,d){var c=this.getContainerBox(e,d);return c},getExposedContainerBox2D:function(d){var c=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,d);c.width=c.x2-c.x1;c.height=c.y2-c.y1;return c},getExposedContainerBox3D:function(d){var c=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,d);c.deltaX=c.x2-c.x1;c.deltaY=c.y2-c.y1;c.deltaZ=c.z2-c.z1;return c}});ClassEx.extend(Kekule.ChemStructureNode,{getDisplayRichText:function(l,g,d,f){var i=Kekule.Render;if(Kekule.ObjUtils.isUnset(g)){g=true}var c=i.RichTextUtils.create();var h;var e=this.getRenderOption("customLabel");if(e){h=i.RichTextUtils.strToRichText(e)}else{h=this.getCoreDisplayRichTextItem(d)}if(h){if(g){h=this.appendElectronStateDisplayText(h,f)}if(h){i.RichTextUtils.append(c,h);c.anchorItem=h}}return c},getCoreDisplayRichTextItem:function(c){return null},appendElectronStateDisplayText:function(e,c){var g=Kekule.Render;var f=this.getCharge();var d=this.getRadical();var i=g.ChemDisplayTextUtils.createElectronStateDisplayTextSection(f,d,c);if(i){var h=g.RichTextUtils.createGroup();g.RichTextUtils.append(h,e);g.RichTextUtils.append(h,i);h.charDirection=Kekule.Render.TextDirection.LTR;h.anchorItem=e;return h}else{return e}}});ClassEx.extend(Kekule.AbstractAtom,{getDisplayRichText:function($super,i,f,d,e){var h=Kekule.Render;if(!i){i=h.HydrogenDisplayLevel.DEFAULT}var c=$super(i,f,d,e);var g=0;switch(i){case h.HydrogenDisplayLevel.NONE:g=0;break;case h.HydrogenDisplayLevel.ALL:g=this.getHydrogenCount();break;case h.HydrogenDisplayLevel.EXPLICIT:g=this.getExplicitHydrogenCount();break;case h.HydrogenDisplayLevel.UNMATCHED_EXPLICIT:if(this.getImplicitHydrogenCount&&(this.getImplicitHydrogenCount()!==this.getExplicitHydrogenCount())){g=this.getExplicitHydrogenCount()}break}if(g){c=this.appendHydrogenDisplayText(c,g)}return c},appendHydrogenDisplayText:function(f,c){var d=Kekule.Render;if(c){if(c>1){var g=d.RichTextUtils.createGroup();g.charDirection=Kekule.Render.TextDirection.LTR;var e=d.RichTextUtils.appendText2(g,"H");d.RichTextUtils.appendText(g,c.toString(),{textType:d.RichText.SUB,refItem:e});d.RichTextUtils.append(f,g)}else{d.RichTextUtils.appendText(f,"H")}}return f}});ClassEx.extend(Kekule.Atom,{getCoreDisplayRichTextItem:function(e){var d=Kekule.Render;var c=d.RichTextUtils.createGroup();if(this.getSymbol()!==a.Element.UNSET_ELEMENT){var f=d.RichTextUtils.createSection(this.getSymbol(),{charDirection:Kekule.Render.TextDirection.LTR});c=d.RichTextUtils.append(c,f);c.anchorItem=f;if(this.getMassNumber()!==Kekule.Isotope.UNSET_MASSNUMBER){c=d.RichTextUtils.insertText(c,0,this.getMassNumber().toString(),{textType:d.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR,refItem:c.anchorItem});c.charDirection=Kekule.Render.TextDirection.LTR}}else{c=d.RichTextUtils.appendText(c,e.getUnsetElement())}return c}});ClassEx.extend(Kekule.Pseudoatom,{getCoreDisplayRichTextItem:function(f){var e=Kekule.Render;var d;var g=f;switch(this.getAtomType()){case Kekule.PseudoatomType.DUMMY:d=g.getDummyAtom();break;case Kekule.PseudoatomType.ANY:d=g.getAnyAtom();break;case Kekule.PseudoatomType.HETERO:d=g.getHeteroAtom();break;default:d=this.getSymbol()}if(!d){d=g.getUnsetElement()}var c=e.RichTextUtils.createSection(d,{charDirection:Kekule.Render.TextDirection.LTR});return c}});var b=function(g,d,c){var f=Kekule.Render;var e=Kekule.IsotopesDataUtil.getIsotopeIdDetail(d);var h;if(e.massNumber){h=f.RichTextUtils.appendText2(g,e.massNumber.toString(),{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR})}var i=f.RichTextUtils.appendText2(g,e.symbol,null,c);if(h){h.refItem=i}g.charDirection=Kekule.Render.TextDirection.LTR;return g};ClassEx.extend(Kekule.VariableAtom,{getCoreDisplayRichTextItem:function(n){var h=Kekule.Render;var c=n;if(this.isListEmpty()){return h.RichTextUtils.strToRichText(c.getVariableAtom())}var d=this.getAllowedIsotopeIds()||this.getDisallowedIsotopeIds();var g=this.isDisallowedList();var o=h.RichTextUtils.createGroup();if(g){o=h.RichTextUtils.appendText(o,c.getIsoListDisallowPrefix())}o=h.RichTextUtils.appendText(o,c.getIsoListLeadingBracket());if(d&&d.length){for(var m=0,f=d.length;m<f;++m){var e=d[m];if(e){if(m!=0){o=h.RichTextUtils.appendText(o,c.getIsoListDelimiter())}o=b(o,e,m==0)}}}o=h.RichTextUtils.appendText(o,c.getIsoListTailingBracket());return o}});ClassEx.extend(Kekule.StructureConnectionTable,{exposedNodesHasCoord2D:function(e){var d=this.getExposedNodes();for(var f=0,c=d.length;f<c;++f){if(d[f].hasCoord2D(e)){return true}}return false},exposedNodesHasCoord3D:function(e){var d=this.getExposedNodes();for(var f=0,c=d.length;f<c;++f){if(d[f].hasCoord3D(e)){return true}}return false},getExposedNodes:function(){var c=[];var f=this.getNodes();for(var g=0,d=f.length;g<d;++g){var h=f[g];if(h.getExposedNodes&&h.isExpanded()){var e=h.getExposedNodes();c=c.concat(e)}else{if(h.isExposed()){c.push(h)}}}return c},getExposedConnectors:function(){var c=this.getConnectors();var e=this.getNodes();for(var f=0,d=e.length;f<d;++f){var h=e[f];if(h.getConnectors&&h.isExpanded()){var g=h.getExposedConnectors();c=c.concat(g)}}return c},getExposedContainerBox:function(d,c){return this.getNodesContainBox(this.getExposedNodes(),d,c)},getExposedContainerBox2D:function(d){var c=this.getExposedContainerBox(Kekule.CoordMode.COORD2D,d);c.width=c.x2-c.x1;c.height=c.y2-c.y1;return c},getExposedContainerBox3D:function(d){var c=this.getExposedContainerBox(Kekule.CoordMode.COORD3D,d);c.deltaX=c.x2-c.x1;c.deltaY=c.y2-c.y1;c.deltaZ=c.z2-c.z1;return c},getConnectorLengthMedian:function(e,d){var c=this.getAllContainingConnectors();return Kekule.ChemStructureUtils.getConnectorLengthMedian(c,e,d)},getAllAutoScaleRefLengths:function(m,g){var f=this.getAllContainingConnectors();var c=[];for(var h=0,e=f.length;h<e;++h){var d=f[h];if(d&&d.getAllAutoScaleRefLengths){var n=d.getAllAutoScaleRefLengths(m,g);if(n){c=c.concat(n)}}}return c}});ClassEx.extend(Kekule.StructureFragment,{isExpanded:function(){var c=this.getOverriddenRenderOptions();return c?(!!c.expanded):false},setExpanded:function(c){this.setRenderOption("expanded",c)},getExposedNodes:function(){if(this.hasCtab()){return this.getCtab().getExposedNodes()}else{return[]}},getExposedConnectors:function(){if(this.hasCtab()){return this.getCtab().getExposedConnectors()}else{return[]}},exposedNodesHasCoord2D:function(c){if(this.hasCtab()){return this.getCtab().exposedNodesHasCoord2D(c)}else{return false}},exposedNodesHasCoord3D:function(c){if(this.hasCtab()){return this.getCtab().exposedNodesHasCoord3D(c)}else{return false}},getExposedContainerBox:function(d,c){if(this.hasCtab()){return this.getCtab().getExposedContainerBox(d,c)}else{return this.getContainerBox(d,c)}},getConnectorLengthMedian:function(d,c){if(this.hasCtab()){return this.getCtab().getConnectorLengthMedian(d,c)}else{return null}},getAutoScaleRefLength:function(d,c){return this.getConnectorLengthMedian(d,c)},getAllAutoScaleRefLengths:function(d,c){if(this.hasCtab()){return this.getCtab().getAllAutoScaleRefLengths(d,c)}else{return null}}});ClassEx.extend(Kekule.SubGroup,{getCoreDisplayRichTextItem:function(f){var e=Kekule.Render;var d=this.getAbbr();if(!d){d=f.getRgroup()}var c;if(d.length<=1){c=e.RichTextUtils.createSection(d)}else{c=e.RichTextUtils.createGroup();c.charDirection=Kekule.Render.TextDirection.LTR;var g=e.RichTextUtils.createSection(d.charAt(0));c=e.RichTextUtils.append(c,g);c.anchorItem=g;g=e.RichTextUtils.createSection(d.substring(1));c=e.RichTextUtils.append(c,g)}return c},_autoSetSelfCoord:function(g,f){if(this._isAutoSettingSelfCoord){return}if(this.getCoordOfMode(g,f)){return}var m=this.getAnchorNodeCount();if(m<=0){return}this.beginUpdate();try{this._isAutoSettingSelfCoord=true;var d={};for(var h=0;h<m;++h){var e=this.getAnchorNodeAt(h);if(e._autoSetSelfCoord){e._autoSetSelfCoord(g,f)}var l=e.getAbsCoordOfMode(g,f);if(l){d=Kekule.CoordUtils.add(d,l)}}var n=Kekule.CoordUtils.divide(d,m);this.setAbsCoordOfMode(n,g);var c=this.getCoordOfMode(g)||{};var m=this.getNodeCount();for(var h=0;h<m;++h){var e=this.getNodeAt(h);var l=e.getCoordOfMode(g,f);if(l){l=Kekule.CoordUtils.substract(l,c);e.setCoordOfMode(l,g)}}}finally{this._isAutoSettingSelfCoord=false;this.endUpdate()}},doGetAbsCoord2D:function($super,c){this._autoSetSelfCoord(Kekule.CoordMode.COORD2D,c);return $super(c)},doGetAbsCoord3D:function($super,c){this._autoSetSelfCoord(Kekule.CoordMode.COORD3D,c);return $super(c)},doSetAbsCoord2D:function($super,c){this._autoSetSelfCoord(Kekule.CoordMode.COORD2D);return $super(c)},doSetAbsCoord3D:function($super,c){this._autoSetSelfCoord(Kekule.CoordMode.COORD3D);return $super(c)}});ClassEx.extend(Kekule.MolecularFormula,{getMaxNestLevel:function(){var c=0;for(var f=0,d=this.getSectionCount();f<d;++f){var g=this.getSectionAt(f);if(g.obj instanceof Kekule.MolecularFormula){var e=g.obj.getMaxNestLevel()+1;if(e>c){c=e}}}return c},getDisplayRichText:function(d,c){var e=Kekule.Render;if(Kekule.ObjUtils.isUnset(d)){d=true}return e.ChemDisplayTextUtils.formulaToRichText(this,d,null,c)}});ClassEx.extend(Kekule.Molecule,{afterInitialization:function(){this.setExpanded(true)}});ClassEx.extend(Kekule.CompositeMolecule,{getExposedContainerBox:function(m,e){var c=null;var g=this.getPropStoreFieldValue("subMolecules");if(g){for(var f=0,d=g.length;f<d;++f){var n=g[f];var h=n.getExposedContainerBox(m,e);if(h){if(!c){c=Object.extend({},h)}else{c=Kekule.BoxUtils.getContainerBox(c,h)}}}}return c},getAllAutoScaleRefLengths:function(m,f){var c=[];var h=this.getPropStoreFieldValue("subMolecules");if(h){for(var g=0,d=h.getItemCount();g<d;++g){var n=h.getObjAt(g);var e=n.getAllAutoScaleRefLengths(m,f);if(e){c=c.concat(e)}}}return c}})})();"use strict";Kekule.Render={};Kekule.Render.CoordSystem={CHEM:0,CONTEXT:1,SCREEN:2};Kekule.Render.RendererType={R2D:2,R3D:3};Kekule.Render.DEF_ATOM_ATOMIC_NUM=6;Kekule.Render.MoleculeDisplayType={SKELETAL:1,CONDENSED:2,DEFAULT:1};Kekule.Render.Molecule2DDisplayType=Kekule.Render.MoleculeDisplayType;Kekule.Render.NodeLabelDisplayMode={HIDDEN:-1,SHOWN:1,SMART:0,DEFAULT:0};Kekule.Render.HydrogenDisplayLevel={NONE:0,EXPLICIT:1,UNMATCHED_EXPLICIT:2,ALL:10,DEFAULT:1};Kekule.Render.TextDirection={DEFAULT:0,LTR:1,RTL:3,TTB:2,BTT:4};Kekule.Render.TextAlign={DEFAULT:0,LEFT:1,RIGHT:2,TOP:3,BOTTOM:4,CENTER:5,LEADING:10,TRAILING:11,getAbsAlign:function(e,f){var c=e;var d=Kekule.Render.TextAlign;var b=Kekule.Render.TextDirection;if((e===d.LEADING)||(e===d.TRAILING)){var a=e==d.LEADING;switch(f){case b.RTL:c=a?d.RIGHT:d.LEFT;break;case b.TTB:c=a?d.TOP:d.BOTTOM;break;case b.BTT:c=a?d.BOTTOM:d.TOP;break;case b.LTR:default:c=a?d.LEFT:d.RIGHT;break}}return c}};Kekule.Render.BoxXAlignment={LEFT:0,RIGHT:1,CENTER:2};Kekule.Render.BoxYAlignment={TOP:0,BOTTOM:1,CENTER:2};Kekule.Render.TextBoxAlignmentMode={BOX:0,ANCHOR:1};Kekule.Render.BondRenderType={SINGLE:0,DOUBLE:1,TRIPLE:2,DASHED:4,DASHED_DOUBLE:5,DASHED_TRIPLE:6,SOLID_DASH:7,ARROWED:8,ARROWED_INV:9,HASHED:10,BOLD:11,BOLD_DOUBLE:12,BOLD_TRIPLE:13,BOLD_DASH:16,WEDGED_SOLID:20,WEDGED_SOLID_INV:21,WEDGED_HOLLOW:22,WEDGED_HOLLOW_INV:23,WEDGED_HASHED:24,WEDGED_HASHED_INV:25,WAVY:30};Kekule.Render.ChargeMarkRenderType={NUM_WITH_SYMBOL:1,DEFAULT:1,CIRCLE_AROUND:3};Kekule.Render.Render3DGraphicQuality={LOW:1,MEDIUM:2,HIGH:3,EXTREME:4};Kekule.Render.Molecule3DDisplayType={WIRE:1,STICKS:2,BALL_STICK:3,SPACE_FILL:4,DEFAULT:3};Kekule.Render.Bond3DRenderMode={NONE:0,WIRE:1,MULTI_WIRE:2,CYLINDER:3,MULTI_CYLINDER:4,isWireMode:function(a){var b=Kekule.Render.Bond3DRenderMode;return(a===b.WIRE)||(a===b.MULTI_WIRE)},isCylinderMode:function(a){var b=Kekule.Render.Bond3DRenderMode;return(a===b.CYLINDER)||(a===b.MULTI_CYLINDER)}};Kekule.Render.Bond3DSpliceMode={UNSPLIT:1,MID_SPLIT:2,WEIGHTING_SPLIT:3};Kekule.Render.Bond3DRenderType={SINGLE:1,DOUBLE:2,TRIPLE:3,DASH:-1,SOLID_DASH:-2};Kekule.Render.Node3DRenderMode={NONE:0,BALL:1,SPACE:2};Kekule.Render.MetaShapeType={POINT:0,CIRCLE:1,LINE:2,RECT:3,POLYGON:10,SPHERE:101,CYLINDER:102,COMPOSITE:-1};Kekule.Render.BoundShapeType=Kekule.Render.MetaShapeType;Kekule.Render.ObjectUpdateType={MODIFY:0,ADD:1,REMOVE:2,CLEAR:3};Kekule.Render.AbstractRenderer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.AbstractRenderer",RENDER_CACHE_FIELD:"__$renderCache__",initialize:function($super,c,a,b){$super();this.setPropValue("chemObj",c,true);if(b){this.setParent(b)}this.setDrawBridge(a);this.setBubbleEvent(true);this._suspendUpdateStatus=0;this._suspendUpdateInfos=[]},finalize:function($super){this.setPropValue("chemObj",null,true);this.setDrawBridge(null);$super()},initProperties:function(){this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false});this.defineProp("parent",{dateType:DataType.OBJECT,serializable:false});this.defineProp("parentRenderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:false,getter:function(){var a=this.getParent();return(a instanceof Kekule.Render.AbstractRenderer)?a:null},setter:function(a){this.setParent(a)}});this.defineProp("redirectContext",{dataType:DataType.OBJECT,serializable:false});this.defineEvent("clear");this.defineEvent("updateBasicDrawObject")},isRootRenderer:function(){return !this.getParentRenderer()},getHigherLevelObj:function(){return this.getParent()},getRendererType:function(){return Kekule.Render.RendererType.R2D},getRenderCache:function(b){var a=this.getExtraProp(b,this.RENDER_CACHE_FIELD);if(!a){a={};this.setExtraProp(b,this.RENDER_CACHE_FIELD,a)}return a},beginDraw:function(d,e,c){var a=this.getDrawBridge();if(a.prepareContext){a.prepareContext(d)}},endDraw:function(d,e,c){var a=this.getDrawBridge();if(a.renderContext){a.renderContext(d)}},updateDrawInfoInCache:function(f,c,d,b,a){var e=this.getRenderCache(c);if(c){e.context=c}if(d){e.baseCoord=d}if(f){e.chemObj=f}if(b){e.options=b}if(a){e.realDrawOptions=a}},_isCurrChemObjNeedToBeDrawn:function(c){var e=this.getChemObj();for(var b=0,a=c.length;b<a;++b){var d=c[b];if((d===e)||(d.isChildOf(e))){return true}}return false},getAutoBaseCoord:function(a){return this.doGetAutoBaseCoord(a)},doGetAutoBaseCoord:function(a){return null},getCachedDrawOptions:function(a){return this.getRenderCache(a).options},getCachedDrawnElem:function(a){return this.getRenderCache(a).drawnElem},draw:function(b,h,n){var d={};var c;var i=this.getParentRenderer();if(i){var c=i.getRenderCache().options}if(c){d=Object.create(c);d=Object.extend(d,n)}else{d=Object.create(n||null)}var l=this.getChemObj();var a=d.partialDrawObjs;if(a&&(!this._isCurrChemObjNeedToBeDrawn(a))){return null}var f=(this.getRendererType()===Kekule.Render.RendererType.R3D)?"getOverriddenRender3DOptions":"getOverriddenRenderOptions";var g=l[f]?l[f]():null;d=Kekule.Render.RenderOptionUtils.mergeRenderOptions(g||{},d);this.updateDrawInfoInCache(this.getChemObj(),b,h,n,d);var e=this.isRootRenderer();if(e){this.beginDraw(b,h,d)}var m=this.doDraw(b,h,d);this.getRenderCache(b).drawnElem=m;if(e){this.endDraw(b,h,d)}this.invokeEvent("draw",{context:b,obj:this.getChemObj()});return m},doDraw:function(b,c,a){return null},redraw:function(d){var c=this.isRootRenderer();if(c){var b=this.getRenderCache(d)||{};this.beginDraw(d,b.baseCoord,b.options)}var a=this.doRedraw(d);this.getRenderCache(d).drawnElem=a;if(c){this.endDraw(d,b.baseCoord,b.options)}return a},doRedraw:function(a){var b=this.getRenderCache(a);return this.draw(a,b.baseCoord,b.options)},canModifyGraphic:function(c){var a=this.getDrawBridge();return a.canModifyGraphic?a.canModifyGraphic(c):false},beginUpdateRenderer:function(){++this._suspendUpdateStatus},endUpdateRenderer:function(){--this._suspendUpdateStatus;if(this._suspendUpdateStatus<=0){this._suspendUpdateStatus=0}if(!this.isUpdatingRenderer()){this.doEndUpdateRenderer()}},doEndUpdateRenderer:function(){this.updateEx(this._suspendUpdateInfos);this._suspendUpdateInfos=[]},isUpdatingRenderer:function(){return this._suspendUpdateStatus>0},updateEx:function(o){var q;var s=true;if(!this.isUpdatingRenderer()){q=this.canModifyGraphic(c);if(q){for(var n=0,f=o.length;n<f;++n){var d=o[n];var c=d.context;for(var h=0,g=d.items.length;h<g;++h){var r=d.items[h];s=s&&this.doUpdate(c,r.updatedObjDetails,r.updateType);if(!s){break}}if(!s){break}}}else{var e=this.isRootRenderer();if(e){var m=[];for(var n=0,f=o.length;n<f;++n){var d=o[n];var c=d.context;Kekule.ArrayUtils.pushUnique(m,c)}for(var n=0,f=m.length;n<f;++n){this.getDrawBridge().clearContext(c);var a=this.getRenderCache(c);this.draw(c,a.baseCoord,a.options)}return true}else{var b=this.getParentRenderer();return b.updateEx(o)}}return s}else{if(!this._suspendUpdateInfos){this._suspendUpdateInfos=[]}this._mergeRendererUpdateInfo(this._suspendUpdateInfos,o);return true}},_mergeRendererUpdateInfo:function(d,g){for(var e=0,b=g.length;e<b;++e){var f=g[e];var c=this._indexOfContextInRendererUpdateInfos(f.context,d);if(c<0){d.push(f)}else{var a=d[c];a.items=a.items.concat(f.items)}}return d},_indexOfContextInRendererUpdateInfos:function(c,e){for(var b=0,a=e.length;b<a;++b){var d=e[b];if(d.context===c){return b}}return -1},update:function(d,g,b){var e=[];for(var c=0,a=g.length;c<a;++c){var f=g[c].obj;if(this.isChemObjRenderedBySelf(d,f)){e.push(g[c])}}if(e.length){return this.updateEx([{context:d,items:[{updateType:b,updatedObjDetails:e}]}])}else{return true}},doUpdate:function(c,h,n){var a=false;if(this.canModifyGraphic(c)){var d=false;var m=this.getChemObj();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.obj===m){d=true;break}}if(d){if(n===Kekule.Render.ObjectUpdateType.CLEAR){return this.doClear(c)}else{this.doClear(c);var b=this.getRenderCache(c);return this.draw(c,b.baseCoord,b.options)}}}return a},_extractObjsOfUpdateObjDetails:function(a){return Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(a)},_createUpdateObjDetailsFromObjs:function(a){return Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(a)},addNew:function(c,a){var b=this._createUpdateObjDetailsFromObjs(a);return this.update(c,b,Kekule.Render.ObjectUpdateType.ADD)},modify:function(a,b){return this.update(a,b,Kekule.Render.ObjectUpdateType.MODIFY)},remove:function(b,c){var a=this._createUpdateObjDetailsFromObjs(c);return this.update(b,a,Kekule.Render.ObjectUpdateType.REMOVE)},clear:function(b){var a=this.doClear(b);this.invokeEvent("clear",{context:b,obj:this.getChemObj()})},doClear:function(a){if(this.canModifyGraphic()){var b=this.getRenderCache(a).drawnElem;if(b){this.getDrawBridge().removeDrawnElem(a,b)}this.getRenderCache(a).drawnElem=null}else{return false}},estimateObjBox:function(c,b,a){var d=this.doEstimateObjBox(c,b,a);d=this._fillBoxDefaultValue(d,this.getRendererType());return d},doEstimateObjBox:function(c,b,a){return null},estimateRenderBox:function(c,e,b,a){var d=this.doEstimateRenderBox(c,e,b,a);d=this._fillBoxDefaultValue(d,this.getRendererType());return d},doEstimateRenderBox:function(c,d,b,a){return null},_fillBoxDefaultValue:function(d,a){if(!d){d={}}var c=a===Kekule.Render.RendererType.R3D;var b={x1:d.x1||0,x2:d.x2||0,y1:d.y1||0,y2:d.y2||0};if(c){b.z1=d.z1||0;b.z2=d.z2||0}return b},transformCoordToObj:function(a,c,b){return this.doTransformCoordToObj(a,c,b)},doTransformCoordToObj:function(a,c,b){return b},transformCoordToContext:function(a,c,b){return this.doTransformCoordToContext(a,c,b)},doTransformCoordToContext:function(a,c,b){return b},transformContextCoordToScreen:function(a,b){return this.doTransformContextCoordToScreen(a,b)},doTransformContextCoordToScreen:function(c,d){var a=this.getDrawBridge();return(a&&a.transformContextCoordToScreen)?a.transformContextCoordToScreen(c,d):d},basicDrawObjectUpdated:function(c,e,d,b,a){this.invokeEvent("updateBasicDrawObject",{context:c,obj:e,parentObj:d,boundInfo:b,updateType:a})},isChemObjRenderedBySelf:function(a,b){return(b===this.getRenderCache(a).chemObj)},isChemObjRenderedDirectlyBySelf:function(a,b){if(b&&this.getRenderCache(a).chemObj){return(b===this.getRenderCache(a).chemObj)}else{return false}},createBoundInfo:function(a,c,b){return Kekule.Render.MetaShapeUtils.createShapeInfo(a,c,b)},createPointBoundInfo:function(a){return this.createBoundInfo(Kekule.Render.BoundShapeType.POINT,[a])},createCircleBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.CIRCLE,[b],{radius:a})},createLineBoundInfo:function(c,b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.LINE,[c,b],{width:a})},createRectBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.RECT,[b,a])},createSphereBoundInfo:function(b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.SPHERE,[b],{radius:a})},createCylinderBoundInfo:function(c,b,a){return this.createBoundInfo(Kekule.Render.BoundShapeType.CYLINDER,[c,b],{radius:a})}});Kekule.ClassDefineUtils.addExtraObjMapSupport(Kekule.Render.AbstractRenderer);Kekule.Render.Renderer2DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS);Kekule.Render.get2DRendererClass=function(b){var a=(b instanceof ObjectEx)?b.getClass():b;return Kekule.Render.Renderer2DFactory.getClass(a)};Kekule.Render.Renderer3DFactory=Kekule.FactoryUtils.createSimpleFactory(Kekule.FactoryUtils.MATCH_BY_CLASS);Kekule.Render.get3DRendererClass=function(b){var a=(b instanceof ObjectEx)?b.getClass():b;return Kekule.Render.Renderer3DFactory.getClass(a)};Kekule.Render.DrawBridgeManager=Class.create({CLASS_NAME:"Kekule.Render.DrawBridgeManager",initialize:function(){this._items=[];this._preferredItem=null},_indexOfBridgeClass:function(d){for(var b=0,a=this._items.length;b<a;++b){var c=this._items[b];if(c.bridgeClass===d){return b}}return -1},_sortItems:function(){this._items.sort(function(b,a){return(b.priorityLevel||0)-(a.priorityLevel||0)})},_reselectPreferred:function(){this._sortItems();for(var a=this._items.length-1;a>=0;--a){var b=this._items[a];if(b.isSupported){this._preferredItem=b;return b}}this._preferredItem=null;return null},register:function(d,a){if(!a){a=0}var b=this._indexOfBridgeClass(d);var c;if(b>=0){c=this._items[b];c.priorityLevel=a}else{c={bridgeClass:d,priorityLevel:a};c.isSupported=d.isSupported?d.isSupported():false;this._items.push(c)}this._sortItems();if((!this._preferredItem)||(this._preferredItem.priorityLevel<a)){if(c.isSupported){this._preferredItem=c}}return c},unregister:function(c){var b=null;var a=this._indexOfBridgeClass(c);if(a>=0){b=this._items[a];this._items.splice(a,1);if(b===this._preferredItem){this._reselectPreferred()}}return b},getPreferredBridgeClass:function(){return(this._preferredItem)?this._preferredItem.bridgeClass:null},getPreferredBridgeInstance:function(){var a=this.getPreferredBridgeClass();if(a){return new a()}else{return null}}});Kekule.Render.DrawBridge2DMananger=new Kekule.Render.DrawBridgeManager();Kekule.Render.DrawBridge3DMananger=new Kekule.Render.DrawBridgeManager();Kekule.Render.RichText={SECTION:"section",GROUP:"group",LINES:"lines",SUP:"superscript",SUB:"subscript",NORMAL:"normal"};Kekule.Render.RichTextUtils={create:function(){return Kekule.Render.RichTextUtils.createGroup()},createGroup:function(a){return{role:a||"group",items:[]}},createSection:function(d,a){var c={text:d};if(a){for(var b in a){if(a.hasOwnProperty(b)){c[b]=a[b]}}}return c},strToRichText:function(h,f){if(!h){h=""}var g=Kekule.Render.RichTextUtils;var d=h.split("\n");if(d.length<=1){return Kekule.Render.RichTextUtils.appendText(g.create(),h,f)}else{var a=g.createGroup(Kekule.Render.RichText.LINES);for(var e=0,c=d.length;e<c;++e){var b=d[e]||"\u00a0";g.appendText(a,b,f)}return a}},insertText:function(e,b,f,c,a){var d=Kekule.Render.RichTextUtils.createSection(f,c);e.items.splice(b,0,d);if(a){e.anchorItem=d}return e},appendText:function(d,e,b,a){var c=Kekule.Render.RichTextUtils.createSection(e,b);d.items.push(c);if(a){d.anchorItem=c}return d},appendText2:function(d,e,b,a){var c=Kekule.Render.RichTextUtils.createSection(e,b);d.items.push(c);if(a){d.anchorItem=c}return c},insert:function(c,a,b){c.items.splice(a,0,b);return c},append:function(b,a){b.items.push(a);return b},getItemType:function(a){if(a.items){return a.role}else{return Kekule.Render.RichText.SECTION}},getItemRole:function(b){var a=Kekule.Render.RichText;return(Kekule.Render.RichTextUtils.getItemType(b)===a.GROUP)?a.GROUP:a.SECTION},getItemTextType:function(a){return a.textType||Kekule.Render.RichText.NORMAL},isSuperscript:function(a){return Kekule.Render.RichTextUtils.getItemTextType(a)==Kekule.Render.RichText.SUP},isSubscript:function(a){return Kekule.Render.RichTextUtils.getItemTextType(a)==Kekule.Render.RichText.SUB},isGroup:function(a){return Kekule.Render.RichTextUtils.getItemType(a)===Kekule.Render.RichText.GROUP},isSection:function(a){return Kekule.Render.RichTextUtils.getItemType(a)===Kekule.Render.RichText.SECTION},getActualRefItem:function(d,c){var a=d.refItem;if((!a)&&(c.items.length>1)){var b=c.items.indexOf(d);if(b>0){a=c.items[b-1]}else{if(b==0){a=c.items[1]}else{a=null}}}return a},getFinalAnchorItem:function(a){if(a.anchorItem){return Kekule.Render.RichTextUtils.getFinalAnchorItem(a.anchorItem)}else{return a}},tidy:function(b){var n=Kekule.Render.RichTextUtils.createGroup(b.role);var a=-1;for(var e=0,d=b.items.length;e<d;++e){var m=b.items[e];if(m.items){var c=Kekule.Render.RichTextUtils.tidy(m);if(c.items.length==1){var f=Object.extend({},c);delete f.items;delete f.role;f=Object.extend(f,c.items[0]);m=f}else{if(c.items.length>0){++a;n.items.push(c);continue}}}var h=false;if(a>=0){var g=n.items[a];if(!g.items){if(Kekule.ObjUtils.equal(m,g,["text"])){g.text+=m.text;h=true}}}if(!h){++a;n.items.push(Object.extend({},m))}}return n},clone:function(g){var b={};Object.extend(b,g);if(g.items){b.items=[];for(var e=0,c=g.items.length;e<c;++e){var f={};f=Kekule.Render.RichTextUtils.clone(g.items[e]);b.items.push(f)}}if(b.items){if(g.anchorItem){var d=g.items.indexOf(g.anchorItem);if(d>=0){b.anchorItem=b.items[d]}else{b.anchorItem=null}}for(var e=0,c=b.items.length;e<c;++e){var a=g.items[e];var f=b.items[e];if(a.refItem){var d=g.items.indexOf(a.refItem);if(d>=0){f.refItem=b.items[d]}else{f.refItem=null}}}}return b},toText:function(e){var a="";if(e.items){for(var c=0,b=e.items.length;c<b;++c){var d=e.items[c];if(d.items){a+=Kekule.Render.RichTextUtils.toText(d)}else{if(d.text){a+=d.text}}}}else{return e.text||""}return a},_toDebugHtml:function(e){var a="";for(var c=0,b=e.items.length;c<b;++c){var d=e.items[c];if(d.items){a+=Kekule.Render.RichTextUtils._toDebugHtml(d)}else{if(d.text){switch(d.textType){case Kekule.Render.RichText.SUB:a+="<sub>"+d.text+"</sub>";break;case Kekule.Render.RichText.SUP:a+="<sup>"+d.text+"</sup>";break;default:a+=d.text}}}}return a}};Kekule.Render.ChemDisplayTextUtils={RADICAL_LABEL:["","\u2022\u2022","\u2022","\u2022\u2022"],getRadicalDisplayText:function(a){return Kekule.Render.ChemDisplayTextUtils.RADICAL_LABEL[a]},createElectronStateDisplayTextSection:function(g,f,d){var b=null;var a="";var c=(!!g)&&(!d||(Math.abs(g)>Math.pow(10,-d)/2));if(c){var h=(g>0)?"+":"-";var e=Math.abs(g);if(e!=1){a+=d?Kekule.NumUtils.toDecimals(e,d):e.toString()}a+=h}if(f){a+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(f)||""}b=Kekule.Render.RichTextUtils.createSection(a,{textType:Kekule.Render.RichText.SUP,charDirection:Kekule.Render.TextDirection.LTR});return b},FORMULA_BRACKETS:[["(",")"],["[","]"],["{","}"]],FORMULA_BRACKET_TYPE_COUNT:3,formulaToRichText:function(e,c,d,b){var a=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(e,false,c,d,b);return a},_convFormulaToRichTextGroup:function(o,t,q,h,d){var u=Kekule.Render.RichTextUtils.createGroup();var s=o.getSections();if(t){var b=o.getMaxNestLevel()%Kekule.Render.ChemDisplayTextUtils.FORMULA_BRACKET_TYPE_COUNT;var p=Kekule.Render.ChemDisplayTextUtils.FORMULA_BRACKETS[b][0];var a=Kekule.Render.ChemDisplayTextUtils.FORMULA_BRACKETS[b][1];u=Kekule.Render.RichTextUtils.appendText(u,p)}for(var g=0,c=s.length;g<c;++g){var f=s[g].obj;var r=null;if(f instanceof Kekule.MolecularFormula){r=Kekule.Render.ChemDisplayTextUtils._convFormulaToRichTextGroup(f,true,q)}else{if(f.getDisplayRichText){var r=f.getDisplayRichText(Kekule.Render.HydrogenDisplayLevel.NONE,q)}}if(r){if(s[g].count!=1){r=Kekule.Render.RichTextUtils.appendText(r,s[g].count.toString(),{textType:Kekule.Render.RichText.SUB})}u=Kekule.Render.RichTextUtils.append(u,r)}}if(t){u=Kekule.Render.RichTextUtils.appendText(u,a)}if(q||h){var n=o.getCharge();var m=o.getRadical();var e=Kekule.Render.ChemDisplayTextUtils.createElectronStateDisplayTextSection(n,m,d);if(e){Kekule.Render.RichTextUtils.append(u,e)}}return u}};Kekule.Render.TextDrawUtils={isHorizontalLine:function(a){return((a==Kekule.Render.TextDirection.LTR)||(a==Kekule.Render.TextDirection.RTL)||(a==null))},isVerticalLine:function(a){return((a==Kekule.Render.TextDirection.TTB)||(a==Kekule.Render.TextDirection.BTT))},getOppositeDirection:function(b){var a=Kekule.Render.TextDirection;switch(b){case a.LTR:return a.RTL;case a.RTL:return a.LTR;case a.TTB:return a.BTT;case a.BTT:return a.TTB}},isOppositeDirection:function(b,a){return Kekule.Render.TextDrawUtils.getOppositeDirection(b)===a},getActualDirection:function(b,a){if(b===TD.LINE_BREAK){return((a===TD.TTB)||(a===TD.BTT))?TD.LTR:((a===TD.LTR)||(a===TD.RTL))?TD.TTB:b}else{return b}},getActualAlign:function(d,c){var a=Kekule.Render.TextAlgin;var b=Kekule.Render.TextDirection;switch(d){case a.LEFT:case a.RIGHT:case a.TOP:case a.BOTTOM:case a.CENTER:return d;break;case a.LEADING:switch(c){case b.TTB:return a.TOP;case b.BTT:return a.BOTTOM;case b.RTL:return a.RIGHT;case b.LTR:default:return a.LEFT}case a.TRAILING:switch(c){case b.BTT:return a.TOP;case b.TTB:return a.BOTTOM;case b.RTL:return a.LEFT;case b.LTR:default:return a.RIGHT}}}};Kekule.Render.DrawPathUtils={makePath:function(){var b=[];var d=null;var g=[];var f;for(var e=0,c=arguments.length;e<c;++e){var a=arguments[e];if(DataType.isArrayValue(a)){g=g.concat(a)}else{if(typeof(a)==="number"){g.push(a)}else{if(d){f={method:d,params:g};b.push(f);d=null;g=[]}d=a.toString()}}if(e===c-1){if(d){f={method:d,params:g};b.push(f)}}}return b}};Kekule.Render.ConnectorDrawUtils={getPossibleConnectorRenderTypes:function(a){if(a instanceof Kekule.Bond){return Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(a)}else{var b=Kekule.Render.BondRenderType;return[b.SINGLE,b.DASHED,b.WAVY]}},getDefConnectorRenderType:function(c){var b=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(c);return b[0]},getPossibleBondRenderTypes:function(f){var b=Kekule.Render.BondRenderType;var c=Kekule.BondType;var g=f.getBondType();switch(g){case c.HYDROGEN:return[b.DASHED,b.ARROWED,b.WAVY];break;case c.COORDINATE:return[b.ARROWED,b.SINGLE,b.DASHED,b.WAVY];break;case c.IONIC:case c.COORDINATE:case c.METALLIC:case c.UNKNOWN:return[b.SINGLE,b.DASHED,b.WAVY];break;case c.COVALENT:break;default:return[b.SINGLE,b.DASHED,b.ARROWED,b.WAVY]}var e=Kekule.BondOrder;switch(f.getBondOrder()){case e.DOUBLE:return[b.DOUBLE,b.DASHED_DOUBLE,b.BOLD_DOUBLE,b.WAVY];break;case e.TRIPLE:return[b.TRIPLE,b.BOLD_TRIPLE,b.WAVY];break;case e.QUAD:return[b.QUAD,b.BOLD_QUAD,b.WAVY];break;case e.EXPLICIT_AROMATIC:return[b.SOLID_DASH,b.WAVY];break;case e.SINGLE:var d=Kekule.BondStereo;var a=[b.SINGLE,b.BOLD,b.WAVY];switch(f.getStereo()){case d.UP:a.unshift(b.WEDGED_SOLID,b.WEDGED_HOLLOW);break;case d.UP_INVERTED:a.unshift(b.WEDGED_SOLID_INV,b.WEDGED_HOLLOW_INV);break;case d.DOWN:a.unshift(b.WEDGED_HASHED,b.DASHED);break;case d.DOWN_INVERTED:a.unshift(b.WEDGED_HASHED_INV,b.DASHED);break;case d.UP_OR_DOWN:case d.UP_OR_DOWN_INVERTED:a=[b.WAVY,b.SINGLE];break;default:}return a;break;default:return[b.SINGLE,b.DASHED,b.ARROWED,b.WAVY]}},getDefBondRenderType:function(c){var b=Kekule.Render.ConnectorDrawUtils.getPossibleBondRenderTypes(c);return b[0]},getConnectorRender3DType:function(a,d){var b=Kekule.Render.Bond3DRenderType;var c=Kekule.Render.Bond3DRenderMode;if(d&&((d===c.WIRE)||(d===c.CYLINDER))){return b.SINGLE}else{if(a instanceof Kekule.Bond){return Kekule.Render.ConnectorDrawUtils.getBondRender3DTypes(a)}else{return b.SINGLE}}},getBondRender3DTypes:function(d){var a=Kekule.Render.Bond3DRenderType;var b=Kekule.BondType;var e=d.getBondType();switch(e){case b.HYDROGEN:return a.DASH;break;case b.COVALENT:break;default:return a.SINGLE}var c=Kekule.BondOrder;switch(d.getBondOrder()){case c.DOUBLE:return a.DOUBLE;break;case c.TRIPLE:return a.TRIPLE;break;case c.EXPLICIT_AROMATIC:return a.SOLID_DASH;break;default:return a.SINGLE}}};Kekule.Render.ObjUtils={getContainerBox:function(f,c,a){if(!c){c=Kekule.CoordMode.COORD2D}var b;var d=f;if(d.getExposedContainerBox){b=d.getExposedContainerBox(c,a)}else{if(d.getContainerBox){b=d.getContainerBox(c,a)}else{var e=d.getAbsCoordOfMode?d.getAbsCoordOfMode(c):null;b=e?Kekule.BoxUtils.createBox(e,e):null}}return b}};Kekule.Render.MetaShapeUtils={createShapeInfo:function(c,d,b){var a={};a.shapeType=c;a.coords=d;if(b){a=Object.extend(a,b)}return a},isCompositeShape:function(a){return DataType.isArrayValue(a)},inflateShape:function(f,h){if(!f){return null}var c=Kekule.Render.MetaShapeType;var a=Kekule.Render.MetaShapeUtils;if(a.isCompositeShape(f)){var n=[];for(var e=0,b=f.length;e<b;++e){var m=f[e];var d=a.inflateShape(m,h);n.push(d)}return n}var g;switch(f.shapeType){case c.POINT:g=a._inflatePointShape(f,h);break;case c.CIRCLE:g=a._inflateCircleShape(f,h);break;case c.LINE:g=a._inflateLineShape(f,h);break;case c.RECT:g=a._inflateRectShape(f,h);break;case c.POLYGON:g=a._inflatePolygonShape(f,h);break}return g},_inflatePointShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[b.coords[0]],{radius:c});return a},_inflateCircleShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.CIRCLE,[b.coords[0]],{radius:b.radius+c});return a},_inflateLineShape:function(b,c){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.LINE,[b.coords[0],b.coords[1]],{width:(b.width||0)+c*2});return a},_inflateRectShape:function(b,d){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.RECT,[]);var c=Kekule.Render.MetaShapeUtils._inflateCoords(b.coords,d);a.coords=c;return a},_inflatePolygonShape:function(b,d){var a=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.BoundShapeType.POLYGON,[]);var c=Kekule.Render.MetaShapeUtils._inflateCoords(b.coords,d);a.coords=c;return a},_inflateCoords:function(h,o){var c=Kekule.CoordUtils;var p=[];var a=c.getCenter(h);for(var f=0,e=h.length;f<e;++f){var g=h[f];var d=c.substract(g,a);var b=c.getDistance(g);var n=c.multiply(d,o/b);var m=c.add(g,n);p.push(m)}return p},isCoordInside:function(f,h,m){if(Kekule.Render.MetaShapeUtils.isCompositeShape(h)){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(Kekule.Render.MetaShapeUtils.isCoordInside(f,b,m)){return true}}return false}else{var d=Kekule.Render.MetaShapeType;var a=Kekule.Render.MetaShapeUtils;var g=m?a.inflateShape(h,m):h;switch(h.shapeType){case d.POINT:return(m?a._isInsideCircle(f,g):a._isInsidePoint(f,g));case d.CIRCLE:return a._isInsideCircle(f,g);case d.LINE:return a._isInsideLine(f,g);case d.RECT:return a._isInsideRect(f,g);case d.POLYGON:return a._isInsidePolygon(f,g);default:return false}}},_isInsidePoint:function(b,a){return Kekule.CoordUtils.isEqual(b,a.coords[0])},_isInsideCircle:function(e,c){var b=Kekule.CoordUtils;var a=b.getDistance(e,c.coords[0]);return(a<=c.radius)},_isInsideLine:function(f,i){var g=i.coords;var e=Kekule.Render.MetaShapeUtils._calcVerticalLineCrossPoint(f,g[0],g[1]);var h;var b=Kekule.NumUtils;if(b.isFloatEqual(g[0].x,g[1].x)&&b.isFloatEqual(g[0].y,g[1].y)){var d={coords:[i.coords[0]],radius:i.width};var l=Kekule.Render.MetaShapeUtils._isInsideCircle(f,d);return l}else{var c=Kekule.CoordUtils.substract(g[1],g[0]);if(Math.abs(c.y)>Math.abs(c.x)){h=(Math.sign(e.y-g[0].y)*Math.sign(e.y-g[1].y)<=0)}else{h=(Math.sign(e.x-g[0].x)*Math.sign(e.x-g[1].x)<=0)}}if(!h){return false}else{var a=Kekule.CoordUtils.getDistance(f,e);return(a<=i.width/2)}},_isInsideRect:function(c,b){var a=b.coords;return Kekule.CoordUtils.insideRect(c,a[0],a[1])},_isInsidePolygon:function(f,o){var a=Kekule.CoordUtils;var m=o.coords;var c=0;for(var e=0,d=m.length;e<d;++e){var h=m[e];var g=m[(e+1)%d];var n=a.substract(g,h);if(n.x===0){continue}else{var b={x:f.x};b.y=((b.x-h.x)/n.x)*n.y+h.y;if(a.insideRect(b,h,g)){++c}}}return(c%2===0)},_calcVerticalLineCrossPoint:function(e,c,b){var a={};if(Math.abs(c.x-b.x)<1e-10){a.x=c.x;a.y=e.y}else{var d=(b.y-c.y)/(b.x-c.x);a.x=(d*d*c.x+d*(e.y-c.y)+e.x)/(d*d+1);a.y=d*(a.x-c.x)+c.y}return a},getContainerBox:function(p,o){var d=Kekule.Render.MetaShapeType;var c=Kekule.Render.MetaShapeUtils;var a=Kekule.BoxUtils;var m=p.coords;o=o||0;var q;if(c.isCompositeShape(p)){q=null;for(var f=0,b=p.length;f<b;++f){var e=p[f];var n=c.getContainerBox(e);if(!q){q=n}else{q=a.getContainerBox(q,n)}}}else{switch(p.shapeType){case d.POINT:case d.CIRCLE:var h=(p.shapeType===d.POINT)?0:(p.radius||0);var g=m[0];q=a.createBox({x:g.x-h,y:g.y-h},{x:g.x+h,y:g.y+h});break;case d.LINE:var q=a.createBox(m[0],m[1]);q=Kekule.BoxUtils.inflateBox(q,(p.width||0)/2);break;case d.RECT:q=a.createBox(m[0],m[1]);break;case d.POLYGON:q=a.createBox(m[0],m[0]);for(var f=1,b=m.length;f<b;++f){var g=m[f];q={x1:Math.min(q.x1,g.x),y1:Math.min(q.y1,g.y),x2:Math.max(q.x2,g.x),y2:Math.max(q.y2,g.y)}}break}}if(o){q=Kekule.BoxUtils.inflateBox(q,o)}return q},isInsideBox:function(c,b){var a=Kekule.Render.MetaShapeUtils.getContainerBox(c);return Kekule.BoxUtils.isInside(a,b)},isIntersectingBox:function(g,d){if(U.isCompositeShape(g)){for(var c=0,b=g.length;c<b;++c){var f=g[c];var a=Kekule.Render.MetaShapeUtils.isIntersectingBox(f,d);if(a){return true}}}else{var e=g.coords;for(var c=0,b=e.length;c<b;++c){var h=e[c];if(Kekule.CoordUtils.isInsideBox(h,d)){return true}}return false}}};Kekule.Render.RenderOptionUtils={mergeObjLocalRenderOptions:function(c,a){var b=(c&&c.getOverriddenRenderOptions)?c.getOverriddenRenderOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(b||{},a)},mergeObjLocalRender3DOptions:function(c,a){var b=(c&&c.getOverriddenRender3DOptions)?c.getOverriddenRender3DOptions():null;return Kekule.Render.RenderOptionUtils.mergeRenderOptions(b||{},a)},mergeRenderOptions:function(c,b){var a=Object.create(b);a=Object.extend(a,c,true,true);return a},getColor:function(a){return a?a.color:null},getMoleculeDisplayType:function(a){return a?a.moleculeDisplayType:null},getNodeDisplayMode:function(a){return a?a.nodeDisplayMode:null},getHydrogenDisplayLevel:function(a){return a?a.hydrogenDisplayLevel:null},getShowCharge:function(a){return a?a.showCharge:null},getChargeDrawOptions:function(b){if(!b){return null}else{var c=["showCharge","chargeMarkType","chargeMarkFontSize","chargeMarkMargin","chargeMarkCircleWidth","color","opacity"];var a=Object.copyValues({},b,c);return a}},getNodeLabelDrawOptions:function(b){if(!b){return null}else{var c=["fontSize","fontFamily","supFontSizeRatio","subFontSizeRatio","superscriptOverhang","subscriptOversink","textBoxXAlignment","textBoxYAlignment","color","opacity"];var a=Object.copyValues({},b,c);return a}},getConnectorRenderType:function(a){return a?renderOption.renderType:null},getConnectorDrawParams:function(b){if(!b){return null}else{var c=["bondLineWidth","boldBondLineWidth","hashSpacing","multipleBondSpacingRatio","multipleBondSpacingAbs","multipleBondMaxAbsSpacing","bondArrowLength","bondArrowWidth","bondWedgeWidth","bondWedgeHashMinWidth","color","opacity"];var a=Object.copyValues({},b,c);return a}},convertConfigsToPlainHash:function(b){var a=Kekule.Render.RenderOptionUtils;if(b instanceof Kekule.Render.Render3DConfigs){return a.convert3DConfigsToPlainHash(b)}else{return a.convert2DConfigsToPlainHash(b)}},convert2DConfigsToPlainHash:function(b){var d=Kekule.ObjUtils;var a={};a._configs=b;var c=b.getGeneralConfigs().toHash();d.replacePropName(c,"drawOpacity","opacity");a=Object.extend(a,c);c=b.getMoleculeDisplayConfigs().toHash();d.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType");d.replacePropName(c,"defNodeDisplayMode","nodeDisplayMode");d.replacePropName(c,"defHydrogenDisplayLevel","hydrogenDisplayLevel");d.replacePropName(c,"defChargeMarkType","chargeMarkType");a=Object.extend(a,c);a.displayLabelConfigs=b.getDisplayLabelConfigs();c=b.getTextFontConfigs().toHash();a=Object.extend(a,c);c=b.getLengthConfigs().toHash();a=Object.extend(a,c);a.unitLength=a.unitLength||1;c=b.getColorConfigs().toHash();a=Object.extend(a,c);return a},convert3DConfigsToPlainHash:function(b){var d=Kekule.ObjUtils;var a={};a._configs=b;var c=b.getGeneralConfigs().toHash();d.replacePropName(c,"drawOpacity","opacity");a=Object.extend(a,c);var c=b.getEnvironmentConfigs().toHash();a=Object.extend(a,c);var c=b.getMoleculeDisplayConfigs().toHash();d.replacePropName(c,"defMoleculeDisplayType","moleculeDisplayType");d.replacePropName(c,"defBondSpliceMode","bondSpliceMode");d.replacePropName(c,"defDisplayMultipleBond","displayMultipleBond");d.replacePropName(c,"defBondColor","bondColor");d.replacePropName(c,"defAtomColor","atomColor");a=Object.extend(a,c);var c=b.getModelConfigs().toHash();a=Object.extend(a,c);var c=b.getLengthConfigs().toHash();a=Object.extend(a,c);return a},getCascadeRenderOptionValueOfObjs:function(n,g,c){var o;var h=false;var f=Kekule.ArrayUtils.toArray(n);var a=c?"getCascadedRender3DOption":"getCascadedRenderOption";for(var e=0,b=f.length;e<b;++e){var d=f[e];if(d[a]){var m=d[a](g);if(!h){o=m;h=true}else{if(o!=m){return null}}}}return o},setRenderOptionValueOfObjs:function(m,o,c){var g=Kekule.ArrayUtils.toArray(m);var h=c?"setRenderOption":"setRenderOption";for(var f=0,a=g.length;f<a;++f){var e=g[f];if(e[h]){var n=Kekule.ObjUtils.getOwnedFieldNames(o);for(var d=0,b=n.length;d<b;++d){e[h](n[d],o[n[d]])}}}}};Kekule.Render.Render3DOptionUtils={getConnectorRenderType:function(a){return a?a.renderType:null},convertConfigsToPlainHash:function(a){}};Kekule.Render.RenderColorUtils={getActiveAtomColorSet:function(a){return Kekule.Render.atomColors[a]},setActiveAtomColorSet:function(b,a){var c=Kekule.Render.AtomColorSets[b];if(c){Kekule.Render.atomColorSet[a]=c}return c},getColor:function(a,b){var c=Kekule.Render.RenderColorUtils.getActiveAtomColorSet(b);var d=c[a];if(!d){d=c[0]}return d}};Kekule.Render.UpdateObjUtils={_extractObjsOfUpdateObjDetails:function(e){var a=[];for(var c=0,b=e.length;c<b;++c){var d=e[c];if(d.obj){Kekule.ArrayUtils.pushUnique(a,d.obj)}}return a},_createUpdateObjDetailsFromObjs:function(b){var a=[];for(var d=0,c=b.length;d<c;++d){a.push({obj:b[d]})}return a}};Kekule.Render.RendererDefineUtils={CompositeObjRendererMethods:{finalize:function($super){this.reset();$super()},doEstimateObjBox:function(c,n,e){var o=null;var d=this.prepareChildRenderers();var g=Kekule.BoxUtils;for(var h=0,f=d.length;h<f;++h){var a=d[h];if(a){var m=a.estimateObjBox(c,n,e);if(m){if(!o){o=Object.extend({},m)}else{o=g.getContainerBox(o,m)}}}}return o},isChemObjRenderedBySelf:function($super,b,d){var h=$super(b,d);if(!h){var g=this.getChildRenderers();for(var e=0,c=g.length;e<c;++e){var a=g[e];if(a.isChemObjRenderedBySelf(b,d)){return true}}}if(!h){this.refreshChildObjs();var f=this.getTargetChildObjs();h=(f.indexOf(d)>=0)}return h},isChemObjRenderedDirectlyBySelf:function($super,a,b){return $super(a,b)},getChildObjs:function(){return null},prepareChildObjs:function(){var a=this.getTargetChildObjs();if(a){return a}this.setTargetChildObjs(this.getChildObjs());return this.getTargetChildObjs()},refreshChildObjs:function(){this.setTargetChildObjs(null);this.prepareChildObjs()},getChildRenderers:function(){return this.getChildRendererMap().getValues()},getRendererForChild:function(g,f){var b=(this.getRendererType()===Kekule.Render.RendererType.R3D)?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass;var e=this.getChildRendererMap();var a=e.get(g);if(!a&&f){var d=b(g);var a=d?new d(g,this.getDrawBridge(),this):null;e.set(g,a);a.setRedirectContext(this.getRedirectContext())}return a},prepareChildRenderers:function(){var g=this.getChildRendererMap();var d=this.prepareChildObjs()||[];var c=g.getKeys();for(var b=0,a=c.length;b<a;++b){var e=c[b];if(d.indexOf(e)<0){g.remove(e)}}for(var b=0,a=d.length;b<a;++b){var f=d[b];this.getRendererForChild(f,true)}return g.getValues()},releaseChildRenderers:function(){var d=this.getChildRendererMap();var b=d.getValues();if(!b){return}for(var c=0,a=b.length;c<a;++c){b[c].finalize()}d.clear()},prepare:function(){this.prepareChildObjs();this.prepareChildRenderers()},reset:function(){this.setTargetChildObjs(null);this.releaseChildRenderers()},doDraw:function($super,b,c,a){this.prepare();$super(b,c,a);return this.doDrawCore(b,a)},doDrawCore:function(b,n){var m=this.createDrawGroup(b);var h=this.getChildRenderers();var c=Object.create(n);this.getRenderCache(b).childDrawOptions=c;for(var f=0,e=h.length;f<e;++f){var a=h[f];var g=null;var d=a.draw(b,g,c);if(m&&d){this.addToDrawGroup(d,m)}}return m},doClear:function(d){var b=this.getChildRendererMap().getValues();for(var c=0,a=b.length;c<a;++c){b[c].clear(d)}return true},doUpdate:function(b,A,g){var B=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(A);var d=this.getTargetChildObjs();var a=this.getChildRendererMap();var f=Kekule.ArrayUtils.toArray(B);var n=new Kekule.MapEx(false);var C=[];var D=false;for(var w=0,t=f.length;w<t;++w){var m=f[w];if(this.isChemObjRenderedDirectlyBySelf(b,m)){D=true}}if(D){this.doClear(b);this.redraw(b);return true}for(var w=0,t=f.length;w<t;++w){var m=f[w];var s=a.get(m);if(s){if(g===Kekule.Render.ObjectUpdateType.REMOVE){s.clear();a.remove(m)}else{Kekule.ArrayUtils.pushUnique(C,s);z=[m];n.set(s,z)}}else{var e=this._getRenderersForChildObj(b,m);if(!e.length){if(d.indexOf(m)>=0){var p=this.getRendererForChild(m,true);var c=p.draw(b,null,this.getRenderCache(b).childDrawOptions);if(c){var y=this.getCachedDrawnElem(b);if(y){this.addToDrawGroup(c,y)}}}}for(var v=0,u=e.length;v<u;++v){var s=e[v];var z=n.get(s);if(!z){C.push(s);z=[];n.set(s,z)}z.push(m)}}}var h=true;for(var w=0,t=C.length;w<t;++w){var s=C[w];var q=n.get(s);var x=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(q);var p=s.update(b,x,g);h=h&&p}var h=C&&C.length>0;if(!h){h=true}return h},_getRenderersForChildObj:function(e,g){var a=[];var c=this.getChildRenderers();for(var d=0,b=c.length;d<b;++d){var f=c[d];if(f.isChemObjRenderedBySelf(e,g)){a.push(f)}}return a}},addCompositeRenderSupport:function(a){ClassEx.defineProp(a,"targetChildObjs",{dataType:DataType.ARRAY,serializable:false});ClassEx.defineProp(a,"childRendererMap",{dataType:DataType.OBJECT,serializable:false,getter:function(){var b=this.getPropStoreFieldValue("childRendererMap");if(!b){b=new Kekule.MapEx(true);this.setPropStoreFieldValue("childRendererMap",b)}return b}});ClassEx.extend(a,Kekule.Render.RendererDefineUtils.CompositeObjRendererMethods)}};(function(){var a=Kekule.OBJDEF_TEXTS;var b=Class.PropertyScope;Kekule.Render.PredefinedConfigsMap=Class.create(Kekule.ConfigPresetMap,{CLASS_NAME:"Kekule.Render.PredefinedConfigsMap"});Kekule.Render.GeneralConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.GeneralConfigs",initProperties:function(){this.addBoolConfigProp("allowCoordBorrow",true,{scope:b.PUBLIC});this.addFloatConfigProp("drawOpacity",1,{title:a.TITLE_DRAWOPACITY,description:a.DES_DRAWOPACITY})}});Kekule.Render.Render2DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render2DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs");this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.MoleculeDisplayConfigs");this.addConfigProp("displayLabelConfigs","Kekule.Render.DisplayLabelConfigs");this.addConfigProp("textFontConfigs","Kekule.Render.TextFontConfigs");this.addConfigProp("lengthConfigs","Kekule.Render.LengthConfigs");this.addConfigProp("colorConfigs","Kekule.Render.ColorConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs());this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.MoleculeDisplayConfigs());this.setPropStoreFieldValue("displayLabelConfigs",new Kekule.Render.DisplayLabelConfigs());this.setPropStoreFieldValue("textFontConfigs",new Kekule.Render.TextFontConfigs());this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.LengthConfigs());this.setPropStoreFieldValue("colorConfigs",new Kekule.Render.ColorConfigs())},initInteractStyleMap:function(){}});Kekule.ClassUtils.makeSingleton(Kekule.Render.Render2DConfigs);Kekule.Render.getRender2DConfigs=function(){return Kekule.Render.Render2DConfigs.getInstance()};Kekule.Render.MoleculeDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.MoleculeDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.MoleculeDisplayType.SKELETAL,{enumSource:Kekule.Render.MoleculeDisplayType});this.addIntConfigProp("defNodeDisplayMode",Kekule.Render.NodeLabelDisplayMode.SMART,{enumSource:Kekule.Render.NodeLabelDisplayMode});this.addIntConfigProp("defHydrogenDisplayLevel",Kekule.Render.HydrogenDisplayLevel.EXPLICIT,{enumSource:Kekule.Render.HydrogenDisplayLevel});this.addIntConfigProp("defChargeMarkType",Kekule.Render.ChargeMarkRenderType.DEFAULT,{enumSource:Kekule.Render.ChargeMarkRenderType});this.addIntConfigProp("partialChargeDecimalsLength",2)}});Kekule.Render.DisplayLabelConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.DisplayLabelConfigs",DEF_UNSET_ELEMENT:"?",DEF_DUMMY_ATOM:"Du",DEF_HETERO_ATOM:"Q",DEF_ANY_ATOM:"A",DEF_VARIABLE_ATOM:"L",DEF_RGROUP:"R",DEF_ISO_LIST_LEADING_BRACKET:"[",DEF_ISO_LIST_TAILING_BRACKET:"]",DEF_ISO_LIST_DELIMITER:",",DEF_ISO_LIST_DISALLOW_PREFIX:"NOT",initProperties:function(){this.addStrConfigProp("unsetElement",this.DEF_UNSET_ELEMENT);this.addStrConfigProp("dummyAtom",this.DEF_DUMMY_ATOM);this.addStrConfigProp("heteroAtom",this.DEF_HETERO_ATOM);this.addStrConfigProp("anyAtom",this.DEF_ANY_ATOM);this.addStrConfigProp("variableAtom",this.DEF_VARIABLE_ATOM);this.addStrConfigProp("rgroup",this.DEF_RGROUP);this.addStrConfigProp("isoListLeadingBracket",this.DEF_ISO_LIST_LEADING_BRACKET);this.addStrConfigProp("isoListTailingBracket",this.DEF_ISO_LIST_TAILING_BRACKET);this.addStrConfigProp("isoListDelimiter",this.DEF_ISO_LIST_DELIMITER);this.addStrConfigProp("isoListDisallowPrefix",this.DEF_ISO_LIST_DISALLOW_PREFIX)}});Kekule.Render.TextFontConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.TextFontConfigs",DEF_LABEL_FONT_FAMILY:"",initProperties:function(){this.addStrConfigProp("labelFontFamily","Arial, Helvetica, sans-serif");this.addStrConfigProp("atomFontFamily","Arial, Helvetica, sans-serif");this.addFloatConfigProp("supFontSizeRatio",0.66);this.addFloatConfigProp("subFontSizeRatio",0.66);this.addFloatConfigProp("superscriptOverhang",0.2);this.addFloatConfigProp("subscriptOversink",0.2);this.addIntConfigProp("textCharDirection",Kekule.Render.TextDirection.LTR,{enumSource:Kekule.Render.TextDirection});this.addIntConfigProp("textHorizontalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign});this.addIntConfigProp("textVerticalAlign",Kekule.Render.TextAlign.LEADING,{enumSource:Kekule.Render.TextAlign});this.addIntConfigProp("textBoxXAlignment",Kekule.Render.BoxXAlignment.LEFT,{enumSource:Kekule.Render.BoxXAlignment,scope:b.PUBLIC});this.addIntConfigProp("textBoxYAlignment",Kekule.Render.BoxYAlignment.TOP,{enumSource:Kekule.Render.BoxYAlignment,scope:b.PUBLIC});this.addIntConfigProp("textBoxAlignmentMode",Kekule.Render.TextBoxAlignmentMode.ANCHOR,{enumSource:Kekule.Render.TextBoxAlignmentMode,scope:b.PUBLIC})}});Kekule.Render.LengthConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.LengthConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:b.PUBLIC});this.addFloatConfigProp("labelFontSize",14);this.addFloatConfigProp("atomFontSize",14);this.addFloatConfigProp("atomLabelBoxExpandRatio",1.2,{scope:b.PUBLIC});this.addFloatConfigProp("chargeMarkFontSize",10);this.addFloatConfigProp("chargeMarkMargin",5);this.addFloatConfigProp("defBondLength",30);this.addFloatConfigProp("bondLineWidth",1);this.addFloatConfigProp("boldBondLineWidthRatio",2,{scope:b.PUBLIC});this.addFloatConfigProp("hashSpacing",3);this.addFloatConfigProp("multipleBondSpacingRatio",0.18);this.addFloatConfigProp("multipleBondSpacingAbs",null,{scope:b.PUBLIC});this.addFloatConfigProp("multipleBondMaxAbsSpacing",5);this.addFloatConfigProp("bondArrowLength",6);this.addFloatConfigProp("bondArrowWidth",6);this.addFloatConfigProp("bondWedgeWidth",6);this.addFloatConfigProp("bondWedgeHashMinWidth",2);this.addFloatConfigProp("bondWavyRadius",5);this.addFloatConfigProp("glyphStrokeWidth",1);this.addFloatConfigProp("rxnMolMargin",10,{scope:b.PUBLIC});this.addFloatConfigProp("autofitContextPadding",20)},getActualLength:function(d){var c=this.getPropValue(d);if((c!==null)&&(c!==undefined)){return c*this.getUnitLength()}else{return null}}});Kekule.Render.ColorConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.ColorConfigs",initProperties:function(){this.addBoolConfigProp("useAtomSpecifiedColor",false);this.addStrConfigProp("labelColor","#000000");this.addStrConfigProp("atomColor","#000000");this.addStrConfigProp("bondColor","#000000");this.addStrConfigProp("glyphStrokeColor","#999999");this.addStrConfigProp("glyphFillColor","#999999")}});Kekule.Render.Render3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DConfigs",initProperties:function(){this.addConfigProp("generalConfigs","Kekule.Render.GeneralConfigs");this.addConfigProp("moleculeDisplayConfigs","Kekule.Render.Molecule3DDisplayConfigs");this.addConfigProp("lengthConfigs","Kekule.Render.Length3DConfigs");this.addConfigProp("environmentConfigs","Kekule.Render.Render3DEnvironmentConfigs");this.addConfigProp("modelConfigs","Kekule.Render.Model3DConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("generalConfigs",new Kekule.Render.GeneralConfigs());this.setPropStoreFieldValue("environmentConfigs",new Kekule.Render.Render3DEnvironmentConfigs());this.setPropStoreFieldValue("moleculeDisplayConfigs",new Kekule.Render.Molecule3DDisplayConfigs());this.setPropStoreFieldValue("modelConfigs",new Kekule.Render.Model3DConfigs());this.setPropStoreFieldValue("lengthConfigs",new Kekule.Render.Length3DConfigs())}});Kekule.ClassUtils.makeSingleton(Kekule.Render.Render3DConfigs);Kekule.Render.getRender3DConfigs=function(){return Kekule.Render.Render3DConfigs.getInstance()};Kekule.Render.Render3DEnvironmentConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Render3DEnvironmentConfigs",initProperties:function(){this.addIntConfigProp("graphicQuality",Kekule.Render.Render3DGraphicQuality.MEDIUM,{enumSource:Kekule.Render.Render3DGraphicQuality})}});Kekule.Render.Molecule3DDisplayConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Molecule3DDisplayConfigs",initProperties:function(){this.addIntConfigProp("defMoleculeDisplayType",Kekule.Render.Molecule3DDisplayType.BALL_STICK,{enumSource:Kekule.Render.Molecule3DDisplayType});this.addIntConfigProp("defBondSpliceMode",Kekule.Render.Bond3DSpliceMode.WEIGHTING_SPLIT,{enumSource:Kekule.Render.Bond3DSpliceMode});this.addBoolConfigProp("defDisplayMultipleBond",true);this.addStrConfigProp("defBondColor","#FFFFFF");this.addStrConfigProp("defAtomColor","#000099");this.addBoolConfigProp("useAtomSpecifiedColor",true)}});Kekule.Render.Model3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Model3DConfigs",initProperties:function(){this.addBoolConfigProp("showNodeLabel",true,{scope:b.PUBLIC});this.addBoolConfigProp("hideHydrogens",false);this.addBoolConfigProp("useVdWRadius",true);this.addFloatConfigProp("nodeRadiusRatio",0.25,{scope:b.PUBLIC});this.addFloatConfigProp("connectorRadiusRatio",0.25,{scope:b.PUBLIC});this.addFloatConfigProp("multiConnectorRadiusRatio",0.5);this.addFloatConfigProp("multiConnectorMarginRatio",1)}});Kekule.Render.Length3DConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Render.Length3DConfigs",initProperties:function(){this.addFloatConfigProp("unitLength",1,{scope:b.PUBLIC});this.addFloatConfigProp("fixedNodeRadius",1.7);this.addFloatConfigProp("connectorRadius",0.6);this.addFloatConfigProp("connectorLineWidth",2);this.addFloatConfigProp("defBondLength",100,{scope:b.PUBLIC})},getActualLength:function(d){var c=this.getPropValue(d);if((c!==null)&&(c!==undefined)){return c*this.getUnitLength()}else{return null}}})})();(function(){var c=Kekule.Render.RichText;var e=Kekule.Render.RichTextUtils;var b=Kekule.Render.TextDirection;var a=Kekule.Render.TextDrawUtils;var d=Kekule.Render.TextAlign;Kekule.Render.AbstractTextDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.AbstractTextDrawBridge",drawText:function(g,i,h,f){return null},canMeasureText:function(f){return false},measureText:function(g,h,f){return{}},canMeasureDrawnText:function(f){return false},measureDrawnText:function(g,h,f){return{}},canModifyText:function(f){return false},modifyDrawnTextCoord:function(g,h,f){},createGroup:function(f){},addToGroup:function(f,g){},removeFromGroup:function(f,g){}});Kekule.Render.BaseRichTextDrawer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BaseRichTextDrawer",ITEM_PARENT_FIELD:"__$parent__",initialize:function($super,h,g,f){$super();this.options=g||{};if(h){this.setDrawBridge(h)}if(f){this.setDrawConfigs(f)}},initProperties:function(){this.defineProp("drawBridge",{dataType:"Kekule.Render.AbstractTextDrawBridge",serializable:false});this.defineProp("drawConfigs",{dataType:"Kekule.Render.Render2DConfigs",serializable:false})},fillOptions:function(f){if(f){var h=f.getTextFontConfigs();var g=this.options;g.supFontSizeRatio=h.getSupFontSizeRatio();g.subFontSizeRatio=h.getSubFontSizeRatio();g.superscriptOverhang=h.getSuperscriptOverhang();g.subscriptOversink=h.getSubscriptOversink();g.textCharDirection=h.getTextCharDirection();g.textLineDirection=h.getTextLineDirection();g.textHorizontalAlign=h.getTextHorizontalAlign();g.textVerticalAlign=h.getTextVerticalAlign();g.textBoxXAlignment=h.getTextBoxXAlignment();g.textBoxYAlignment=h.getTextBoxYAlignment();g.textBoxAlignmentMode=h.getTextBoxAlignmentMode()}},cloneRichText:function(f){return Kekule.Render.RichTextUtils.clone(f)},_FONT_OPTION_FIELDS:["fontSize","fontFamily","fontWeight","fontStyle","color","overhang","oversink","opacity","zoom"],_DRAW_OPTIONS_FIELDS:["textType","charDirection","fontSize","fontFamily","fontWeight","fontStyle","color","horizontalAlign","verticalAlign","zoom"],_fillLocalDrawOptions:function(h,m){var f=m||{};var o=0;for(var n=0,g=this._DRAW_OPTIONS_FIELDS.length;n<g;++n){var q=this._DRAW_OPTIONS_FIELDS[n];var p=h[q];if(Kekule.ObjUtils.notUnset(p)){f[q]=p;++o}}return f},RECT_INFO_FIELD:"__rectInfo__",ACTUAL_FONT_FIELD:"__drawFont__",RENDER_TEXT_FIELD:"__renderText__",RENDER_ELEM_FIELD:"__renderElem__",LOCAL_DRAW_OPTIONS_FIELD:"__drawOptions__",_setItemRectInfo:function(g,f,h){g[this.RECT_INFO_FIELD]={boundRect:Object.extend({},f),alignRect:Object.extend({},h)}},_getItemRectInfo:function(f){return f[this.RECT_INFO_FIELD]},_setActualFontInfo:function(f,g){f[this.ACTUAL_FONT_FIELD]=g},_getActualFontInfo:function(f){return f[this.ACTUAL_FONT_FIELD]},_setRenderText:function(f,g){f[this.RENDER_TEXT_FIELD]=g},_getRenderText:function(f){return f[this.RENDER_TEXT_FIELD]||f.text},_setRenderElem:function(f,g){f[this.RENDER_ELEM_FIELD]=g},_getRenderElem:function(f){return f[this.RENDER_ELEM_FIELD]},_itemHasNoAlignRect:function(g){var f=Kekule.ObjUtils.notUnset(g._noAlignRect)?(!!g._noAlignRect):(e.isSubscript(g)||e.isSuperscript(g));return f},drawEx:function(i,o,h,s,p){var l;if(!s){l=this.options}else{l=Object.create(this.options||{});l=Object.extend(l,s)}var m=this.cloneRichText(h);var n=this.getDrawBridge();var g={delayDrawing:n.canMeasureText(),adjustDrawing:n.canModifyText()};this.doPrepare(i,o,m,l,g);var f=this.doRenderRichText(i,m,l,g);var q=this._getItemRectInfo(m).boundRect;var r={drawnObj:f,boundRect:q};return r},draw:function(h,l,i,g,f){return this.drawEx(h,l,i,g,f).drawnObj},doPrepare:function(l,p,i,s,h){var t=this.doPrepareItem(l,i,s,h);var m=null;if(s.textBoxAlignmentMode===Kekule.Render.TextBoxAlignmentMode.ANCHOR){m=this.doGetRootAnchorItemAbsAlignRect(i)}var g=this._getItemRectInfo(i);var r;if(m){var q=this.doAlignRectToCoord(p,m,s.textBoxXAlignment,s.textBoxYAlignment);r={x:q.left-m.left,y:q.top-m.top}}else{var n=this.doAlignRectToCoord(p,g.alignRect,s.textBoxXAlignment,s.textBoxYAlignment);r={x:n.left-g.alignRect.left,y:n.top-g.alignRect.top}}var o=Kekule.RectUtils.shiftRect(g.alignRect,r.x,r.y);var f=Kekule.RectUtils.shiftRect(g.boundRect,r.x,r.y);this._setItemRectInfo(i,f,o);return t},doAlignRectToCoord:function(i,o,f,n){var m=Kekule.Render.BoxXAlignment;var g=Kekule.Render.BoxYAlignment;var l=(f===m.RIGHT)?-1:(f===m.CENTER)?-0.5:0;var h=(n===g.TOP)?0:(n===g.CENTER)?-0.5:-1;var p=Object.extend({},o);p.left=i.x+p.width*l;p.top=i.y+p.height*h;return p},doGetRootAnchorItemAbsAlignRect:function(g){var h=g;if(h.anchorItem){var f=this._getItemRectInfo(h).alignRect;var i={x:f.left,y:f.top};while(h.anchorItem){h=h.anchorItem;f=this._getItemRectInfo(h).alignRect;i.x+=f.left;i.y+=f.top}return Kekule.RectUtils.createRect(i.x,i.y,f.width,f.height)}else{return null}},doCalcActualDrawFontInfo:function(h,n){var f={sizeScale:1};for(var m=0,g=this._FONT_OPTION_FIELDS.length;m<g;++m){var o=this._FONT_OPTION_FIELDS[m];if(Kekule.ObjUtils.notUnset(n[o])){f[o]=n[o]}}f.fontSize*=(n.zoom||1);if(e.isSuperscript(h)){f.sizeScale=n.supFontSizeRatio;f.fontSize*=n.supFontSizeRatio;f.isSup=true;if(Kekule.ObjUtils.isUnset(f.overhang)){f.overhang=n.superscriptOverhang||0}}else{if(e.isSubscript(h)){f.sizeScale=n.subFontSizeRatio;f.fontSize*=n.subFontSizeRatio;f.isSub=true;if(Kekule.ObjUtils.isUnset(f.oversink)){f.oversink=n.subscriptOversink||0}}}return f},doPrepareItem:function(h,l,g,m){var n=e.getItemType(l);var i=Object.create(g);i=this._fillLocalDrawOptions(l,i);var f;switch(n){case c.SECTION:f=this.doPrepareSection(h,l,i,m);break;case c.LINES:f=this.doPrepareLines(h,l,i,m);break;default:f=this.doPrepareGroup(h,l,i,m);break}return f},doPrepareSection:function(g,s,x,f){var m=this.getDrawBridge();var n=this.doCalcActualDrawFontInfo(s,x);this._setActualFontInfo(s,n);var v=s.text;if(a.isVerticalLine(x.charDirection)&&(v.length>1)){var u=s;u.role="group";delete u.text;u.charDirection=x.charDirection;var r=Object.create(x);r=Object.extend(r,n);u.items=[];for(var p=0,h=v.length;p<h;++p){e.appendText(u,v.charAt(p))}return this.doPrepareItem(g,u,r,f)}if(x.charDirection===b.RTL){v=v.reverse()}this._setRenderText(s,v);var q;if(f.delayDrawing){q=m.measureText(g,v,n)}else{var o={x:-10000,y:-10000};var t=this.getDrawBridge().drawText(g,o,v,n);this._setRenderElem(s,t);q=m.measureDrawnText(g,t,n)}var w={left:0,top:0,width:q.width||0,height:q.height||0};this._setItemRectInfo(s,w,w)},doPrepareLines:function(g,q,s,f){var h=s.charDirection||b.DEFAULT;var p=q.items;var n=(h===b.TTB)?b.RTL:(h===b.BTT)?b.LTR:b.TTB;for(var o=0,m=p.length;o<m;++o){var r=p[o];if(!r.charDirection){r.charDirection=h}}q.charDirection=n;s.charDirection=n;s._originCharDirection=h;return this.doPrepareGroup(g,q,s,f)},doPrepareGroup:function(m,w,o,D){var B=w.items;if(B.length<=0){return null}for(var H=0,E=B.length;H<E;++H){var N=B[H];this.doPrepareItem(m,N,o,D)}var R=o.charDirection||b.DEFAULT;var v=o._originCharDirection||R;var s=a.isHorizontalLine(R);var p=s?"x":"y";var h=s?"y":"x";var g;var F=d.getAbsAlign(o.horizontalAlign,v);var z=d.getAbsAlign(o.verticalAlign,v);if(s){g=(z==d.TOP)?0:(z==d.CENTER)?-0.5:-1}else{g=(F==d.RIGHT)?-1:(F==d.CENTER)?-0.5:0}var q={x:0,y:0};var u=((R===b.RTL)||(R===b.BTT))?-1:1;var J=s?"left":"top";var P=s?"top":"left";var y=[];for(var H=0,E=B.length;H<E;++H){var N=B[H];var n=this._getItemRectInfo(N);var f=n.boundRect;var C=n.alignRect;if(u>0){var I=q[p]-f[J];f[J]=q[p];C[J]+=I}var M={x:f.width,y:f.height};q[p]+=M[p]*u;if(u<0){var I=q[p]-f[J];f[J]=q[p];C[J]+=I}var M={x:C.width,y:C.height};var x=this._getActualFontInfo(N);if(x){isSupSub=x.isSup||x.isSub}else{isSupSub=false}if(isSupSub&&e.getActualRefItem(N,w)){y.push(N)}else{var L=x?(x.oversink||(-(x.overhang||0))):0;if(!s){L=-L}var K=M[h]*(g+L);var Q=C[P]-K;C[P]=K;f[P]-=Q}}for(var H=0,E=y.length;H<E;++H){var N=y[H];var A=e.getActualRefItem(N,w);var x=this._getActualFontInfo(N);var n=this._getItemRectInfo(N);var G=this._getItemRectInfo(A).alignRect;var f=n.boundRect;var C=n.alignRect;if(x.isSup){var O=x.overhang;if(s){C.top=G.top;C.height=G.height;f.top=G.top-G.height*O}else{C.left=G.left+G.width-f.left;C.width=G.width;f.left=C.left+G.width*O}}else{var L=x.oversink;if(s){C.top=G.top+G.height-f.height;C.height=G.height;f.top=C.top+G.height*L}else{C.left=G.left;C.width=G.width;f.left=G.left-G.width*L}}}var B=w.items;var t=null;var r=null;for(var H=0,E=B.length;H<E;++H){var N=B[H];n=this._getItemRectInfo(N);if((!this._itemHasNoAlignRect(N))||((!t)&&(H==E-1))){if(!t){t=Object.extend({},n.alignRect)}else{t=Kekule.RectUtils.getContainerRect(t,n.alignRect)}}if(!r){r=Object.extend({},n.boundRect)}else{r=Kekule.RectUtils.getContainerRect(r,n.boundRect)}}var Q={x:-t.left,y:-t.top};if((Q.x!==0)||(Q.y!==0)){for(var H=0,E=B.length;H<E;++H){n=this._getItemRectInfo(B[H]);n.alignRect=Kekule.RectUtils.shiftRect(n.alignRect,Q.x,Q.y);n.boundRect=Kekule.RectUtils.shiftRect(n.boundRect,Q.x,Q.y)}t.left=0;t.top=0;r.left+=Q.x;r.top+=Q.y}this._setItemRectInfo(w,r,t)},doRenderRichText:function(g,i,f,l){var m=this.getDrawBridge();var h=m.createGroup(g);this.doRenderItem(g,{x:0,y:0},i,l,h);return h},doRenderItem:function(g,m,i,l,h){var n=e.getItemType(i);var f;switch(n){case c.SECTION:f=this.doRenderSection(g,m,i,l,h);break;default:f=this.doRenderGroup(g,m,i,l,h);break}return f},doRenderGroup:function(g,q,r,f,p){var o=r.items;if(o.length<=0){return null}var s=this._getItemRectInfo(r);var n={x:q.x+s.alignRect.left,y:q.y+s.alignRect.top};for(var m=0,h=o.length;m<h;++m){this.doRenderItem(g,n,o[m],f,p)}},doRenderSection:function(i,q,s,h,p){var g=this._getItemRectInfo(s);var f=g.boundRect;var o={x:f.left,y:f.top};o=Kekule.CoordUtils.add(o,q);var r=this._getRenderText(s);var l=this._getActualFontInfo(s);var n=this.getDrawBridge();var m;if(h.delayDrawing){m=n.drawText(i,o,r,l)}else{if(h.adjustDrawing){m=this._getRenderElem(s);n.modifyDrawnTextCoord(i,m,o)}}n.addToGroup(m,p)}})})();Kekule.Render.BoundInfoRecorder=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.BoundInfoRecorder",initialize:function($super,a){$super();this.setPropStoreFieldValue("boundInfos",new Kekule.TwoTupleMapEx(true));this._renderer=a;this.installEventListener(a)},finalize:function($super){var a=this.getPropStoreFieldValue("boundInfos");if(a){a.clear()}$super()},initProperties:function(){this.defineProp("boundInfos",{dataType:"Kekule.TwoTupleMapEx",serializable:false,setter:null});this.defineProp("targetContext",{dataType:DataType.OBJECT,serializable:false})},needRecordOnContext:function(a){var b=this.getTargetContext();return(!b)||(b===a)},installEventListener:function(a){a.addEventListener("updateBasicDrawObject",function(d){var c=Kekule.Render.ObjectUpdateType;if(this.needRecordOnContext(d.context)){var b=d.updateType;if(b===c.ADD){this.add(d.context,d.obj,d.parentObj,d.boundInfo,d.target)}else{if(b===c.MODIFY){this.modify(d.context,d.obj,d.parentObj,d.boundInfo,d.target)}else{if(b===c.REMOVE){this.remove(d.context,d.obj)}else{if(b===c.CLEAR){this.clear(d.context)}}}}this.invokeEvent("updateBasicDrawObject",d)}},this);a.addEventListener("clear",function(b){if(this.needRecordOnContext(b.context)){this.clearOnRenderer(b.context,b.target)}var c=this.getAllRecordedInfoOfContext(b.context)},this)},getInfo:function(a,b){return this.getBoundInfos().get(a,b)},getBelongedInfos:function(e,b){var g=this.getInfo(e,b);if(g){return[g]}else{var a=[];var h=this.getAllRecordedInfoOfContext(e);for(var d=0,c=h.length;d<c;++d){var g=h[d];var f=g.obj;if(f.isChildOf(b)){a.push(g)}}return a}},getBound:function(b,g){var c=this.getInfo(b,g);var o=c?c.boundInfo:null;if(!o){var e=Kekule.BoxUtils;var m=Kekule.Render.MetaShapeUtils;var n=this.getBelongedInfos(b,g);var a=null;for(var f=0,d=n.length;f<d;++f){var c=n[f];var h=m.getContainerBox(c.boundInfo,0);a=a?e.getContainerBox(a,h):h}if(a){o=m.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:a.x1,y:a.y1},{x:a.x2,y:a.y2}])}}return o},clearOnRenderer:function(b,c){var h=this.getBoundInfos();var f=h.getSecondLevelMap(b);if(f){var g=f.getKeys();var h=f.getValues();for(var a=g.length-1;a>=0;--a){var e=g[a];var d=h[a];if(d.renderer===c){f.remove(e)}}}},clear:function(a){var c=this.getBoundInfos();var b=c.getSecondLevelMap(a);if(b){b.clear()}return this},clearAll:function(){this.getBoundInfos().clear();return this},add:function(b,e,d,a,c){this.getBoundInfos().set(b,e,{obj:e,parentObj:d,boundInfo:a,renderer:c});return this},modify:function(b,g,f,a,e){var c=this.getBoundInfos().get(b,g);if(!c){c={};this.getBoundInfos.set(b,g,c)}var d=Kekule.ObjUtils.notUnset;if(d(f)){c.parentObj=f}if(d(a)){c.boundInfo=a}if(d(e)){c.renderer=e}return this},remove:function(a,c,b){this.getBoundInfos().remove(a,c);return this},getAllRecordedInfoOfContext:function(a){var c=this.getBoundInfos();var b=c.getSecondLevelMap(a);if(!b){return[]}else{return b.values}},getAllBoundInfosOfContext:function(e){var f=this.getAllRecordedInfoOfContext(e);var a=[];for(var d=0,b=f.length;d<b;++d){var c=f[d].boundInfo;if(c){a.push(c)}}return a},getContainerBox:function(f){var d=Kekule.BoxUtils;var c=Kekule.Render.MetaShapeUtils;var a=null;var h=this.getAllBoundInfosOfContext(f);for(var e=0,b=h.length;e<b;++e){var g=c.getContainerBox(info[e],0);a=d.getContainerBox(a,g)}return a},getIntersectionInfos:function(a,e,h,g){var m=[];var f=this.getAllRecordedInfoOfContext(a);for(var d=0,b=f.length;d<b;++d){var c=f[d].boundInfo;if(c){if(Kekule.Render.MetaShapeUtils.isCoordInside(e,c,g)){m.push(f[d])}}}return m}});(function(){var b=Kekule.Render.BondRenderType;var c=Kekule.Render.TextDirection;var a=Kekule.BoxUtils;var d=Kekule.oneOf;Kekule.Render.Abstract2DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract2DDrawBridge",createContext:function(f,g,e){return null},releaseContext:function(e){},getContextDimension:function(e){return{}},setContextDimension:function(f,g,e){return null},getContextElem:function(e){},setContextViewBox:function(i,e,m,g,l,f){},clearContext:function(e){return null},transformContextCoordToScreen:function(e,f){return f},transformScreenCoordToContext:function(e,f){return f},canModifyGraphic:function(e){return false},drawPath:function(f,g,e){},drawLine:function(f,h,g,e){},drawTriangle:function(f,i,h,g,e){},drawRect:function(f,h,g,e){},drawRoundRect:function(g,i,h,e,f){},drawCircle:function(g,h,e,f){},createGroup:function(e){return null},addToGroup:function(e,f){},removeFromGroup:function(e,f){},removeDrawnElem:function(e,f){},exportToDataUrl:function(g,e,f){}});Kekule.Render.Base2DRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.Base2DRenderer",initialize:function($super,g,e,f){$super(g,e,f);this._richTextDrawer=null},initProperties:function(){this.defineProp("richTextDrawerClass",{dataType:DataType.CLASS,serializable:false})},getActualTargetContext:function(e){return this.getRedirectContext()||e},getRendererType:function(){return Kekule.Render.RendererType.R2D},canMeasureText:function(e){return this.getDrawBridge().canMeasureText(e)},getAutoScaleRefDrawLength:function(e){return e.defBondLength},getAutoScaleRefObjLength:function(h,e){var f=h||this.getChemObj();if(f.getAllAutoScaleRefLengths){var g=f.getAllAutoScaleRefLengths(Kekule.CoordMode.COORD2D,e);if(g){return Kekule.ArrayUtils.getMedian(g)}}else{Kekule.error(Kekule.ErrorMsg.INAVAILABLE_AUTOSCALE_REF_LENGTH)}},getRichTextDrawer:function(){if(!this._richTextDrawer){var e=this.getRichTextDrawerClass()||Kekule.Render.BaseRichTextDrawer;this._richTextDrawer=new e(this.getDrawBridge())}return this._richTextDrawer},drawPath:function(f,g,e){return this.getDrawBridge().drawPath(this.getActualTargetContext(f),g,e)},drawLine:function(f,h,g,e){return this.getDrawBridge().drawLine(this.getActualTargetContext(f),h,g,e)},drawArrowLine:function(e,g,f,p,h){var v=this.getActualTargetContext(e);if(!p){return this.drawLine(v,g,f,h)}else{var q=this.createDrawGroup(v);var r=this.drawLine(v,g,f,h);this.addToDrawGroup(r,q);var t=f.x-g.x;var s=f.y-g.y;var n=Math.atan(s/t);var u=(p.width||6)/2;var i=p.length||3;var y=Math.atan(u/i);var w=Math.sqrt(Math.sqr(u)+Math.sqr(i));var z=Math.cos(n-y)*w;var o=Math.sin(n-y)*w;var x=Math.cos(n+y)*w;var m=Math.sin(n+y)*w;r=this.drawLine(v,f,{x:f.x-z,y:f.y-o},h);this.addToDrawGroup(r,q);r=this.drawLine(v,f,{x:f.x-x,y:f.y-m},h);this.addToDrawGroup(r,q);return q}},drawTriangle:function(f,i,h,g,e){return this.getDrawBridge().drawTriangle(this.getActualTargetContext(f),i,h,g,e)},drawRect:function(g,l,i,e){var h={x:Math.min(l.x,i.x),y:Math.min(l.y,i.y)};var f={x:Math.max(l.x,i.x),y:Math.max(l.y,i.y)};return this.getDrawBridge().drawRect(this.getActualTargetContext(g),h,f,e)},drawRoundRect:function(h,m,l,e,f){var i={x:Math.min(m.x,l.x),y:Math.min(m.y,l.y)};var g={x:Math.max(m.x,l.x),y:Math.max(m.y,l.y)};return this.getDrawBridge().drawRoundRect(this.getActualTargetContext(h),i,g,e,f)},drawCircle:function(g,h,e,f){return this.getDrawBridge().drawCircle(this.getActualTargetContext(g),h,e,f)},drawText:function(g,l,i,f){var h=this.getRichTextDrawer();var e=Kekule.Render.RichTextUtils.strToRichText(i,f);return h.drawEx(this.getActualTargetContext(g),l,e,f)},drawRichText:function(f,i,h,e){var g=this.getRichTextDrawer();return g.drawEx(this.getActualTargetContext(f),i,h,e)},createDrawGroup:function(e){return this.getDrawBridge().createGroup(this.getActualTargetContext(e))},addToDrawGroup:function(e,f){return this.getDrawBridge().addToGroup(e,f)},removeFromDrawGroup:function(e,f){return this.getDrawBridge().removeFromGroup(e,f)},removeDrawnElem:function(e,f){return this.getDrawBridge().removeDrawnElem(this.getActualTargetContext(e),f)},transformScreenCoordToContext:function(e,f){return this.doTransformScreenCoordToContext(this.getActualTargetContext(e),f)},doTransformScreenCoordToContext:function(f,g){var e=this.getDrawBridge();return(e&&e.transformScreenCoordToContext)?e.transformScreenCoordToContext(this.getActualTargetContext(f),g):g}});Kekule.Render.ChemObj2DRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj2DRenderer",doEstimateObjBox:function(g,f,e){return Kekule.Render.ObjUtils.getContainerBox(this.getChemObj(),Kekule.CoordMode.COORD2D,e)},doEstimateRenderBox:function(g,h,f,e){var l=this.estimateObjBox(g,f,e);if(l){var i=this.prepareTransformParams(g,h,f,l);var m=i;return a.transform2D(l,m)}else{return null}},doGetAutoBaseCoord:function(g){var h=g.transformParams;if(h){var f=this.getChemObj();var e=f.getAbsBaseCoord?f.getAbsBaseCoord():f.getAbsBaseCoord2D?f.getAbsBaseCoord2D():null;if(e){return Kekule.CoordUtils.transform2D(e,h)}}return null},doDraw:function($super,f,g,e){this.prepareTransformParams(f,g,e);this.prepareGeneralOptions(f,e);return $super(f,g,e)},prepareGeneralOptions:function(f,e){},prepareTransformParams:function(g,h,m,n){var e;if(m.transformParams){e=m.transformParams}else{var l=this.generateTransformParams(g,h,m,n);m.transformParams=l;e=l}var f=Kekule.CoordUtils.calcTransform2DMatrix(e);var i=Kekule.CoordUtils.calcInverseTransform2DMatrix(e);m.transformParams.transformMatrix=f;m.transformParams.invTransformMtrix=i;this.getRenderCache(g).transformParams=e;this.getRenderCache(g).transformMatrix=f;this.getRenderCache(g).invTransformMatrix=i;return e},calcPreferedTransformOptions:function(e,o,r,f){var s={};s.allowCoordBorrow=d(r.allowCoordBorrow,false);s.unitLength=r.unitLength||1;if(!f){f=this.estimateObjBox(e,r,s.allowCoordBorrow)}var p={x:(f.x1+f.x2)/2,y:(f.y1+f.y2)/2};var g=Kekule.ObjUtils;if(g.isUnset(r.translateX)&&g.isUnset(r.translateY)){if(o){s.translateX=o.x-p.x;s.translateY=o.y-p.y}}else{s.translateX=r.translateX||0;s.translateY=r.translateY||0}s.zoom=r.zoom||1;if((!r.scale)&&(!r.scaleX)&&(!r.scaleY)){if(r.autofit){var n=this.getDrawBridge().getContextDimension(e);n.x=n.width;n.y=n.height;n=this.getDrawBridge().transformScreenCoordToContext(e,n);n.width=n.x;n.height=n.y;var m=r.autofitContextPadding;m*=s.unitLength*2;f.width=f.x2-f.x1;f.height=f.y2-f.y1;var l=Math.max(n.width-m,0)/(f.width||1);var i=Math.max(n.height-m,0)/(f.height||1);if(g.isUnset(r.retainAspect)||(r.retainAspect)){s.scaleX=s.scaleY=Math.min(l,i)}else{s.scaleX=l;s.scaleY=i}}else{var q=d(r.refDrawLength,this.getAutoScaleRefDrawLength(r))||1;var h=this.getAutoScaleRefObjLength(this.getChemObj(),s.allowCoordBorrow)||1;s.scaleX=s.scaleY=(q/h)||1}}else{s.scaleX=d(r.scaleX,r.scale,1);s.scaleY=d(r.scaleY,r.scale,1)}if(g.notUnset(r.rotateAngle)){s.rotateAngle=r.rotateAngle}if(g.isUnset(r.center)){s.center=p}else{s.center=r.center}if(o){s.drawBaseCoord=o}else{s.drawBaseCoord=Kekule.CoordUtils.transform2D(p,s)}return s},generateTransformParams:function(f,g,i,l){var e=this.calcPreferedTransformOptions(f,g,i,l);var h=Object.extend({},e);e=this.getFinalTransformParams(f,e);e.initialTransformOptions=h;return e},getFinalTransformParams:function(f,g){var e=Object.create(g);if(e.zoom){e.scaleX*=e.zoom;e.scaleY*=e.zoom}e.scaleY=-e.scaleY;if(e.unitLength){e.translateX*=e.unitLength;e.translateY*=e.unitLength;e.drawBaseCoord.x*=e.unitLength;e.drawBaseCoord.y*=e.unitLength}return e},getRenderFinalTransformParams:function(e){return this.getRenderCache(e).transformParams},getRenderInitialTransformOptions:function(e){var f=this.getRenderFinalTransformParams(e);return f?f.initialTransformOptions:null},doTransformCoordToObj:function(f,h,g){var e=this.getRenderCache(f).invTransformMatrix;return Kekule.CoordUtils.transform2DByMatrix(g,e)},doTransformCoordToContext:function(f,h,g){var e=this.getRenderCache(f).transformMatrix;return Kekule.CoordUtils.transform2DByMatrix(g,e)}});Kekule.Render.RichTextBased2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.RichTextBased2DRenderer",DRAWN_OBJ_FIELD:"__$drawnObj__",getDrawnObj:function(e){return this.getExtraProp(e,this.DRAWN_OBJ_FIELD)},setDrawnObj:function(e,f){this.setExtraProp(e,this.DRAWN_OBJ_FIELD,f)},getRichText:function(e){return null},extractRichTextDrawOptions:function(f){var e=Object.create(f||{});e.horizontalAlign=d(e.horizontalAlign,e.textHorizontalAlign);e.verticalAlign=d(e.verticalAlign,e.textVerticalAlign);e.charDirection=d(e.charDirection,e.textCharDirection);return e},doDraw:function($super,f,i,m){$super(f,i,m);var l=this.getChemObj();var g=m.transformParams;var e=this.getRichText(this.getChemObj());if(!e){return null}if(!i){i=this.getAutoBaseCoord(m)}var n=this.drawRichText(f,i,e,this.extractRichTextDrawOptions(m));var h=n.boundRect;this.basicDrawObjectUpdated(f,l,l,this.createRectBoundInfo({x:h.left,y:h.top},{x:h.left+h.width,y:h.top+h.height}),Kekule.Render.ObjectUpdateType.ADD);this.getRenderCache(f).drawnObj=n.drawnObj;this.setDrawnObj(f,n.drawnObj);return n.drawnObj}});Kekule.Render.TextBlock2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.TextBlock2DRenderer",getRichText:function(f){var e=Kekule.Render.RichTextUtils.strToRichText(f.getText());return e},doEstimateObjBox:function(g,f,e){return this.getChemObj().getBox2D(e)},extractRichTextDrawOptions:function($super,e){var f=$super(e);f.fontSize=d(f.fontSize,f.labelFontSize);f.fontFamily=d(f.fontFamily,f.labelFontFamily);f.color=d(f.color,f.labelColor);f.textBoxXAlignment=Kekule.Render.BoxXAlignment.LEFT;f.textBoxYAlignment=Kekule.Render.BoxYAlignment.TOP;return f}});Kekule.Render.Formula2DRenderer=Class.create(Kekule.Render.RichTextBased2DRenderer,{CLASS_NAME:"Kekule.Render.Formula2DRenderer",basicDrawObjectUpdated:function($super,g,i,h,f,e){if(i===this.getChemObj()){return $super(g,i.getParent(),i.getParent(),f,e)}else{return $super(g,i,h,f,e)}},getRichText:function(e){return e.getDisplayRichText(true)},doEstimateObjBox:function(g,f,e){var h=this.getChemObj().getParent();var i=(h)?h.getAbsBaseCoord2D(e):{x:0,y:0};return a.createBox(i,i)},extractRichTextDrawOptions:function($super,e){var f=$super(e);f.fontSize=d(f.fontSize,f.atomFontSize);f.fontFamily=d(f.fontFamily,f.atomFontFamily);f.color=d(f.color,f.labelColor,f.atomColor);f.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER;f.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER;return f}});Kekule.Render.Ctab2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.Ctab2DRenderer",DRAW_ELEM_FIELD:"__$drawElem__",TRANSFORM_COORD_FIELD:"__$transCoord2D__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",RENDERED_OBJS_FIELD:"__$renderedObjs__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",doEstimateObjBox:function(g,f,e){var h=this.getChemObj().getExposedContainerBox2D(e);return h},getObjDrawElem:function(e,f){return this.getExtraProp2(e,f,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(e,g,f){this.setExtraProp2(e,g,this.DRAW_ELEM_FIELD,f)},getRenderedObjs:function(e){return this.getExtraProp(e,this.RENDERED_OBJS_FIELD)},addRenderedObj:function(e,f){var g=this.getRenderedObjs(e);if(!g){g=[f];this.setExtraProp(e,this.RENDERED_OBJS_FIELD,g)}else{Kekule.ArrayUtils.pushUnique(g,f)}},removeRenderedObj:function(e,f){var g=this.getRenderedObjs(e);if(g){Kekule.ArrayUtils.remove(g,f)}},clearRenderedObj:function(e){this.setExtraProp(e,this.RENDERED_OBJS_FIELD,null)},prepareGeneralOptions:function($super,f,e){return $super(f,e)},doPrepare:function($super,f,h,g,e){$super(f,h,g,e)},handleNodeSpecifiedRenderOptions:function(g,f){var h=(g.getOverriddenRenderOptions?g.getOverriddenRenderOptions():null)||{};var e=Object.create(f);e=Object.extend(e,h);return e},handleConnectorSpecifiedRenderOptions:function($super,g,f){var h=(g.getOverriddenRenderOptions?g.getOverriddenRenderOptions():null)||{};var e=Object.create(f);e=Object.extend(e,h);return e},isChemObjRenderedBySelf:function($super,g,h){var f=this.getRenderedObjs(g);var e=$super(g,h)||(f&&(f.indexOf(h)>=0))||(this.getChemObj().hasChildObj(h)&&(!h.isExposed||h.isExposed()));return e},isChemObjRenderedDirectlyBySelf:function($super,f,g){var e=this.getRenderedObjs(f);return $super(f,g)||(e&&(e.indexOf(g)>=0))},doDraw:function($super,g,i,f){$super(g,i,f);var l=this.getChemObj();this._ctab=l;var h=f.transformParams;this.getRenderCache(g).transformOptions=h;this.transformCtabCoords2DToContext(g,l,h);this.doPrepare(g,l,i,f);this.getRenderCache(g).appliedOptions=f;var e=this.doDrawCore(g,l,f,h);return e},doRedraw:function(e){var f=this.getRenderCache(e);return this.doDrawCore(e,this.getChemObj(),f.appliedOptions,f.transformOptions)},doDrawCore:function(f,i,e,g){this.clearRenderedObj(f);var h=this.createDrawGroup(f);this.doDrawConnectors(f,h,i,e,g);this.doDrawNodes(f,h,i,e,g);this.setObjDrawElem(f,i,h);return h},doUpdate:function($super,g,i,e){if(this.canModifyGraphic(g)){var h=false;var f=Kekule.Render.ObjectUpdateType;switch(e){case f.ADD:h=this.doAddNew(g,i);break;case f.MODIFY:h=this.doModify(g,i);break;case f.REMOVE:h=this.doRemove(g,Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(i));break;default:return $super(g,i,e)}return h}else{return $super(g,updatedObjs,e)}},doAddNew:function(e,f){if(this.canModifyGraphic()){return this.doModify(e,f)}else{return false}},doModify:function(f,o){if(this.canModifyGraphic()){var n=this._extractObjsOfUpdateObjDetails(o);this.remove(f,n);var q=this.getChemObj();var p=this.getObjDrawElem(f,q);var e=this.getRenderCache(f);var r=e.appliedOptions;if(n.indexOf(q)>=0){this.draw(f,e.baseCoord,r)}for(var m=0,g=n.length;m<g;++m){var h=n[m];if(!h.isExposed||h.isExposed()){if(q.hasConnector(h)){this.doDrawConnector(f,p,h,this.getChemObj(),r,e.transformParams)}else{if(q.hasNode(h)){this.doDrawNode(f,p,h,this.getChemObj(),r,e.transformParams)}}}}return true}else{return false}},doRemove:function(g,o){if(this.canModifyGraphic()){var p=Kekule.ArrayUtils.toArray(o);for(var f=0,e=p.length;f<e;++f){var n=p[f];var h=this.getObjDrawElem(g,n);if(h){var m=this.getObjDrawElem(g,this.getChemObj());this.removeFromDrawGroup(h,m);this.removeDrawnElem(g,h)}this.removeRenderedObj(g,n);this.removeExtraProp2(g,n);this.basicDrawObjectUpdated(g,n,this.getChemObj(),null,Kekule.Render.ObjectUpdateType.REMOVE)}return true}else{return false}},getCoordTransformOptions:function(e){return this.getRenderCache(e).transformOptions},transformCtabCoords2DToContext:function(e,q,n){var h=n.allowCoordBorrow;var o=Object.extend({},n);o.centerX=0;o.centerY=0;var t;var p=n.transformMatrix;this.setExtraProp2(e,q,this.TRANSFORM_MATRIX_FIELD,p);var f=p;this.setExtraProp2(e,q,this.CHILD_TRANSFORM_MATRIX_FIELD,p);var s=n.invTransformMatrix;this.setExtraProp2(e,q,this.INV_TRANSFORM_MATRIX_FIELD,s);for(var r=0,m=q.getNodeCount();r<m;++r){var g=q.getNodeAt(r);this.transformObjCoord2DToContext(e,g,p,f,h)}},transformObjCoord2DToContext:function(e,m,h,o,f){if(m&&m.getAbsBaseCoord2D){var p=m.getAbsBaseCoord2D(f);if(p){var q=Kekule.CoordUtils.transform2DByMatrix(p,h);this.setTransformedCoord2D(e,m,q)}if(m.getNodes){for(var n=0,g=m.getNodeCount();n<g;++n){this.transformObjCoord2DToContext(e,m.getNodeAt(n),o,o,f)}}}},getTransformedCoord2D:function(i,m,h){if(Kekule.ObjUtils.isUnset(h)){h=this.getRenderCache(i).options.transformParams.allowCoordBorrow}var f=this.getExtraProp2(i,m,this.TRANSFORM_COORD_FIELD);if(!f){var l=this.getChemObj();var g=this.getExtraProp2(i,l,this.TRANSFORM_MATRIX_FIELD);var e=this.getExtraProp2(i,l,this.CHILD_TRANSFORM_MATRIX_FIELD);if(l&&(l.hasNode(m,false)||l.hasConnector(m,false))){this.transformObjCoord2DToContext(i,m,g,e,h)}else{this.transformObjCoord2DToContext(i,m,e,e,h)}}return this.getExtraProp2(i,m,this.TRANSFORM_COORD_FIELD)},setTransformedCoord2D:function(e,f,g){this.setExtraProp2(e,f,this.TRANSFORM_COORD_FIELD,g)},doTransformCoordToObj:function(f,h,g){var e=this.getExtraProp2(f,h,this.INV_TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform2DByMatrix(g,e)},doTransformCoordToContext:function(f,h,g){var e=this.getExtraProp2(f,h,this.TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform2DByMatrix(g,e)},doDrawNodes:function(f,r,p,s,h){var e=p.getExposedNodes();for(var q=0,o=e.length;q<o;++q){var n=e[q];var g=this.handleNodeSpecifiedRenderOptions(e[q],s);var m=this.doDrawNode(f,r,n,p,g,h)}},doDrawNode:function(f,l,h,i,e,g){},doDrawConnectors:function(e,r,p,s,f){var g=this.handleConnectorSpecifiedRenderOptions(p,s);var h=p.getExposedConnectors();for(var q=0,o=h.length;q<o;++q){var n=h[q];var m=this.doDrawConnector(e,r,n,p,g,f)}},doDrawConnector:function(f,q,e,o,l,t){var s;var r=e.getConnectedExposedObjs();var u=r.length;if(u<2){return null}var z,x;var h,g;var A;var B=(u>2)?this.createDrawGroup(f):null;var n;var m=(u>2)?[]:null;var p=this.handleConnectorSpecifiedRenderOptions(e,l);for(var w=0;w<u;++w){z=r[w];h=this.getTransformedCoord2D(f,z,t.allowCoordBorrow);if(h){for(var v=w+1;v<u;++v){x=r[v];g=this.getTransformedCoord2D(f,x,t.allowCoordBorrow);if(g){n=this.doDrawConnectorShape(f,e,z,x,p,t);if(n){A=n.element;if(A&&B){this.addToDrawGroup(A,B)}var y=n.boundInfo;if(m){m.push(y)}}}}}}s=B||A;if(s&&q){this.addToDrawGroup(s,q)}if(s){this.setObjDrawElem(f,e,s)}else{this.setObjDrawElem(f,e,null)}this.addRenderedObj(f,e);if(y||m){this.basicDrawObjectUpdated(f,e,o,m||y,Kekule.Render.ObjectUpdateType.ADD)}return s},doDrawConnectorShape:function(i,f,h,e,g,l){}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.Ctab2DRenderer);Kekule.Render.ChemCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab2DRenderer",OBJ_NEED_LABEL_FIELD:"__$needDrawLabel__",getObjNeedDrawLabel:function(f,h){var e=this.getExtraProp2(f,h,this.OBJ_NEED_LABEL_FIELD);if(Kekule.ObjUtils.isUnset(e)){var g=this.getRenderCache(f).appliedOptions;e=(h instanceof Kekule.ChemStructureConnector)?false:this._needNodeDrawLabel(h,g);this.setObjNeedDrawLabel(f,h,e)}return e},setObjNeedDrawLabel:function(e,g,f){this.setExtraProp2(e,g,this.OBJ_NEED_LABEL_FIELD,f)},doPrepare:function($super,f,p,o,q){$super(f,p,o,q);if(!q.fontSize){q.fontSize=q.atomFontSize}q.textBoxXAlignment=Kekule.Render.BoxXAlignment.CENTER;q.textBoxYAlignment=Kekule.Render.BoxYAlignment.CENTER;var e=p.getExposedNodes();for(var n=0,h=e.length;n<h;++n){var g=e[n];var m=this._needNodeDrawLabel(g,q);this.setObjNeedDrawLabel(f,g,m)}},handleNodeSpecifiedRenderOptions:function($super,g,f){var e=$super(g,f);e.color=e.color||e.atomColor;e.fontFamily=e.fontFamily||e.atomFontFamily;e.fontSize=e.fontSize||e.atomFontSize;return e},handleConnectorSpecifiedRenderOptions:function($super,g,f){var e=$super(g,f);e.color=e.color||e.bondColor;return e},doDrawNode:function(h,q,w,o,i,u){var s;var z;var x=this.getTransformedCoord2D(h,w,u.allowCoordBorrow);var f=this.handleNodeSpecifiedRenderOptions(w,i);var y=w.getAtomicNumber?w.getAtomicNumber():0;var l=w.getOverriddenRenderOptions()||{};var t=l.color||l.atomColor;var p=t||(f.useAtomSpecifiedColor?Kekule.Render.RenderColorUtils.getColor(y,this.getRendererType()):f.color);f.color=p;if(this.getObjNeedDrawLabel(h,w)){var g=Kekule.Render.HydrogenDisplayLevel.ALL;var r=w.getDisplayRichText(g,true,f.displayLabelConfigs,f.partialChargeDecimalsLength);r.charDirection=!f.charDirection?this._decideNodeLabelCharDirection(h,w):f.charDirection;f.fontSize*=f.unitLength;var m=this.drawRichText(h,x,r,f);var A=m.drawnObj;var e=m.boundRect;z=this.createRectBoundInfo({x:e.left,y:e.top},{x:e.left+e.width,y:e.top+e.height});s=A}else{var n,v;if(f.atomRadius){f.strokeColor=f.color;f.fillColor=f.color;n=this.drawCircle(h,x,f.atomRadius,f);z=this.createCircleBoundInfo(x,f.atomRadius)}else{z=this.createPointBoundInfo(x)}if(w.getCharge()||w.getRadical()){var m=this.doDrawElectronStateMark(h,q,w,f.chargeMarkType,f.partialChargeDecimalsLength,f.fontFamily,f.chargeMarkFontSize*f.unitLength,f.chargeMarkMargin*f.unitLength,f.chargeMarkCircleWidth*f.unitLength,f.color,f.opacity,f.zoom||1);if(m){v=m.drawnObj}}if(n&&v){s=this.createDrawGroup(h);this.addToDrawGroup(s,n);this.addToDrawGroup(s,v)}else{s=n||v}}if(s){this.setObjDrawElem(h,w,s);if(q){this.addToDrawGroup(s,q)}}else{this.setObjDrawElem(h,w,null)}this.addRenderedObj(h,w);this.basicDrawObjectUpdated(h,w,o,z,Kekule.Render.ObjectUpdateType.ADD);return s},_getNodeFontSize:function(e,f,g){if(!g){g=this.getRenderCache(e).appliedOptions||this.getRenderCache(e).options}var h=Kekule.Render.RenderOptionUtils.getNodeLabelDrawOptions(f.getOverriddenRenderOptions())||{};return d(h.fontSize,g.fontSize,g.atomFontSize)},_getNodeHydrogenDisplayLevel:function(g,h){var i=g.getOverriddenRenderOptions();var f=Kekule.Render.RenderOptionUtils.getHydrogenDisplayLevel(i);var e=Kekule.ObjUtils.notUnset(f)?f:((h.moleculeDisplayType===Kekule.Render.MoleculeDisplayType.CONDENSED)?Kekule.Render.HydrogenDisplayLevel.ALL:h.hydrogenDisplayLevel);return e},_needNodeDrawLabel:function(g,p){var i=Kekule.Render.RenderOptionUtils;var m=Kekule.Render.NodeLabelDisplayMode;var e=g.getOverriddenRenderOptions();var l=i.getNodeDisplayMode(e)||p.nodeDisplayMode;if(!(g instanceof Kekule.ChemStructureNode)){return false}if(l===m.HIDDEN){return false}else{if(l===m.SHOWN){return true}else{var h=p.moleculeDisplayType;if(h===Kekule.Render.MoleculeDisplayType.CONDENSED){return true}else{var f=g.getLinkedConnectors();if(f.length<=0){return true}if((g instanceof Kekule.Atom)&&(g.getAtomicNumber()===Kekule.Render.DEF_ATOM_ATOMIC_NUM)&&(!g.getMassNumber())){if(g.getRenderOption("customLabel")){return true}var n=this._getNodeHydrogenDisplayLevel(g,p);var o=Kekule.Render.HydrogenDisplayLevel;if((n===o.ALL)||(n===o.NONE)){return true}else{if(n===o.UNMATCHED_EXPLICIT){return(g.getImplicitHydrogenCount()!==g.getExplicitHydrogenCount())}else{return Kekule.ObjUtils.notUnset(g.getExplicitHydrogenCount())}}}else{return true}}}}},_isNodeHasConnectorToDirection:function(n,h,e){if(Kekule.ObjUtils.isUnset(e)){e=1/5}for(var g=0,f=n.length;g<f;++g){var m=n[g];if((h===c.LTR)&&(m.x>e)){return true}else{if((h===c.RTL)&&(m.x<-e)){return true}}if((h===c.TTB)&&(m.y>e)){return true}else{if((h===c.BTT)&&(m.y<-e)){return true}}}return false},_calcConnectorVectorWeight:function(g){var p=0;var n=0;var m=function(i,q){var l=100;if(q==0){return l}else{return Math.min(l,Math.pow(i/q,2))}};var o=1;var h=1;for(var f=0,e=g.length;f<e;++f){p+=g[f].x*m(g[f].x,g[f].y)*o;n+=g[f].y*m(g[f].y,g[f].x)*h}return{x:p,y:n}},_calcConnectorVectorOfNode:function(h,m){var e={x:0,y:0};var n=this._getStandardizedLinkedObjRelCoords(h,m,null);for(var g=0,f=n.length;g<f;++g){e.x+=n[g].x;e.y+=n[g].y}if(e.x===e.y===0){e={x:1,y:0}}return e},_calcVectorAxisDirection:function(e){var g=Math.abs(e.x);var f=Math.abs(e.y);if(g>=f){return(e.x>0)?c.LTR:c.RTL}else{return(e.y>0)?c.TTB:c.BTT}},_decideNodeLabelCharDirection:function(f,g){var h=this._getStandardizedLinkedObjRelCoords(f,g,null);var e=Kekule.Render.TextDirection;var p=[e.LTR,e.RTL,e.TTB,e.BTT];var q;for(var n=0,m=p.length;n<m;++n){if(!this._isNodeHasConnectorToDirection(h,p[n])){return p[n]}}var o=this._calcConnectorVectorWeight(h);if(Math.abs(o.x)>Math.abs(o.y)){if(o.x<=0){q=e.LTR}else{q=e.RTL}}else{if(o.y<=0){q=e.TTB}else{q=e.BTT}}return q},_calcConnectorAnglesOfNode:function(h,m){var e=[];var p=this._getStandardizedLinkedObjRelCoords(h,m,null);for(var g=0,f=p.length;g<f;++g){var o=p[g];var n=Math.atan2(o.y,o.x);if(n<0){n=Math.PI*2+n}e.push(n)}e.sort();return e},_getMostEmptyDirectionAngleOfNode:function(f,h){var p=this._calcConnectorAnglesOfNode(f,h);var m=p.length;if(m===0){return 0}else{if(m===1){return -p[0]}else{var q=0;var o=0;for(var n=0;n<m;++n){var g=p[n];var e=p[(n+1)%m];var r=e-g;if(r<0){r+=Math.PI*2}if(r>q){q=r;o=n}}return p[o]+q/2}}},doDrawElectronStateMark:function(i,r,z,w,H,o,C,F,n,E,m,f){var y=z.getCharge();var G=z.getRadical();var u="";if((!H)||(Math.abs(y)>Math.pow(10,-H)/2)){var p=w===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND;var e=(w===Kekule.Render.ChargeMarkRenderType.CIRCLE_AROUND);if(y===1){u=e?"\u2295":"+"}else{if(y===-1){u=e?"\u2296":"\u2212"}else{var B=H?Kekule.NumUtils.toDecimals(Math.abs(y),H):Math.abs(y).toString();u=B+((y>0)?"+":"\u2212")}}}if(G){u+=Kekule.Render.ChemDisplayTextUtils.getRadicalDisplayText(G)}if(!u){return null}var A=this.getTransformedCoord2D(i,z);var D=this._getMostEmptyDirectionAngleOfNode(i,z);var h={x:Math.cos(D),y:Math.sin(D)};var l=1;var q=F/l;var v={x:h.x*q,y:h.y*q};v=Kekule.CoordUtils.add(A,v);var g=Kekule.Render.BoxXAlignment;var s=Kekule.Render.BoxYAlignment;var t,x;t=g.CENTER;x=s.CENTER;var I=this.drawText(i,v,u,{fontFamily:o,fontSize:C,color:E,opacity:m,textBoxXAlignment:t,textBoxYAlignment:x,zoom:f||1});return I},doDrawConnectorShape:function(Q,f,w,v,x,M){var m=Kekule.CoordUtils;var O=Object.extend({},this.getTransformedCoord2D(Q,w,M.allowCoordBorrow));var N=Object.extend({},this.getTransformedCoord2D(Q,v,M.allowCoordBorrow));var y=x.unitLength||1;var J=Math.sqrt(Math.sqr(N.x-O.x)+Math.sqr(N.y-O.y));if(this.getObjNeedDrawLabel(Q,w)||this.getObjNeedDrawLabel(Q,v)){var E=x.atomLabelBoxExpandRatio;var g,z;var B;var t=N.x-O.x;var G=N.y-O.y;var o=(t>=0)?1:-1;var e=(G>=0)?1:-1;var F=(t===0);if(!F){var P=Math.abs(G/t)}if(Math.abs(t)>=Math.abs(G)){B=true}else{B=false}var C=[w,v];var n=[O,N];var R=m.getDistance(O,N);var q=0;for(var K=0,I=C.length;K<I;++K){var A=C[K];var r=n[K];var L=null;if(this.getObjNeedDrawLabel(Q,A)){var h=this._getNodeFontSize(Q,A)*(M.zoom||1);g=z=h*y*E/2;if(B){L={x:g*o,y:g*P*e}}else{if(!F){L={x:z/P*o,y:z*e}}else{L={x:0,y:z*e}}}if(L){q+=m.getDistance(L,{x:0,y:0});var u=m.add(r,L);r.x=u.x;r.y=u.y}}o*=-1;e*=-1}}if(q>=R){return null}var D=(x.bondLineWidth||x.strokeWidth||1)*(x.unitLength||1);x.strokeWidth=D;var p=x.renderType;var H=Kekule.Render.ConnectorDrawUtils.getPossibleConnectorRenderTypes(f);if(Kekule.ObjUtils.isUnset(p)||(H.indexOf(p)<0)){p=H[0]}var s;if(this.isLineBasedConnector(p)){s=this.doDrawLineBasedConnector(Q,p,w,v,O,N,J,x)}else{if(this.isTriangleBasedConnector(p)){s=this.doDrawTriangleBasedConnector(Q,p,w,v,O,N,J,x)}else{if(this.isTriangleHashBasedConnector(p)){s=this.doDrawTriangleHashBasedConnector(Q,p,w,v,O,N,J,x)}else{if(this.isWavyBasedConnector(p)){s=this.doDrawWavyBasedConnector(Q,p,w,v,O,N,J,x)}}}}return s},_lineBasedConnectorTypes:[b.SINGLE,b.DOUBLE,b.TRIPLE,b.BOLD,b.BOLD_DOUBLE,b.BOLD_TRIPLE,b.DASHED,b.DASHED_DOUBLE,b.DASHED_TRIPLE,b.SOLID_DASH,b.BOLD_DASH,b.ARROWED],_triangleBasedConnectorTypes:[b.WEDGED_SOLID,b.WEDGED_SOLID_INV,b.WEDGED_HOLLOW,b.WEDGED_HOLLOW_INV],_triangleHashBasedConnectorTypes:[b.WEDGED_HASHED,b.WEDGED_HASHED_INV,b.HASHED],isLineBasedConnector:function(e){return(this._lineBasedConnectorTypes.indexOf(e)>=0)},isTriangleBasedConnector:function(e){return(this._triangleBasedConnectorTypes.indexOf(e)>=0)},isTriangleHashBasedConnector:function(e){return(this._triangleHashBasedConnectorTypes.indexOf(e)>=0)},isWavyBasedConnector:function(e){return e=b.WAVY},doDrawLineBasedConnector:function(g,f,s,r,p,o,e,t){var m=[];var l={isBold:false,isDash:false};var q={isBold:true,isDash:false};var h={isBold:false,isDash:true};switch(f){case b.DOUBLE:for(var n=0;n<2;++n,m.push(l)){}break;case b.TRIPLE:for(var n=0;n<3;++n,m.push(l)){}break;case b.BOLD:m.push(q);break;case b.BOLD_DOUBLE:m.push(q);m.push(l);break;case b.BOLD_TRIPLE:m.push(q);for(var n=0;n<2;++n,m.push(l)){}break;case b.DASHED:m.push(h);break;case b.DASHED_DOUBLE:for(var n=0;n<2;++n,m.push(h)){}break;case b.DASHED_TRIPLE:for(var n=0;n<3;++n,m.push(h)){}break;case b.SOLID_DASH:m.push(l);m.push(h);break;case b.BOLD_DASH:m.push(q);m.push(h);break;case b.ARROWED:l.isArrow=true;m.push(l);case b.SINGLE:default:m.push(l)}return this.doDrawSymmetryLineConnector(g,s,r,p,o,e,m,t)},doDrawSymmetryLineConnector:function(T,z,y,S,R,L,E,C){var o=E.length;var x=null,p=null;if(o===1){var G=C.strokeWidth;if(E[0].isBold){G*=C.boldBondLineWidthRatio}var l=null;if(E[0].isArrow){l={width:C.bondArrowWidth*C.unitLength,length:C.bondArrowLength*C.unitLength}}var v={strokeWidth:G,strokeColor:Kekule.Render.RenderOptionUtils.getColor(C),isDash:E[0].isDash,opacity:C.opacity};var p=this.drawArrowLine(T,S,R,l,v);var Q=this.createLineBoundInfo(S,R,G)}else{if(o>1){x=this.createDrawGroup(T);var K=C.multipleBondSpacingAbs?C.multipleBondSpacingAbs:C.multipleBondSpacingRatio*L;if(C.multipleBondMaxAbsSpacing){K=Math.min(K,C.multipleBondMaxAbsSpacing)}K*=C.unitLength;var J=R.x-S.x;var O=R.y-S.y;var g=Math.sqrt(Math.sqr(J)+Math.sqr(O));var N=O/g;var H=J/g;var f=0;var D=[];var I=1;if(!(o&1)){I=Kekule.ObjUtils.isUnset(E.bondAlign)?this._decideEvenBondAlign(T,z,y):E.bondAlign}for(var M=0;M<o;++M){if(Kekule.ObjUtils.notUnset(E[M].offsetAdjust)){D.push(E[M].offsetAdjust)}else{if((M===0)&&(I!==0)){D.push(0)}else{var q=(M&1)?1:-1;if(I!==0){var m=I*q*((M+1)>>1)}else{var m=((M>>1)*1+0.5)*q}D.push(m)}}}var n=K;if(n>P){P=n}if(n<F){F=n}var e={x:0,y:0};var V={x:0,y:0};var P=0,F=0;var u=Object.create(C);for(var M=0;M<o;++M){var s=n*N;var r=n*H;var B={x:S.x-s*D[M],y:S.y+r*D[M]};var A={x:R.x-s*D[M],y:R.y+r*D[M]};e=Kekule.CoordUtils.add(e,B);V=Kekule.CoordUtils.add(V,A);var l=null;if(E[M].isArrow){l={width:C.bondArrowWidth*C.unitLength,length:C.bondArrowLength*C.unitLength}}var G=C.strokeWidth;if(E[M].isBold){G*=C.boldBondLineWidthRatio}u.strokeColor=C.color;u.strokeDash=E[M].isDash;var p=this.drawArrowLine(T,B,A,l,u);this.addToDrawGroup(p,x);if(E[M].isBold){n=K+Math.floor(G/2)}else{n=K}}e=Kekule.CoordUtils.divide(e,o);V=Kekule.CoordUtils.divide(V,o);var Q=this.createLineBoundInfo(e,V,P-F)}}var t={element:x||p,boundInfo:Q};return t},_getStandardizedLinkedObjRelCoords:function(e,g,h){var s=[];var q=this.getTransformedCoord2D(e,g);var f=g.getLinkedExposedObjs();for(var o=0,m=f.length;o<m;++o){var n=f[o];if(n===h){continue}var p=this.getTransformedCoord2D(e,n);var r=Kekule.CoordUtils.substract(p,q);r=Kekule.CoordUtils.standardize(r);s.push(r)}return s},_decideEvenBondAlign:function(e,q,o){var f=Kekule.CoordUtils.substract(this.getTransformedCoord2D(e,o),this.getTransformedCoord2D(e,q));f=Kekule.CoordUtils.standardize(f);var r=this._getStandardizedLinkedObjRelCoords(e,q,o);var p=this._getStandardizedLinkedObjRelCoords(e,o,q);var n=0;var h={x:0,y:0};for(var m=0,g=r.length;m<g;++m){n+=this._calcSinglePointAlign(r[m],f);h.x+=r[m].x;h.y+=r[m].y}for(var m=0,g=p.length;m<g;++m){n+=this._calcSinglePointAlign(p[m],f);h.x+=p[m].x;h.y+=p[m].y}if(n!==0){return Math.sign(n)}else{return this._calcSinglePointAlign(h,f)}},_calcSinglePointAlign:function(l,f){var e;var g=0.0001;if(Math.abs(f.x)<g){if(Math.abs(l.x)<g){e=0}else{e=-Math.sign(l.x)*Math.sign(f.y)}return e}else{var i=f.y*l.x/f.x;var h=l.y-i;if(h>g){e=1}else{if(h<-g){e=-1}else{e=0}}e*=Math.sign(f.x);return e}},doDrawTriangleBasedConnector:function(g,f,t,s,o,n,e,v){var m=(f===b.WEDGED_SOLID)||(f===b.WEDGED_SOLID_INV);var q=(f===b.WEDGED_SOLID_INV)||(f===b.WEDGED_HOLLOW_INV);var i=q?[n,o]:[o,n];var r=v.bondWedgeWidth*v.unitLength;var p=this._calcTriangleBaselineCoords(i[0],i[1],r);var l=Object.create(v);l.strokeColor=v.color;l.fillColor=m?v.color:null;var h=this.drawTriangle(g,i[0],p[0],p[1],l);var u={element:h};u.boundInfo=this.createLineBoundInfo(i[0],i[1],r);return u},doDrawTriangleHashBasedConnector:function(g,D,f,e,m,h,B,o){var G=(D===b.WEDGED_HASHED_INV);var x=(D!==b.HASHED);var r=G?[h,m]:[m,h];var z=o.hashSpacing*o.unitLength;var E=o.bondWedgeWidth*o.unitLength;var y=(x)?o.bondWedgeHashMinWidth*o.unitLength:E;var I=E-y;var u=Kekule.CoordUtils.substract(r[1],r[0]);var w=Math.sqrt(Math.sqr(u.x)+Math.sqr(u.y));var p=Math.floor(w/z);var s=this.createDrawGroup(g);var n=Object.create(o);n.strokeColor=o.color;for(var C=0;C<p;++C){var A=z*C;var q=A/w;var t={x:u.x*q,y:u.y*q};t=Kekule.CoordUtils.add(t,r[0]);var H=this._calcTriangleBaselineCoords(r[0],t,I*q+y);var F=this.drawLine(g,H[0],H[1],n);this.addToDrawGroup(F,s)}var v={element:s};v.boundInfo=this.createLineBoundInfo(r[0],r[1],E);return v},_calcTriangleBaselineCoords:function(e,l,g){var h=Kekule.CoordUtils.substract(l,e);var i=Math.sqrt(Math.sqr(h.x)+Math.sqr(h.y));var m=h.y/i;var f=h.x/i;var n=g/2;var o=[];o.push({x:l.x+n*m,y:l.y-n*f});o.push({x:l.x-n*m,y:l.y+n*f});return o},doDrawWavyBasedConnector:function(g,B,f,e,l,h,z,n){var I=Kekule.CoordUtils;var q=n.bondWavyRadius*n.unitLength;var x=I.getDistance(l,h);var o=Math.round(x/q);var D=I.divide(I.substract(h,l),o);var t=x/o;var v=[];var p;var w=l;var C=Math.atan2(D.y,D.x)+Math.PI;var H={x:t/1.5*Math.sin(C),y:-t/1.5*Math.cos(C)};var G=1;for(var A=0;A<o;++A){G=-G;p=w;w=I.add(p,D);var F=I.multiply(H,G);var s=I.add(p,F);var r=I.add(w,F);if(A===0){v.push("M");v.push([p.x,p.y])}v.push("C");v.push([s.x,s.y,r.x,r.y,w.x,w.y])}var y=Kekule.Render.DrawPathUtils.makePath.apply(Kekule.Render.DrawPathUtils,v);var m=Object.create(n);m.strokeColor=n.color;m.fillColor=null;var E=this.drawPath(g,y,m);var u={element:E};u.boundInfo=this.createLineBoundInfo(l,h,t);return u}});Kekule.Render.StructFragment2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment2DRenderer",initialize:function($super,g,e,f){$super(g,e,f);this._concreteRenderer=null;if(g.hasCtab()){this._concreteChemObj=g.getCtab();this._concreteRenderer=new Kekule.Render.ChemCtab2DRenderer(g.getCtab(),e,this)}else{this._concreteChemObj=g.getFormula();this._concreteRenderer=new Kekule.Render.Formula2DRenderer(g.getFormula(),e,this)}},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize();this._concreteRenderer=null}},getRenderCache:function(e){return this._concreteRenderer.getRenderCache(e)},_getConcreteRendererDrawOptions:function(e){return e},isChemObjRenderedBySelf:function($super,f,g){var e=$super(f,g)||(g===this.getChemObj())||this._concreteRenderer.isChemObjRenderedBySelf(f,g);return e},isChemObjRenderedDirectlyBySelf:function($super,e,f){return $super(e,f)||(f===this.getChemObj())},doSetRedirectContext:function($super,e){$super(e);this._concreteRenderer.setRedirectContext(e)},doDraw:function($super,f,h,e){$super(f,h,e);var l=this.getChemObj();var g=h;if((!g)&&(this._concreteRenderer instanceof Kekule.Render.Formula2DRenderer)){if(l.getAbsBaseCoord2D){var i=l.getAbsBaseCoord2D(e.allowCoordBorrow);g=Kekule.CoordUtils.transform2D(i,e.transformParams)}}if(!l.hasFormula()&&!l.hasCtab()){return null}else{return this._concreteRenderer.draw(f,g,this._getConcreteRendererDrawOptions(e))}},doRedraw:function(e){return this._concreteRenderer.redraw(e)},doUpdate:function(f,i,e){var h=this._extractObjsOfUpdateObjDetails(i);if(h.indexOf(this.getChemObj())>=0){var g=this.getRenderCache(f);this.doClear(f);return this.draw(f,g.baseCoord,g.options)}return this._concreteRenderer.doUpdate(f,i,e)},doClear:function(e){return this._concreteRenderer.clear(e)},estimateRenderBox:function(g,h,f,e){return this._concreteRenderer.estimateRenderBox(g,h,this._getConcreteRendererDrawOptions(f),e)},transformCoordToObj:function(e,h,g){var f=(this.getChemObj()===h)?this._concreteChemObj:h;return this._concreteRenderer.transformCoordToObj(e,f,g)},transformCoordToContext:function(e,h,g){var f=(this.getChemObj()===h)?this._concreteChemObj:h;return this._concreteRenderer.transformCoordToContext(e,f,g)}});Kekule.Render.Mol2DRenderer=Kekule.Render.StructFragment2DRenderer;Kekule.Render.CompositeObj2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj2DRenderer"});Kekule.Render.RendererDefineUtils.addCompositeRenderSupport(Kekule.Render.CompositeObj2DRenderer);Kekule.Render.CompositeMolecule2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){var g=[];var h=this.getChemObj().getSubMolecules();for(var f=0,e=h.getItemCount();f<e;++f){var m=h.getObjAt(f);g.push(m)}return g}});Kekule.Render.ChemObjGroupList2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule2DRenderer",getChildObjs:function(){var h=this.getChemObj();if(h instanceof Kekule.ChemObjList){var g=[];for(var f=0,e=h.getItemCount();f<e;++f){g.push(h.getItemAt(f))}}else{if(h instanceof Kekule.ChemStructureObjectGroup){g=h.getAllObjs()}}return g}});Kekule.Render.Reaction2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.Reaction2DRenderer",getChildObjs:function(){var g=[];var h=this.getChemObj();var g=[];for(var f=0,e=h.getReactantCount();f<e;++f){var m=h.getReactantAt(f);g.push(m)}for(var f=0,e=h.getProductCount();f<e;++f){var m=h.getProductAt(f);g.push(m)}return g}});Kekule.Render.ChemSpaceElement2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement2DRenderer",getChildObjs:function(){var e=this.getChemObj();return e.getChildren().toArray()}});Kekule.Render.ChemSpace2DRenderer=Class.create(Kekule.Render.CompositeObj2DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace2DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()]},doEstimateObjBox:function($super,i,g,f){var h=this.getChemObj().getSize2D();if(h.x&&h.y&&g.useExplicitSpaceSize){var e={x1:0,y1:0,x2:h.x,y2:h.y};return e}else{return $super(i,g,f)}}});Kekule.Render.Renderer2DFactory.register(Kekule.TextBlock,Kekule.Render.TextBlock2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.Reaction,Kekule.Render.Reaction2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement2DRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace2DRenderer)})();(function(){var c=Kekule.Render.DrawPathUtils;var a=Kekule.Render.CoordUtils;var e=Kekule.oneOf;var b=Kekule.Glyph.NodeType;var d=Kekule.Glyph.PathType;Kekule.Render.BaseGlyph2DRenderer=Class.create(Kekule.Render.ChemObj2DRenderer,{CLASS_NAME:"Kekule.Render.BaseGlyph2DRenderer",doDraw:function($super,g,i,f){var h=Object.create(f);h.strokeColor=f.strokeColor||f.glyphStrokeColor;h.fillColor=f.fillColor||f.glyphFillColor;h.strokeWidth=f.strokeWidth||f.glyphStrokeWidth;return $super(g,i,h)}});Kekule.Render.PathGlyphCtab2DRenderer=Class.create(Kekule.Render.Ctab2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyphCtab2DRenderer",extractGlyphDrawOptions:function(f){var g=f.unitLength||1;return{strokeColor:f.strokeColor||f.color||f.glyphStrokeColor,fillColor:f.fillColor||f.color||f.glyphFillColor,strokeWidth:(f.strokeWidth||f.glyphStrokeWidth)*g}},doDraw:function($super,g,h,f){return $super(g,h,f)},doDrawNode:function(f,o,h,i,p,g){var n;var m=this.getTransformedCoord2D(f,h,g.allowCoordBorrow);var l=h.getNodeType();if(!l||l===b.LOCATION){n=this.createPointBoundInfo(m)}if(n){this.basicDrawObjectUpdated(f,h,i,n,Kekule.Render.ObjectUpdateType.ADD)}},doDrawConnectorShape:function(ae,f,z,y,C,Y){var aa=Object.extend({},this.getTransformedCoord2D(ae,z,Y.allowCoordBorrow));var Z=Object.extend({},this.getTransformedCoord2D(ae,y,Y.allowCoordBorrow));var x=this.extractGlyphDrawOptions(C);var t=f.getPathType();var B=f.getPathParams()||{};var D=this.getChemObj();var M=B.lineGap||0;var q=M?(B.lineCount||1):1;var r=Kekule.CoordUtils;var W=Kekule.Glyph.ArrowSide;var V=r.substract(Z,aa);var J=V.x;var S=V.y;var O=r.getDistance(aa,Z);var R=S/O;var I=J/O;var N={y:M*I,x:M*R};var G=r.substract(this.transformCoordToContext(ae,D,{x:0,y:0}),this.transformCoordToContext(ae,D,N));var s=r.getDistance(G,{x:0,y:0});var ac=r.multiply(G,(q-1)/2);var K,L;var u=[];if(!!B.startArrowType&&B.startArrowWidth){var v=this._transformArrowLength(ae,B.startArrowLength,B.startArrowWidth);K={arrowLength:v.arrowLength,arrowWidth:v.arrowWidth,arrowType:B.startArrowType,arrowSide:B.startArrowSide,drawOnCenter:(!B.startArrowSide||B.startArrowSide===W.BOTH)};if(K.drawOnCenter){Kekule.ArrayUtils.pushUnique(u,this.doDrawArrowShape(ae,f,Z,aa,K,x,true))}}if(!!B.endArrowType&&B.endArrowWidth){var v=this._transformArrowLength(ae,B.endArrowLength,B.endArrowWidth);var L={arrowLength:v.arrowLength,arrowWidth:v.arrowWidth,arrowType:B.endArrowType,arrowSide:B.endArrowSide,drawOnCenter:(!B.endArrowSide||B.endArrowSide===W.BOTH)};if(L.drawOnCenter){Kekule.ArrayUtils.pushUnique(u,this.doDrawArrowShape(ae,f,aa,Z,L,x))}}var H=r.multiply(G,(q-1)/2);var p=r.substract(aa,H);var n=r.substract(Z,H);var ad=[];var F=[];var X,T;var A=O;var g=(q-1)/2;for(var Q=0;Q<q;++Q){X=null;T=null;if(Q!==0){p=r.add(p,G);n=r.add(n,G)}if(K||L){var E=Q-g;var o=s*Math.abs(E);if(K){if(K.drawOnCenter&&(!K.arrowSide||(K.arrowSide===W.SINGLE&&E<0)||(K.arrowSide===W.REVERSED&&E>0))){var ab=(K.arrowType===Kekule.Glyph.ArrowType.OPEN)?K.arrowLength*o/(K.arrowWidth/2):K.arrowLength;var X=r.add(p,r.multiply(V,ab/A))}if(!K.drawOnCenter&&((K.arrowSide===W.SINGLE&&Q===0)||(K.arrowSide===W.REVERSED&&Q===q-1))){Kekule.ArrayUtils.pushUnique(u,this.doDrawArrowShape(ae,f,n,p,K,x,true))}}if(L){if(L.drawOnCenter&&(!L.arrowSide||(L.arrowSide===W.SINGLE&&E<0)||(L.arrowSide===W.REVERSED&&E>0))){var ab=(L.arrowType===Kekule.Glyph.ArrowType.OPEN)?L.arrowLength*o/(L.arrowWidth/2):L.arrowLength;var T=r.substract(n,r.multiply(V,ab/A))}if(!L.drawOnCenter&&((L.arrowSide===W.SINGLE&&Q===0)||(L.arrowSide===W.REVERSED&&Q===q-1))){Kekule.ArrayUtils.pushUnique(u,this.doDrawArrowShape(ae,f,p,n,L,x))}}}var P;if(t===d.LINE){P=this.doDrawLineShape(ae,f,X||p,T||n,x,C)}ad.push(P.element);F.push(P.boundInfo)}if((q<=1)&&!u.length){return{element:ad[0],boundInfo:F[0]}}else{var m=this.createDrawGroup(ae);for(var Q=0;Q<q;++Q){this.addToDrawGroup(ad[Q],m)}for(var Q=0,O=u.length;Q<O;++Q){this.addToDrawGroup(u[Q],m)}return{element:m,boundInfo:F}}},_transformArrowLength:function(h,i,f){var l={x:i||0,y:f||0};var g=Kekule.CoordUtils.substract(this.transformCoordToContext(h,this.getChemObj(),l),this.transformCoordToContext(h,this.getChemObj(),{x:0,y:0}));return{arrowLength:Math.abs(g.x),arrowWidth:Math.abs(g.y)}},doDrawArrowShape:function(i,g,m,l,r,q,h){var G=Kekule.CoordUtils;var t=Kekule.Glyph.ArrowSide;var s=Kekule.Glyph.ArrowType;var E=G.substract(l,m);var n=G.getDistance(l,m);var o=E.y/n;var H=E.x/n;var y=r.arrowLength;var D=r.arrowWidth;var F=D/2;var p=G.substract(l,G.multiply(E,y/n));var C={x:F*o,y:-F*H};var x;var w;var u=Kekule.Render.DrawPathUtils;var A=[];if(!r.arrowSide||(!h&&r.arrowSide===t.SINGLE)||(h&&r.arrowSide===t.REVERSED)){x=G.add(p,C);A.push("M");A.push([x.x,x.y]);A.push("L");A.push([l.x,l.y])}else{A.push("M");A.push([l.x,l.y])}if(!r.arrowSide||(!h&&r.arrowSide===t.REVERSED)||(h&&r.arrowSide===t.SINGLE)){w=G.substract(p,C);A.push("L");A.push([w.x,w.y])}var B=false;if(r.arrowType===s.TRIANGLE){var v=(x&&w)?null:p;if(v){A.push("L");A.push([v.x,v.y])}A.push("Z");B=true}var z=u.makePath.apply(this,A);var f=Object.create(q);if(!B){f.fillColor="transparent"}return this.drawPath(i,z,f)},doDrawLineShape:function(i,f,n,m,o,g){var l=this.drawLine(i,n,m,o);var h=this.createLineBoundInfo(n,m,o.strokeWidth);return{element:l,boundInfo:h}}});Kekule.Render.PathGlyph2DRenderer=Class.create(Kekule.Render.BaseGlyph2DRenderer,{CLASS_NAME:"Kekule.Render.PathGlyph2DRenderer",initialize:function($super,h,f,g){$super(h,f,g);this._concreteChemObj=h.getCtab();this._concreteRenderer=new Kekule.Render.PathGlyphCtab2DRenderer(h.getCtab(),f,this)},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize();this._concreteRenderer=null}},getRenderCache:function(f){return this._concreteRenderer.getRenderCache(f)},_getConcreteRendererDrawOptions:function(f){return f},isChemObjRenderedBySelf:function($super,g,h){var f=$super(g,h)||(h===this.getChemObj())||this._concreteRenderer.isChemObjRenderedBySelf(g,h);return f},isChemObjRenderedDirectlyBySelf:function($super,f,g){return $super(f,g)||(g===this.getChemObj())},doSetRedirectContext:function($super,f){$super(f);this._concreteRenderer.setRedirectContext(f)},doDraw:function($super,g,h,f){$super(g,h,f);var i=this.getChemObj();return this._concreteRenderer.draw(g,h,this._getConcreteRendererDrawOptions(f))},doRedraw:function(f){return this._concreteRenderer.redraw(f)},doUpdate:function(g,l,f){var i=this._extractObjsOfUpdateObjDetails(l);if(i.indexOf(this.getChemObj())>=0){var h=this.getRenderCache(g);this.doClear(g);return this.draw(g,h.baseCoord,h.options)}return this._concreteRenderer.doUpdate(g,l,f)},doClear:function(f){return this._concreteRenderer.clear(f)},estimateRenderBox:function(h,g,f){return this._concreteRenderer.estimateRenderBox(h,this._getConcreteRendererDrawOptions(g),f)},transformCoordToObj:function(f,i,h){var g=(this.getChemObj()===i)?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToObj(f,g,h)},transformCoordToContext:function(f,i,h){var g=(this.getChemObj()===i)?this._concreteChemObj:i;return this._concreteRenderer.transformCoordToContext(f,g,h)}});Kekule.Render.Renderer2DFactory.register(Kekule.Glyph.PathGlyph,Kekule.Render.PathGlyph2DRenderer)})();"use strict";Kekule.Render.CanvasRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.CanvasRendererBridge",DEF_DOUBLE_BUFFERED:false,SHADOW_CANVAS_FIELD:"__$shadow_canvas__",SHADOW_CONTEXT_FIELD:"__$shadow_context__",getShadowContext:function(a){return a[this.SHADOW_CONTEXT_FIELD]},getShadowCanvas:function(a){return a[this.SHADOW_CANVAS_FIELD]},getOperatingContext:function(a){return this.getShadowContext(a)||a},createContext:function(e,b,h,a,c){if(c===undefined){c=this.DEF_DOUBLE_BUFFERED}var g=e.ownerDocument;var d=document.createElement("canvas");if(a){d.id=a}e.appendChild(d);var i=d.getContext("2d");if(c){var f=document.createElement("canvas");f.style.position="absolute";f.style.display="none";e.appendChild(f);i[this.SHADOW_CANVAS_FIELD]=f;i[this.SHADOW_CONTEXT_FIELD]=f.getContext("2d")}this.setContextDimension(i,b,h);return i},releaseContext:function(b){var a=b.canvas;var d=this.getShadowCanvas(b);var c=a.parentNode;if(c){c.removeChild(a);if(d){c.removeChild(d)}}},getContextDimension:function(a){return{width:a.canvas.width,height:a.canvas.height}},setContextDimension:function(b,d,a){var c=this.getShadowCanvas(b);if(d){b.canvas.width=d;b.canvas.style.width=d+"px";if(c){c.width=d;c.style.width=d+"px"}}if(a){b.canvas.height=a;b.canvas.style.height=a+"px";if(c){c.height=a;c.style.height=a+"px"}}},getContextElem:function(a){return a?a.canvas:null},setContextViewBox:function(d,a,f,c,e,b){},clearContext:function(a){var c=a.canvas;c.width=c.width;var b=this.getShadowCanvas(a);if(b){b.width=b.width}},renderContext:function(a){var b=this.getShadowCanvas(a);if(b){a.drawImage(b,0,0)}},transformContextCoordToScreen:function(a,b){return b},transformScreenCoordToContext:function(a,b){return b},canModifyGraphic:function(a){return false},_drawDashLine:function(c,h,g,f){if(f==undefined){f=5}c.moveTo(h.x,h.y);var e=g.x-h.x;var d=g.y-h.y;var i=Math.floor(Math.sqrt(e*e+d*d)/f);var n=e/i;var m=d/i;var a=0;var b=h.x;var l=h.y;while(a++<i){b+=n;l+=m;c[a%2==0?"moveTo":"lineTo"](b,l)}c[a%2==0?"moveTo":"lineTo"](g.x2,g.y)},drawLine:function(a,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);if(b.strokeDash&&(!this.isLineDashSupported(c))){this._drawDashLine(c,e,d,b.strokeDash)}else{c.moveTo(e.x,e.y);c.lineTo(d.x,d.y)}this.doneDraw(c,b)},drawTriangle:function(a,f,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);c.moveTo(f.x,f.y);c.lineTo(e.x,e.y);c.lineTo(d.x,d.y);c.closePath();this.doneDraw(c,b)},drawRect:function(a,e,d,b){var c=this.getOperatingContext(a);c.beginPath();this.setDrawStyle(c,b);c.rect(e.x,e.y,d.x-e.x,d.y-e.y);this.doneDraw(c,b)},drawRoundRect:function(b,e,d,a,c){return this.drawRect(b,e,d,c)},drawCircle:function(b,e,a,c){var d=this.getOperatingContext(b);d.beginPath();this.setDrawStyle(d,c);d.arc(e.x,e.y,a,0,2*Math.PI,false);this.doneDraw(d,c)},_PATH_CMDS:["M","Z","L","C","Q"],_PATH_METHODS:["moveTo","closePath","lineTo","bezierCurveTo","quadraticCurveTo"],drawPath:function(n,o,p){var d=this.getOperatingContext(n);if(o.length<=0){return}d.beginPath();this.setDrawStyle(d,p);var b;for(var f=0,e=o.length;f<e;++f){b=[];var m=o[f];var h=m.method.toUpperCase();var g=this._PATH_CMDS.indexOf(h);var a;if(g>=0){var a=this._PATH_METHODS[g];b=m.params;d[a].apply(d,b)}}this.doneDraw(d,p)},isLineDashSupported:function(a){return(a.setLineDash&&(typeof(a.lineDashOffset)=="number"))},setDrawStyle:function(b,a){if(Kekule.ObjUtils.notUnset(a.strokeWidth)){b.lineWidth=a.strokeWidth}else{b.lineWidth=1}if(a.strokeColor){b.strokeStyle=a.strokeColor}if(this.isLineDashSupported(b)){if(a.strokeDash){var c=(a.strokeDash===true)?[5]:Kekule.ArrayUtils.isArray(a.strokeDash)?a.strokeDash:[a.strokeDash];b.setLineDash(c)}else{b.setLineDash([])}}if(a.fillColor){b.fillStyle=a.fillColor}else{b.fillStyle="transparent"}if(Kekule.ObjUtils.notUnset(a.opacity)){b.globalAlpha=a.opacity}else{b.globalAlpha=1}},doneDraw:function(b,a){b.stroke();if(a.fillColor){b.fill()}},getCanvasFontStyle:function(b){var a="";if(b.fontStyle){a+=b.fontStyle+" "}if(b.fontWeight){a+=b.fontWeight+" "}if(b.fontSize){a+=b.fontSize+"px "}if(b.fontFamily){a+=b.fontFamily+" "}return a},drawText:function(a,h,g,b){var c=this.getOperatingContext(a);var d=c.font;var f=c.fillStyle;var e=this.getCanvasFontStyle(b);this.setDrawStyle(c,b);c.font=e;if(b.color){c.fillStyle=b.color}c.textBaseline="top";c.fillText(g,h.x,h.y);c.fontStyle=d;c.fillStyle=f},canMeasureText:function(a){return true},measureText:function(d,f,c){var e=this.getCanvasFontStyle(c);d.font=e;var b=d.measureText(f);var a={width:b.width,height:c.fontSize};return a},canMeasureDrawnText:function(a){return false},canModifyText:function(a){return false},createGroup:function(a){},addToGroup:function(a,b){},removeFromGroup:function(a,b){},exportToDataUrl:function(c,a,b){var d=this.getContextElem(c);return d?d.toDataURL(a,b):null}});Kekule.Render.CanvasRendererBridge.isSupported=function(){var a=false;if(document&&document.createElement){a=!!document.createElement("canvas").getContext}return a};Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.CanvasRendererBridge,20);if(this.Raphael){Raphael.fn.line=function(b,d,a,c){return this.path("M"+b+" "+d+" L"+a+" "+c)};Raphael.fn.arrowLine=function(c,h,a,g,m){if(!m){return this.line(c,h,a,g)}var p=this.set();var o=a-c;var n=g-h;var f=Math.atan(n/o);var b=(m.width||6)/2;var d=m.length||3;var i=Math.atan(b/d);var e=Math.sqrt(Math.sqr(b)+Math.sqr(d));p.push(this.path("M"+a+" "+g+" L"+(a-e*Math.cos(f-i))+" "+(g-e*Math.sin(f-i))+" M"+a+" "+g+" L"+(a-e*Math.cos(f+i))+" "+(g-e*Math.sin(f+i))),this.path("M"+c+" "+h+" L"+a+" "+g));return p};Raphael.fn.triangle=function(d,f,b,e,a,c){return this.path("M"+d+" "+f+" L"+b+" "+e+" L"+a+" "+c+" L"+d+" "+f)};Raphael.fn.polygon=function(d){var c="M"+d[0].x+" "+d[0].y;for(var b=1,a=d.length;b<a;++b){c+=" L"+d[b].x+" "+d[b].y}c+="L"+d[0].x+" "+d[0].y;return this.path(c)};Raphael.el.translateCoord=function(b){if(this.forEach){this.forEach(function(c){c.translateCoord(b)})}else{var a=this.attr(["x","y"]);if((typeof(a.x)!="undefined")&&(typeof(a.y)!="undefined")){this.attr({x:a.x+b.x,y:a.y+b.y})}}return this};Raphael.st.translateCoord=function(a){if(this.forEach){this.forEach(function(b){b.translateCoord(a)})}return this};Raphael.st.remove=function(a){this.forEach(function(b){b.remove()},this);this.clear()}}Kekule.Render.RaphaelRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.RaphaelRendererBridge",createContext:function(b,c,a){return Raphael(b,c,a)},releaseContext:function(a){a.remove()},getContextDimension:function(a){return{width:a.width,height:a.height}},setContextDimension:function(b,c,a){b.setSize(c,a)},clearContext:function(a){a.clear()},getContextElem:function(a){return a?a.canvas:null},transformContextCoordToScreen:function(a,b){return b},transformScreenCoordToContext:function(a,b){return b},canModifyGraphic:function(a){return true},drawPath:function(a,m,n){var d="";for(var f=0,b=m.length;f<b;++f){var g=m[f];d+=g.method;if(g.params&&g.params.length){for(var e=0,c=g.params.length;e<c;++e){d+=(e===0)?"":",";if(DataType.isArrayValue(g.params[e])){d+=g.params[e].join(",")}else{d+=g.params[e]}}}}var h=a.path(d);this.setBasicElemAttribs(h,n);return h},drawLine:function(c,e,d,b){var a=c.line(e.x,e.y,d.x,d.y);this.setBasicElemAttribs(a,b);return a},drawTriangle:function(c,f,e,d,b){var a=c.triangle(f.x,f.y,e.x,e.y,d.x,d.y);this.setBasicElemAttribs(a,b);return a},drawRect:function(c,e,d,b){var a=c.rect(e.x,e.y,d.x-e.x,d.y-e.y);this.setBasicElemAttribs(a,b);return a},drawRoundRect:function(d,f,e,b,c){var a=d.rect(f.x,f.y,e.x-f.x,e.y-f.y,b);this.setBasicElemAttribs(a,c);return a},drawCircle:function(d,e,b,c){var a=d.circle(e.x,e.y,b);this.setBasicElemAttribs(a,c);return a},setBasicElemAttribs:function(b,a){if(Kekule.ObjUtils.notUnset(a.strokeWidth)){b.attr("stroke-width",a.strokeWidth)}if(a.strokeColor){b.attr("stroke",a.strokeColor)}if(a.strokeDash){var c="- ";b.attr("stroke-dasharray",c)}if(a.fillColor){b.attr("fill",a.fillColor)}if(a.opacity){b.attr({"stroke-opacity":a.opacity,"fill-opacity":a.opacity})}},getRaphaelFontStyle:function(b){var a={};if(b.fontStyle){a["font-style"]=b.fontStyle}if(b.fontWeight){a["font-weight"]=b.fontWeight}if(b.fontSize){a["font-size"]=b.fontSize+"px"}if(b.fontFamily){a["font-family"]=b.fontFamily}return a},drawText:function(b,f,e,a){var d=this.getRaphaelFontStyle(a);var c=b.text(-10000,-10000,e);c.attr(d);if(a.color){c.attr({stroke:a.color,fill:a.color})}this.modifyDrawnTextCoord(b,c,f);this.setBasicElemAttribs(c,a);return c},canMeasureText:function(a){return false},canMeasureDrawnText:function(a){return true},canModifyText:function(a){return true},measureDrawnText:function(c,f,b){var e=Kekule.oneOf;var d=f.getBBox();var a={};a.width=e(d.width,(d.x2-d.x1));a.height=e(d.height,(d.y2-d.y1));return a},modifyDrawnTextCoord:function(b,d,a){var c=this.measureDrawnText(b,d,null);d.attr({x:a.x+c.width/2,y:a.y+c.height/2})},createGroup:function(a){return a.set()},addToGroup:function(a,b){return b.push(a)},removeFromGroup:function(a,b){if(a!==b){return b.exclude(a)}else{return false}},removeDrawnElem:function(a,b){b.remove()},exportToDataUrl:function(d,b,c){if(d.toSVG){var a=d.toSVG();return"data:image/svg+xml;base64,"+btoa(a)}else{if(d.canvas&&(d.canvas.tagName.toLowerCase()==="svg")){var a=XmlUtility.serializeNode(d.canvas);return"data:image/svg+xml;base64,"+btoa(a)}}}});Kekule.Render.RaphaelRendererBridge.isSupported=function(){var a=false;if($jsRoot.Raphael){a=!!(Raphael.svg||Raphael.vml)}return a};Kekule.Render.DrawBridge2DMananger.register(Kekule.Render.RaphaelRendererBridge,10);(function(){var f=Kekule.ObjUtils;var c=Kekule.BoxUtils;var d=Kekule.Render.Molecule3DDisplayType;var h=Kekule.Render.Bond3DRenderMode;var b=Kekule.Render.Bond3DRenderType;var a=Kekule.Render.Bond3DSpliceMode;var e=Kekule.Render.Node3DRenderMode;var g=Kekule.oneOf;Kekule.Render.Abstract3DDrawBridge=Class.create({CLASS_NAME:"Kekule.Render.Abstract3DDrawBridge",getGraphicQualityLevel:function(){return null},setGraphicQualityLevel:function(i){},transformContextCoordToScreen:function(i,l){return{x:l.x,y:l.y}},canModifyGraphic:function(i){return false},createContext:function(l,m,i){return null},getContextDimension:function(i){return{}},setContextDimension:function(l,m,i){return null},clearContext:function(i){return null},drawSphere:function(m,n,i,l){},drawCylinder:function(m,o,n,i,l){},drawLine:function(l,n,m,i){},createDrawGroup:function(i){},addToDrawGroup:function(i,l){},removeFromDrawGroup:function(i,l){},getCameraProps:function(i){},setCameraProps:function(i,l){},exportToDataUrl:function(m,i,l){}});Kekule.Render.Base3DRenderer=Class.create(Kekule.Render.AbstractRenderer,{CLASS_NAME:"Kekule.Render.Base3DRenderer",initialize:function($super,m,i,l){$super(m,i,l)},getRendererType:function(){return Kekule.Render.RendererType.R3D},getActualTargetContext:function(i){return this.getRedirectContext()||i},getCameraProps:function(i){return this.getDrawBridge().getCameraProps(i)},setCameraProps:function(i,l){return this.getDrawBridge().setCameraProps(i,l)},drawSphere:function(m,n,i,l){return this.getDrawBridge().drawSphere(this.getActualTargetContext(m),n,i,l)},drawCylinder:function(n,p,o,l,m){var i=this.getDrawBridge();return i?i.drawCylinder(this.getActualTargetContext(n),p,o,l,m):null},drawCylinderEx:function(o,r,q,l,m){var i=null;var p=this.drawCylinder(o,r,q,l,m);if(p&&m.withEndCaps){i=this.createDrawGroup(o);var n=this.drawSphere(o,r,l);this.addToDrawGroup(n,i);var n=this.drawSphere(o,q,l);this.addToDrawGroup(n,i)}return i||p},drawParallelCylinders:function(m,s,o){var t=this.getDrawBridge();if(t.drawParallelCylinders){return t.drawParallelCylinders(this.getActualTargetContext(m),s,o)}else{var u=this.createDrawGroup(m);for(var r=0,p=s.length;r<p;++r){var n=s[r];var q=this.drawCylinderEx(m,n.coord1,n.coord2,n.radius,{color:n.color,withEndCaps:o});this.addToDrawGroup(q,u)}return u}},drawLine:function(m,o,n,l){var i=this.getDrawBridge();return i?i.drawLine(this.getActualTargetContext(m),o,n,l):null},drawParallelLines:function(p,o){var m=this.getDrawBridge();if(m.drawParallelLines){return m.drawParallelLines(this.getActualTargetContext(p),o,drawEndCaps)}else{if(m.drawLine){var r=o.length;var l=[];for(var n=0;n<r;++n){var s=o[n];var q=this.drawLine(p,s.coord1,s.coord2,{lineWidth:s.lineWidth,color:s.color,opacity:s.opacity});l.push(q)}return l}}},createDrawGroup:function(i){return this.getDrawBridge().createGroup(this.getActualTargetContext(i))},addToDrawGroup:function(i,l){return this.getDrawBridge().addToGroup(i,l)},removeFromDrawGroup:function(i,l){return this.getDrawBridge().removeFromGroup(i,l)},removeDrawnElem:function(i,l){}});Kekule.Render.ChemObj3DRenderer=Class.create(Kekule.Render.Base3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObj3DRenderer",initialize:function($super,m,i,l){$super(m,i,l);this._enableTransformByCamera=true},doEstimateObjBox:function(m,l,i){var n=this.getChemObj();if(n.getExposedContainerBox3D){return n.getExposedContainerBox3D(i)}else{if(n.getContainerBox3D){return n.getContainerBox3D(i)}else{return null}}},doEstimateRenderBox:function(m,n,l,i){var q=this.estimateObjBox(m,l,i);if(q){var o=this.prepareTransformParams(m,n,l,q);var r=o;return c.transform3D(q,r)}else{return null}},beginDraw:function($super,m,n,l){$super(m,n,l);if(this.isRootRenderer()){var i=this.getDrawBridge();if(i&&i.setGraphicQualityLevel){var o=l.graphicQuality;i.setGraphicQualityLevel(o)}}},endDraw:function($super,l,m,i){if(this.isRootRenderer()){this.adjustCamera(l,i.transformParams)}$super(l,m,i)},doDraw:function($super,m,n,l){this.prepareTransformParams(m,n,l);var i=$super(m,n,l)},changeGeometryOptions:function(i,m,o){var l=Object.create(o);var n=this.prepareTransformParams(i,m,l);if(n.pureCameraTransform){this.endDraw(i,m,l)}else{this.getDrawBridge().clearContext(i);this.draw(i,m,o)}},prepareTransformParams:function(m,n,r,s){var i;if(r.transformParams){i=r.transformParams}else{var q=this.generateTransformParams(m,n,r,s);r.transformParams=q;i=q}var l=Kekule.CoordUtils.calcTransform3DMatrix(i);var o=Kekule.CoordUtils.calcInverseTransform3DMatrix(i);r.transformParams.transformMatrix=l;r.transformParams.invTransformMtrix=o;this.getRenderCache(m).transformParams=i;this.getRenderCache(m).transformMatrix=l;this.getRenderCache(m).invTransformMatrix=o;this.getRenderCache(m).transformParams=i;return i},canDoPureCameraTransform:function(i,m){var l=this._enableTransformByCamera&&(m.scaleX===m.scaleY)&&(m.scaleY===m.scaleZ)&&(!m.rotateAngle)&&(!m.rotateX)&&(!m.rotateY)&&(!m.rotateZ);return l},generateTransformParams:function(i,H,n,x){var r={};r.allowCoordBorrow=g(n.allowCoordBorrow,false);r.unitLength=n.unitLength||1;if(!x){x=this.estimateObjBox(i,n,r.allowCoordBorrow)}var A={x:(x.x1+x.x2)/2,y:(x.y1+x.y2)/2,z:(x.z1+x.z2)/2};var o=Kekule.ObjUtils;if(o.isUnset(n.translateX)&&o.isUnset(n.translateY)&&o.isUnset(n.translateZ)){if(H){r.translateX=H.x-A.x;r.translateY=H.y-A.y;r.translateZ=H.z||0-A.z||0}}r.zoom=n.zoom||1;r.scaleX=g(n.scaleX,n.scale,1);r.scaleY=g(n.scaleY,n.scale,1);r.scaleZ=g(n.scaleZ,n.scale,1);var G=!(n.scaleX||n.scaleY||n.scaleZ||n.scale);if(f.notUnset(n.rotateMatrix)){r.rotateMatrix=n.rotateMatrix}else{if(f.notUnset(n.rotateAngle)&&f.notUnset(n.rotateAxisVector)){r.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:n.rotateAngle,rotateAxisVector:n.rotateAxisVector})}else{if(r.rotateX||r.rotateY||r.rotateZ){r.rotateMatrix=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:n.rotateX||0,rotateY:n.rotateY||0,rotateZ:n.rotateZ||0})}}}if(o.isUnset(n.center)){r.center=A}if(H){r.drawBaseCoord=H}else{r.drawBaseCoord=Kekule.CoordUtils.transform3D(A,r)}var p=Object.extend({},r);r=this.getFinalTransformParams(i,r);r.initialTransformOptions=p;var t=this.canDoPureCameraTransform(i,r);r.pureCameraTransform=t;if(this.isRootRenderer()){if(n.autofit||(!n.cameraPos)){var C=this.getAutofitObjBoxInflation(i,this.getChemObj(),n);var I=Kekule.BoxUtils.inflateBox(x,C.x,C.y,C.z);var s=Math.max(I.x2-I.x1,I.y2-I.y1);var J=this.getCameraProps(i);var B=s/2/Math.tan(J.fov/2);var y=Math.sqrt(Math.sqr(B)-Math.sqr(s/2));if(t){y=y/r.scaleX;r.cameraWidth=s/r.scaleX;r.cameraHeight=r.cameraWidth;var E=Kekule.MatrixUtils.create(4,1,[0,0,1,1]);var F=Kekule.MatrixUtils.create(4,1,[0,1,1,1]);var z,v;var D,m;if(r.rotateMatrix){var q=Kekule.MatrixUtils.transpose(r.rotateMatrix);z=Kekule.MatrixUtils.multiply(q,E);D=Kekule.MatrixUtils.multiply(q,F);v={x:z[0],y:z[1],z:z[2]};m={x:D[0],y:D[1],z:D[2]}}else{v={x:0,y:0,z:1};m={x:0,y:1,z:1}}v=Kekule.CoordUtils.multiply(v,y);r.cameraPos={x:v.x,y:v.y,z:v.z};r.cameraPos=Kekule.CoordUtils.add(r.cameraPos,r.drawBaseCoord);r.cameraUp=m;r.scaleX=r.scaleY=r.scaleZ=1;r.rotateMatrix=null}else{r.cameraPos={x:r.drawBaseCoord.x,y:r.drawBaseCoord.y,z:y+r.drawBaseCoord.z};r.cameraUp={x:0,y:1,z:1}}r.cameraLookAtVector=r.drawBaseCoord||{x:0,y:0,z:0};var u={x:-r.translateX,y:-r.translateY,z:-r.translateZ};r.translateX=r.translateY=r.translateZ=0;r.cameraPos=Kekule.CoordUtils.add(r.cameraPos,u);r.cameraLookAtVector=Kekule.CoordUtils.add(r.cameraLookAtVector,u)}}return r},getFinalTransformParams:function(l,m){var i=Object.create(m);if(i.zoom){i.scaleX*=i.zoom;i.scaleY*=i.zoom;i.scaleZ*=i.zoom}if(i.unitLength!==1){i.translateX*=i.unitLength;i.translateY*=i.unitLength;i.translateZ*=i.unitLength;if(i.drawBaseCoord){i.drawBaseCoord=Kekule.CoordUtils.multiply(i.drawBaseCoord,i.unitLength)}}return i},getRenderFinalTransformParams:function(i){return this.getRenderCache(i).transformParams},getRenderInitialTransformOptions:function(i){var l=this.getRenderFinalTransformParams(i);return l?l.initialTransformOptions:null},getAutofitObjBoxInflation:function(i,n,m){var l=m.fixedNodeRadius||0;return{x:l,y:l,z:l}},adjustCamera:function(o,q){var l=q.cameraWidth;var p=q.cameraHeight;var m={position:q.cameraPos,upVector:q.cameraUp,lookAtVector:q.cameraLookAtVector};if(l&&p){var i=l/2;var n=p/2;m.left=-i;m.right=i;m.top=n;m.bottom=-n}this.setCameraProps(o,m)}});Kekule.Render.ChemCtab3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemCtab3DRenderer",TRANSFORM_COORD_FIELD:"__$transCoord3D__",DRAW_ELEM_FIELD:"__$drawElem__",DRAW_COLOR_FIELD:"__$drawColor__",BASE_RADIUS_FIELD:"__$baseRadius__",TRANSFORM_MATRIX_FIELD:"__$transMatrix__",INV_TRANSFORM_MATRIX_FIELD:"__$inverseTransMatrix__",CHILD_TRANSFORM_MATRIX_FIELD:"__$childTransMatrix__",HIDDEN_NODES_FIELD:"__$hiddenNodes__",HIDDEN_CONNECTORS_FIELD:"__$hiddenConnectors__",getObjDrawElem:function(i,l){return this.getExtraProp2(i,l,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(i,m,l){this.setExtraProp2(i,m,this.DRAW_ELEM_FIELD,l)},getObjDrawColor:function(i,l){return this.getExtraProp2(i,l,this.DRAW_COLOR_FIELD)},setObjDrawColor:function(i,m,l){this.setExtraProp2(i,m,this.DRAW_COLOR_FIELD,l)},getNodeBaseRadius:function(i,l){return this.getExtraProp2(i,l,this.BASE_RADIUS_FIELD)},setNodeBaseRadius:function(i,m,l){this.setExtraProp2(i,m,this.BASE_RADIUS_FIELD,l)},getHiddenNodes:function(i){return this.getExtraProp(i,this.HIDDEN_NODES_FIELD)||[]},setHiddenNodes:function(i,l){return this.setExtraProp(i,this.HIDDEN_NODES_FIELD,l)},getHiddenConnectors:function(i){return this.getExtraProp(i,this.HIDDEN_CONNECTORS_FIELD)||[]},setHiddenConnectors:function(i,l){return this.setExtraProp(i,this.HIDDEN_CONNECTORS_FIELD,l)},doEstimateObjBox:function(m,l,i){var n=this.getChemObj().getExposedContainerBox3D(i);return n},doPrepare:function(l,s,r,t){var p=t;var q=this.getRenderCache(l);var n,o;switch(p.moleculeDisplayType){case d.WIRE:n=e.NONE;o=p.displayMultipleBond?h.MULTI_WIRE:h.WIRE;break;case d.STICKS:n=e.NONE;o=p.displayMultipleBond?h.MULTI_CYLINDER:h.CYLINDER;break;case d.SPACE_FILL:n=e.SPACE;o=h.NONE;break;case d.BALL_STICK:default:n=e.BALL;o=p.displayMultipleBond?h.MULTI_CYLINDER:h.CYLINDER;break}q.nodeRenderMode=n;q.connectorRenderMode=o;q.options=p;var i=s.getExposedNodes();var m=s.getExposedConnectors();this.prepareHiddenObjects(l,i,m,p);this.prepareNodesDrawColor(l,i,p);this.prepareNodeBaseRadii(l,i,p);return p},prepareHiddenObjects:function(n,m,q,o){var w=[];this.setHiddenNodes(n,w);for(var v=0,t=m.length;v<t;++v){var r=m[v];if(o.hideHydrogens&&(r instanceof Kekule.Atom)&&(r.getAtomicNumber()===1)){w.push(r)}}var x=[];this.setHiddenConnectors(n,x);for(var v=0,t=q.length;v<t;++v){var s=q[v];var u=s.getConnectedExposedObjs();var p=Kekule.ArrayUtils.exclude(u,w);if(p<2){x.push(s)}}},prepareNodesDrawColor:function(o,n,p){var m=p.useAtomSpecifiedColor;for(var u=0,r=n.length;u<r;++u){var q=n[u];var t=q.getOverriddenRender3DOptions()||{};var s=t.color||t.atomColor;if(s&&(!t.useAtomSpecifiedColor)){}else{if(m||t.useAtomSpecifiedColor){var v=q.getAtomicNumber?q.getAtomicNumber():0;s=Kekule.Render.RenderColorUtils.getColor(v,this.getRendererType())}else{s=g(t.color||p.atomColor)}}this.setObjDrawColor(o,q,s)}},prepareNodeBaseRadii:function(r,p,o){for(var q=0,n=p.length;q<n;++q){var m;var s=p[q];m=this.calcNodeBaseRadius(s,o);this.setNodeBaseRadius(r,s,m)}},calcNodeBaseRadius:function(n,l){var o=n.getOverriddenRender3DOptions()||{};var i=n.getAtomicNumber?n.getAtomicNumber():null;if(o.nodeRadius||l.nodeRadius){radius=o.nodeRadius||l.nodeRadius}else{if(g(o.useVdWRadius,l.useVdWRadius)&&i){var m=Kekule.ChemicalElementsDataUtil.getElementProp(i,"radiiVdw")||o.fixedNodeRadius||l.fixedNodeRadius;radius=m}else{radius=g(o.fixedNodeRadius,l.fixedNodeRadius)}}return radius},doDraw:function($super,l,n,i){$super(l,n,i);var p=this.getChemObj();var m=i.transformParams;this.getRenderCache(l).transformOptions=m;this.transformCtabCoords3DToContext(l,p,m);var o=this.doPrepare(l,p,n,i);return this.doDrawCore(l,p,o,m)},doRedraw:function(i){var l=this.getRenderCache(i);return this.doDrawCore(i,this.getChemObj(),l.options,l.transformOptions)},doDrawCore:function(l,o,i,m){var n=this.createDrawGroup(l);this.doDrawConnectors(l,n,o,i,m);this.doDrawNodes(l,n,o,i,m);this.setObjDrawElem(l,o,n);return n},transformCtabCoords3DToContext:function(m,u,r){var p=r.allowCoordBorrow;r.scaleX=r.scaleX||r.scale;r.scaleY=(r.scaleY||r.scale);r.scaleZ=(r.scaleZ||r.scale);var s=Object.extend({},r);s.centerX=0;s.centerY=0;var x;var t=r.transformMatrix;this.setExtraProp2(m,u,this.TRANSFORM_MATRIX_FIELD,t);var n=t;this.setExtraProp2(m,u,this.CHILD_TRANSFORM_MATRIX_FIELD,t);var w=r.invTransformMatrix;this.setExtraProp2(m,u,this.INV_TRANSFORM_MATRIX_FIELD,w);for(var v=0,q=u.getNodeCount();v<q;++v){var o=u.getNodeAt(v);this.transformObjCoord3DToContext(m,o,t,n,p)}},transformObjCoord3DToContext:function(s,t,q,n,p){if(t&&t.getAbsBaseCoord3D){coord=t.getAbsBaseCoord3D(p);if(coord){var m=Kekule.CoordUtils.transform3DByMatrix(coord,q);this.setTransformedCoord3D(s,t,m)}if(t.getNodes){for(var r=0,o=t.getNodeCount();r<o;++r){this.transformObjCoord3DToContext(s,t.getNodeAt(r),n,n,p)}}}},getTransformedCoord3D:function(o,q,n){if(Kekule.ObjUtils.isUnset(n)){n=this.getRenderCache(o).options.transformParams.allowCoordBorrow}var l=this.getExtraProp2(o,q,this.TRANSFORM_COORD_FIELD);if(!l){var p=this.getChemObj();var m=this.getExtraProp2(o,p,this.TRANSFORM_MATRIX_FIELD);var i=this.getExtraProp2(o,p,this.CHILD_TRANSFORM_MATRIX_FIELD);if(p&&(p.hasNode(q,false)||p.hasConnector(q,false))){this.transformObjCoord3DToContext(q,m,i,n)}else{this.transformObjCoord3DToContext(q,i,i,n)}}return this.getExtraProp2(o,q,this.TRANSFORM_COORD_FIELD)},setTransformedCoord3D:function(i,l,m){this.setExtraProp2(i,l,this.TRANSFORM_COORD_FIELD,m)},doTransformCoordToObj:function(l,n,m){var i=this.getExtraProp2(l,n,this.INV_TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(m,i)},doTransformCoordToContext:function(l,n,m){var i=this.getExtraProp2(l,n,this.TRANSFORM_MATRIX_FIELD);return Kekule.CoordUtils.transform3DByMatrix(m,i)},doDrawNodes:function(n,v,s,w,o){var m=s.getExposedNodes();var u=this.getHiddenNodes(n);for(var t=0,r=m.length;t<r;++t){var q=m[t];if(u.indexOf(q)>=0){continue}var p=this.doDrawNode(n,v,q,s,w,o)}},doDrawNode:function(l,t,n,q,u,m){var v;var o=this.getRenderCache(l).nodeRenderMode;if(o===e.NONE){return null}else{op=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(n,u);var i;i=this.getNodeBaseRadius(l,n);if(Kekule.ObjUtils.isUnset(i)){i=this.calcNodeBaseRadius(n,u)}if(o===e.SPACE){i*=m.scaleX}else{i*=op.nodeRadiusRatio*m.scaleX}var p=this.getObjDrawColor(l,n);var s=this.getTransformedCoord3D(l,n,m.allowCoordBorrow);v=this.drawSphere(l,s,i,{color:p,opacity:op.opacity});var r=this.createSphereBoundInfo(s,i);this.basicDrawObjectUpdated(l,n,q,r,Kekule.Render.ObjectUpdateType.ADD)}if(v){this.setObjDrawElem(l,n,v);if(t){this.addToDrawGroup(v,t)}}},doDrawConnectors:function(m,v,s,w,n){if(this.getRenderCache(m).connectorRenderMode===h.NONE){return null}var o=s.getExposedConnectors();var u=this.getHiddenConnectors(m);for(var t=0,r=o.length;t<r;++t){var q=o[t];if(u.indexOf(q)>=0){continue}var p=this.doDrawConnector(m,v,q,s,w,n)}},doDrawConnector:function(m,r,l,q,p,u){var t=Object.create(p);t=Kekule.Render.RenderOptionUtils.mergeObjLocalRender3DOptions(l,p);var B=this.getHiddenNodes(m);var s=l.getConnectedExposedObjs();s=Kekule.ArrayUtils.exclude(s,B);var v=s.length;var z,y;var o,n;var C=(v>2)?this.createDrawGroup(m):null;var A;for(var x=0;x<v;++x){z=s[x];o=this.getTransformedCoord3D(m,z,u.allowCoordBorrow);if(o){for(var w=x+1;w<v;++w){y=s[w];n=this.getTransformedCoord3D(m,y,u.allowCoordBorrow);if(n){A=this.doDrawConnectorShape(m,l,z,y,q,o,n,t,u);if(A&&C){this.addToDrawGroup(A,C)}}}}}if(C){this.addToDrawGroup(C,r)}else{this.addToDrawGroup(A,r)}return C||A},doDrawConnectorShape:function(am,p,J,I,v,aj,ai,Q,ah){var D=Kekule.CoordUtils;var G=p.getOverriddenRender3DOptions()||{};var T=Q.unitLength;var ab=g(G.bondSpliceMode,Q.bondSpliceMode);var L=(ab===a.MID_SPLIT)?0.5:null;if(ab===a.WEIGHTING_SPLIT){var B=this.getNodeBaseRadius(am,J);var A=this.getNodeBaseRadius(am,I);if(B&&A){L=B/(B+A)}else{L=0.5}}var y=null;var af=false;var aa=[];if(L){var n=g(Q.color||Q.bondColor);var W=g(G.color||G.bondColor);af=false;if(W){aa.push(W)}else{var P=g(this.getObjDrawColor(am,J),n);var N=g(this.getObjDrawColor(am,I),n);if(P!==N){aa.push(P);aa.push(N);af=true}else{aa.push(g(P,Q.color,Q.bondColor,Q.defBondColor))}}}else{aa.push(g(G.color,G.bondColor,Q.color,Q.bondColor,Q.defBondColor))}if(L&&af){var u=ai.x-aj.x;var t=ai.y-aj.y;var r=ai.z-aj.z;y={};y.x=aj.x+u*L;y.y=aj.y+t*L;y.z=aj.z+r*L}var X=af?[[aj,y],[y,ai]]:[[aj,ai]];var ak=this.getRenderCache(am).connectorRenderMode;var F=this._getBondRenderType(p,ak);var q=false;var al=g(G.connectorRadius,Q.connectorRadius)*g(G.connectorRadiusRatio,Q.connectorRadiusRatio)*Q.unitLength;al*=ah.scaleX;var K=g(G.connectorLineWidth,Q.connectorLineWidth)*Q.unitLength;if((F!==b.SINGLE)&&(F!==b.DASH)){al*=g(G.multiConnectorRadiusRatio,Q.multiConnectorRadiusRatio);q=(ak===h.MULTI_CYLINDER)}else{q=false}var S=[];var Y=1,x=0;switch(F){case b.SINGLE:Y=1;break;case b.DOUBLE:Y=2;break;case b.TRIPLE:Y=3;break;case b.DASH:case b.SOLID_DASH:}x=Y;var O=null;if(x>1){var z=g(G.multiConnectorMarginRatio,Q.multiConnectorMarginRatio)*al;if(q){z+=al*2}var Z=D.getDistance(aj,ai);var M=D.substract(ai,aj);var w=M.y/Z;var R=M.x/Z;var H={x:-z*w,y:z*R,z:0};O=((x%2)?0:0.5)-Math.floor(x/2);var s=D.multiply(H,O)}for(var ae=0,ac=X.length;ae<ac;++ae){if(x===1){var E={};E.coord1=X[ae][0];E.coord2=X[ae][1];if(af){E.jointCoordIndex=(ae===0)?2:1}E.color=aa[ae];E.radius=al;E.lineWidth=K;E.opacity=Q.opacity;S.push(E)}else{var o=D.add(X[ae][0],s);var m=D.add(X[ae][1],s);for(var ad=0;ad<x;++ad){var E={};E.coord1=o;E.coord2=m;o=D.add(o,H);m=D.add(m,H);if(af){E.jointCoordIndex=(ae===0)?2:1}E.color=aa[ae];E.radius=al;E.lineWidth=K;E.opacity=Q.opacity;S.push(E)}}}var V=ak;var ag;if((V===h.WIRE)||(V===h.MULTI_WIRE)){ag=this.createLineBoundInfo(aj,ai,{width:K})}else{ag=this.createCylinderBoundInfo(aj,ai,{radius:al})}this.basicDrawObjectUpdated(am,p,v,ag,Kekule.Render.ObjectUpdateType.ADD);return this.doDrawConnectorSet(am,S,V,F,Q)},doDrawConnectorSet:function(m,o,p,n,l){if((p===h.WIRE)||(p===h.MULTI_WIRE)){return this.drawParallelLines(m,o)}else{var i=this.getRenderCache(m).nodeRenderMode===e.NONE;return this.drawParallelCylinders(m,o,i)}},_getBondRenderType:function(l,m){var n=l.getOverriddenRender3DOptions()||{};var i=Kekule.Render.Render3DOptionUtils.getConnectorRenderType(n);if(i){return i}else{return Kekule.Render.ConnectorDrawUtils.getConnectorRender3DType(l,m)}}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.Render.ChemCtab3DRenderer);Kekule.Render.StructFragment3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.StructFragment3DRenderer",initialize:function($super,m,i,l){$super(m,i,l);this._concreteRenderer=null;if(m.hasCtab()){this._concreteRenderer=new Kekule.Render.ChemCtab3DRenderer(m.getCtab(),i,this)}else{this._concreteRenderer=null;Kekule.raise(Kekule.ErrorMsg.FORMULA_RENDERER_3D_NOT_AVAILABLE)}this._concreteRenderer.setParentRenderer(this)},finalize:function($super){$super();if(this._concreteRenderer){this._concreteRenderer.finalize()}},getRenderCache:function(i){return this._concreteRenderer.getRenderCache(i)},_getConcreteRendererDrawOptions:function(i){var l=Object.create(i);var n=this.getChemObj();var m=(this.getRendererType()===Kekule.Render.RendererType.R3D)?n.getOverriddenRender3DOptions():n.getOverriddenRenderOptions();l=Object.extend(l,m||{});return l},isChemObjRenderedBySelf:function($super,l,m){var i=$super(l,m)||(m===this.getChemObj())||this._concreteRenderer.isChemObjRenderedBySelf(l,m);return i},isChemObjRenderedDirectlyBySelf:function($super,i,l){return $super(i,l)||(l===this.getChemObj())},doSetRedirectContext:function($super,i){$super(i);this._concreteRenderer.setRedirectContext(i)},doDraw:function($super,l,m,i){$super(l,m,i);return this._concreteRenderer.draw(l,m,this._getConcreteRendererDrawOptions(i))},doRedraw:function(i){return this._concreteRenderer.redraw(i)},doUpdate:function(l,o,i){var n=this._extractObjsOfUpdateObjDetails(o);if(n.indexOf(this.getChemObj())>=0){var m=this.getRenderCache(l);this.doClear(l);return this.draw(l,m.baseCoord,m.options)}return this._concreteRenderer.doUpdate(l,o,i)},estimateRenderBox:function(m,l,i){return this._concreteRenderer.estimateRenderBox(m,this._getConcreteRendererDrawOptions(l),i)},transformCoordToObj:function(i,n,m){var l=(this.getChemObj()===n)?this._concreteChemObj:n;return this._concreteRenderer.transformCoordToObj(i,l,m)},transformCoordToContext:function(i,n,m){var l=(this.getChemObj()===n)?this._concreteChemObj:n;return this._concreteRenderer.transformCoordToContext(i,l,m)}});Kekule.Render.Mol3DRenderer=Kekule.Render.StructFragment3DRenderer;Kekule.Render.CompositeObj3DRenderer=Class.create(Kekule.Render.ChemObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeObj3DRenderer"});Kekule.Render.RendererDefineUtils.addCompositeRenderSupport(Kekule.Render.CompositeObj3DRenderer);Kekule.Render.CompositeMolecule3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.CompositeMolecule3DRenderer",getChildObjs:function(){var p=[];var q=this.getChemObj().getSubMolecules();for(var n=0,m=q.getItemCount();n<m;++n){var s=q.getObjAt(n);p.push(s)}return p}});Kekule.Render.ChemObjGroupList3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemObjGroupList3DRenderer",getChildObjs:function(){var p=this.getChemObj();if(p instanceof Kekule.ChemObjList){var o=[];for(var n=0,m=p.getItemCount();n<m;++n){o.push(p.getItemAt(n))}}else{if(p instanceof Kekule.ChemStructureObjectGroup){o=p.getAllObjs()}}return o}});Kekule.Render.ChemSpaceElement3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpaceElement3DRenderer",getChildObjs:function(){return this.getChemObj().getChildren().toArray()}});Kekule.Render.ChemSpace3DRenderer=Class.create(Kekule.Render.CompositeObj3DRenderer,{CLASS_NAME:"Kekule.Render.ChemSpace3DRenderer",getChildObjs:function(){return[this.getChemObj().getRoot()]}});Kekule.Render.Renderer3DFactory.register(Kekule.StructureFragment,Kekule.Render.StructFragment3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.CompositeMolecule,Kekule.Render.CompositeMolecule3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemObjList,Kekule.Render.ChemObjGroupList3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemStructureObjectGroup,Kekule.Render.ChemObjGroupList3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpaceElement,Kekule.Render.ChemSpaceElement3DRenderer);Kekule.Render.Renderer3DFactory.register(Kekule.ChemSpace,Kekule.Render.ChemSpace3DRenderer)})();if($jsRoot.THREE){THREE.Object3D.prototype.clear=function(){var b=this.children;for(var a=b.length-1;a>=0;a--){var c=b[a];c.clear();this.remove(c)}};THREE.Scene.prototype.clearMesh=function(){var b=this.children;for(var a=b.length-1;a>=0;a--){var c=b[a];if((c instanceof THREE.Mesh)||(c instanceof THREE.Line)||(c.__objGroup__)){c.clear();this.remove(c)}}}}Kekule.Render.ThreeObjectCache=Class.create({CLASS_NAME:"Kekule.Render.ThreeObjectCache",initialize:function(){this.cache=new Kekule.MapEx(true)},finalize:function(){this.cache.finalize();this.cache=null},createInstance:function(a,b){return null},isSameParams:function(d,c){if(d.length!==c.length){return false}for(var b=0,a=d.length;b<a;++b){if(!this.isParamEqual(d[b],c[b])){return false}}return true},isParamEqual:function(c,b){var a=(c===b);if(!a){if(DataType.isObjectValue(c)&&DataType.isObjectValue(b)){a=Kekule.ObjUtils.equal(c,b)}}return a},add:function(){var c=Array.prototype.slice.call(arguments);var b=c.shift();var d=this.cache.get(b);if(!d){d=[];this.cache.set(b,d)}var e={params:c};e.instance=this.createInstance(b,c);d.push(e);return e.instance},get:function(){var d=Array.prototype.slice.call(arguments);var b=d[0];var e=this.cache.get(b);if(e){d.shift();for(var f=0,c=e.length;f<c;++f){var g=e[f].params;if(this.isSameParams(g,d)){return e[f].instance}}d.unshift(b)}return this.add.apply(this,d)}});Kekule.Render.ThreeGeometryCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeGeometryCache",createInstance:function(d,f){var b=null;var c=f;var e=c[0];switch(d){case THREE.SphereGeometry:b=new THREE.SphereGeometry(c[1],c[2],c[3]);break;case THREE.CylinderGeometry:b=new THREE.CylinderGeometry(c[1],c[2],c[3],c[4],c[5],c[6]);break}return b}});Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeGeometryCache);Kekule.Render.ThreeMaterialCache=Class.create(Kekule.Render.ThreeObjectCache,{CLASS_NAME:"Kekule.Render.ThreeMaterialCache",createInstance:function(a,b){return new a(b[1])}});Kekule.ClassUtils.makeSingleton(Kekule.Render.ThreeMaterialCache);Kekule.Render.ThreeContext=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ThreeContext",initialize:function($super,c,a,b){$super();this.setScene(c);this.setCamera(a);this.setRenderer(b)},initProperties:function(){this.defineProp("scene",{dataType:DataType.OBJECT,serializable:false});this.defineProp("camera",{dataType:DataType.OBJECT,serializable:false});this.defineProp("renderer",{dataType:DataType.OBJECT,serializable:false});this.defineProp("width",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("height",{dataType:DataType.INT,serializable:false,setter:null})},getDimension:function(){return{width:this.getWidth(),height:this.getHeight()}},setDimension:function(b,a){this.setPropStoreFieldValue("width",b);this.setPropStoreFieldValue("height",a);this.getRenderer().setSize(b,a);var d=this.getCamera();if(d instanceof THREE.OrthographicCamera){d.left=b/-2;d.right=b/2;d.top=a/2;d.bottom=a/-2}else{d.aspect=b/a}d.updateProjectionMatrix()}});Kekule.Render.ThreeRendererBridge=Class.create({CLASS_NAME:"Kekule.Render.ThreeRendererBridge",_qualitySettings:[null,{sphereSegments:8,sphereRings:8,cylinderSegmentsRadius:8},{sphereSegments:16,sphereRings:16,cylinderSegmentsRadius:16},{sphereSegments:32,sphereRings:32,cylinderSegmentsRadius:32},{sphereSegments:64,sphereRings:64,cylinderSegmentsRadius:64}],initialize:function(){this.geometryCache=Kekule.Render.ThreeGeometryCache.getInstance();this.materialCache=Kekule.Render.ThreeMaterialCache.getInstance();this._quality=null;this._modelParams={}},finalize:function(){this.geometryCache=null;this.materialCache=null},getGraphicQualityLevel:function(){return this._quality},setGraphicQualityLevel:function(a){this._quality=a;this._modelParams=this.calcModelParams(a)},calcModelParams:function(b){var a=this._qualitySettings[b];if(!a){a=this._qualitySettings[Kekule.Render.Render3DGraphicQuality.MEDIUM]}return a},createContext:function(d,a,g){var i=Kekule.BrowserFeature;var f=i.webgl?new THREE.WebGLRenderer({preserveDrawingBuffer:true}):i.canvas?new THREE.CanvasRenderer():new THREE.SVGRenderer();var e=new THREE.PerspectiveCamera();e.fov=5;var c=new THREE.Scene();c.add(e);f.setSize(a,g);var b=new THREE.DirectionalLight(13421772,1,10,true);b.position.set(5,5,10);c.add(b);var b=new THREE.DirectionalLight(13421772,1,10,true);b.position.set(-5,-5,-10);c.add(b);d.appendChild(f.domElement);var h=new Kekule.Render.ThreeContext(c,e,f);h.setDimension(a,g);return h},releaseContext:function(a){var b=this.getContextElem(a);a.finalize();if(b){b.parentNode.removeChild(b)}},getContextElem:function(a){return a?a.getRenderer().domElement:null},getContextDimension:function(a){return{width:a.getWidth(),height:a.getHeight()}},setContextDimension:function(b,c,a){b.setDimension(c,a)},transformContextCoordToScreen:function(a,c){var b=a.getDimension();return{x:c.x+b.width/2,y:c.y+b.height/2}},transformScreenCoordToContext:function(a,c){var b=a.getDimension();return{x:c.x-b.width/2,y:c.y-b.height/2,z:0}},clearContext:function(a){a.clear()},canModifyGraphic:function(a){return true},transformContextCoordToScreen:function(a,b){return{x:b.x,y:b.y}},colorStrToHex:function(a){return Kekule.StyleUtils.colorStrToValue(a)},createGroup:function(a){var b=new THREE.Object3D();b.__objGroup__=true;a.getScene().add(b);return b},addToGroup:function(a,b){b.add(a);return b},removeFromGroup:function(a,b){b.remove(a)},clearContext:function(a){a.getScene().clearMesh();this.renderContext(a)},renderContext:function(a){a.getRenderer().render(a.getScene(),a.getCamera())},drawSphere:function(a,c,d,i){var b=this._modelParams.sphereSegments;var g=this._modelParams.sphereRings;var f=this.geometryCache.get(THREE.SphereGeometry,a.getScene(),1,b,g);var e=this.materialCache.get(THREE.MeshLambertMaterial,a.getScene(),{color:this.colorStrToHex(i.color),opacity:i.opacity||1});var h=new THREE.Mesh(f,e);h.scale.x=d;h.scale.y=d;h.scale.z=d;h.position.x=c.x;h.position.y=c.y;h.position.z=c.z;a.getScene().add(h);return h},drawLine:function(c,e,d,a){var f=this.colorStrToHex(a.color);var g=this.materialCache.get(THREE.LineBasicMaterial,c.getScene(),{color:this.colorStrToHex(a.color),opacity:a.opacity||1,linewidth:a.lineWidth||1});var b=new THREE.Geometry();b.vertices.push(new THREE.Vector3(e.x,e.y,e.z));b.vertices.push(new THREE.Vector3(d.x,d.y,d.z));line=new THREE.Line(b,g);c.getScene().add(line);return line},drawCylinder:function(b,g,f,d,o){var a=Kekule.CoordUtils;var i=this._modelParams.cylinderSegmentsRadius;var l=1;var m=a.getDistance(g,f);var h=this.geometryCache.get(THREE.CylinderGeometry,b.getScene(),1,1,1,i,l,true);var e=this.materialCache.get(THREE.MeshLambertMaterial,b.getScene(),{color:this.colorStrToHex(o.color),opacity:o.opacity||1});var n=new THREE.Mesh(h,e);n.scale.y=m;n.scale.x=d;n.scale.z=d;var c=Kekule.ObjUtils.isUnset(o.quaternion)?this._calcQuaternion(g,f):o.quaternion;if(c){n.useQuaternion=true;n.quaternion=c;n.updateMatrix()}n.position.x=(g.x+f.x)/2;n.position.y=(g.y+f.y)/2;n.position.z=(g.z+f.z)/2;b.getScene().add(n);return n},drawParallelCylinders:function(c,q,f){var b=Kekule.CoordUtils;var p=q[0];var n=this._calcQuaternion(p.coord1,p.coord2);var r=this.createGroup(c);for(var o=0,e=q.length;o<e;++o){var d=q[o];var m=this.drawCylinder(c,d.coord1,d.coord2,d.radius,{color:d.color,quaternion:n,opacity:d.opacity});this.addToGroup(m,r)}if(f){var a;for(var o=0,e=q.length;o<e;++o){var d=q[o];if(Kekule.ObjUtils.isUnset(d.jointCoordIndex)){a=[d.coord1,d.coord2]}else{a=(d.jointCoordIndex===1)?[d.coord2]:[d.coord1]}for(var h=0,g=a.length;h<g;++h){var m=this.drawSphere(c,a[h],d.radius,{color:d.color,opacity:d.opacity});this.addToGroup(m,r)}}}return r},removeDrawnElem:function(a,b){if(b.parent&&b.parent.remove){b.parent.remove(b)}},_calcQuaternion:function(i,g){var a=Kekule.CoordUtils;var l=a.substract(g,i);if(l.x||l.z){var c={x:l.z,y:0,z:-l.x};c=a.standardize(c);var e=Math.atan2(Math.sqrt(Math.sqr(l.x)+Math.sqr(l.z)),l.y);var h=e/2;var b=Math.cos(h);var d=Math.sin(h);var f=new THREE.Quaternion(d*c.x,d*c.y,d*c.z,b);return f}else{return null}},getCameraProps:function(a){var b=a.getCamera();return{position:b.position,fov:b.fov*Math.PI/180,aspect:b.aspect,left:b.left,right:b.right,top:b.top,bottom:b.bottom,lookAtVector:b.lookAtVector,upVector:b.up}},setCameraProps:function(b,d){var g=b.getCamera();var e=Kekule.ObjUtils.notUnset;var f=d.position;if(f){g.position.x=f.x;g.position.y=f.y;g.position.z=f.z}if(e(d.near)){g.near=d.near}if(e(d.far)){g.near=d.far}if(d.fov){g.fov=d.fov*180/Math.PI}if(d.aspect){g.aspect=d.aspect}if(e(d.left)){g.left=d.left}if(e(d.top)){g.top=d.top}if(e(d.bottom)){g.bottom=d.bottom}if(e(d.right)){g.right=d.right}if(e(d.upVector)){var a=d.upVector;g.up=new THREE.Vector3(a.x,a.y,a.z)}if(e(d.lookAtVector)){var a=d.lookAtVector;g.lookAt(new THREE.Vector3(a.x,a.y,a.z))}g.updateMatrix()},exportToDataUrl:function(d,b,c){var f=d.getRenderer();if(f instanceof THREE.SVGRenderer){var e=d.getRenderer().domElement;var a=XmlUtility.serializeNode(e);return"data:image/svg+xml;base64,"+btoa(a)}else{var e=d.getRenderer().domElement;return e?e.toDataURL(b,c):null}}});Kekule.Render.ThreeRendererBridge.isSupported=function(){var a=(typeof(THREE)!=="undefined");if(a){var b=Kekule.BrowserFeature;a=b.webgl||b.canvas||b.svg}return !!a};Kekule.Render.DrawBridge3DMananger.register(Kekule.Render.ThreeRendererBridge,20);(function(){Kekule.Render.ChemObjPainter=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Render.ChemObjPainter",initialize:function($super,b,e,a,d){$super();var c=b||Kekule.Render.RendererType.R2D;this.setPropStoreFieldValue("renderType",c);this.setPropStoreFieldValue("chemObj",e);this.setPropStoreFieldValue("drawBridge",a||((c===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger.getPreferredBridgeInstance():Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance()));if(d){this.setPropStoreFieldValue("renderConfigs",d)}},finalize:function($super){if(this.getRenderer()){this.getRenderer().finalize()}$super()},initProperties:function(){this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,setter:null});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("renderConfigs");if(!a){a=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return a}});this.defineProp("renderer",{dateType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null})},getDrawOptionFromConfigs:function(b){var a=Kekule.Render.RenderOptionUtils;return a.convertConfigsToPlainHash(b)},prepareRenderer:function(){if(this.getRenderer()){return this.getRenderer()}var b=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.get3DRendererClass:Kekule.Render.get2DRendererClass;var d=b(this.getChemObj());if(d){var a=new d(this.getChemObj(),this.getDrawBridge(),this);this.setPropStoreFieldValue("renderer",a);return a}else{Kekule.error(Kekule.ErrorMsg.CANNOT_FIND_SUITABLE_RENDERER_FOR_OBJ);return null}},createContext:function(b,c,a){var d=this.getRenderer();return d.createContext(b,c,a)},_convertContextBoxToScreen:function(a,c){var e=this.getDrawBridge();var d=e.transformContextCoordToScreen(a,{x:c.x1,y:c.y1});var b=e.transformContextCoordToScreen(a,{x:c.x2,y:c.y2});return Kekule.BoxUtils.createBox(d,b)},estimateObjBox:function(c,b,a){var d=this._generateDrawOptions(b);this.prepareRenderer();return this.getRenderer().estimateObjBox(c,b,a)},estimateRenderBox:function(c,f,b,a){var d=this._generateDrawOptions(b);this.prepareRenderer();var e=this.getRenderer();return e.estimateRenderBox(c,f,d,a)},estimateScreenBox:function(c,e,b,a){var d=this.estimateRenderBox(c,e,b,a);return this._convertContextBoxToScreen(c,d)},_generateDrawOptions:function(b){var c=this.getRenderConfigs();var a=c?this.getDrawOptionFromConfigs(c):{};a=Object.extend(a,b);return a},draw:function(c,f,b){this.prepareRenderer();var d=this._generateDrawOptions(b);var e=this.getRenderer();var a=e.draw(c,f,d);return a},redraw:function(a){return this.getRenderer().redraw(a)},getActualRenderTransformParams:function(a){var b=this.getRenderer();if(b){return b.getRenderFinalTransformParams(a)}else{return null}},getActualInitialRenderTransformOptions:function(a){var b=this.getRenderer();if(b){return b.getRenderInitialTransformOptions(a)}else{return null}},changeGeometryOptions:function(a,d,e){var c=this.getRenderer();if(c&&c.changeGeometryOptions){var b=this._generateDrawOptions(e);return c.changeGeometryOptions(a,d,b)}else{this.clearContext(a);return this.draw(a,d,e)}},supportGeometryOptionChange:function(){var a=this.getRenderer();return a&&a.changeGeometryOptions},beginUpdatePainter:function(){return this.getRenderer().beginUpdateRenderer()},endUpdatePainter:function(){return this.getRenderer().endUpdateRenderer()},update:function(c,a,b){return this.getRenderer().update(c,a,b)},addNew:function(b,a){return this.getRenderer().addNew(b,a)},modify:function(b,a){return this.getRenderer().modify(b,a)},remove:function(a,b){return this.getRenderer().remove(a,b)},clear:function(a){var b=this.getRenderer();if(b){b.clear(a)}return this},clearContext:function(a){return this.getDrawBridge().clearContext(a)}});Kekule.Render.ChemObjPainter2D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter2D",initialize:function($super,c,a,b){$super(Kekule.Render.RendererType.R2D,c,a,b)}});Kekule.Render.ChemObjPainter3D=Class.create(Kekule.Render.ChemObjPainter,{CLASS_NAME:"Kekule.Render.ChemObjPainter3D",initialize:function($super,c,a,b){$super(Kekule.Render.RendererType.R3D,c,a,b)}})})();Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function($super){$super()},initProperties:function(){},isReversible:function(){return true},execute:function(){var a=this.doExecute();return a},doExecute:function(){},reverse:function(){if(!this.isReversible()){Kekule.raise(Kekule.ErrorMsg.COMMAND_NOT_REVERSIBLE)}var a=this.doReverse();return a},doReverse:function(){}});Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1};Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function($super,a){$super();this.setChildren(a||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){if(!c[b].isReversible()){return false}}return true},doExecute:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){c[b].execute()}},doReverse:function(){var b=this.getChildren();for(var a=b.length-1;a>=0;--a){b[a].reverse()}},add:function(a){return this.getChildren().push(a)},remove:function(c){var b=this.getChildren();var a=b.indexOf(c);if(a>=0){return b.splice(a,1)}else{return null}},getChildAt:function(a){return this.getChildren()[a]},getChildCount:function(){return this.getChildren().length}});Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function($super,a){$super();this.setCapacity(a||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT});this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var a=this.getPropStoreFieldValue("operations");if(!a){a=[];this.setPropStoreFieldValue("operations",a)}return a}});this.defineProp("currIndex",{dataType:DataType.INT,serializable:false});this.defineEvent("push");this.defineEvent("pop");this.defineEvent("undo");this.defineEvent("redo")},checkCapacity:function(){var d=this.getCapacity();if((!d)||(d<=0)){return}var b=this.getPropStoreFieldValue("operations");while(b&&(b.length>d)){b.shift();if(this.getCurrIndex()>0){this.setCurrIndex(this.getCurrIndex()-1)}}},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(a){return this.getOperations()[a]},getCurrOperation:function(){var a=this.getCurrIndex();if(a>=0){return this.getOperations()[a]}else{return null}},clear:function(){this.setOperations([]);this.setCurrIndex(-1);this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},push:function(c){var b=this.getOperations();var d=this.getCurrIndex();if(d<b.length){b.splice(d+1,b.length-d-1)}b.push(c);this.setCurrIndex(b.length-1);this.checkCapacity();this.invokeEvent("push",{operation:c,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},pop:function(){var a;var b=this.getCurrIndex();if(this.canPop()){a=this.getOperations()[b];this.setCurrIndex(--b);this.invokeEvent("pop",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")}else{a=null}return a},canPop:function(){var a=this.getCurrIndex();return((a>=0)&&(!!this.getOperations().length))},unpop:function(){var b;var d=this.getCurrIndex();var c=this.getOperations();if(this.canUnpop()){this.setCurrIndex(++d);b=this.getOperations()[d]}else{b=null}return b},canUnpop:function(){var a=this.getCurrIndex();return(a<this.getOperations().length-1)},undo:function(){var a=this.pop();if(a&&a.isReversible()){a.reverse()}this.invokeEvent("undo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},undoAll:function(){while(this.canUndo){this.undo()}},canUndo:function(){return this.canPop()},redo:function(){var a=this.unpop();if(a){a.execute()}this.invokeEvent("redo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},canRedo:function(){return this.canUnpop()}});(function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function($super){$super();this.setPropStoreFieldValue("enabled",true);this.setPropStoreFieldValue("linkedWidgets",[]);this.setPropStoreFieldValue("enabled",true);this.setPropStoreFieldValue("visible",true);this.setPropStoreFieldValue("displayed",true);this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName());this.setBubbleEvent(true);this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function($super){var a=this.getOwner();if(a&&a.actionRemoved){a.actionRemoved(this)}this.unlinkAllWidgets();this.setPropStoreFieldValue("linkedWidgets",[]);$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(a){if(a!==this.getEnabled()){this.setPropStoreFieldValue("enabled",a);this.updateAllWidgetsProp("enabled",a)}}});this.defineProp("visible",{dataType:DataType.BOOL,setter:function(a){if(a!==this.getVisible()){this.setPropStoreFieldValue("visible",a);this.updateAllWidgetsProp("visible",a)}}});this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(a){if(a!==this.getDisplayed()){this.setPropStoreFieldValue("displayed",a);this.updateAllWidgetsProp("displayed",a)}}});this.defineProp("checked",{dataType:DataType.BOOL,setter:function(a){if(a!==this.getChecked()){this.setPropStoreFieldValue("checked",a);this.updateAllWidgetsProp("checked",a);this.checkedChanged()}}});this.defineProp("checkGroup",{dataType:DataType.STRING});this.defineProp("hint",{dataType:DataType.STRING,setter:function(a){if(a&&(a!==this.getHint())){this.setPropStoreFieldValue("hint",a);this.updateAllWidgetsProp("hint",a)}}});this.defineProp("text",{dataType:DataType.STRING,setter:function(a){if(a&&(a!==this.getText())){this.setPropStoreFieldValue("text",a);this.updateAllWidgetsProp("text",a)}}});this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(b){var a=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",b);this.updateAllWidgetClassName(b,a)}});this.defineProp("owner",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null})},getHigherLevelObj:function(){return this.getOwner()},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var a=this.getOwner();return(a instanceof Kekule.ActionList)?a:null},checkedChanged:function(){var a=this.getActionList();if(a){a.actionCheckedChanged(this)}},linkWidget:function(b){var a=this.getLinkedWidgets();if(a.indexOf(b)<0){var d=this.getText();if(d){this.updateWidgetProp(b,"text",d)}var c=this.getHint();if(c){this.updateWidgetProp(b,"hint",c)}this.updateWidgetProp(b,"enabled",this.getEnabled());this.updateWidgetProp(b,"displayed",this.getDisplayed());this.updateWidgetProp(b,"visible",this.getVisible());this.updateWidgetProp(b,"checked",this.getChecked());this.updateWidgetClassName(b,this.getHtmlClassName(),null);b.addEventListener("execute",this.reactWidgetExecuteBind);a.push(b);return this}},unlinkWidget:function(c){var b=this.getLinkedWidgets();var a=b.indexOf(c);if(a>=0){this.updateWidgetClassName(c,null,this.getHtmlClassName());c.removeEventListener("execute",this.reactWidgetExecuteBind);b.splice(a,1)}},unlinkAllWidgets:function(){var b=this.getLinkedWidgets();for(var a=b.length-1;a>=0;--a){this.unlinkWidget(b[a])}},reactWidgetExecute:function(a){return this.execute(a.target)},execute:function(b){var a=this.getChecked();if(!this.getCheckGroup()||!a){this.doExecute(b);if(this.getCheckGroup()){this.setChecked(true)}}this.invokeEvent("execute");return this},doExecute:function(a){},update:function(){this.doUpdate();return this},doUpdate:function(){},updateAllWidgetsProp:function(e,f){var d=this.getLinkedWidgets();for(var c=0,b=d.length;c<b;++c){var a=d[c];this.updateWidgetProp(a,e,f)}},updateWidgetProp:function(b,a,c){if(b.hasProperty(a)){b.setPropValue(a,c)}},updateWidgetClassName:function(b,c,a){if(a){b.removeClassName(a,true)}if(c){b.addClassName(c,true)}},updateAllWidgetClassName:function(f,a){var e=this.getLinkedWidgets();for(var d=0,c=e.length;d<c;++d){var b=e[d];this.updateWidgetClassName(b,f,a)}}});Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function($super){$super();this.setPropStoreFieldValue("actions",[]);this.setPropStoreFieldValue("ownActions",true);this.setPropStoreFieldValue("autoUpdate",true);this.reactActionExecutedBind=this.reactActionExecuted.bind(this);this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function($super){this.removeEventListener("execute",this.reactActionExecutedBind);this.clear();this.setPropStoreFieldValue("actions",null);$super()},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("ownActions",{dataType:DataType.BOOL});this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(a){this.setPropStoreFieldValue("autoUpdate",a);if(a){this.updateAll()}}})},hasActionChecked:function(e){var f=this.getActions();for(var d=0,c=f.length;d<c;++d){var b=f[d];if((b.getCheckGroup()===e)&&(b.getChecked())){return true}}return false},actionAdded:function(a){Kekule.ArrayUtils.pushUnique(this.getActions(),a);a.setPropStoreFieldValue("owner",this);a.update()},actionRemoved:function(a){Kekule.ArrayUtils.remove(this.getActions(),a);a.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var f=e.getCheckGroup();if(f){var g=this.getActions();for(var d=0,c=g.length;d<c;++d){var b=g[d];if((b!==e)&&(b.getCheckGroup()===f)&&(b.getChecked())){b.setChecked(false)}}}}},reactActionExecuted:function(a){if(a.target instanceof Kekule.Action){this.invokeEvent("execute",{action:a.target});if(this.getAutoUpdate()){this.updateAll()}}},getActionCount:function(){return this.getActions().length},getActionAt:function(a){return this.getActions()[a]},add:function(a){this.actionAdded(a);return this},remove:function(a){this.actionRemoved(a);if(this.getOwnActions()){a.finalize()}return this},removeAt:function(a){var c=this.getActions();var b=c[a];if(b){Kekule.ArrayUtils.removeAt(c,a);this.actionRemoved(b)}return this},clear:function(){var b=this.getActions();for(var a=b.length-1;a>=0;--a){this.actionRemoved(b[a])}this.setPropStoreFieldValue("actions",[]);return this},updateAll:function(){var c=this.getActions();for(var b=0,a=c.length;b<a;++b){c[b].update()}return this}});Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileOpen",initialize:function($super){$super();this._inputElem=null;this.reactInputChangeBind=this.reactInputChange.bind(this)},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.BrowserFeature.fileapi)},doExecute:function(d){var b=d.getElement();var c=b.ownerDocument;var a=this.createInputElem(c);a.click()},createInputElem:function(d){var b=this;var a=document.createElement("input");a.setAttribute("type","file");var c=a.style;c.position="absolute";c.left="-10000px";c.opacity=0;document.body.appendChild(a);Kekule.X.Event.addListener(a,"change",this.reactInputChangeBind);return a},reactInputChange:function(b){var a=b.getTarget();this.fileOpened(a.files);Kekule.X.Event.removeListener(a,"change",this.reactInputChangeBind);a.ownerDocument.body.focus();if(a.parentNode){a.parentNode.removeChild(a)}},fileOpened:function(a){this.doFileOpened(a);this.invokeEvent("open",{files:a})},doFileOpened:function(a){}});Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function($super,a,b){$super();if(a){this.setData(a)}if(b){this.setFileName(b)}},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:false});this.defineProp("fileName",{dataType:DataType.STRING,serializable:false})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&this.getData())},doExecute:function(d){var c;if(!d){c=document}else{var b=d.getElement();c=b.ownerDocument}var a=this.createDataElem(c,this.getData(),this.getFileName());a.click();a.parentNode.removeChild(a)},createDataElem:function(c,b,d){var a=c.createElement("a");a.setAttribute("href","data:application/octet-stream,"+encodeURIComponent(b));a.setAttribute("download",d);c.body.appendChild(a);return a}})})();(function(){Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function($super,c,a,d,b){$super();this.setSource(c);this.setSourceName(a);this.setTarget(d);this.setTargetName(b)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("sourceName",{dataType:DataType.STRING,serializable:false});this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("targetName",{dataType:DataType.STRING,serializable:false})},updateData:function(a){var f=this.getSource();var e=this.getTarget();var c=this.getSourceName();var b=this.getTargetName();if(f&&e&&c&&b){if(a){var d=e.getDataByBindingName(b);f.setDataByBindingName(c,d)}else{var d=f.getDataByBindingName(sourceName);e.setDataByBindingName(b,d)}}}});ClassEx.extend(ObjectEx,{getDataByBindingName:function(a){if(this.hasProperty(a)){return this.getPropValue(a)}else{if(DataType.isFunctionValue(this[a])){return this[a]()}}},setDataByBindingName:function(c,d){var b=d;var a=this.getPropInfo(c);if(a){var e=a.dataType;var f=DataType.getType(d);if((e!==f)&&(f===DataType.STRING)){b=StringUtils.deserializeValue(d)}}this.setPropValue(c,b);return this},createDataBinding:function(d,c,b){var a=new Kekule.DataBingItem(d,c,this,b);this.getDataBindings(true).push(a);return a},removeDataBinding:function(a){Kekule.ArrayUtils.remove(this.getDataBindings(),a)},updateBindingData:function(c){var b=this.getDataBindings();if(b&&b.length){for(var d=0,a=b.length;d<a;++d){b[d].updateData(c)}}}});ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(b){var a=this.getPropStoreFieldValue("dataBindings");if(!a&&b){a=[];this.setPropStoreFieldValue("dataBindings",a)}return a}})})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.HtmlElementUtils;Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",DEF_TOUCH_GESTURE_HANDLER_PREFIX:"react_touch_",getEventHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f},getTouchGestureHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f}};Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",POPUP:"K-Popup",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show"};var c=Kekule.Widget.HtmlClassNames;Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2};Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12};Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(g){var f=Kekule.Widget.Direction;return !!((g&f.LTR)||(g&f.RTL))},isInVertical:function(g){var f=Kekule.Widget.Direction;return !!((g&f.TTB)||(g&f.BTT))}};Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var b=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0};Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","mousewheel","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchleave","touchmove"];Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave"];Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","pinch","pinchin","pinchout","touch","release"];var d="__$kekule_widget__";Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function($super,f,g){this._stateClassName=null;this._isDismissed=false;this._pendingHtmlClassNames="";$super();this.setPropStoreFieldValue("isDumb",!!g);if(!g){this.reactUiEventBind=this.reactUiEvent.bind(this)}this.setPropStoreFieldValue("inheritEnabled",true);this.setPropStoreFieldValue("inheritStatic",true);this.setPropStoreFieldValue("selfEnabled",true);this.setPropStoreFieldValue("selfStatic",false);this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY);this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL);if(f){if(f instanceof Kekule.Widget.BaseWidget){this.setDocument(f.getDocument());this.createElement();this.setParent(f)}else{if(f.documentElement){this.setDocument(f);this.createElement()}else{this.setDocument(f.ownerDocument);this.setElement(f)}}}this._stateClassName=null;this._layoutClassName=null;if(!this.getLayout()){this.setLayout(Kekule.Widget.Layout.HORIZONTAL)}this.setDraggable(false);this._periodicalExecBind=this._periodicalExec.bind(this);this.setBubbleEvent(true);this.setInheritBubbleUiEvents(true);this.stateChanged();if(Kekule.Widget.globalManager){Kekule.Widget.globalManager.notifyWidgetCreated(this)}},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){if(this.getIsDumb()!=g){this.setPropStoreFieldValue("isDumb",g);var f=this.getElement();if(f){if(g){this.uninstallUiEventHandlers(f)}else{this.installUiEventHandlers(f)}}}}});this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:function(g){var f=this.getParent();if(f){f._removeChild(this)}if(g){g._addChild(this)}this.setPropStoreFieldValue("parent",g)}});this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("childWidgets");if(!f){f=[];this.setPropStoreFieldValue("childWidgets",f)}return f}});this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("element",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){var f=this.getElement();if(g!==f){this.setPropStoreFieldValue("element",g);this.elementChanged(g,f)}}});this.defineElemAttribMappingProp("id","id");this.defineElemAttribMappingProp("draggable","draggable");this.defineElemStyleMappingProp("width","width");this.defineElemStyleMappingProp("height","height");this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null});this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetLeft},setter:null});this.defineProp("offsetTop",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetTop},setter:null});this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetWidth},setter:null});this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetHeight},setter:null});this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(f){this.getElement().innerHTML=f}});this.defineProp("style",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null});this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(f){this.getElement().className=f}});this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(h){var g=this.getElement();var f=this.getCustomHtmlClassName();if(g&&(f!==h)){if(f){e.removeClass(g,f)}if(h){e.addClass(g,h)}this.setPropStoreFieldValue("customHtmlClassName",h)}}});this.defineProp("visible",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setVisibility(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("displayed",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setDisplay(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("showHideType",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("layout",{dataType:DataType.INT,setter:function(f){if(this.getPropStoreFieldValue("layout")!==f){this.setPropStoreFieldValue("layout",f);this.layoutChanged()}}});this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("useCornerDecoration",f);if(!f){this.removeClassName(c.CORNER_ALL)}else{this.addClassName(c.CORNER_ALL)}}});this.defineProp("showText",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showText",f);if(f){this.removeClassName(c.HIDE_TEXT);this.addClassName(c.SHOW_TEXT)}else{this.addClassName(c.HIDE_TEXT);this.removeClassName(c.SHOW_TEXT)}}});this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showGlyph",f);if(f){this.removeClassName(c.HIDE_GLYPH);this.addClassName(c.SHOW_GLYPH)}else{this.addClassName(c.HIDE_GLYPH);this.removeClassName(c.SHOW_GLYPH)}}});this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:false,setter:function(f){if(f){this.removeClassName(c.TEXT_NO_WRAP)}else{this.addClassName(c.TEXT_NO_WRAP)}}});this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritEnabled",f);this.stateChanged()}});this.defineProp("enabled",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var g=this.getParent();if(g){f=f&&g.getEnabled()}}return f},setter:function(g){var f=this.getElement();if(!g){f.setAttribute("disabled","true")}else{f.removeAttribute("disabled")}this.setPropStoreFieldValue("selfEnabled",g);this.stateChanged()}});this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritStatic",f);this.stateChanged()}});this.defineProp("static",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var g=this.getParent();if(g){f=f||g.getStatic()}}return f},setter:function(f){this.setPropStoreFieldValue("selfStatic",f);this.stateChanged()}});this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritState",f);this.stateChanged()}});this.defineProp("state",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var f;if(this.getInheritState()){var g=this.getParent();if(g){f=g.getState()}}else{if(!this.getEnabled()){f=b.DISABLED}else{f=this.getIsActive()?b.ACTIVE:this.getIsHover()?b.HOVER:this.getIsFocused()?b.FOCUSED:b.NORMAL}}return f}});this.defineElemStyleMappingProp("cursor","cursor");this.defineProp("isHover",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){this.setPropStoreFieldValue("isHover",f);this.setPropStoreFieldValue("isActive",false);this.stateChanged()}});this.defineProp("isActive",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){this.setPropStoreFieldValue("isActive",f);this.stateChanged()}});this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var g=this.getDocument();var f=this.getElement();if(g&&f&&g.activeElement){return(g.activeElement===f)}},setter:function(g){this.setPropStoreFieldValue("isFocused",g);var f=this.getCoreElement();if(f&&f.focus&&g){f.focus()}if(f&&f.blur&&(!g)){f.blur()}this.stateChanged()}});this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL});this.defineProp("periodicalExecDelay",{dataType:DataType.INT});this.defineProp("periodicalExecInterval",{dataType:DataType.INT});this.defineElemAttribMappingProp("hint","title");this.defineProp("action",{dataType:"Kekule.Action",serializable:false,setter:function(g){var f=this.getAction();if(f!==g){if(f&&f.unlinkWidget){f.unlinkWidget(this);this.unlinkAction(f)}this.setPropStoreFieldValue("action",g);if(g&&g.linkWidget){g.linkWidget(this);this.linkAction(g)}}}});this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("iaControllerMap");if(!f){f=new Kekule.HashEx();this.setPropStoreFieldValue("iaControllerMap",f)}return f}});this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("defIaController",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}});this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("activeIaController",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}})},doFinalize:function($super){this.setAction(null);this.setParent(null);this.releaseChildWidgets();var f=this.getElement();this.setElement(null);this.destroyElement(f);if(Kekule.Widget.globalManager){Kekule.Widget.globalManager.notifyWidgetFinalized(this)}$super()},invokeEvent:function($super,g,h){if(!h){h={}}if(!h.widget){h.widget=this}$super(g,h);var f=Kekule.Widget.globalManager;if(f){f.notifyWidgetEventFired(this,g,h)}},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return false},doPropChanged:function(f,g){if((f==="width")||(f==="height")){this.resized()}},getActualBubbleUiEvents:function(){var f=this.getParent();if(this.getBubbleUiEvents()){return true}else{if(this.getInheritBubbleUiEvents()&&f&&f.getActualBubbleUiEvents){return f.getActualBubbleUiEvents()}else{false}}},releaseChildWidgets:function(){var g=this.getChildWidgets();for(var f=g.length-1;f>=0;--f){g[f].finalize()}},defineElemAttribMappingProp:function(i,h,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getElement().getAttribute(h)},setter:function(l){this.getElement().setAttribute(h,l)}},f||{});return this.defineProp(i,g)},defineElemStyleMappingProp:function(h,i,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getStyleProperty(i)},setter:function(l){this.setStyleProperty(i,l)}},f||{});return this.defineProp(h,g)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(f){},unlinkAction:function(f){},linkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.linkTo(h||this)}return this},unlinkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.unlinkFrom(h||this)}return this},getStyleProperty:function(f,h){var i=h||this.getElement();var g=i[this.STYLE_RES_FIELD];if(!g||!g[f]){return i.style[f]}else{return g[f]}},setStyleProperty:function(g,n,l){var m=l||this.getElement();if(m){var i;if(n instanceof Kekule.Widget.StyleResource){i=n}else{if((DataType.getType(n)===DataType.STRING)&&(n.startsWith(Kekule.Widget.StyleResourceNames.PREFIX))){i=Kekule.Widget.StyleResourceManager.getResource(n)}}if(i){var h=m[this.STYLE_RES_FIELD];if(!h){h={};m[this.STYLE_RES_FIELD]=h}var f=h[g];if(f){this.unlinkStyleResource(f,m)}if(i){this.linkStyleResource(i,m)}h[g]=i}else{m.style[g]=n;var h=m[this.STYLE_RES_FIELD];if(h&&h[g]){this.unlinkStyleResource(h[g],m)}}}},removeStyleProperty:function(f,i,g){var h=g||this.getElement();Kekule.StyleUtils.removeStyleProperty(h.style,f)},_addChild:function(g){if(!g){return}var f=this.getChildWidgets();if(f.indexOf(g)<0){f.push(g);this.childWidgetAdded(g);this.childrenModified()}},_insertChild:function(i,g){if(!i){return}var f=this.getChildWidgets();var h=g?f.indexOf(g):f.length;if(h<0){h=f.length}if(f.indexOf(i)>=0){this._moveChild(i,h-1)}else{f.splice(h-1,0,i);this.childrenModified()}},_removeChild:function(l){if(!l){return}var g=this.getChildWidgets();var h=g.indexOf(l);if(h>=0){g.splice(h,1);var f=this.getChildrenHolderElement();var i=l.getElement();if(i&&Kekule.DomUtils.isDescendantOf(i,f)){i.parentNode.removeChild(i)}this.childWidgetRemoved(l);this.childrenModified()}},_moveChild:function(g,f){if(!g){return}if(Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),g,f)){this.childWidgetMoved(g,f);this.childrenModified()}},childrenModified:function(){},childWidgetAdded:function(f){},childWidgetRemoved:function(f){},childWidgetMoved:function(g,f){},indexOfChild:function(f){return this.getChildWidgets().indexOf(f)},hasChild:function(g){var f=this.indexOfChild(g);return(f>=0)},show:function(h,l,i){if(!this.getElement()){return}if(this.__$isShowing){return}this.__$isShowing=true;var g=this;var f=function(){g.__$showHideTransInfo=null;g.widgetShowStateDone(true);g.__$isShowing=false;if(l){l()}};this.widgetShowStateBeforeChanging(true);if(Kekule.ObjUtils.notUnset(i)){this.setIsPopup((i===Kekule.Widget.ShowHideType.DROPDOWN)||(i===Kekule.Widget.ShowHideType.POPUP));if(i===Kekule.Widget.ShowHideType.DIALOG){i=Kekule.Widget.ShowHideType.POPUP}if(i===Kekule.Widget.ShowHideType.DROPDOWN){Kekule.Widget.globalManager.preparePopupWidget(this,h,i)}}if(Kekule.Widget.showHideManager){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,h,f,i)}}else{this.setDisplayed(true,true);this.setVisible(true,true);f()}this.setShowHideCaller(h);this.setShowHideType(i);this.widgetShowStateChanged(true);return this},flash:function(i,h,m,l){var g=this;var f=function(){if(m){m()}setTimeout(g.hide.bind(g),i)};this.show(h,f,l);return this},hide:function(i,n,m,l){if(!this.getElement()){return}if(this.__$isHiding){return}this.__$isHiding=true;if(!i){i=this.getShowHideCaller()}if(!m){m=this.getShowHideType()}var h=this;var g=this.getFinalizeAfterHiding();var f=function(){h.__$showHideTransInfo=null;h.widgetShowStateDone(false);if(m===Kekule.Widget.ShowHideType.DROPDOWN){Kekule.Widget.globalManager.unpreparePopupWidget(h)}h.__$isHiding=false;if(n){n()}if(g){h.finalize()}};this.widgetShowStateBeforeChanging(false);if(Kekule.Widget.showHideManager){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,i,f,m)}}else{if(l){this.setVisible(false,true)}else{this.setDisplayed(false,true)}f()}this.widgetShowStateChanged(false);return this},dismiss:function(f,i,h,g){this._isDismissed=true;return this.hide(f,i,h,g)},isShown:function(){var f=this.isInDomTree()&&this.getVisible()&&this.getDisplayed();return f},widgetShowStateBeforeChanging:function(f){},widgetShowStateChanged:function(f){if(Kekule.ObjUtils.isUnset(f)){f=this.isShown()}if(Kekule.ObjUtils.notUnset(this._lastShown)&&(this._lastShown===f)){return}this._lastShown=f;if(f){this._isDismissed=false}if(this.getIsPopup()){if(f){Kekule.Widget.globalManager.registerPopupWidget(this)}else{Kekule.Widget.globalManager.unregisterPopupWidget(this)}}this.doWidgetShowStateChanged(f);this.invokeEvent("showStateChange",{widget:this,isShown:f,isDismissed:this._isDismissed})},doWidgetShowStateChanged:function(f){},widgetShowStateDone:function(f){},isInDomTree:function(){var f=this.getElement();return Kekule.DomUtils.isInDomTree(f)},focus:function(){this.setIsFocused(true);return this},blur:function(){this.setIsFocused(false);return this},getBoundingClientRect:function(h){if(!this.getDisplayed()){var i=Kekule.StyleUtils.getDisplayed(this.getElement());var g=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden");this.setDisplayed("");var f=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}finally{this.setDisplayed(i);this.setVisible(g)}return f}else{return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}},setDimension:function(i,f,h){var g=false;var l=Kekule.ObjUtils.notUnset;if(l(i)){this.getStyle().width=(typeof(i)==="number")?i+"px":i;g=true}if(l(f)){this.getStyle().height=(typeof(f)==="number")?f+"px":f;g=true}if(g&&(!h)){this.resized()}return this},resized:function(){this.doResize();this.invokeEvent("resize",{widget:this})},doResize:function(){},layoutChanged:function(){var f=this.getLayout();if(this._layoutClassName){this.removeClassName(this._layoutClassName)}this._layoutClassName=this.getLayoutClassName(f);if(this._layoutClassName){this.addClassName(this._layoutClassName)}},getLayoutClassName:function(f){var g=Kekule.Widget.Layout;return(f===g.VERTICAL)?c.LAYOUT_V:(f===g.HORIZONTAL)?c.LAYOUT_H:null},stateChanged:function(){if(this._stateClassName){this.removeClassName(this._stateClassName)}this._stateClassName=this.getStateClassName(this.getState());if(this._stateClassName){this.addClassName(this._stateClassName)}var h=this.getChildWidgets();for(var g=0,f=h.length;g<f;++g){h[g].stateChanged()}},getStateClassName:function(h){var g=Kekule.Widget.State;var f=(h===g.ACTIVE)?c.STATE_ACTIVE:(h===g.HOVER)?c.STATE_HOVER:(h===g.FOCUSED)?c.STATE_FOCUSED:(h===g.DISABLED)?c.STATE_DISABLED:c.STATE_NORMAL;return f},createElement:function(){var g=this.getDocument();var f=this.doCreateRootElement(g);this.setElement(f);return f},doCreateRootElement:function(f){},doCreateSubElements:function(g,f){return[]},destroyElement:function(f){var f=f||this.getElement();if(f&&f.parentNode){f.parentNode.removeChild(f)}},appendToElem:function(f){f.appendChild(this.getElement());return this},insertToElem:function(f,g){f.insertBefore(this.getElement(),g);return this},appendToWidget:function(f){this.setParent(f);this.appendToElem(f.getChildrenHolderElement());return this},insertToWidget:function(f,g){this.setParent(f);if(g){this.insertToElem(f.getChildrenHolderElement(),g.getElement())}else{this.appendToElem(f.getChildrenHolderElement())}return this},insertedToDom:function(){this.widgetShowStateChanged(this.isShown());return this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){this.widgetShowStateChanged(false);return this.doRemovedFromDom()},doRemovedFromDom:function(){},domElemAdded:function(f){return this.doDomElemAdded(f)},doDomElemAdded:function(f){},domElemRemoved:function(f){return this.doDomElemRemoved(f)},doDomElemRemoved:function(f){},getWidgetClassName:function(){var f=Kekule.Widget.HtmlClassNames.BASE;if(this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getElement())){f+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND}f+=" "+this.doGetWidgetClassName();return f},doGetWidgetClassName:function(){return""},addClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.addTokens(f,g);this.setCustomHtmlClassName(f)}else{e.addClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,g)}return this},removeClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.removeTokens(f,g);this.setCustomHtmlClassName(f)}else{e.removeClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,g)}return this},toggleClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.toggleTokens(f,g);this.setCustomHtmlClassName(f)}else{e.toggleClass(this.getElement(),g)}}return this},isElementBindable:function(f){var h=this.getBindableElemTagNames();if(h){var g=f.tagName;return(h.indexOf(g.toLowerCase())>=0)}else{return true}},getBindableElemTagNames:function(){if(this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")){return this.BINDABLE_TAG_NAMES}else{return null}},bindElement:function(r){if(r){if(!this.isElementBindable(r)){Kekule.error(Kekule.ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM.format(this.getClassName(),r.tagName));return}var f=r.className;if(f){this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+f)}var x=Kekule.DomUtils;var n=Kekule.HtmlElementUtils;var q=function(h){var w=x.getDirectChildElems(h);for(var l=w.length-1;l>=0;--l){var B=w[l];if(n.hasClass(B,c.DYN_CREATED)){h.removeChild(B)}}};q(r);var A=this.doCreateSubElements(this.getDocument(),r);if(A&&A.length){for(var s=0,o=A.length;s<o;++s){var m=A[s];n.addClass(m,c.DYN_CREATED)}}this.doBindElement(r);if(Kekule.DomUtils.hasAttribute(r,"disabled")){this.setEnabled(false)}var z=r.getAttribute("width");var u=r.getAttribute("height");if(Kekule.ObjUtils.notUnset(z)||Kekule.ObjUtils.notUnset(u)){z=parseFloat(z.toString())||0;u=parseFloat(u.toString())||0;this.setDimension(z,u)}var p=Kekule.DomUtils.getDataset(r);if(p){for(var g in p){var y=p[g];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,g,y)}catch(v){Kekule.warn(v)}}}var t=this.getWidgetClassName();e.addClass(r,t);t=this.getCustomHtmlClassName();if(t){e.addClass(r,t)}if(!this.getTextSelectable()){e.addClass(r,c.NONSELECTABLE)}if(this._pendingHtmlClassNames){e.addClass(r,this._pendingHtmlClassNames);this._pendingHtmlClassNames=""}if(!this.getIsDumb()){this.installUiEventHandlers(r)}r[d]=this;this.invokeEvent("bind",{widget:this,element:r})}},doBindElement:function(f){},unbindElement:function(g){if(g){if(!this.getIsDumb()){this.uninstallUiEventHandlers(g)}var f=this.getWidgetClassName();e.removeClass(g,f);this.doUnbindElement(g);g[d]=undefined;try{delete g[d]}catch(h){}this.invokeEvent("unbind",{widget:this,element:g})}},doUnbindElement:function(f){},elementChanged:function(f,g){if(g){this.unbindElement(g)}if(f){this.bindElement(f)}},createDecorationContent:function(g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_DECORATION_CONTENT,c.DYN_CREATED]);if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createTextContent:function(l,g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_TEXT_CONTENT,c.DYN_CREATED]);f.innerHTML=l;if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createGlyphContent:function(g,h,i){var l=g.ownerDocument;var f=l.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_GLYPH_CONTENT,c.DYN_CREATED]);if(i){e.addClass(f,i)}if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},installUiEventHandlers:function(m){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.addListener(m,h[g],this.reactUiEventBind)}},uninstallUiEventHandlers:function(m){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(m,h[g],this.reactUiEventBind)}},reactUiEvent:function(i){if(this.getStatic()){}else{if(!this.getEnabled()){i.stopPropagation()}else{var h=false;var m=i.getType();var q=Kekule.X.Event.KeyCode;var p;if(m==="mousemove"){var g=this.getEventMouseRelCoord(i);var o=this.testMouseCursor(g,i);if(Kekule.ObjUtils.notUnset(o)&&this.getElement()){this.setCursor(o);h=true}}else{if(m==="focus"){if(i.getTarget()==this.getCoreElement()){this.setIsFocused(true);h=true}}else{if(m==="blur"){if(i.getTarget()==this.getCoreElement()){var r=this.getDocument().activeElement;var f=this.getElement();if(r&&(Kekule.DomUtils.isDescendantOf(r,f)||r===f)){}else{this.setIsFocused(false)}h=true}}else{if(m==="mouseover"){this.setIsHover(true);h=true}else{if(m==="mouseout"){this.setIsHover(false);this.reactDeactiviting(i);h=true}else{if((m==="mousedown")||(m==="touchstart")){this.reactActiviting(i);h=true}else{if((m==="mouseup")||(m==="touchend")||(m==="touchcancel")||(m==="touchleave")){this.reactDeactiviting(i);h=true}else{if(m==="keydown"){p=i.getKeyCode();if((p===q.ENTER)||(p===q.SPACE)){if(!this.getIsActive()){this.reactActiviting(i)}h=true}}else{if(m==="keyup"){p=i.getKeyCode();if((p===q.ENTER)||(p===q.SPACE)){if(this.getIsActive()){this.reactDeactiviting(i)}h=true}}}}}}}}}}var l=Kekule.Widget.getEventHandleFuncName(i.getType());if(this[l]){h=this[l](i)}else{h=this.dispatchEventToIaControllers(i)||h}this.doReactUiEvent(i);this.invokeEvent(m,{htmlEvent:i})}}if(this.getActualBubbleUiEvents()){var n=this.getParent();if(n&&n.reactUiEvent){n.reactUiEvent(i)}}},doReactUiEvent:function(f){},reactTouchGesture:function(g){var f=Kekule.Widget.getTouchGestureHandleFuncName(g.getType());if(this[f]){this[f](g)}else{this.dispatchEventToIaControllers(g)}},reactActiviting:function(f){if(!this.getIsActive()){this.setIsActive(true);this.doReactActiviting(f);this.invokeEvent("activate",{widget:this})}},doReactActiviting:function(f){},reactDeactiviting:function(f){if(this.getIsActive()){this.doReactDeactiviting();this.invokeEvent("deactivate",{widget:this});this.setIsActive(false)}},doReactDeactiviting:function(f){},dispatchEventToIaControllers:function(h){var g=false;var f=this.getActiveIaController();if(f){g=f.handleUiEvent(h)}if(!g){f=this.getDefIaController();if(f){g=f.handleUiEvent(h)}}return g},getEventMouseRelCoord:function(f){return{x:f.getRelXToCurrTarget(),y:f.getRelYToCurrTarget()}},testMouseCursor:function(i,h){var f=this.doTestMouseCursor(i,h);if(!f){var g=this.getActiveIaController();if(g){f=g.testMouseCursor(i,h)}if(!f){g=this.getDefIaController();if(g){f=g.testMouseCursor(i,h)}}}return f},doTestMouseCursor:function(g,f){return null},addIaController:function(h,f,g){this.getIaControllerMap().set(h,f);if(g){this.setDefIaControllerId(h)}if(f){f.setWidget(this)}},removeIaController:function(g){var f=this.getIaControllerMap().get(g);if(f){this.getIaControllerMap().remove(g);if(g===this.getDefIaControllerId()){this.setDefIaControllerId(null)}if(g===this.getActiveIaControllerId()){this.setActiveIaControllerId(null)}f.setWidget(null)}},getIaController:function(f){return this.getIaControllerMap().get(f)},execute:function(){this.doExecute();this.invokeEvent("execute",{widget:this})},doExecute:function(){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(){var f=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=true;setTimeout(this._periodicalExecBind,f)},stopPeriodicalExec:function(){this._periodicalExecuting=false},_periodicalExec:function(f){if(this.isPeriodicalExecuting()){if(!this._waitPeriodicalProcess){this._waitPeriodicalProcess=true;this.execute();this._waitPeriodicalProcess=false}setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20)}}});Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function($super,f){$super();if(f){this.setWidget(f)}},doFinalize:function($super){this.setWidget(null);$super()},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},handleUiEvent:function(h){var f=h.getType();var g=Kekule.Widget.getEventHandleFuncName(f);if(this[g]){return this[g](h)}else{return false}},_defEventHandler:function(f){return false},testMouseCursor:function(g,f){return this.doTestMouseCursor(g,f)},doTestMouseCursor:function(g,f){return null},_getEventMouseCoord:function(i,h){var m={x:i.getClientX(),y:i.getClientY()};var g=h||this.getWidget().getElement();var l={x:g.getBoundingClientRect().left-g.scrollLeft,y:g.getBoundingClientRect().top-g.scrollTop};var f=Kekule.CoordUtils.substract(m,l);return f}});Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function($super,f){$super(f,true)},doCreateRootElement:function(g){var f=g.createElement("span");return f}});Kekule.Widget.Utils={getWidgetOnElem:function(f){return f[d]},getWidgetsInsideElem:function(h,p){var r;var n=Kekule.Widget.Utils.getWidgetOnElem(h);if(n){r=[n]}else{r=[]}if(!p){return r}var q=Kekule.DomUtils.getDirectChildElems(h);for(var m=0,g=q.length;m<g;++m){var f=q[m];var o=Kekule.Widget.Utils.getWidgetsInsideElem(f,p);r=r.concat(o)}return r},getWidgetById:function(h,g){if(!g){g=document}var f=g.getElementById(h);if(f){return Kekule.Widget.Utils.getWidgetOnElem(f)}else{return undefined}},getBelongedWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);g=g.parentNode}return f},setWidgetPropFromElemAttrib:function(m,h,g){var l=h.camelize();var f=m.getPropertyDataType(l);if(!f){return}if(f===DataType.STRING){m.setPropValue(l,g)}else{if(Kekule.PredefinedResReferer.isResValue(g)){Kekule.PredefinedResReferer.loadResource(g,function(p,q){if(m.loadPredefinedResDataToProp){m.loadPredefinedResDataToProp(l,p,q)}},null,m.getDocument())}else{if(g.startsWith("#")&&(ClassEx.isOrIsDescendantOf(ClassEx.findClass(f),Kekule.Widget.BaseWidget))){var o=g.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(m,l,o)}else{var i=JSON.parse(g);if(Kekule.ObjUtils.notUnset(i)){var n=ObjSerializerFactory.getSerializer("json").load(null,i);m.setPropValue(l,n)}}}}},_setWidgetRefPropFromId:function(h,g,i){if(i){var f=Kekule.Widget.getWidgetById(i,h.getDocument());if(f){h.setPropValue(g,f)}}}};Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem;Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById;Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget;Kekule.Widget.GlobalManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",initialize:function($super,f){$super();this._document=f||document;this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",[]);this.setPropStoreFieldValue("widgets",[]);this.setPropStoreFieldValue("preserveWidgetList",true);this.reactUiEventBind=this.reactUiEvent.bind(this);this.reactTouchGestureBind=this.reactTouchGesture.bind(this);Kekule.X.domReady(this.domReadyInit.bind(this))},finalize:function($super){this.uninstallGlobalDomMutationHandlers(this._document.body);this.uninstallGlobalTouchHandlers(this._document.body);this.uninstallGlobalEventHandlers(this._document.body);this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",null);this.setPropStoreFieldValue("widgets",null);$super()},initProperties:function(){this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:false,setter:function(f){this.setPropStoreFieldValue("preserveWidgetList",f);if(!f){this.setPropStoreFieldValue("widgets",[])}}});this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:false,setter:null})},domReadyInit:function(){this.installGlobalEventHandlers(this._document.body);this._hammertime=this.installGlobalTouchHandlers(this._document.body);this.installGlobalDomMutationHandlers(this._document.body)},notifyWidgetCreated:function(f){if(this.getPreserveWidgetList()){this.getWidgets().push(f)}this.invokeEvent("widgetCreate",{widget:f})},notifyWidgetFinalized:function(f){Kekule.ArrayUtils.remove(this.getWidgets(),f);this.invokeEvent("widgetFinalize",{widget:f})},hasPopupWidgets:function(){return !!this.getPopupWidgets().length},getBelongedResponsiveWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);if(f&&f.getStatic()){f=null}g=g.parentNode}return f},notifyWidgetEventFired:function(h,f,g){var i=Object.extend({},g);i.widget=h;this.invokeEvent(f,i)},installGlobalEventHandlers:function(m){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.addListener(m,h[g],this.reactUiEventBind)}},uninstallGlobalEventHandlers:function(m){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(m,h[g],this.reactUiEventBind)}},installGlobalTouchHandlers:function(g){if(typeof(Hammer)!=="undefined"){var f=Hammer(g).on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind);return f}},uninstallGlobalTouchHandlers:function(f){if(this._hammertime){this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)}},installGlobalDomMutationHandlers:function(h){var g=this;if(Kekule.X.MutationObserver){var f=new Kekule.X.MutationObserver(function(p){for(var t=0,o=p.length;t<o;++t){var n=p[t];if(n.type==="childList"){var r=n.addedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomAddedElem(u)}}var r=n.removedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomRemovedElem(u)}}}}});f.observe(h,{childList:true,subtree:true});this._domMutationObserver=f}else{this._reactDomNodeInserted=function(l){var i=l.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomAddedElem(i)}};this._reactDomNodeRemoved=function(l){var i=l.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomRemovedElem(i)}};Kekule.X.Event.addListener(h,"DOMNodeInserted",this._reactDomNodeInserted);Kekule.X.Event.addListener(h,"DOMNodeRemoved",this._reactDomNodeRemoved)}},uninstallGlobalDomMutationHandlers:function(f){if(this._domMutationObserver){this._domMutationObserver.disconnect()}if(this._reactDomNodeInserted){Kekule.X.Event.removeListener(f,"DOMNodeInserted",this._reactDomNodeInserted)}if(this._reactDomNodeRemoved){Kekule.X.Event.removeListener(f,"DOMNodeRemoved",this._reactDomNodeRemoved)}},_handleDomAddedElem:function(n){var m=Kekule.Widget.Utils.getWidgetsInsideElem(n,true);for(var h=0,g=m.length;h<g;++h){var f=m[h];f.insertedToDom()}var f=Kekule.Widget.Utils.getBelongedWidget(n);if(f){f.domElemAdded(n)}},_handleDomRemovedElem:function(n){var m=Kekule.Widget.Utils.getWidgetsInsideElem(n,true);for(var h=0,g=m.length;h<g;++h){var f=m[h];f.removedFromDom()}var f=Kekule.Widget.Utils.getBelongedWidget(n);if(f){f.domElemRemoved(n)}},reactUiEvent:function(i){var h=Kekule.Widget.getEventHandleFuncName(i.getType());if(this[h]){this[h](i)}var f=i.getTarget();var g=this.getBelongedResponsiveWidget(f);if(g){g.reactUiEvent(i)}},reactTouchGesture:function(h){var g=Kekule.Widget.getTouchGestureHandleFuncName(h.getType());if(this[g]){this[g](h)}var f=Kekule.Widget.getBelongedWidget(h.target);if(f){f.reactTouchGesture(h)}else{}},react_mousedown:function(g){if(this.hasPopupWidgets()){var f=g.getTarget();this.hidePopupWidgets(f)}},react_keydown:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){if(this.hasPopupWidgets()){this.hidePopupWidgets(null,true)}}},react_touchstart:function(g){if(this.hasPopupWidgets()){var f=g.getTarget();this.hidePopupWidgets(f)}},unpreparePopupWidget:function(f){f.setPopupCaller(null);this.restoreElem(f.getElement())},preparePopupWidget:function(n,o,t){n.setPopupCaller(o);var z=n.getElement();var x=z.ownerDocument;var m=this.getTopmostLayer(x,true);var v=z.parentNode===m;var u=Kekule.Widget.ShowHideType;var r;if((t===u.DROPDOWN)&&o){r=this._calcDropDownWidgetPosInfo(n,o)}else{if(!v){r=this._calcPopupWidgetPosInfo(n)}}if(!v){this.moveElemToTopmostLayer(z)}if(r){var y=["left","top","right","bottom","width","height"];var q={};var g=z.style;g.position="absolute";for(var s=0,p=y.length;s<p;++s){var f=y[s];var w=r[f];if(w){q[f]=g[f]||"";g[f]=w}}var h=this._getElemStoredInfo(z);h.styles=q}},_calcPopupWidgetPosInfo:function(g){var l=Kekule.HtmlElementUtils;var f=g.getElement();var i=g.isShown();if(!i){dropElem.style.visible="hidden";dropElem.style.display=""}var h=l.getElemBoundingClientRect(f);return{top:h.top+"px",left:h.left+"px"}},_calcDropDownWidgetPosInfo:function(g,I){var H=Kekule.HtmlElementUtils;var B=Kekule.Widget.Position;var n=I.getDropPosition?I.getDropPosition():null;var F=I.getParent();var O=F&&F.getLayout()||Kekule.Widget.Layout.HORIZONTAL;var K=I.getElement();var N=H.getElemBoundingClientRect(K);var G=H.getViewportDimension(K);var q=g.getElement();q.style.visible="hidden";q.style.display="";var f=false;var Q=this.getTopmostLayer(q.ownerDocument);if(!q.parentNode){Q.appendChild(q);f=true}q.style.position="relative";var z=H.getElemOffsetDimension(q);var L=H.getElemScrollDimension(q);var E=H.getElemBoundingClientRect(q);q.style.position="absolute";if(f){Q.removeChild(q)}if(!n||n===B.AUTO){n=0;if(O===Kekule.Widget.Layout.VERTICAL){var l=N.x;var P=G.width-l-N.width;if(P>=z.width){n|=B.RIGHT}else{n|=(l>P)?B.LEFT:B.RIGHT}}else{var C=N.y;var o=G.height-C-N.height;if(o>=z.height){n|=B.BOTTOM}else{n|=(C>o)?B.TOP:B.BOTTOM}}}var t=Kekule.StyleUtils;var N=H.getElemBoundingClientRect(K,true);var v=t.getComputedStyle(q,"width")||L.width;var M=t.getComputedStyle(q,"height")||L.height;var s;if(n&B.LEFT){s=N.left-E.width}else{if(n&B.RIGHT){s=N.right}else{var m=G.width-N.right;var i=G.width-N.left;if(i>=E.width){s=N.left}else{s=N.right-E.width}}}var r;if(n&B.TOP){r=N.top-E.height}else{if(n&B.BOTTOM){r=N.bottom}else{var J=G.height-N.bottom;var A=G.height-N.top;if(A>=E.height){r=N.bottom}else{r=N.bottom-E.height}}}s+="px";r+="px";v+="px";M+="px";var u={};u.left=s;u.top=r;u.width=v;u.height=M;return u},hidePopupWidgets:function(g,o){var q=this.getPopupWidgets();var f=Kekule.Widget.getBelongedWidget(g);var p=f?f.getPopupCaller():null;var l=p?p.getElement():null;for(var m=q.length-1;m>=0;--m){var n=q[m];var h=n.getElement();if(h){if(h===l||Kekule.DomUtils.isDescendantOf(l,h)){continue}if((!g)||((h!==g)&&(!Kekule.DomUtils.isDescendantOf(g,h)))){if(!o){n.hide()}else{n.dismiss()}}}else{Kekule.ArrayUtils.remove(this.getPopupWidgets(),n)}}},registerPopupWidget:function(f){f.addClassName(c.POPUP);Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),f)},unregisterPopupWidget:function(f){f.removeClassName(c.POPUP);Kekule.ArrayUtils.remove(this.getPopupWidgets(),f)},getTopmostLayer:function(g,h){var f=g.body;return f},_getElemStoredInfo:function(g){var f=g[this.INFO_FIELD];if(!f){f={};g[this.INFO_FIELD]=f}return f},_clearElemStoredInfo:function(f){if(f[this.INFO_FIELD]){f[this.INFO_FIELD]=undefined}},moveElemToTopmostLayer:function(g){var h=this._getElemStoredInfo(g);h.parentElem=g.parentNode;h.nextSibling=g.nextSibling;var f=this.getTopmostLayer(g.ownerDocument);f.appendChild(g)},restoreElem:function(m){var h=this._getElemStoredInfo(m);var r=h.styles;var p=Kekule.ObjUtils.getOwnedFieldNames(r);var f=m.style;for(var o=0,n=p.length;o<n;++o){var g=p[o];var q=r[g];if(q){f[g]=q}else{Kekule.StyleUtils.removeStyleProperty(f,g)}}if(h.parentElem){if(h.nextSibling){h.parentElem.insertBefore(m,h.nextSibling)}else{h.parentElem.appendChild(m)}}m[this.INFO_FIELD]=null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager);Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()})();(function(){var c=function(){var m=["monospace","sans-serif","serif"];var f="mmmmmmmmmmlli";var i="72px";var g=document.getElementsByTagName("body")[0];var o=document.createElement("span");o.style.fontSize=i;o.innerHTML=f;var n={};var d={};for(var l in m){o.style.fontFamily=m[l];g.appendChild(o);n[m[l]]=o.offsetWidth;d[m[l]]=o.offsetHeight;g.removeChild(o)}function e(p){var r=false;for(var q in m){o.style.fontFamily=p+","+m[q];g.appendChild(o);var h=(o.offsetWidth!=n[m[q]]||o.offsetHeight!=d[m[q]]);g.removeChild(o);r=r||h}return r}this.detect=e};var b;Kekule.Widget.FontDetector={detect:function(e){var f=b;if(!f){f=new c();b=f}return f.detect(e)}};var a=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(e){if(!e){e=a}var d=[];for(var g=0,f=e.length;g<f;++g){var h=e[g];if(Kekule.Widget.FontDetector.detect(h)){d.push(h)}}return d}}})();(function(){Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function($super){$super();this._data=new Kekule.MapEx(true);if(Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage;this.setEnableCrossPageClipboard(true);var a=this;Kekule.X.Event.addListener(window,"storage",function(d){if(a.getEnableCrossPageClipboard()){var c=d.key;var b=a._extractSessionDataType(c);if(b){a.invokeEvent("setData",{dataType:b,data:a.deserializeData(d.newValue)})}}})}},finalize:function($super){this._data.finalize();$super()},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(a){return(a.startsWith(this.STORAGE_KEY))?a.substr(this.STORAGE_KEY.length):null},serializeData:function(b){var a;if(DataType.isSimpleValue(b)){a=JSON.stringify(b)}else{var c={};ObjSerializerFactory.getSerializer("json").save(b,c);a=JSON.stringify(c)}return a},deserializeData:function(a){var b=JSON.parse(a);if(DataType.isSimpleValue(b)){return b}else{return ObjSerializerFactory.getSerializer("json").load(null,b)}},setData:function(a,c){if(this._useSessionClipboard()){var b=this.serializeData(c);this._crossPageStorage.setItem(this.STORAGE_KEY+a,b)}else{this._data.set(a,c)}this.invokeEvent("setData",{dataType:a,data:c});return this},getData:function(a){if(this._useSessionClipboard()){var b=this._crossPageStorage.getItem(this.STORAGE_KEY+a);return b?this.deserializeData(b):null}else{return this._data.get(a)}},hasData:function(a){return Kekule.ObjUtils.notUnset(this.getData(a))},clearData:function(){if(this._useSessionClipboard()){var c=this.getTypes();for(var b=0,a=c.length;b<a;++b){this._crossPageStorage.removeItem(this.STORAGE_KEY+c[b])}}else{this._data.clear()}this.invokeEvent("setData",{dataType:null,data:null});return this},getTypes:function(){if(this._useSessionClipboard()){var a=[];for(var e=0,b=this._crossPageStorage.length;e<b;++e){var d=this._crossPageStorage.key(e);var c=this._extractSessionDataType(d);if(c){a.push(c)}}return a}else{return this._data.getKeys()}},setObjects:function(h,d){var f=[];var g=ObjSerializerFactory.getSerializer("json");for(var c=0,a=d.length;c<a;++c){var b=d[c];var m={};g.save(b,m);f.push(m)}var e=JSON.stringify(f);return this.setData(h,e)},getObjects:function(g){var c=this.getData(g);if(DataType.isSimpleValue(c)){var e=JSON.parse(c);if(!DataType.isArrayValue(e)){e=[e]}var m=[];var f=ObjSerializerFactory.getSerializer("json");for(var d=0,a=e.length;d<a;++d){var h=e[d];var b=f.load(null,h);m.push(b)}return m}else{return c}}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard);Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()})();(function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var a=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5000,initialize:function($super,d,c,b,e,f){$super();this._timeoutRevokeHandle=null;this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this);this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this);this.setTimeout(f||this.DEF_TIMEOUT);this.setPropStoreFieldValue("evokeModes",b||[]);this.setPropStoreFieldValue("revokeModes",e||[]);this.linkWidgets(d,c)},finalize:function($super){this.unlinkWidgets(this.getEvokee(),this.getEvoker());$super()},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evokeModes",{dataType:DataType.ARRAY});this.defineProp("revokeModes",{dataType:DataType.ARRAY});this.defineProp("timeout",{dataType:DataType.INT});this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);this.getEvoker().show(this.getEvokee(),null,this.getShowHideType());this.postponeTimeoutCheck()}},revoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);var b=this.getEvoker().getDocument();b.body.focus();this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType())}},doObjectChange:function($super,c){$super(c);var b=Kekule.ArrayUtils.intersect(c,["evokeModes","revokeModes"]);if(b.length>0){this.evokeModesChanged()}},linkWidgets:function(c,b){this.setPropStoreFieldValue("evokee",c);this.setPropStoreFieldValue("evoker",b);this.installEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.installEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind);this.updateOnAlwaysMode()},unlinkWidgets:function(c,b){this.uninstallEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.uninstallEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.addEventListener(d[c],e)}},uninstallEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.removeEventListener(d[c],e)}},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){this.evoke()}else{if(this.getRevokeModes().indexOf(a.ALWAYS)>=0){this.revoke()}}},checkTimeoutRevoke:function(m){if(!this.getEvoker()){return}var g=Kekule.DomUtils;var n=this.getEvoker().getDocument();var h=n.activeElement;var b=this.getRevokeModes();var o=[];if(b.indexOf(a.EVOKEE_TIMEOUT)>=0){o.push(this.getEvokee().getElement())}if(b.indexOf(a.EVOKER_TIMEOUT)>=0){o.push(this.getEvoker().getElement())}var f=false;for(var e=0,d=o.length;e<d;++e){var c=o[e];if((h===c)||g.isDescendantOf(h,c)){f=true;break}}if(f){this.postponeTimeoutCheck()}else{this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}else{this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}}},hasTimeoutMode:function(b){return Kekule.ArrayUtils.intersect([a.EVOKEE_TIMEOUT,a.EVOKER_TIMEOUT],b).length>0},getEventTypeOfMode:function(b){switch(b){case a.EVOKEE_CLICK:case a.EVOKER_CLICK:return"click";case a.EVOKEE_MOUSE_ENTER:case a.EVOKER_MOUSE_ENTER:return"mouseenter";case a.EVOKEE_MOUSE_LEAVE:case a.EVOKER_MOUSE_LEAVE:return"mouseleave";case a.EVOKEE_MOUSE_DOWN:case a.EVOKER_MOUSE_DOWN:return"mousedown";case a.EVOKEE_MOUSE_UP:case a.EVOKER_MOUSE_UP:return"mouseup";case a.EVOKEE_MOUSE_MOVE:case a.EVOKER_MOUSE_MOVE:return"mousemove";case a.EVOKEE_TOUCH:case a.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(b){return(b>=a.EVOKEE_CLICK)&&(b<=a.EVOKEE_TOUCH)},reactEvokeEvents:function(h){var n=h.htmlEvent.getType();var g=h.target;if((g!==this.getEvokee())&&(g!==this.getEvoker())){return}var d=(h.target===this.getEvokee());var m=!this.getEvoker().isShown();if(m){if((this.getRevokeModes().indexOf(a.ALWAYS)>=0)){return}var f=this.getEvokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(n===this.getEventTypeOfMode(f[c]))){this.evoke();return}}}else{if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}var f=this.getRevokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(n===this.getEventTypeOfMode(f[c]))){this.revoke();return}}}}})})();(function(){var c=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function($super,f,e){$super();this.setPropStoreFieldValue("name",f);if(e){this.setCssClassName(e)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null});this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(e){c.addClass(this._getElement(e),this.getCssClassName());return this},unlinkFrom:function(e){c.removeClass(this._getElement(e),this.getCssClassName())},_getElement:function(e){if(e instanceof Kekule.Widget.BaseWidget){return e.getElement()}else{return e}}});Kekule.Widget.StyleResourceManager={_resources:{},register:function(f){var e=f.getName();if(e){d._resources[e]=f}return d},unregister:function(f){var e;if(typeof(f)==="string"){e=f}else{if(f.getName){e=f.getName()}}if(e){delete d._resources[e]}return d},getResource:function(e){return d._resources[e]}};Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_LOAD_FILE:"$$btn_load_file"};var d=Kekule.Widget.StyleResourceManager;var b=Kekule.Widget.StyleResource;var a=Kekule.Widget.StyleResourceNames;d.register(new b(a.CURSOR_ROTATE,"K-Res-Cursor-Rotate"));d.register(new b(a.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE"));d.register(new b(a.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW"));d.register(new b(a.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE"));d.register(new b(a.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW"));d.register(new b(a.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick"));d.register(new b(a.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet"));d.register(new b(a.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed"));d.register(new b(a.BUTTON_YES_OK,"K-Res-Button-YesOk"));d.register(new b(a.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel"));d.register(new b(a.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile"))})();(function(){var a=Kekule.DomUtils;Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",initialize:function($super){$super();this._executingFlag=0;this._pendingWidgetRefMap=new Kekule.MapEx(true);var c=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(g,f,h){if(h){var d=Kekule.Widget.getWidgetById(h,g.getDocument());if(d){g.setPropValue(f,d)}else{var e=g.getDocument().getElementById(h);if(e&&c.isExecuting()){c.addPendingWidgetRefItem(e,g,f)}}}}},finalize:function($super){this._pendingWidgetRefMap=null;$super()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(c,e,d){this._pendingWidgetRefMap.set(c,{widget:e,propName:d})},removePendingWidgetRefItem:function(c){this._pendingWidgetRefMap.remove(c)},handlePendingWidgetRef:function(){var h=this._pendingWidgetRefMap.getKeys();for(var e=0,c=h.length;e<c;++e){var g=h[e];var d=Kekule.Widget.getWidgetOnElem(g);if(d){var f=this._pendingWidgetRefMap.get(g);f.widget.setPropValue(f.propName,d)}}},beginExec:function(){++this._executingFlag},endExec:function(){if(this._executingFlag>0){--this._executingFlag}if(this._executingFlag<=0){this.handlePendingWidgetRef()}},isExecuting:function(){return this._executingFlag>0},execute:function(c){this.beginExec();try{this.executeOnElem(c.ownerDocument,c,null)}finally{this.endExec()}},executeOnElem:function(q,g,c){var n;var p=c;if(Kekule.Widget.getWidgetOnElem(g)){return}var o=g.getAttribute(this.WIDGET_ATTRIB);if(!o){o=g.getAttribute(this.WIDGET_ATTRIB_ALT)}if(o){var f=this.getWidgetClass(o);if(f){n=this.createWidgetOnElem(q,g,f);if(n){if(c){n.setParent(c)}p=n}}}if(!n||Kekule.Widget.AutoLauncher.enableCascadeLaunch){var e=a.getDirectChildElems(g);for(var m=0,h=e.length;m<h;++m){var d=e[m];this.executeOnElem(q,d,p)}}},createWidgetOnElem:function(e,d,f){var c=new f(d);return c},getWidgetClass:function(c){return ClassEx.findClass(c)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher);Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance();Kekule.Widget.AutoLauncher.enabled=true;Kekule.Widget.AutoLauncher.enableCascadeLaunch=true;Kekule.Widget.AutoLauncher.enableDynamicDomCheck=true;var b=function(){if(b.done){return}if(Kekule.Widget.AutoLauncher.enabled){Kekule.Widget.autoLauncher.execute(document.body)}if(Kekule.X.MutationObserver){var c=new Kekule.X.MutationObserver(function(f){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck){for(var o=0,e=f.length;o<e;++o){var d=f[o];if(d.type==="childList"){var n=d.addedNodes;for(var h=0,g=n.length;h<g;++h){var p=n[h];if(p.nodeType===Node.ELEMENT_NODE){Kekule.Widget.autoLauncher.execute(p)}}}}}});c.observe(document.body,{childList:true,subtree:true})}else{Kekule.X.Event.addListener(document,"DOMNodeInserted",function(f){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck){var d=f.getTarget();if(d.nodeType===(Node.ELEMENT_NODE||1)){Kekule.Widget.autoLauncher.execute(d)}}})}b.done=true};Kekule.X.domReady(b)})();(function(){var b=Kekule.Widget.Direction;SU=Kekule.StyleUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function($super){$super()},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:false});this.defineProp("caller",{dataType:DataType.OBJECT,serializable:false})},canExecute:function(d,c){return true},prepare:function(e,d,c){},finish:function(e,d,c){},execute:function(h,g,l,f){this.setElement(h);if(g){this.setCaller(g)}var i=Object.extend({from:0,to:1},f);var e=this;var d=function(){e.finish(h,g,i);if(l){l()}};this.prepare(h,g,i);var e=this;var c={element:h,caller:g,callback:l,doneCallback:d,options:f,executor:this,halt:function(){e.halt(c)}};this.doExecute(h,g,d,i);return c},doExecute:function(e,d,f,c){},halt:function(c){if(c.executor!==this){c.executor.halt(c)}else{this.doHalt(c);if(c.doneCallback){c.doneCallback()}}},doHalt:function(c){},setElementProp:function(e,c,d){}});Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function($super){$super()},initProperties:function(){this.defineProp("cssProperty",{dataType:DataType.STRING});this.defineProp("timingFunc",{dataType:DataType.STRING})},getAffectedCssPropNames:function(){},getTransCssPropNames:function(){},storeCssInlineValues:function(g,m){var h=g.style;var c={};for(var f=0,d=m.length;f<d;++f){var e=m[f];c[e]=h[e]}return c},restoreCssInlineValues:function(g,o,n){var h=g.style;for(var f=0,c=o.length;f<c;++f){var d=o[f];if(!n[d]){try{h.removeProperty(d)}catch(m){h[d]=""}}else{h[d]=n[d]}}},storeCssComputedValues:function(g,m){var c={};for(var f=0,d=m.length;f<d;++f){var e=m[f];var h=SU.getComputedStyle(g,e);c[e]=h}return c},canExecute:function(d,c){return Kekule.BrowserFeature.cssTransition},isSupported:function(){return Kekule.BrowserFeature.cssTransition},isAppear:function(c){return !!c.isAppear},isDisappear:function(c){return !!c.isDisappear},setTransitionProp:function(g,f,e){var h=["Moz"+f.capitalizeFirst(),"Webkit"+f.capitalizeFirst(),f];for(var d=0,c=h.length;d<c;++d){g[h[d]]=e}},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(f,e,d){this.setCssProperty(this.getTransCssPropNames().join(","));var c=this.getAffectedCssPropNames();this._affectedCssPropNames=c;this._originCssInlineValues=this.storeCssInlineValues(f,c);this._computedCssValues=this.storeCssComputedValues(f,c)},finish:function(e,d,c){if((c.to===1)||this.isAppear(c)||this.isDisappear(c)){this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues)}},doExecute:function(g,d,n,q){var h=Kekule.StyleUtils;var c=g.style;var l=this.isAppear(q);var m=this.isDisappear(q);if(this.isSupported()){this.setElementProp(g,q.from,q);if(!h.isDisplayed(g)){h.setDisplay(g,true)}if(!h.isVisible(g)){h.setVisibility(g,true)}var p=this.getCssProperty();this.setTransitionProp(c,"transitionProperty",p);p=this.getTimingFunc();if(p){this.setTransitionProp(c,"transitionTimingFunction",p)}p=q.duration.toString()+"ms";this.setTransitionProp(c,"transitionDuration",p);var o=this;var f=function(r){Kekule.X.Event.removeListener(g,"transitionend",f);o.setTransitionProp(c,"transition","");if(n){n()}};this._currEventHandler=f;Kekule.X.Event.addListener(g,"transitionend",f);setTimeout(function(){o.setElementProp(g,q.to,q)},0)}else{try{this.setElementProp(g,q.to,q)}catch(i){}if(n){n()}}},doHalt:function(c){var d=c.element;if(d){this.setTransitionProp(d.style,"transitionProperty","none")}}});Kekule.Widget.Css3OpacityTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3OpacityTrans",getAffectedCssPropNames:function(){return["opacity"]},getTransCssPropNames:function(){return["opacity"]},setElementProp:function(e,c,d){var f=parseFloat(this._computedCssValues.opacity)||1;e.style.opacity=f*c}});Kekule.Widget.Css3SlideTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3SlideTransition",initialize:function($super,c){$super();if(Kekule.ObjUtils.notUnset(c)){this.setDirection(c)}},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},canExecute:function($super,e,d){return true;var c=$super(e,d);if(c){var f=this.getDirection();if(b.isInHorizontal(f)){c=Kekule.ObjUtils.notUnset(SU.analysisUnitsValue(SU.getComputedStyle(e,"width")).value)}if(b.isInVertical(f)){c=c&&Kekule.ObjUtils.notUnset(SU.analysisUnitsValue(SU.getComputedStyle(e,"height")).value)}}return c},prepare:function($super,e,d,c){SU.setDisplay(e,true);this._direction=this.getActualDirection(e);$super(e,d,c);e.style.overflow="hidden"},setElementProp:function(d,e,m){var f=this._direction;var l;if(b.isInHorizontal(f)){l=this.getComputedCssValues().width;var i=SU.analysisUnitsValue(l);d.style.width=i.value*e+i.units;l=this.getComputedCssValues().left;if(l){var c=SU.analysisUnitsValue(l);if(c.units===i.units){d.style.left=(i.value*(1-e)+c.value)+c.units}}}if(b.isInVertical(f)){l=this.getComputedCssValues().height;var g=SU.analysisUnitsValue(l);d.style.height=g.value*e+g.units;l=this.getComputedCssValues().top;if(l){var h=SU.analysisUnitsValue(l);if(h.units===g.units){d.style.top=(g.value*(1-e)+h.value)+h.units}}}},getAffectedCssPropNames:function(){var c=[].concat(this.getTransCssPropNames());c.push("overflow");return c},getTransCssPropNames:function(){var d=this.getActualDirection(this.getElement());var c=[];if(b.isInHorizontal(d)){c.push("width");if(d&b.RTL){c.push("left")}}if(b.isInVertical(d)){c.push("height");if(d&b.BTT){c.push("top")}}return c},getRefRect:function(){var d=Kekule.HtmlElementUtils;if(this.getCaller()){var e=d.getElemPagePos(this.getCaller());var c=d.getElemClientDimension(this.getCaller());return{x:e.x||0,y:e.y||0,width:c.width||0,height:c.height||0}}else{return null}},getActualDirection:function(l){if(!l){l=this.getElement()}var c=Kekule.Widget.Direction;var i=Kekule.HtmlElementUtils;var p=this.getDirection();if(!p||(p===c.AUTO)){var d=this.getRefRect();if(!d){p=c.TTB}else{var n={x:d.x+d.width/2,y:d.y+d.height/2};var e=i.getElemPagePos(l);var m=i.getElemClientDimension(l);var f={x:e.x+(m.width||0)/2,y:e.y+(m.height||0)/2};var o=Kekule.CoordUtils.substract(f,n);if(d.width<1){p=(o.x>=0)?c.LTR:c.RTL}else{if(o.x<1){p=(o.y>=0)?c.TTB:c.BTT}else{var h=Math.abs(d.height/d.width);var g=Math.abs(o.y/o.x);if(h>g){p=(o.x>=0)?c.LTR:c.RTL}else{p=(o.y>=0)?c.TTB:c.BTT}}}}}return p}});Kekule.Widget.Css3GrowTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3GrowTransition",initialize:function($super,c){$super();if(c){if(c.ownerDocument){this.setBaseElement(c)}else{this.setCaller(c)}}},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(){var d=Kekule.HtmlElementUtils;if(this.getBaseRect()){return this.getBaseRect()}else{if(this.getCaller()){var e=d.getElemPagePos(this.getCaller());var c=d.getElemClientDimension(this.getCaller());return{x:e.x,y:e.y,width:c.width,height:c.height}}else{return{x:0,y:0,width:0,height:0}}}},canExecute:function($super,e,d){return true;var c=$super(e,d);if(c){c=Kekule.ObjUtils.notUnset(SU.analysisUnitsValue(SU.getComputedStyle(e,"width")).value);c=c&&Kekule.ObjUtils.notUnset(SU.analysisUnitsValue(SU.getComputedStyle(e,"height")).value)}return c},prepare:function($super,f,d,l){SU.setDisplay(f,true);$super(f,d,l);f.style.overflow="hidden";Kekule.HtmlElementUtils.makePositioned(f);var c=this.getRefRect();var e=Kekule.HtmlElementUtils;var h=e.getElemPagePos(f);var g=e.getElemClientDimension(f);var i={x:h.x-c.x,y:h.y-c.y,width:g.width-c.width,height:g.height-c.height};this._delta=i},setElementProp:function(e,c,d){var l=this.getComputedCssValues();var i=this._delta;var g=1-c;var f=e.style;var h=SU.analysisUnitsValue(l.left);if(h.units==="px"){f.left=(h.value-g*i.x)+"px"}var h=SU.analysisUnitsValue(l.top);if(h.units==="px"){f.top=(h.value-g*i.y)+"px"}var h=SU.analysisUnitsValue(l.width);if(h.units==="px"){f.width=(h.value-g*i.width)+"px"}var h=SU.analysisUnitsValue(l.height);if(h.units==="px"){f.height=(h.value-g*i.height)+"px"}},getAffectedCssPropNames:function(){var c=[].concat(this.getTransCssPropNames());c.push("overflow");return c},getTransCssPropNames:function(){return["left","top","width","height","position"]}});Kekule.Widget.Css3TransitionSimpleClassCreator={create:function(g,e,d,f){var c=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:g,initialize:function($super){$super();this.setCssProperty(e);this.setTimingFunc(d)}});if(f){c=ClassEx.extend(c,f)}return c}};var a=Kekule.Widget.Css3TransitionSimpleClassCreator})();(function(){SU=Kekule.StyleUtils;Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function($super){$super();this.setEnableTransition(true);this.setShowDuration(300);this.setHideDuration(300)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL});this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:false});this.defineProp("showDuration",{dataType:DataType.INT});this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(c){if(!c){return null}else{return c.getElement?c.getElement():Kekule.DomUtils.isElement(c)?c:null}},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(g,f,e){var d=this.getTransitionSelector();if(!d){return null}else{var c=d.selectTransition(g,f,e);if(c&&f){c.setCaller(this._getCallerElement(f))}}return c},show:function(g,e,i,h){var f={from:0,to:1,isAppear:true,duration:this.getShowDuration()};var c=this.selectTransition(g,e,h);if(c&&this.isUsingTransition()&&c.canExecute(g.getElement(),f)){var d=function(l){g.setVisible(true,true);g.setDisplayed(true,true);if(i){i()}};return c.execute(g.getElement(),this._getCallerElement(e),d,f)}else{g.setVisible(true,true);g.setDisplayed(true,true);if(i){i()}}return null},hide:function(h,e,l,i,g){var f={from:1,to:0,isDisappear:true,duration:this.getHideDuration()};var c=this.selectTransition(h,e,i);if(c&&this.isUsingTransition()&&c.canExecute(h.getElement(),f)){var d=function(){if(g){h.setVisible(false,true)}else{h.setDisplayed(false,true)}if(l){l()}};return c.execute(h.getElement(),this._getCallerElement(e),d,f)}else{if(g){h.setVisible(false,true)}else{h.setDisplayed(false,true)}if(l){l()}}return null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager);Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance();Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function($super){$super();this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:false})},_getTransClassOfType:function(c){var d=this.getTransitionClassMap();return d[c]||d[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(c,d){this.getTransitionClassMap()[c]=d},selectTransition:function(g,d,c){var f;var e=Kekule.Widget.ShowHideType;if(d){f=this._getTransClassOfType(c)}else{f=this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT)}if(f){return new f()}else{return null}}});var b=new Kekule.Widget.ShowHideTransitionSelector();var a=Kekule.Widget.ShowHideType;b.addTransitionClass(a.DEFAULT,Kekule.Widget.Css3OpacityTrans);b.addTransitionClass(a.DROPDOWN,Kekule.Widget.Css3SlideTransition);b.addTransitionClass(a.POPUP,Kekule.Widget.Css3GrowTransition);b.addTransitionClass(a.DIALOG,Kekule.Widget.Css3GrowTransition);Kekule.Widget.showHideManager.setTransitionSelector(b)})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function($super,c,d){this._imgElem=null;$super(c);if(d){this.setNormalInfo(d)}},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH});this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH});this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH});this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH});this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,c){var d=Object.extend({setter:function(f){if(f){this.setPropStoreFieldValue(e,Object.extend({},f))}else{this.setPropStoreFieldValue(e,null)}this.imgInfoChanged()}},c);return this.defineProp(e,d)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(d){var c=d.createElement("span");return c},doBindElement:function($super,c){$super();this.createImgContainer(c)},createImgContainer:function(c,e){var d=c.ownerDocument;this._imgElem=d.createElement("span");this._imgElem.className=a.FULLFILL;c.innerHTML="";c.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function($super){$super();this.updateImg()},updateImg:function(){var c=Kekule.Widget.State;var d=this.getState();var e=(d===c.DISABLED)?this.getDisabledInfo():(d===c.ACTIVE)?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():(d===c.HOVER)?this.getHoverInfo():(d===c.FOCUSED)?this.getFocusedInfo():this.getNormalInfo();e=e||this.getNormalInfo();this.showImgOfInfo(e)},showImgOfInfo:function(d){var c=this._imgElem;if(c){if(d){if(d.className){c.className=a.FULLFILL;b.addClass(c,d.className)}else{c.className=a.FULLFILL}c.style.backgroundImage=d.src?"url("+d.src+")":"";c.style.backgroundPosition=d.position||"";c.style.backgroundRepeat=d.repeat||"no-repeat"}else{c.style.backgroundImage=""}}}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",MENUITEM:"K-MenuItem"});Kekule.Widget.Menu=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",SUB_MENU_TAGS:["ol","ul"],initialize:function($super,d){this.setPropStoreFieldValue("useCornerDecoration",true);$super(d)},initProperties:function(){},doGetWidgetClassName:function($super){return $super()+" "+a.MENU},doBindElement:function($super,d){$super(d);this.prepareElement(d)},doDomElemAdded:function(d){this.prepareElement(d)},prepareElement:function(e){var d=e.tagName.toLowerCase();if((d==="ul")||(d)==="ol"||(d==="li")){if(this.getUseCornerDecoration()){c.addClass(e,a.CORNER_ALL)}else{c.removeClass(e,a.CORNER_ALL)}}var f=e.firstChild;while(f){if(f.nodeType===Node.ELEMENT_NODE){this.prepareElement(f)}f=f.nextSibling}},getMenuListTagName:function(){return this.getElement().tagName},getMenuItems:function(d){if(!d){d=this.getElement()}return b.getDirectChildElems(d,this.MENU_ITEM_TAG)},getSubMenu:function(h){var e;for(var g=0,f=this.SUB_MENU_TAGS.length;g<f;++g){var d=this.SUB_MENU_TAGS[g];e=b.getDirectChildElems(menuListElem,d);if(e&&e.length){break}}return e},getSubMenuItems:function(d){return this.getMenuItems(this.getSubMenu(d))},insertMenuItem:function(e,d){}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",TOOLBAR:"K-Toolbar"});var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function($super,c){$super(c);this.reactShowStateChangeBind=this.reactShowStateChange.bind(this);this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function($super){this.removeEventListener("showStateChange",this.reactShowStateChangeBind);this.clearWidgets();$super()},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth");this.defineChildDimensionRelatedProp("childHeight");this.defineChildDimensionRelatedProp("childMargin");this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:false,setter:function(c){this.setPropStoreFieldValue("allowChildWrap",c);if(c){this.removeClassName(a.NOWRAP)}else{this.addClassName(a.NOWRAP)}}})},initPropValues:function($super){$super();this.setAllowChildWrap(true)},defineChildDimensionRelatedProp:function(e,c){var d=Object.extend({dataType:DataType.STRING,setter:function(f){this.setPropStoreFieldValue(e,f);this.updateChildSizes()}},c||{});return this.defineProp(e,d)},doGetWidgetClassName:function(){return a.CONTAINER},doCreateRootElement:function(d){var c=d.createElement("span");return c},getContainerElement:function(){return this.getElement()},appendWidget:function(c){c.setParent(this);return this},insertWidgetBefore:function(d,c){d.insertToWidget(this,c);return this},removeWidget:function(d,c){d.setParent(null);if(!c){d.finalize()}},clearWidgets:function(c){var e=this.getChildWidgets();for(var d=e.length-1;d>=0;--d){var f=e[d];this.removeWidget(f,c)}},_insertChildWidget:function(e,d){var c=d?d.getElement():null;if(c){this.getContainerElement().insertBefore(e.getElement(),c)}else{this.getContainerElement().appendChild(e.getElement())}},reactShowStateChange:function(c){if(c.target!==this){this.childrenModified()}},childrenModified:function($super){$super();var h=this.getChildWidgets();var c=h.length;var e=0;var l=h[e];while(l&&(!l.isShown())&&(e<c)){++e;l=h[e]}var g=(e<c)?l:null;var e=c-1;var l=h[c-1];while(l&&(!l.isShown())&&(e>=0)){--e;l=h[e]}var d=(e>=0)?l:null;var f=this.getFirstChild();var i=this.getLastChild();if(g!==f){if(f){f.removeClassName(a.FIRST_CHILD)}if(g){g.addClassName(a.FIRST_CHILD)}this.setPropStoreFieldValue("firstChild",g)}if(d!==i){if(i){i.removeClassName(a.LAST_CHILD)}if(d){d.addClassName(a.LAST_CHILD)}this.setPropStoreFieldValue("lastChild",d)}},childWidgetAdded:function($super,f){$super(f);var c=this.getChildWidth();if(c){f.setWidth(c)}var d=this.getChildHeight();if(d){f.setHeight(d)}var e=this.getChildMargin();if(e){f.getStyle().margin=e}this._insertChildWidget(f,null)},childWidgetRemoved:function($super,c){$super(c)},childWidgetMoved:function($super,g,e){$super(g,e);var f=g.getElement();var d=this.getChildWidgets()[e+1];var c=d?d.getElement():null;if(c){this.getContainerElement().insertBefore(f,c)}else{this.getContainerElement().appendChild(f)}},updateChildSizes:function(){var f=this.getChildWidgets();var d=this.getChildWidth()||"";var g=this.getChildHeight()||"";var o=this.getChildMargin()||"";var m=this.getLayout();for(var e=0,c=f.length;e<c;++e){var n=f[e];n.setWidth(d);n.setHeight(g);n.getStyle().margin=o}}});Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+a.PANEL}});Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doObjectChange:function($super,c){$super(c);if(c.indexOf("useCornerDecoration")>=0){this._updateChildStyles()}},childWidgetAdded:function($super,c){if(c.setUseCornerDecoration){c.setUseCornerDecoration(false)}$super(c)},layoutChanged:function($super){$super();this._updateChildStyles()},childrenModified:function($super){$super();this._updateChildStyles()},_updateChildStyles:function(){var f=Kekule.Widget.Layout;var m=this.getLayout();var h=this.getFirstChild();var p=this.getLastChild();var o=this.getUseCornerDecoration();var d=this.getChildWidgets();var n=[a.CORNER_LEADING,a.CORNER_TAILING];for(var g=0,e=d.length;g<e;++g){var c=d[g];c.removeClassName(n);if(c===h){if(o){c.addClassName(a.CORNER_LEADING)}}if(c===p){if(o){c.addClassName(a.CORNER_TAILING)}}}}});Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",doGetWidgetClassName:function($super){return $super()+" "+a.TOOLBAR},doSetShowText:function($super,c){$super(c);this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function($super,c){$super(c);this._updateAllChildTextGlyphStyles()},childWidgetAdded:function($super,c){$super(c);this._updateChildTextGlyphStyles(c)},_updateChildTextGlyphStyles:function(c){if(c.setShowText){c.setShowText(this.getShowText())}if(c.setShowGlyph){c.setShowGlyph(this.getShowGlyph())}},_updateAllChildTextGlyphStyles:function(){var d=this.getChildWidgets();for(var c=d.length-1;c>=0;--c){this._updateChildTextGlyphStyles(d[c])}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"});Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function($super,c,d){this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;$super(c);if(d){this.setText(d)}},initProperties:function(){this.defineElemAttribMappingProp("actionType","type");this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(c){this.changeContentText(c)}});this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("leadingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart);this.setPropStoreFieldValue("leadingGlyph",c)}return c}});this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("tailingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemTailingGlyphPart);this.setPropStoreFieldValue("tailingGlyph",c)}return c}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(d){var c=this.getButtonKind();if(d!==c){this.cancelButtonKind(c);this.applyButtonKind(d);this.setPropStoreFieldValue("buttonKind",d)}}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setPropStoreFieldValue("showLeadingGlyph",true);this.setPropStoreFieldValue("showTailingGlyph",true);this.setPropStoreFieldValue("useCornerDecoration",true);this.setAllowTextWrap(false)},_createDefaultGlyphWidget:function(c){var d=new Kekule.Widget.Glyph(this);d.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT);d.setStatic(true).setInheritState(true).setInheritStatic(true).setInheritEnabled(true);d.appendToElem(c);return d},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON},doCreateRootElement:function(d){var c=d.createElement("button");return c},doBindElement:function($super,c){$super(c);var d=b.getInnerText(c);c.innerHTML="";this._elemTextPart=this.createTextContent(d,c);this._elemLeadingGlyphPart=this.createGlyphContent(c,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(c,null,a.PART_ASSOC_GLYPH_CONTENT);if(this.getUseCornerDecoration()){b.addClass(c,a.CORNER_ALL)}},changeContentText:function(c){this._elemTextPart.innerHTML=c||""},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function(c){if(this.getEnablePeriodicalExec()){this.startPeriodicalExec()}},doReactDeactiviting:function(c){this.stopPeriodicalExec();if(this.getIsActive()){this.execute()}},cancelButtonKind:function(c){if(c){this.removeClassName(c);this.removeClassName(a.BUTTON_KINDED)}},applyButtonKind:function(c){if(c){this.addClassName(a.BUTTON_KINDED);this.addClassName(c)}}});Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit"};Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(c){if(this.getPropStoreFieldValue("checked")!==c){this.setPropStoreFieldValue("checked",c);this.checkChanged();this.stateChanged()}}})},checkChanged:function(){},getStateClassName:function($super,d){var c=this.getChecked()?Kekule.Widget.State.ACTIVE:d;return $super(c)},doReactActiviting:function(c){if(this.getEnabled()){this.setChecked(!this.getChecked())}}});Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function(){if(this.getChecked()){this.uncheckSiblings()}},uncheckSiblings:function(){var g=this.getParent();var h=this.getGroup();if(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if((c!==this)&&c.getGroup&&c.setChecked&&(c.getGroup()===h)){c.setChecked(false)}}}},doReactActiviting:function(c){if(this.getEnabled()){this.setChecked(true)}}});Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function($super){var c=this.getDropDownWidget();if(c){c.finalize()}},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(c){this.setPropStoreFieldValue("dropDownWidget",c);if(c){c.setDisplayed(false)}}});this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function(d){var c=d.createElement("a");c.setAttribute("href","javascript:void(0)");return c},calcActualDropPosition:function(){var d=Kekule.Widget.Position;var m=this.getDropPosition();if(!m){var e=this.getParent();var i=e?e.getLayout():Kekule.Widget.Layout.HORIZONTAL;var h=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement());var g=Kekule.HtmlElementUtils.getViewportDimension(this.getElement());var n=this.getDropDownWidget().getElement();n.style.visible="hidden";n.style.display="";this.getElement().appendChild(n);var o=Kekule.HtmlElementUtils.getElemOffsetDimension(n);this.getElement().removeChild(n);if(i){if(i===Kekule.Widget.Layout.VERTICAL){var f=h.x;var q=g.width-f-h.width;if(q>=o.width){m=d.RIGHT}else{m=(f>q)?d.LEFT:d.RIGHT}}else{var l=h.y;var c=g.height-l-h.height;if(c>=o.height){m=d.BOTTOM}else{m=(l>c)?d.TOP:d.BOTTOM}}}}return m},showDropDownWidget:function(){var e=this.getDropDownWidget();var c=e.getElement();c.style.position="absolute";var d=this.getElement();e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN);this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var d=this.getDropDownWidget();var c=d&&d.isShown();return c},doExecute:function($super){if(this.getDropDownWidget()){if(this.isDropDownWidgetShown()){this.hideDropDownWidget()}else{this.showDropDownWidget()}}$super()}});Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setAllowChildWrap(false)},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON_GROUP},doCreateRootElement:function(d){var c=d.createElement("span");return c}});Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function($super,c,d){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this);this.setPropStoreFieldValue("showCompactMark",true);this.setPropStoreFieldValue("cloneSelectedOutlook",true);$super(c,d);if(!this.getButtonSet()){this.initButtonGroup()}},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:function(d){var c=this.getButtonSet();if(c!==d){if(c){c.finalize()}this.initButtonGroup(d)}}});this.defineProp("buttonSetLayout",{dataType:DataType.INT});this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:false,setter:function(d){if(d){if(this.getButtonSet().hasChild(d)){if(this.getCloneSelectedOutlook()){this.cloneSetButton(d)}if(d.setChecked){d.setChecked(true)}}}else{var c=this.getSelected();if(c){c.setChecked(false)}}this.setPropStoreFieldValue("selected",d)}});this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL});this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(d){var c=this.getShowCompactMark();if(c!==d){this.setPropStoreFieldValue("showCompactMark",d);if(d){this.createCompactMark()}else{this.removeCompactMark()}}}})},doGetWidgetClassName:function($super){return $super()+" "+a.COMPACT_BUTTON},doSetShowText:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowText(c)}return $super(c)},doSetShowGlyph:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowGlyph(c)}return $super(c)},createCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}var d=this.getDocument().createElement("span");d.className=a.BTN_COMPACT_MARK;c.appendChild(d);this._compactMark=d;return d},removeCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}},initButtonGroup:function(d){if(!d){d=new Kekule.Widget.ButtonGroup(this)}else{var c=this._getCheckedButtonInGroup(d)}d.setDisplayed(false);d.setShowText(this.getShowText());d.setShowGlyph(this.getShowGlyph());this.setPropStoreFieldValue("buttonSet",d);this.setDropDownWidget(d);d.addEventListener("execute",this.reactSetButtonExecuteBind);if(c){this.cloneSetButton(c)}},_getCheckedButtonInGroup:function(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if(c.getChecked&&c.getChecked()){return c}}return null},cloneSetButton:function(d){if(!this.getCloneSelectedOutlook()){return}var f=this.getElement();var p=this.getButtonSet().getElement();var o=Kekule.DomUtils;var g=o.getDirectChildElems(f);var m=o.getDirectChildElems(d.getElement());var n=false;for(var h=0,e=g.length;h<e;++h){var c=g[h];if(c!==p){f.removeChild(c)}else{n=true}}for(var h=0,e=m.length;h<e;++h){var c=m[h].cloneNode(true);if(n){f.insertBefore(c,p)}else{f.appendChild(c)}}if(this._clonedCustomHtmlClassName){this.removeClassName(this._clonedCustomHtmlClassName)}this._clonedCustomHtmlClassName=d.getCustomHtmlClassName();if(this._clonedCustomHtmlClassName){this.addClassName(this._clonedCustomHtmlClassName)}this._compactMark=null;this.createCompactMark()},calcActualButtonSetLayout:function(){var d=Kekule.Widget.Layout;var c=this.getButtonSetLayout();if(!c){var f=this.getParent();var e=f?f.getLayout():d.HORIZONTAL;c=(e===d.VERTICAL)?d.HORIZONTAL:d.VERTICAL}return c},showDropDownWidget:function($super){var c=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(c);$super()},reactSetButtonExecute:function(c){if(c.target instanceof Kekule.Widget.Button){if(c.target!==this.getSelected()){c.target.setIsFocused(false);c.target.setIsHover(false);c.target.setIsActive(false);this.getButtonSet().hide();this.setSelected(c.target);this.invokeEvent("select",{selected:c.target})}}},append:function(c,d){this.getButtonSet().appendWidget(c);if(d){this.setSelected(c)}return this},insertBefore:function(c,e,d){this.getButtonSet().insertWidgetBefore(c);if(d){this.setSelected(c)}return this},remove:function(d,c){this.getButtonSet().removeWidget(d,c);return this}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper"});Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function($super,e,f){this.reactValueChangeBind=this.reactValueChange.bind(this);this.reactInputBind=this.reactInput.bind(this);this.setPropStoreFieldValue("isDirty",false);$super(e,f)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}});this.defineProp("value",{dataType:DataType.VARIANT,serializable:false,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return true},doGetWidgetClassName:function($super){return $super()+" "+a.FORMCONTROL},doBindElement:function($super,f){$super(f);var e=this.getCoreElement();if(e){Kekule.X.Event.addListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.addListener(e,"input",this.reactInputBind)}},doUnbindElement:function($super,f){var e=this.getCoreElement();if(e){Kekule.X.Event.removeListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.removeListener(e,"input",this.reactInputBind)}$super(f)},selectAll:function(){var e=this.getCoreElement();if(e&&e.select){e.select()}return this},reactValueChange:function(){this.setIsDirty(true);this.invokeEvent("valueChange",{widget:this})},reactInput:function(){this.setIsDirty(true)}});Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(Kekule.ObjUtils.notUnset(f)){this.setChecked(!!f)}},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return e?e.checked:false},setter:function(f){var e=this.getCoreElement();if(e){e.checked=!!f}}});this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(e){Kekule.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function($super){return $super()+" "+a.CHECKBOX},getInputElem:function(){var f=this.getElement();if(f){var e=f.getElementsByTagName("input");if(e&&e.length){return e[0]}}return null},getLabelElem:function(){var e=this.getElement();if(e){if(e.tagName.toLowerCase()==="label"){return e}else{var f=e.getElementsByTagName("label");if(f&&f.length){return f[0]}}}return null},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,e){var f=h.createElement("label");e.appendChild(f);var g=h.createElement("input");g.setAttribute("type","checkbox");f.appendChild(g);return[f,g]}});Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){if(e){this.getElement().value=e}else{this.getElement().value=""}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTBOX},doCreateRootElement:function(f){var e=f.createElement("input");e.setAttribute("type","text");return e},doBindElement:function($super,e){$super(e)}});Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e)}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}});this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e);if(e){this.addClassName(a.OVERLAP)}else{this.removeClassName(a.OVERLAP)}this.adjustWidgetsSize()}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null});this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(g){var e=this.getHeadingWidget();if(g!==e){this.setPropStoreFieldValue("headingWidget",g);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(g){var f=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;g.setParent(this);g.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);g.insertToElem(this.getElement(),f)}}}});this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(f){var e=this.getTailingWidget();if(f!==e){this.setPropStoreFieldValue("tailingWidget",f);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(f){f.setParent(this);f.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);f.appendToElem(this.getElement())}}}})},finalize:function($super){this._finalizeSubWidgets();$super()},_finalizeSubWidgets:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getHeadingWidget();if(e){e.finalize()}var e=this.getTailingWidget();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOTEXTBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function($super,h,g){var e=$super(h,g);var f=this;this._finalizeSubWidgets();var i=new Kekule.Widget.TextBox(this);i.addClassName(a.TEXTBOX);i.appendToElem(this.getElement());this.setPropStoreFieldValue("textBox",i);e.push(i.getElement());return e},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getHeadingWidget())||(e===this.getTailingWidget())){g.widget=this}return $super(f,g)},doSetEnabled:function(f){var g=this.getTextBox();if(g){g.setEnabled(f)}var e=this.getHeadingWidget();if(e){e.setEnabled(f)}e=this.getTailingWidget();if(e){e.setEnabled(f)}},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function($super,e){$super(e);if(e){this.adjustWidgetsSize()}},doInsertedToDom:function(){if(this.isShown()){this.adjustWidgetsSize()}},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var h=Kekule.StyleUtils;var o=this.getOverlapOnTextBox();var l=o?"absolute":"relative";var g=this.getTextBox().getElement();if(!g){return}var n=Kekule.HtmlElementUtils.getElemBoundingClientRect(g);var i=this.getHeadingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=l;if(o){var m=Kekule.HtmlElementUtils.getElemBoundingClientRect(f);e.left=0;e.top=((n.height-m.height)/2)+"px";g.style.paddingLeft=m.width+"px"}else{h.removeStyleProperty(e,"left");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingLeft")}}else{h.removeStyleProperty(g.style,"paddingLeft")}var i=this.getTailingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=l;if(o){var m=Kekule.HtmlElementUtils.getElemBoundingClientRect(f);e.right=0;e.top=((n.height-m.height)/2)+"px";g.style.paddingRight=m.width+"px"}else{h.removeStyleProperty(e,"right");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingRight")}}else{h.removeStyleProperty(g.style,"paddingRight")}}});Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function($super,e,f){$super(e,f);this.setOverlapOnTextBox(true)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:false,setter:null,getter:function(){return this.getTailingWidget()}});this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}});this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e)}})},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTONTEXTBOX},doCreateSubElements:function($super,h,f){var e=$super(h,f);var g=this.createAssocButton();if(g){e.push(g.getElement())}return e},createAssocButton:function(){var e=new Kekule.Widget.Button(this);this.setTailingWidget(e);e.addEventListener("change",this.adjustWidgetsSize,this);e.addEventListener("execute",function(f){this.invokeEvent("buttonExecute",{widget:this})},this);return e},execBtn:function(){var e=this.getButton();if(e){e.execute();return true}},react_keypress:function(f){if(f.getKeyCode()===13){this.execBtn()}},react_keydown:function(g){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var f=Kekule.X.Event.KeyCode;if(g.getKeyCode()===f.DOWN){this.execBtn()}}}});Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e);this.adjustAutoSize()}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}});this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e);this._autoSizeChanged()}});this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e);this._autoSizeChanged()}});this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTAREA},doCreateRootElement:function(f){var e=f.createElement("textarea");return e},doBindElement:function($super,e){$super(e);this.adjustAutoSize()},setValue:function($super,e){$super(e);this.adjustAutoSize()},widgetShowStateChanged:function($super,e){$super(e);if(e){this.adjustAutoSize()}},reactValueChange:function($super){this.adjustAutoSize();$super()},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){if(e){this.adjustAutoSize()}},_autoSizeChanged:function(){var e=this.getCoreElement().style;if(this.getAutoSizeX()){e.overflowX="hidden";this.setWrap("off")}else{e.overflowX="auto";this.setWrap("")}if(this.getAutoSizeY()){e.overflowY="hidden"}else{e.overflowY="auto"}this.adjustAutoSize()},adjustAutoSize:function(){if(this.getAutoSizeX()||this.getAutoSizeY()){this.adjustSizeByContent()}},adjustSizeByContent:function(){var f=this.getCoreElement();var i=this.getText();var h=!i;var e=f.style;if(this.getAutoSizeX()){e.width="1px"}if(this.getAutoSizeY()){e.height="1px"}var g=Kekule.HtmlElementUtils.getElemScrollDimension(f);var l=Kekule.HtmlElementUtils.getElemClientDimension(f);if(this.getAutoSizeX()){if(h){e.width="1em"}else{if(g.width>l.width){e.width=g.width+"px"}}}if(this.getAutoSizeY()){if(h){e.height="1em"}if(g.height>l.height){e.height=g.height+"px"}}}});Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function($super,e,f){$super(e);if(f){this.setItems(f)}},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var g=this.getAllItemElems();var e=[];for(var h=0,f=g.length;h<f;++h){var m=g[h];var n=this._getBoxItemInfo(m);e.push(n)}return e},setter:function(n){var f=this.getElement();this.clear();if(n){var g=Kekule.ArrayUtils.toArray(n);for(var h=0,e=g.length;h<e;++h){var o=g[h];if(o){var m=this._createBoxItemElem(f);this._setBoxItemInfo(m,o)}}}}});this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.SELECTBOX},doCreateRootElement:function(f){var e=f.createElement("select");return e},_createBoxItemElem:function(f,g){var h=f.ownerDocument;var e=h.createElement("option");if(g){f.insertBefore(e,g)}else{f.appendChild(e)}return e},doBindElement:function($super,e){$super(e)},doGetValue:function(){var e=this.getSelectedItemElem();if(e){var f=this._getBoxItemInfo(e);return f.value}else{return undefined}},doSetValue:function(n){var f=this.getAllItemElems();var g;for(var h=0,e=f.length;h<e;++h){var m=f[h];var o=this._getBoxItemInfo(m);if(o.value===n){this.setIndex(h);return}}this.setIndex(-1)},getAllItemElems:function(){return c.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){var f=this.getAllItemElems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.selected){return h}}return null},clear:function(){this.getElement().innerHTML=""},dropDown:function(){var g=this.getDocument();var f=this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",true,true);this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(f){var e={};e.text=d.getInnerText(f);e.value=f[this.ITEM_VALUE_FIELD];if(b.notUnset(f.title)){e.title=f.title}if(b.notUnset(f[this.ITEM_DATA_FIELD])){e.data=f[this.ITEM_DATA_FIELD]}return e},_setBoxItemInfo:function(g,e){var f=e.text||e.value;if(b.notUnset(f)){Kekule.DomUtils.setElementText(g,f)}g.value=""+e.value;g[this.ITEM_VALUE_FIELD]=e.value;if(b.notUnset(e.title)){g.title=e.title}if(b.notUnset(e.data)){g[this.ITEM_DATA_FIELD]=e.data}if(e.selected){g.setAttribute("selected","selected")}else{g.selected=false}return this}});Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e);this.textChanged()}}});this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var f=this.getSelectBox();if(f){f.setItems(e)}}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getSelectBox();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,f){var e=this;this._finalizeSubElements();var l=h.createElement("span");l.className=a.COMBOBOX_TEXTWRAPPER;f.appendChild(l);var i=new Kekule.Widget.TextBox(this);i.appendToElem(l);this.setPropStoreFieldValue("textBox",i);var g=new Kekule.Widget.SelectBox(this);g.appendToElem(f);this.setPropStoreFieldValue("selectBox",g);g.addEventListener("valueChange",function(n){var p=g.getSelectedItemElem();if(p){var m=p.value;var o=p.text||p.value;i.setText(o);i.selectAll();i.focus();e.invokeEvent("valueSelect",{widget:e,value:m})}});i.addEventListener("valueChange",function(m){e.textChanged()});Kekule.X.Event.addListener(i.getElement(),"keydown",function(n){var m=n.getKeyCode();if(m===Kekule.X.Event.KeyCode.DOWN){g.dropDown()}});return[l]},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getSelectBox())){g.widget=this}return $super(f,g)},textChanged:function(){var f=this.getText();var e=this._getValueOfText(f);this.getSelectBox().setValue(e)},_getValueOfText:function(m){var f=this.getSelectBox().getItems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.text&&(h.text===m)){return h.value}}return m},doSetEnabled:function(e){var g=this.getTextBox();if(g){g.setEnabled(e)}var f=this.getSelectBox();if(f){f.setEnabled(e)}},doGetValue:function($super){var f=$super();var e=this._getValueOfText(f);return e},doSetValue:function($super,m){var n=m;var f=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.value===m){n=h.text||h.value;this.getSelectBox().setIndex(g);break}}$super(n)}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"});Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function($super,a){$super(a)},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(b){var a=b.createElement("div");return a},doBindElement:function($super,a){$super(a)},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var a=this.doCreateChildItemElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM);Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_EMPTY);return a},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var a=this.doCreateChildContainerElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER);return a},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(d,c){if(!d){d=this.getElement()}var b=d.getElementsByTagName(this.getContainerElemTag());var a=b.length?b[0]:null;if(!a&&c){a=this._createChildContainerElem();d.appendChild(a)}return a},getItemData:function(a){return a[this.ITEM_DATA_FIELD]},setItemData:function(f,d){this.doSetItemData(f,d);f[this.ITEM_DATA_FIELD]=d;var e=d.children;if(e&&Kekule.ArrayUtils.isArray(e)){this.clearChildItems(f);for(var b=0,a=e.length;b<a;++b){var c=e[b];this.appendChildItem(f,c)}}return this},doSetItemData:function(b,a){},hasChildItem:function(a){return this.getChildItemCount(a)>0},getChildItemCount:function(a){return this.getChildren(a).length},getChildren:function(c){var b=this.getChildContainerElem(c);if(b){var a=Kekule.DomUtils.getDirectChildElems(b,this.getItemElemTag());return a}else{return[]}},getChildItemAt:function(a,b){var c=this.getChildren(a);return(c.length&&(c.length>b))?c[b]:null},insertChildItem:function(e,d,f){var b;var a=this.getChildContainerElem(e,true);if(d&&Kekule.DomUtils.isElement(d)){b=d}else{var b=this._createChildItemElem();if(!this.getItemInitialExpanded()){Kekule.HtmlElementUtils.addClass(b,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED)}if(d){this.setItemData(b,d)}}var c=DataType.isSimpleType(f)?this.getChildren(e)[index]:f;if(c){a.insertBefore(b,c)}else{a.appendChild(b)}this.childItemsChanged(e);return b},appendChildItem:function(b,a){return this.insertChildItem(b,a)},removeChildItem:function(c,b){var a=this.getChildContainerElem(c);if(a){a.removeChild(b);if(!this.hasChildItem(c)){c.removeChild(a)}this.childItemsChanged(c)}return this},removeChildItemAt:function(b,a){var c=this.getChildItemAt(b,a);if(c){this.removeChildItem(b,c)}return this},clearChildItems:function(b){var a=this.getChildContainerElem(b);if(!b){b=this.getElement()}if(a){b.removeChild(a)}this.childItemsChanged(b)},childItemsChanged:function(a){if(a){var b=Kekule.Widget.HtmlClassNames.STATE_EMPTY;if(this.hasChildItem(a)){Kekule.HtmlElementUtils.removeClass(a,b)}else{Kekule.HtmlElementUtils.addClass(a,b)}}},expandItem:function(a){Kekule.HtmlElementUtils.removeClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},collapseItem:function(a){Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},toggleExpandStateOfItem:function(a){Kekule.HtmlElementUtils.toggleClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},isChildItem:function(a){return Kekule.HtmlElementUtils.hasClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(d){var b=d;var c=this.getElement();var a=this.getDocument().body;while((b!==c)&&(b!==a)){b=b.parentNode;if(this.isChildItem(b)){return b}}return null},getAllChildItems:function(e){var b=[];var a=this.getChildContainerElem(e,false);if(a){var g=Kekule.DomUtils.getDirectChildElems(a);for(var f=0,c=g.length;f<c;++f){var h=g[f];if(this.isChildItem(h)){b.push(h);var d=this.getAllChildItems(h);b=b.concat(d)}}}return b},getChildItemRange:function(c,b,g){var f=this.getAllChildItems(g);var e=f.indexOf(c);var d=f.indexOf(b);if((e>=0)&&(d>=0)){if(e>d){var a=true;var h=e;e=d;d=h}var i=f.slice(e,d+1);if(a){i=i.reverse()}return i}else{return[]}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"});Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var c=this.getPropStoreFieldValue("selection");if(!c){c=[];this.setPropStoreFieldValue("selection",c)}return c},setter:function(c){this.select(c)}});this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:false,getter:function(){var c=this.getSelection();return c.length?c[c.length-1]:null},setter:function(c){this.select(c)}});this.defineProp("enableMultiSelected",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return a.TREEVIEW},doCreateChildItemElem:function($super){var c=$super();if(c){var d=this.createGlyphContent(c,null,a.TREEVIEW_EXPANDMARK);d[this.BELONGED_ITEM_FIELD]=c;c._expandMarkerElem=d;var e=this.getDocument().createElement("span");e.className=a.TREEVIEW_ITEMCONTENT;c.appendChild(e);e[this.BELONGED_ITEM_FIELD]=c;c._contentElem=e}return c},doSetItemData:function(d,c){this.setItemText(d,c.text)},getExpandMarkerElem:function(c){return c._expandMarkerElem},getItemContentElem:function(c){return c._contentElem},getTextPartElem:function(e,d){var c=e._textPartElem;if(!c&&d){c=this.createTextContent("",this.getItemContentElem(e));e._textPartElem=c}return c},setItemText:function(d,e){var c=this.getTextPartElem(d,true);c.innerHTML=e},isItemSelected:function(d){var c=this.getSelection();return c?(c.indexOf(d)>=0):false},selectionChanged:function(){this.notifyPropSet("selection",this.getSelection())},clearSelection:function(){var e=this.getSelection();if(e.length){for(var d=0,c=e.length;d<c;++d){var f=e[d];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(f),a.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]);this.selectionChanged()}return this},removeFromSelection:function(d){if(d){var f=Kekule.ArrayUtils.toArray(d);if(f&&f.length){var g=this.getSelection();for(var e=0,c=f.length;e<c;++e){var h=f[e];if(Kekule.ArrayUtils.remove(g,h)){Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(h),a.STATE_SELECTED)}}this.selectionChanged()}}return this},addToSelection:function(d){if(d){var h=Kekule.ArrayUtils.toArray(d);if(h&&h.length){if(!this.getEnableMultiSelected()){this.clearSelection();h=[h[h.length-1]]}var f=this.getSelection();for(var e=0,c=h.length;e<c;++e){var g=h[e];if(!this.isItemSelected(g)){Kekule.HtmlElementUtils.addClass(this.getItemContentElem(g),a.STATE_SELECTED);f.push(g)}}this.selectionChanged()}}return this},toggleSelectionState:function(d){if(d){this.beginUpdate();try{var h=Kekule.ArrayUtils.toArray(d);var f=this.getSelection();if(h&&h.length){for(var e=0,c=h.length;e<c;++e){var g=h[e];if(this.isItemSelected(g)){this.removeFromSelection(g)}else{this.addToSelection(g)}}}}finally{this.endUpdate()}}},select:function(c){this.beginUpdate();try{this.clearSelection();if(c){if(this.getEnableMultiSelected()){this.addToSelection(c)}else{var d=Kekule.ArrayUtils.toArray(c);this.addToSelection(d[d.length-1])}}}finally{this.endUpdate()}},react_click:function(h){var g=h.getTarget();var f=g[this.BELONGED_ITEM_FIELD];if(f&&this.isChildItem(f)){this.toggleExpandStateOfItem(f)}else{f=this.getBelongedChildItem(g);if(h.getShiftKey()){var d=this.getSelectedItem();if(d){var c=this.getChildItemRange(d,f);if(c.length){if(h.getCtrlKey()){this.addToSelection(c)}else{this.select(c)}}}else{this.select(f)}}else{if(h.getCtrlKey()){this.toggleSelectionState(f)}else{if(f){this.select(f)}}}}},react_dblclick:function(f){var d=f.getTarget();var c=this.getBelongedChildItem(d);if(c){this.toggleExpandStateOfItem(c)}}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel",DIALOG_MODAL_BACKGROUND:"K-Dialog-Modal-Background"});Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no"};Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4};Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function($super,e,f,g){this._dialogCallback=null;this._modalInfo=null;this._childButtons=[];this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER);$super(e);this._dialogOpened=false;this.setUseCornerDecoration(true);if(f){this.setCaption(f)}if(g){this.setButtons(g)}},doFinalize:function($super){this.unprepareModal();$super()},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return c.getElementText(this.getCaptionElem())},setter:function(e){c.setElementText(this.getCaptionElem(),e);b.setDisplay(this.getCaptionElem(),!!e)}});this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e);b.setDisplay(this.getBtnPanelElem(),e&&e.length);this.buttonsChanged()}});this.defineProp("result",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("location",{dataType:DataType.INT});this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC})},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return a.DIALOG},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function(h,f){var e=[];var g=h.createElement("div");g.className=a.DIALOG_CAPTION;f.appendChild(g);this.setPropStoreFieldValue("captionElem",g);e.push(g);var g=h.createElement("div");g.className=a.DIALOG_CLIENT;f.appendChild(g);this.setPropStoreFieldValue("clientElem",g);e.push(g);var g=h.createElement("div");g.className=a.DIALOG_BTN_PANEL;f.appendChild(g);this.setPropStoreFieldValue("btnPanelElem",g);e.push(g);return e},buttonsChanged:function(){for(var g=this._childButtons.length-1;g>=0;--g){var f=this._childButtons[g];f.finalize()}var h=this.getButtons()||[];for(var g=0,e=h.length;g<e;++g){this.createDialogButton(h[g])}},createDialogButton:function(m,f,l,g){var i=this._getPredefinedButtonInfo(m);if(!i){i={text:m}}if(i){var h=new Kekule.Widget.Button(this,i.text);h[this.BTN_NAME_FIELD]=m;h.addEventListener("execute",this._reactDialogBtnExec,this);h.appendToElem(this.getBtnPanelElem());h.__$name__=m;var e=f||this._getDialogButtonResName(m);if(e){h.linkStyleResource(e)}this._childButtons.push(h);return h}else{return null}},_getDialogButtonResName:function(f){var e=Kekule.Widget.DialogButtons;if([e.OK,e.YES].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_YES_OK}else{if([e.CANCEL,e.NO].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL}else{return null}}},_reactDialogBtnExec:function(i){var f=Kekule.Widget.DialogButtons;var h=[f.OK,f.YES,f.CANCEL,f.NO];var g=i.target;if(g){var l=g.__$name__;if(h.indexOf(l)>=0){this.setResult(l);this.close(l)}}},_getPredefinedButtonInfo:function(l){var g=Kekule.Widget.DialogButtons;var e=Kekule.WidgetTexts;var i=[g.OK,g.CANCEL,g.YES,g.NO];var h=[e.CAPTION_OK,e.CAPTION_CANCEL,e.CAPTION_YES,e.CAPTION_NO];var f=i.indexOf(l);return(f>=0)?{text:h[f]}:null},getDialogButton:function(g){for(var f=this._childButtons.length-1;f>=0;--f){var e=this._childButtons[f];if(e[this.BTN_NAME_FIELD]===g){return e}}return null},_storePositionInfo:function(){var f=this.getElement();var e=f.style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}},_restorePositionInfo:function(){var f=this.getElement();var e=f.style;var g=this._posInfo;if(g){e.left=g.left;e.top=g.top;e.right=g.right;e.bottom=g.bottom;e.width=g.width;e.height=g.height;e.position=g.position}},adjustLocation:function(){this._storePositionInfo();var i=Kekule.Widget.Location;var e=this.getLocation()||i.DEFAULT;if(e!==i.DEFAULT){var s,o,n,u,p,y;var z=this.getDisplayed();var C=this.getVisible();try{this.setDisplayed(true,true);this.setVisible(true,true);var q=Kekule.DocumentUtils.getClientDimension(this.getDocument());var A=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement());var g=A.right-A.left;var B=A.bottom-A.top;var m=this.getOffsetParent();var f=m?Kekule.HtmlElementUtils.getElemBoundingClientRect(m):{left:0,top:0,width:0,height:0}}finally{this.setVisible(C,true);this.setDisplayed(z,true)}if(e===i.CENTER_OR_FULLFILL){if((g>=q.width)||(B>=q.height)){e=i.FULLFILL}else{e=i.CENTER}}if(e===i.FULLFILL){s=0;o=0;p=0;y=0}else{if(e===i.CENTER){s=(q.width-g)/2;o=(q.height-B)/2}}var v=this.getElement().style;var x=Kekule.ObjUtils.notUnset;if(x(s)){v.left=s+"px"}if(x(o)){v.top=o+"px"}if(x(p)){v.right=p+"px"}if(x(y)){v.bottom=p+"px"}if(x(n)){v.width=n+"px"}if(x(u)){v.height=u+"px"}v.position="fixed";this.adjustClientSize(n,u)}},adjustClientSize:function(f,e){},prepareShow:function(g){var f=this.getElement();if(!f.parentNode){this.getDocument().body.appendChild(f)}var e=this;setTimeout(function(){e._dialogCallback=g},0)},prepareModal:function(){var f=this.getDocument();var g=this.getModalBackgroundElem();if(!g){g=f.createElement("div");g.className=a.DIALOG_MODAL_BACKGROUND;this.setPropStoreFieldValue("modalBackgroundElem",g)}var e=this.getElement();this._modalInfo={oldParent:e.parentNode,oldSibling:e.nextSibling};if(e.parentNode){e.parentNode.removeChild(e)}g.appendChild(e);f.body.appendChild(g)},unprepareModal:function(){if(this._modalInfo){if(this._modalInfo.oldParent){this._modalInfo.oldParent.insertBefore(this.getElement(),this._modalInfo.oldSibling)}}if(this.getModalBackgroundElem()){this.getDocument().body.removeChild(this.getModalBackgroundElem())}},openModal:function(f,e){this.prepareModal();return this.open(f,e)},openPopup:function(f,e){return this.open(f,e,Kekule.Widget.ShowHideType.POPUP)},open:function(g,e,f){this.prepareShow(g);this.show(e,null,f||Kekule.Widget.ShowHideType.DIALOG);this._dialogOpened=true;return this},close:function(e){var f=this;this.hide()},widgetShowStateBeforeChanging:function($super,e){$super(e);if(e){this.adjustLocation();this.setResult(null)}else{}},doWidgetShowStateChanged:function($super,e){$super(e);if(!e){if(this._dialogCallback){this._dialogCallback(this.getResult());this._dialogCallback=null}}},widgetShowStateDone:function($super,e){$super(e);if(!e&&this._dialogOpened){if(this._modalInfo){this.unprepareModal()}this._restorePositionInfo();this._dialogOpened=false}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"});Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"};Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c,e,d){this._contentElem=null;this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;this.setPropStoreFieldValue("showText",true);$super(c);if(e){this.setText(e)}if(d){this.setMsgType(d)}this.setUseCornerDecoration(true)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(c){this.changeContentText(c)}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=c?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=c?"":"none"}});this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var c=this.getMsgType();if(c!==e){var d=this.getClassNameForMsgType(c);var f=this.getClassNameForMsgType(e);if(d!==f){this.removeClassName(d);this.addClassName(f)}this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function($super){return $super()+" "+a.MSGPANEL},doCreateRootElement:function(d){var c=d.createElement("span");return c},doCreateSubElements:function($super,e,c){var f=b.getInnerText(c);c.innerHTML="";var d=e.createElement("span");d.className=a.MSGPANEL_CONTENT;c.appendChild(d);this._contentElem=d;this._elemTextPart=this.createTextContent(f,d);this._elemLeadingGlyphPart=this.createGlyphContent(d,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(d,null,a.PART_ASSOC_GLYPH_CONTENT)},doSetUseCornerDecoration:function($super,c){$super(c);if(c){Kekule.HtmlElementUtils.addClass(this._contentElem,a.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(this._contentElem,a.CORNER_ALL)}},getTextSelectable:function(){return true},changeContentText:function(c){Kekule.DomUtils.setElementText(this._elemTextPart,c||"")},getClassNameForMsgType:function(c){var d=Kekule.Widget.MsgType;switch(c){case d.INFO:return a.MSG_INFO;case d.WARNING:return a.MSG_WARNING;case d.ERROR:return a.MSG_ERROR;default:return a.MSG_NORMAL}}});Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c){$super(c);this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL});this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(c){this.setPropStoreFieldValue("maxMsgCount",c);this.clearExcessiveMsgs()}});this.defineProp("msgFlashTime",{dataType:DataType.INT})},doGetWidgetClassName:function($super){return $super()+" "+a.MSGGROUP},doCreateRootElement:function(d){var c=d.createElement("div");return c},addMessage:function(i,d,h,e){if(i||d){var c=new Kekule.Widget.MsgPanel(this,i,d);c.setFinalizeAfterHiding(true);if(e){c.addClassName(e)}var g=this.getReversedOrder();if(g){c.insertToWidget(this,this.getChildAt(0))}else{c.appendToWidget(this)}var f=h||this.getMsgFlashTime();if(f){c.flash(f,this)}else{c.show(this)}this.clearExcessiveMsgs();return c}},clearExcessiveMsgs:function(){var h=this.getMaxMsgCount();if(h&&h>0){var g=this.getChildWidgets().length;var f=g-h;if(f>0){var e=0;var d=this;var c;var i=function(){if(e<f){c=d.getOldestMsgPanel();d.hideMsgPanel(c,i);++e}};i()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(c,d){c.hide(this,d);return c}})})();(function(){var c=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var a=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"});Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW_PAGE},doCreateRootElement:function(e){var d=e.createElement("div");return d}});Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function($super,d){$super(d);this.addEventListener("execute",function(g){var f=g.target;if((f instanceof Kekule.Widget.RadioButton)&&(f.getChecked())){this.invokeEvent("switch",{button:f})}},this);this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}})},initPropValues:function($super){$super();this.setUseCornerDecoration(false)},doGetWidgetClassName:function($super){return $super()+" "+b.TABBUTTONGROUP},tabButtonPosChanged:function(){var e=Kekule.Widget.Position;var g=this.getTabButtonPosition();var f=(g&e.LEFT)||(g&e.RIGHT);var d=(g&e.RIGHT)?b.TAB_AT_RIGHT:(g&e.BOTTOM)?b.TAB_AT_BOTTOM:(g&e.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.setLayout(f?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}});Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function($super,d){this._tabBtnContainer=null;this._pageContainer=null;$super(d);if(Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())){this.setUseCornerDecoration(true)}this.tabButtonPosChanged();this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function($super){if(this.getTabGroup()){this.getTabGroup().finalize()}$super()},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("tabPages");if(!d){d=[];this.setPropStoreFieldValue("tabPages",d)}return d},setter:null});this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:false,setter:function(e){var d=this.getActiveTabPage();if(d!==e){if(this.hasChild(e)){this.setPropStoreFieldValue("activeTabPage",e);if(d){d.removeClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(d).setChecked(false)}if(e){e.addClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(e).setChecked(true);this.invokeEvent("switchTab",{tabPage:e})}}}}});this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:false,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var d=this.getTabPages()[e];if(d){this.setActiveTabPage(d)}}});this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}});this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var d=this.getTabGroup();return d&&d.getDisplayed()},setter:function(e){var d=this.getTabGroup();if(d){d.setDisplayed(e)}}});this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(g,e){var d=[];var h=g.createElement("div");h.className=b.TABVIEW_TABBUTTON_CONTAINER;var f=g.createElement("div");f.className=b.TABVIEW_PAGE_CONTAINER;this._tabBtnContainer=h;this._pageContainer=f;e.appendChild(h);e.appendChild(f);this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(g,h));return d},doCreateTabbar:function(f,e){var d=new Kekule.Widget.TabButtonGroup(f);d.appendToElem(e);d.addEventListener("switch",function(i){var g=i.button;if(g.getChecked()){var h=this._getPageOfTabButton(g);if(h){this.setActiveTabPage(h)}}},this);return d},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(d){return d[this.TAB_BTN_FIELD]},_setPageTabButton:function(d,e){d[this.TAB_BTN_FIELD]=e},_getPageOfTabButton:function(g){var d=this.getTabPages();for(var f=0,e=d.length;f<e;++f){var h=d[f];if(this._getPageTabButton(h)===g){return h}}return null},childWidgetAdded:function($super,e){$super(e);if(e instanceof Kekule.Widget.TabPage){var d=!this.getTabPages().length;e.appendToElem(this._pageContainer);this.getTabPages().push(e);this._insertTabButtonBefore(e);if(d){this.setActiveTabPage(e)}}},childWidgetRemoved:function($super,d){$super(d);if(d instanceof Kekule.Widget.TabPage){a.remove(this.getTabPages(),d);this._removeTabButton(d)}},childWidgetMoved:function($super,e,d){$super(e,d);if(e instanceof Kekule.Widget.TabPage){this._changeTabIndex(e,d)}},_insertTabButtonBefore:function(d,g){var f=this.getTabGroup();var e=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(d,e);this._setPageTabButton(d,e);if(g){e.insertToWidget(f,g)}else{e.appendToWidget(f)}},_updateTabButton:function(d,e){if(!e){e=this._getPageTabButton(d)}e.setText(d.getText()||"");if(d.getHint()){e.setHint(d.getHint())}},_removeTabButton:function(d){var e=this._getPageTabButton(d);if(e){e.finalize()}},_changeTabIndex:function(e,g){var f=this._getPageTabButton(e);this.getTabGroup()._moveChild(f,g);var d=this.getTabPages();var h=d.indexOf(e);if(h>=0&&h!==g){a.changeItemIndex(d,e,g)}},reactTabPagePropChange:function(g){var f=g.target;if(f instanceof Kekule.Widget.TabPage){var d=this._getPageTabButton(f);if(d){this._updateTabButton(f,d)}}},tabButtonPosChanged:function(){var f=Kekule.Widget.Position;var h=this.getTabButtonPosition();var e=(h&f.BOTTOM)||(h&f.RIGHT);var g=(h&f.LEFT)||(h&f.RIGHT);var d=(h&f.RIGHT)?b.TAB_AT_RIGHT:(h&f.BOTTOM)?b.TAB_AT_BOTTOM:(h&f.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.getTabGroup().setTabButtonPosition(h);if(e){this.getElement().appendChild(this._tabBtnContainer)}else{this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)}},createNewTabPage:function(i,h,e){var g=this.getDocument();var d=new Kekule.Widget.TabPage(g);d.setText(i);d.setHint(h);d.appendToWidget(this);if(e){var f=this.getChildWidgets().indexOf(e);this._moveChild(d,f)}return d}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"});Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function($super,e){$super(e);this._inlineEdit=null;this._isActivitingRow=false},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e);this.setPropStoreFieldValue("hash",e)}});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("useKeyHint",{dataType:DataType.BOOL});this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){if(this.getValueDisplayMode()!==e){this.setPropStoreFieldValue("valueDisplayMode",e);this.valueDisplayModeChanged()}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getActiveRow();if(e!==f){if(e){this.finishEditing();d.removeClass(e,b.VALUELISTEDITOR_ACTIVE_ROW);this._showValueCellText(e)}if(this._inlineEdit){this._inlineEdit.finalize()}if(f){d.addClass(f,b.VALUELISTEDITOR_ACTIVE_ROW);if(!this.getReadOnly()){this.createValueEditWidget(f)}}this.setPropStoreFieldValue("activeRow",f);this.invokeEvent("activeRowChange",{row:f})}}})},doGetWidgetClassName:function(){return b.VALUELISTEDITOR},doCreateRootElement:function(f){var e=f.createElement("table");return e},doBindElement:function($super,e){$super(e)},getRootElem:function(){return this.getElement()},createRowElem:function(f){var e=f.createElement(this.ROW_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_ROW);return e},createCellElem:function(f){var e=f.createElement(this.CELL_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_CELL);return e},createIndicatorCellElem:function(g){var e=this.createCellElem(g);d.addClass(e,b.VALUELISTEDITOR_INDICATORCELL);var f=g.createElement("span");e.appendChild(f);return e},createKeyCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_KEYCELL);return e},createValueCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_VALUECELL);return e},createValueEditWidget:function(h){if(this._inlineEdit){this._inlineEdit.finalize();this._inlineEdit=null}var f=this.doCreateValueEditWidget(h);if(f){f.setBubbleUiEvents(true);d.addClass(f.getElement(),b.VALUELISTEDITOR_INLINE_EDIT);var e=this.getValueCell(h);var g=this.getCellContentWrapper(e,true);f.appendToElem(g);if(f.focus){f.focus()}if(f.selectAll){f.selectAll()}this._inlineEdit=f;this._hideValueCellText(h)}return f},doCreateValueEditWidget:function(l){var i=this.getRowData(l);var h=this.getValueCellText(l,i);var f=this.getValueEditWidgetInfo(l);var g=f.widgetClass;var e=new g(this);if(f.propValues){e.setPropValues(f.propValues)}e.setValue(h);return e},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){if(this.getRootElem()){return c.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG)}else{return[]}},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var f=this.getRowElems();return f?f[e]:null},getPrevRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.previousSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.previousSibling}return e},getNextRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.nextSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.nextSibling}return e},getKeyCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[1]},getCellContentWrapper:function(f,h){var g=c.getDirectChildElems(f);var e=g?g[0]:null;if(!e&&h){e=f.ownerDocument.createElement("span");f.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_CELL_CONTENT)}return e},getValueCellTextWrapper:function(f,i){var e=null;var h=this.getCellContentWrapper(f,i);if(h){var g=h.getElementsByTagName("span");e=g?g[0]:null;if(!e&&i){e=f.ownerDocument.createElement("span");h.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_VALUECELL_TEXT)}}return e},_hideValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="hidden"}},_showValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="visible"}},getValueCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[2]},getParentCell:function(f){var e=c.getNearestAncestorByTagName(f,this.CELL_ELEM_TAG,true);return e},getParentRow:function(f){var e=c.getNearestAncestorByTagName(f,this.ROW_ELEM_TAG,true);return e},_createNewRow:function(h){var l=this.getDocument();var e=this.createRowElem(l);if(e){var i=this.createIndicatorCellElem(l);e.appendChild(i);var f=this.createKeyCellElem(l);e.appendChild(f);var g=this.createValueCellElem(l);e.appendChild(g);if(h){this.setRowData(e,h)}}return e},insertRowBefore:function(f,e){var g=this._createNewRow(f);if(g){this.getRootElem().insertBefore(g,e||null)}return g},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){if(e===this.getActiveRow()){this.setActiveRow(null)}this.getRootElem().removeChild(e);return this},removeRowAt:function(e){var f=this.getRowAt(e);if(f){this.removeRow(f)}return this},clear:function(){this.setActiveRow(null);if(this.getRootElem()){Kekule.DomUtils.clearChildContent(this.getRootElem())}},updateAll:function(){var h=this.getRowElems();for(var f=0,e=h.length;f<e;++f){var m=h[f];var g=this.getRowData(m);this.setRowData(m,g)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(f,e){return e.title||e.key},getKeyCellHint:function(f,e){return e.hint||this.getKeyCellText(f,e)},getValueCellText:function(h,f){var g=this.getValueDisplayMode();var e=(g===a.JSON)?JSON.stringify(f.value):""+f.value;return e},valueCellTextToValue:function(e,h,g){var f=this.getValueDisplayMode();return(f===a.JSON)?JSON.parse(e):e},setValueCellText:function(e,h){var g=this.getRowData(h);var f=this.valueCellTextToValue(e,h,g);g.value=f;this.setRowData(h,g);return this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(f,e){f[this.ROW_DATA_FIELD]=e;this.setRowKeyCellContent(f,this.getKeyCellText(f,e),this.getKeyCellHint(f,e));this.setRowValueCellContent(f,this.getValueCellText(f,e));if(f===this.getActiveRow()&&this._inlineEdit){this.createValueEditWidget(f)}},setRowKeyCellContent:function(i,g,f){var e=this.getKeyCell(i);var h=this.getCellContentWrapper(e,true);h.innerHTML=g;if(this.getUseKeyHint()){h.title=f}},setRowValueCellContent:function(h,f){var e=this.getValueCell(h);var i=this.getValueCellTextWrapper(e,true);var g=f;if(g===""){i.innerHTML="&nbsp;"}else{Kekule.DomUtils.setElementText(i,g)}},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(f,e){f[this.ROW_EDIT_INFO_FIELD]=e;if(f===this.getActiveRow()){this.setActiveRow(null);this.setActiveRow(activeRow)}},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){this.setValueCellText(this._inlineEdit.getValue(),e);this.invokeEvent("editFinish",{row:e})}return this},cancelEditing:function(){var f=this.getActiveRow();if(f&&this._inlineEdit){var e=this.getRowData(f);this.setRowData(f,e);this.invokeEvent("editCancel",{row:f})}return this},_getTotalHash:function(){var e={};var m=this.getRowElems();for(var g=0,f=m.length;g<f;++g){var n=m[g];var h=this.getRowData(n);if(h){e[h.key]=h.value}}return e},_setTotalHash:function(g){var r=this.getRowElems();var e=r.length;var p=Kekule.ObjUtils.getOwnedFieldNames(g);var f=p.length;for(var h=0;h<f;++h){var o=p[h];var m=g[o];var q;if(h<e){q=this.getRowAt(h);this.setRowData(q,{key:o,value:m})}else{q=this.appendRow({key:o,value:m})}}if(e>f){for(var h=e-1;h>=f;--h){this.removeRow(r[h])}}var n=this.getActiveRow();if(n){this.setActiveRow(null);this.setActiveRow(n)}return this},react_click:function(g){var f=g.getTarget();var h=this.getParentRow(f);if(h){this.setActiveRow(h)}},react_keydown:function(i){var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){var l;if(h===Kekule.X.Event.KeyCode.UP){l=this.getPrevRow(g)}else{if(h===Kekule.X.Event.KeyCode.DOWN){l=this.getNextRow(g)}}if(l){this.setActiveRow(l)}}}},react_keyup:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){this.cancelEditing()}else{if(f===Kekule.X.Event.KeyCode.ENTER){this.finishEditing()}}},react_blur:function(f){return;this.finishEditing();this.setActiveRow(null)}});Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var a=Kekule.Widget.ValueListEditor.ValueDisplayMode})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"});Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,d){$super(d);this.setUseCornerDecoration(true);this.setValue("#000000")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(d){this.setPropStoreFieldValue("value",d);this.getHexBox().innerHTML=d||"&nbsp;";this.getPreviewer().style.backgroundColor=d;if(this.getColorInput()){this.getColorInput().value=d}}});this.defineProp("colorClassName",{dataType:DataType.STRING});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(d){this.setPropStoreFieldValue("specialColors",d);this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("palette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+a.COLORPICKER},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(f,e){var d=[];d.push(this.doCreateHeader(f,e));d.push(this.doCreatePalette(f,e));return d},doCreateHeader:function(h,e){var d=h.createElement("div");d.className=a.COLORPICKER_HEADER;d.appendChild(this.doCreateSpecialColorPalette(h));d.appendChild(this.doCreateHexBox(h));d.appendChild(this.doCreatePreviewer(h));var g=this.doCreateColorInput(h);if(g){d.appendChild(g);var f=this.doCreateColorDialogBtn(h);if(f){f.appendToElem(d)}}e.appendChild(d);return d},doCreateSpecialColorPalette:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_SPEC_COLOR_PALETTE;this._recreateSpecialColorPaletteCells(e,d);this.setSpecialColorPalette(d);return d},_isPredefinedSpecialColor:function(d){var f=Kekule.Widget.ColorPicker.SpecialColors;var e=[f.UNSET,f.DEFAULT,f.MIXED];return e.indexOf(d)>=0},_getPredefinedSpecialColorInfo:function(f){var m=Kekule.Widget.ColorPicker.SpecialColors;var e=Kekule.WidgetTexts;var h=[m.UNSET,m.DEFAULT,m.MIXED];var l=[a.COLORPICKER_SPEC_COLOR_UNSET,a.COLORPICKER_SPEC_COLOR_DEFAULT,a.COLORPICKER_SPEC_COLOR_MIXED];var i=[e.S_COLOR_UNSET,e.S_COLOR_DEFAULT,e.S_COLOR_MIXED];var d={value:f};var g=h.indexOf(f);if(g>=0){d.text=i[g];d.className=l[g]}return d},_recreateSpecialColorPaletteCells:function(o,d){Kekule.DomUtils.clearChildContent(d);var f=this.getSpecialColors();if(f&&f.length){for(var h=0,e=f.length;h<e;++h){var g=f[h];var n;var m={};if(DataType.isObjectValue(g)){m=g}else{if(this._isPredefinedSpecialColor(g)){m=this._getPredefinedSpecialColorInfo(g)}else{m.value=g}}n=this.doCreatePaletteCell(o,m.value,m.text,m.className);if(m.className){Kekule.HtmlElementUtils.addClass(n,m.className)}d.appendChild(n)}}},doCreateHexBox:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_HEXBOX;d.innerHTML="&nbsp";this.setHexBox(d);return d},doCreatePreviewer:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_PREVIEWER;d.innerHTML="&nbsp";this.setPreviewer(d);return d},doCreateColorInput:function(f){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=f.createElement("input");d.setAttribute("type","color");d.className=a.COLORPICKER_INPUT;var e=this;Kekule.X.Event.addListener(d,"change",function(h){var g=d.value;e.setValue(g);e.notifyColorSet()});this.setColorInput(d);return d}else{return null}},doCreateColorDialogBtn:function(e){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=new Kekule.Widget.Button(e);d.setText(Kekule.WidgetTexts.CAPTION_BROWSE_COLOR);d.setHint(Kekule.WidgetTexts.HINT_BROWSE_COLOR);d.setShowText(false);d.doSetShowGlyph(true);d.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK);d.addClassName(a.COLORPICKER_BROWSE_BTN);d.addEventListener("execute",this.openColorDialog,this);return d}},doCreatePalette:function(n,m){var q=n.createElement("div");q.className=a.COLORPICKER_PALETTE;var o=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null];var p=o.length;var d=this.doCreatePaletteLine(n);for(var l=0;l<p;l++){var h=o[l]?"#"+o[l]+o[l]+o[l]:"transparent";var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}q.appendChild(d);o=["00","33","66","99","CC","FF"];var p=o.length;for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=0;g<(p>>1);g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=(p>>1);g<p;g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}m.appendChild(q);this.setPalette(q);return q},doCreatePaletteCell:function(m,i,g,f){var d=m.createElement("span");var h=a.COLORPICKER_PALETTE_CELL;if(i==="transparent"){h+=" "+a.COLORPICKER_PALETTE_CELL_TRANSPARENT}else{try{d.style.backgroundColor=i}catch(l){}}d[this.COLOR_VALUE_FIELD]=i;d[this.COLOR_TEXT_FIELD]=g||i;d[this.COLOR_CLASS_FIELD]=f;d.className=h;d.title=g||i;return d},doCreatePaletteLine:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_PALETTE_LINE;return d},_isPaletteCellElem:function(d){return Kekule.HtmlElementUtils.hasClass(d,a.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){if(this.getColorInput()){this.getColorInput().click()}return this},applyColor:function(g){var d=g[this.COLOR_VALUE_FIELD];if(d){this.setValue(d)}var e=g[this.COLOR_TEXT_FIELD];if(e){this.getHexBox().innerHTML=e}var f=g[this.COLOR_CLASS_FIELD];this.setColorClassName(f)},notifyColorSet:function(){this.setIsDirty(true);this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()})},react_mousedown:function($super,f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){var d=f.getTarget();if(this._isPaletteCellElem(d)){this.setIsPicking(true);this.applyColor(d);return true}}return $super(f)},react_mouseup:function($super,f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this.getIsPicking()){this.setIsPicking(false);var d=f.getTarget();if(this._isPaletteCellElem(d)){this.applyColor(d)}this.notifyColorSet();return true}}return $super(f)},react_mousemove:function($super,f){if(this.getIsPicking()){var d=f.getTarget();if(this._isPaletteCellElem(d)){this.applyColor(d)}return true}return $super(f)}});Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)"};Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){this.getPreviewElem().style.display=d?"inherit":""}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueSet",this.reactColorPickerValueSet,this);d.appendToElem(this.getElement());this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPTEXTBOX},doCreateSubElements:function($super,f,d){$super(f,d);var e=new Kekule.Widget.DumbWidget(this);e.addClassName(a.COLORPREVIEWER);this.setHeadingWidget(e);return[e.getElement()]},getPreviewElem:function(){var d=this.getHeadingWidget();if(d){return d.getElement()}},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactDropbuttonExecute:function(d){this.showColorPicker()},reactColorPickerValueSet:function(f){var d=f.value;this.setValue(d);this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty());this.setColorClassName(f.colorClassName);this.hideColorPicker()},doSetValue:function($super,e){$super(e);var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}});Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){this.getPreviewElem().style.display=d?"inherit":""}});this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(d){this.setText(d);this.updateColorPreview(d)}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueSet",this.reactColorPickerValueSet,this);this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(d){this.getColorPicker().setIsDirty(d)}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactColorPickerValueSet:function(g){var f=g.value;var d=g.colorClassName;this.setValue(f);this.setColorClassName(d);this.hideColorPicker();this.invokeEvent("valueChange",{value:f})},updateColorPreview:function(e){var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}})})();(function(){var b=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var c=Kekule.WidgetTexts;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"});Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],initialize:function($super,e){this._toolCompWidgets=[];this.setPropStoreFieldValue("showToolbar",true);$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextArea();return e?e.getText():null},setter:function(e){var f=this.getTextArea();if(f){f.setText(e)}}});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getTextArea().getReadOnly()},setter:function(e){return this.getTextArea().setReadOnly(e)}});this.defineProp("wrap",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getTextArea().getWrap()},setter:function(f){var e=this.getTextArea().setWrap(f);this.updateToolButtonStates();return e}});this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("textArea");if(!e){e=this.createTextArea();this.setPropStoreFieldValue("textArea",e)}return e}});this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var e=this.getPropStoreFieldValue("toolbar");if(!e){if(this.getShowToolbar()){e=this.createToolbar();this.setPropStoreFieldValue("styleToolbar",e)}}return e}});this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showToolbar",f);var e=this.getToolbar();e.setDisplayed(f)}});this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(e){this.setPropStoreFieldValue("toolbarPos",e);this.updateChildWidgetPos()}});this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var e=this.getPropStoreFieldValue("toolbarComponents");if(!e){e=null;this.setPropStoreFieldValue("toolbarComponents",e)}return e},setter:function(e){this.setPropStoreFieldValue("toolbarComponents",e);this.recreateToolbarComponents(e)}});this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY});this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(e){this.setPropStoreFieldValue("fontSizeLevel",e);this.setTextStyle({fontSize:""+e+"em"})}})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var e=this.getTextArea();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextArea();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTEDITOR},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(g,e){var f=this.createToolbar();if(f){f.appendToElem(e)}var h=this.createTextArea();h.appendToElem(e);this.updateChildWidgetPos();return[f.getElement(),h.getElement()]},doWidgetShowStateChanged:function($super,e){$super(e);if(e){this.updateChildWidgetPos();this.updateToolButtonStates()}},createToolbar:function(){if(this.getShowToolbar()){var e=new Kekule.Widget.Toolbar(this);this.setPropStoreFieldValue("toolbar",e);e.addClassName(a.TEXTEDITOR_TOOLBAR);this.recreateToolbarComponents();return e}else{return null}},recreateToolbarComponents:function(o){if(!o){o=this.getToolbarComponents()}var m=o||this.DEF_TOOLBAR_COMPONENTS;var h=this.getToolbar();if(h){this._toolCompWidgets.length=0;h.clearWidgets();h.setShowText(false);h.setShowGlyph(true);var n;for(var g=0,e=m.length;g<e;++g){var f=m[g];if(f==="fontFamily"){n=this.createFontFamilyComboBox(h)}else{n=this.createToolButton(h,f)}this._toolCompWidgets[f]=n}this.updateToolButtonStates()}},createFontFamilyComboBox:function(m){var e=new Kekule.Widget.ComboBox(m);var n=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies());var g=[];for(var h=0,f=n.length;h<f;++h){g.push({text:n[h],value:n[h]})}e.setHint(c.HINT_CHOOSE_FONT_FAMILY);e.addClassName(a.TEXTEDITOR_FONTBOX);e.setItems(g);e.appendToWidget(m);e.addEventListener("valueChange",function(i){this.setTextStyle({fontFamily:e.getValue()})},this);return e},createToolButton:function(h,m){var g,l;var f;var i=(m==="textWrap")?Kekule.Widget.CheckButton:Kekule.Widget.Button;var e=new i(h);e.appendToWidget(h);if(m==="textWrap"){g=c.CAPTION_TOGGLE_TEXTWRAP;l=c.HINT_TOGGLE_TEXTWRAP;f=a.TEXTEDITOR_BTN_TEXTWRAP;e.setChecked(this.getWrap()!=="off");e.addEventListener("execute",function(o){var n=e.getChecked();this.setWrap(n?"virtual":"off")},this)}else{if(m==="fontSizeInc"){g=c.CAPTION_INC_TEXT_SIZE;l=c.HINT_INC_TEXT_SIZE;f=a.TEXTEDITOR_BTN_FONTSIZEINC;e.addEventListener("execute",this.increaseTextSize,this)}else{if(m==="fontSizeDec"){g=c.CAPTION_DEC_TEXT_SIZE;l=c.HINT_DEC_TEXT_SIZE;f=a.TEXTEDITOR_BTN_FONTSIZEDEC;e.addEventListener("execute",this.decreaseTextSize,this)}}}e.setText(g);e.setHint(l);e.addClassName(f);return e},createToolCheckButton:function(f,g){var e=new Kekule.Widget.CheckButton(f);e.appendToWidget(f);return e},createTextArea:function(){var e=new Kekule.Widget.TextArea(this);this.setPropStoreFieldValue("textArea",e);e.addClassName(a.TEXTEDITOR_TEXTAREA);return e},updateChildWidgetPos:function(){var g=this.getToolbarPos();var h=this.getToolbar().getElement();var f=this.getTextArea().getElement();var e=h.parentNode;if(g===Kekule.Widget.Position.BOTTOM){e.insertBefore(f,h)}else{e.insertBefore(h,f)}},updateToolButtonStates:function(){var e=this._toolCompWidgets.textWrap;if(e){e.setChecked(this.getWrap()!=="off")}},setTextStyle:function(n){var m=this.getTextArea();if(m){var g=Kekule.ObjUtils.getOwnedFieldNames(n);for(var f=0,e=g.length;f<e;++f){var h=g[f];m.setStyleProperty(h,n[h])}}return this},increaseTextSize:function(){var f=this.getFontSizeLevel()||1;var e=Kekule.ZoomUtils.getNextZoomInRatio(f);this.setFontSizeLevel(e)},decreaseTextSize:function(){var f=this.getFontSizeLevel()||1;var e=Kekule.ZoomUtils.getNextZoomOutRatio(f);this.setFontSizeLevel(e)}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"});Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function($super,e){$super(e);this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE);this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]);this.setEnableLiveUpdate(true);this.setSubPropNamePadding("1em");this.setUseKeyHint(true)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var g=Kekule.ArrayUtils.toArray(f);var e=this.getObjects();this.setPropStoreFieldValue("objects",g);this.inspectedObjectsChanged(g,e)}});this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e);this.updateAll()}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("subPropNamePadding",{dataType:DataType.STRING});this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();if(e){return this.getRowPropEditor(e)}else{return null}}});this.defineProp("keyField",{dataType:DataType.STRING});this.defineProp("sortField",{dataType:DataType.STRING});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC})},doFinalize:function($super){$super()},initPropValues:function($super){$super();this.setKeyField("title");this.setSortField("key")},doGetWidgetClassName:function($super){return $super()+" "+a.PROPLISTEDITOR},inspectedObjectsChanged:function(f,e){var g=Kekule.ArrayUtils.toArray(f);if(e){this._uninstallObjectsEventHandlers(e)}if(f){this._installObjectsEventHandlers(g)}this.updateAll(g)},_installObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.addEventListener){h.addEventListener("change",this.reactObjectsChange,this)}}},_uninstallObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.removeEventListener){h.removeEventListener("change",this.reactObjectsChange,this)}}},reactObjectsChange:function(g){if(this.getEnableLiveUpdate()){var f=g.changedPropNames;this.updateValues(f)}},getKeyCellExpandMarker:function(p,o){var r=null;var e=this.getCellContentWrapper(p,o);if(e){var g=c.getDirectChildElems(e)||[];for(var m=0,h=g.length;m<h;++m){var f=g[m];if(d.hasClass(f,a.PROPLISTEDITOR_PROPEXPANDMARKER)){r=f;break}}if(!r&&o){var q=this.getDocument();r=q.createElement("span");d.addClass(r,a.PROPLISTEDITOR_PROPEXPANDMARKER);var n=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(r,n)}}return r},getKeyCellIndentDecorator:function(p,o){var r=null;var e=this.getCellContentWrapper(p,o);if(e){var g=c.getDirectChildElems(e)||[];for(var m=0,h=g.length;m<h;++m){var f=g[m];if(d.hasClass(f,a.PROPLISTEDITOR_INDENTDECORATOR)){r=f;break}}if(!r&&o){var q=this.getDocument();r=q.createElement("div");d.addClass(r,a.PROPLISTEDITOR_INDENTDECORATOR);var n=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(r,n)}}return r},setRowKeyCellContent:function($super,p,m,g){var q=$super(p,m,g);var o=this.getKeyCell(p);var i=this.getKeyCellExpandMarker(o,true);var n=this.getRowSubLevel(p);var e=this.getSubPropNamePadding();if(e){var h=Kekule.StyleUtils.multiplyUnitsValue(e,n);e=Kekule.StyleUtils.multiplyUnitsValue(e,n);var l=this.getKeyCell(p);var f=this.getCellContentWrapper(l,true);f.style.paddingLeft=e}return q},updateAll:function(m){if(!m){m=this.getObjects()}if(!m||!m.length){this.clear();return}this.setActiveRow(null);this.collapseAllRows();var f=m[0];var o=this.getDisplayPropEditors(m);this.sortPropEditors(o);var t=m.length>1;var s=this.getRows();var p=s.length;var e=o.length;var g=0;var h=0;var n=this.getValueDisplayMode();for(var g=0;g<e;++g){var q=o[g];q.setValueTextMode(n);if(!this.isPropEditorVisible(q)){continue}var r=(h<p)?s[h]:this.appendRow();this.setRowPropEditor(r,q);++h}if(p>h){for(var g=p-1;g>=h;--g){this.removeRow(s[g])}}return this},updateValues:function(o){var n=o&&o.length;var h=this.getRows();for(var f=0,e=h.length;f<e;++f){var m=h[f];if(n){var g=this.getRowPropEditor(m);if(!g||(o.indexOf(g.getPropertyName())<0)){continue}}this.updateRowPropValue(m)}},updateRowPropValue:function(o){var h=this.getRowPropEditor(o);var n=h.getValueText();var m=this.getRowData(o);m.value=n;this.setRowData(o,m);this.updateRowExpandState(o);var e=this.getSubPropRows(o);if(e){for(var g=0,f=e.length;g<f;++g){this.updateRowPropValue(e[g])}}},setRowPropEditor:function(l,g){var i;var f=this.getKeyField()||"title";if(f){if(f==="name"){i=g.getPropertyName()}else{if(f==="title"){i=g.getTitle()}else{var e=g.getPropertyInfo();i=e[f]}}}if(!i){i=g.getTitle()||g.getPropertyName()}var h={key:g.getPropertyName(),value:g.getValueText(),title:i,hint:g.getHint(),propEditor:g,expanded:false};var m=g.isReadOnly();if(m){d.addClass(l,a.PROPLISTEDITOR_READONLY)}else{d.removeClass(l,a.PROPLISTEDITOR_READONLY)}this.setRowData(l,h);this.updateRowExpandState(l)},getRowPropEditor:function(f){var e=this.getRowData(f);if(e){return e.propEditor}else{return null}},getPropEditor:function(f,e){var g=Kekule.PropertyEditor.findEditorClass(f,e);if(g){return new g()}else{return null}},isPropEditorVisible:function(i){var f=true;var m=i.getObjects();var e=m.length>1;f=!e||(i.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS);if(f){var h=i.getPropertyInfo();if(h){var l=h.scope||Class.PropertyScope.DEFAULT;if(l){var g=this.getDisplayedPropScopes();if(g){f=g.indexOf(l)>=0}}}}return f},isRowExpandable:function(f){var e=this.getRowPropEditor(f);return e?e.hasSubPropertyEditors():false},isRowExpanded:function(f){var e=this.getRowData(f);return !!e.expanded},updateRowExpandState:function(f){var e=this.isRowExpandable(f);if(!e){this.removeSubPropertyRows(f)}d.removeClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);if(e){if(this.isRowExpanded(f)){d.addClass(f,a.PROPLISTEDITOR_PROPEXPANDED)}else{d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED)}}},expandRow:function(h){if(this.isRowExpandable(h)&&(!this.isRowExpanded(h))){d.removeClass(h,a.PROPLISTEDITOR_PROPCOLLAPSED);d.addClass(h,a.PROPLISTEDITOR_PROPEXPANDED);var g=this.getRowData(h);g.expanded=true;var f=this.getRowPropEditor(h);var e=f.getSubPropertyEditors(this.getDisplayedPropScopes());h[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(h,e)}return this},collapseRow:function(f){if(this.isRowExpandable(f)&&this.isRowExpanded(f)){d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);var e=this.getRowData(f);e.expanded=false;this.removeSubPropertyRows(f)}return this},toggleRowExpandState:function(e){if(this.isRowExpanded(e)){return this.collapseRow(e)}else{return this.expandRow(e)}},collapseAllRows:function(){var g=this.getRows();for(var f=0,e=g.length;f<e;++f){this.collapseRow(g[f])}return this},addSubPropertyRows:function(m,o){var h=this.getNextRow(m);var e=[];if(o&&o.length){this.sortPropEditors(o);for(var g=0,f=o.length;g<f;++g){var n=o[g];if(!this.isPropEditorVisible(n)){continue}e.push(this.addSubPropRow(m,n,h))}}return e},addSubPropRow:function(h,g,f){var e=this.insertRowBefore(null,f);e[this.PARENT_ROW_FIELD]=h;this.setRowPropEditor(e,g);return e},removeSubPropertyRows:function(g){var e=this.getSubPropRows(g);for(var f=e.length-1;f>=0;--f){this.removeSubPropertyRows(e[f]);this.removeRow(e[f])}g[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(g){var e=0;var f=this.getParentPropRow(g);while(f){++e;f=this.getParentPropRow(f)}return e},getValueCellText:function($super,f,e){return e.value},finishEditing:function(){var l=this.getActiveRow();var h=this.getRowPropEditor(l);if(h){var e=this.getOperHistory();var i=this.getEnableOperHistory()&&e;var g=h.getValue();var f=h.saveEditValue();if(f){if(i){var m=new Kekule.Widget.PropEditorModifyOperation(h,h.getValue(),g);e.push(m)}this.updateValues();this.invokeEvent("propertyChange",{propertyEditor:h,propertyInfo:h.getPropertyInfo(),oldValue:g,newValue:h.getValue()});this.invokeEvent("editFinish",{row:l})}}return this},doCreateValueEditWidget:function($super,g){var f=this.getRowPropEditor(g);var e=f.createEditWidget(this);if(e){if(f.isReadOnly()){if(e.setReadOnly){e.setReadOnly(true)}}}else{e=this.doCreateDefaultValueEditWidget(g)}return e},doCreateDefaultValueEditWidget:function(g){var e=new Kekule.Widget.TextBox(this);e.setReadOnly(true);var f=this.getRowData(g).value;e.setValue(f);return e},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().undo()}return this},redo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().redo()}return this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(o){var n=this.getCommonSuperClass(o);var f=ClassEx.getPropListOfScopes(n,this.getDisplayedPropScopes());var e=[];for(var m=0,h=f.getLength();m<h;++m){var g=f.getPropInfoAt(m);e.push(g.name)}return e},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(p){var r=[];var q=this.getDisplayPropNames(p);var n=this.getCommonSuperClass(p);var f=p[0];for(var g=0,e=q.length;g<e;++g){var h=q[g];var m=f.getPropInfo(h);var o=this.getPropEditor(n,m);o.setObjects(p);o.setPropertyInfo(m);r.push(o)}return r},sortPropEditors:function(g){var e=this.getSortField();if(!e){return}if(e==="key"){e===this.getKeyField()||"title"}var f=function(h,i){return h[i]||h.name};g.sort(function(m,i){var l=f(m.getPropertyInfo(),e);var h=f(i.getPropertyInfo(),e);return(l<h)?-1:(l>h)?1:0})},getObjPropValue:function(f,e){if(f instanceof ObjectEx){return f.getPropValue(e)}else{if(f instanceof Object){return f[e]}else{return undefined}}},getObjsPropValue:function(n,m){var o=n[0];var e=this.getObjPropValue(o,m);for(var g=1,f=n.length;g<f;++g){var o=n[g];var h=this.getObjPropValue(o,m);if(h!==e){return undefined}}return e},react_click:function($super,h){var g=h.getTarget();var i=this.getParentRow(g);if(i){var f=this.getKeyCellExpandMarker(this.getKeyCell(i),false);if(g===f){this.toggleRowExpandState(i)}}$super(h)},react_dblclick:function(i){var h=i.getTarget();var f=this.getParentCell(h);var g=false;if(f){var l=this.getParentRow(f);if(f===this.getKeyCell(l)){this.toggleRowExpandState(l);g=true}}},react_keydown:function($super,i){$super(i);var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){if(h===Kekule.X.Event.KeyCode.RIGHT){this.expandRow(g)}else{if(h===Kekule.X.Event.KeyCode.LEFT){this.collapseRow(g)}}}}}});Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function($super,e){this._propListElem=null;this._objsInfoElem=null;this._propInfoElem=null;this.setPropStoreFieldValue("showObjsInfoPanel",true);this.setPropStoreFieldValue("showPropInfoPanel",true);$super(e)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var f=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",f);this.inspectedObjectsChanged(f)}});this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e);b.setDisplay(this._objsInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e);b.setDisplay(this._propInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){var e=this.getPropEditor();return e?e.getEnableOperHistory():false},setter:function(f){var e=this.getPropEditor();return e?e.setEnableOperHistory(f):null}});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(f){var e=this.getPropEditor();return e?e.setOperHistory(f):null}});this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){return this.getPropEditor().getSortField()},setter:function(e){this.getPropEditor().setSortField(e)}})},doFinalize:function($super){this._finalizeChildWidgets();$super()},getChildrenHolderElement:function($super){return this._propListElem||$super()},doGetWidgetClassName:function(){return a.OBJINSPECTOR},doBindElement:function($super,e){$super(e);this._updateChildElemSize()},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,i,g){$super(i,g);var h=this._createSubPartElem(i);d.addClass(h,a.OBJINSPECTOR_OBJSINFOPANEL);g.appendChild(h);this._objsInfoElem=h;var f=this._createSubPartElem(i);d.addClass(f,a.OBJINSPECTOR_PROPINFOPANEL);g.appendChild(f);this._propInfoElem=f;var e=this._createSubPartElem(i);d.addClass(e,a.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER);g.appendChild(e);this._propListElem=e;this._createChildWidgets(e);return[h,f,e]},_createSubPartElem:function(f){var e=f.createElement("div");e.className=a.OBJINSPECTOR_SUBPART;return e},_createChildWidgets:function(e){this._finalizeChildWidgets();var g=new Kekule.Widget.ObjPropListEditor(this);g.appendToWidget(this);var f=this;g.addEventListener("activeRowChange",function(h){f._updatePropInfo()});this.setPropStoreFieldValue("propEditor",g)},_finalizeChildWidgets:function(){var e=this.getPropEditor();if(e){e.finalize()}},inspectedObjectsChanged:function(f){var e=this.getPropEditor();if(e){e.setObjects(f)}this._updateObjectsInfo(f);this._updatePropInfo()},_updateObjectsInfo:function(h){if(this._objsInfoElem){var g;if(h.length<=0){g=Kekule.WidgetTexts.S_INSPECT_NONE}else{if(h.length===1){var f=h[0];var i=f.getId?f.getId():null;var e=DataType.getType(f);g=i?Kekule.WidgetTexts.S_INSPECT_ID_OBJECT.format(i,e):Kekule.WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT.format(e)}else{g=Kekule.WidgetTexts.S_INSPECT_OBJECTS.format(h.length)}}c.setElementText(this._objsInfoElem,g)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var g=this.getPropEditor().getActivePropEditor();if(g){var i=g.getTitle();var f=g.getDescription()||g.getPropertyType()||"";var h=this._propInfoElem.ownerDocument;var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_TITLE;c.setElementText(e,i);this._propInfoElem.appendChild(e);var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_DESCRIPTION;c.setElementText(e,f);this._propInfoElem.appendChild(e)}}},undo:function(){if(this.getPropEditor()){this.getPropEditor().undo()}return this},redo:function(){if(this.getPropEditor()){this.getPropEditor().redo()}return this},_updateChildElemSize:function(){var e=this;setTimeout(function(){var g;if(e.getShowObjsInfoPanel()){g=b.getComputedStyle(e._objsInfoElem,"height")}else{g=0}var f;if(e.getShowPropInfoPanel()){f=b.getComputedStyle(e._propInfoElem,"height")}else{f=0}e._propListElem.style.top=g;e._propListElem.style.bottom=f},100)},setUseCornerDecoration:function($super,f){var e=$super(f);if(f){}return e}})})();(function(){Kekule.Widget.PropertyEditor={};Kekule.PropertyEditor=Kekule.Widget.PropertyEditor;Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function($super){$super();this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,setter:function(c){var b=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",b.clone(b.toArray(c)))}});this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:false});this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var b=this.getPropertyInfo();return b?b.name:null}});this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var b=this.getPropertyInfo();return b?b.dataType:null}});this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("valueTextMode",{dataType:DataType.INT});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function($super){this.finalizeWidget();$super()},finalizeWidget:function(){if(this._editWidget){this._editWidget.finalize();this._editWidget=null}},getEditWidget:function(){return this._editWidget},getObjPropValue:function(c,b){if(c instanceof ObjectEx){return c.getPropValue(b)}else{if(DataType.isArrayValue(c)){return c[b]}else{if(c instanceof Object){return c[b]}else{return undefined}}}},setObjPropValue:function(c,b,d){if(c instanceof ObjectEx){c.setPropValue(b,d)}else{if(c instanceof Object){c[b]=d}}return this},getObjsPropValue:function(g,f){if(!g||Kekule.ObjUtils.isUnset(f)){return undefined}var h=g[0];var b=this.getObjPropValue(h,f);for(var d=1,c=g.length;d<c;++d){var h=g[d];var e=this.getObjPropValue(h,f);if(e!==b){return undefined}}return b},setObjsPropValue:function(e,d,g){if(!e||!d){return this}for(var c=0,b=e.length;c<b;++c){var f=e[c];this.setObjPropValue(f,d,g)}return this},isReadOnly:function(){return !!(this.getAttributes()&a.READONLY)},hasSubPropertyEditors:function(){var b=this.getAttributes();return !!(b&a.SUBPROPS)},getAttributes:function(){var b=a.MULTIOBJS|a.SIMPLEVALUE;var c=this.getPropertyInfo();if(Kekule.ObjUtils.isUnset(this.getReadOnly())){if(c&&!c.setter){b=b|a.READONLY}}else{if(this.getReadOnly()){b=b|a.READONLY}}return b},getSubPropertyEditors:function(b){return null},getTitle:function(){var b=this.getPropertyInfo();if(b){return(b.title||b.name)}else{return""}},getHint:function(){return this.getTitle()},getDescription:function(){var b=this.getPropertyInfo();return b.description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var c=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValue();var g=this.getValueTextMode();try{var b=(g===c.JSON)?JSON.stringify(d):Kekule.ObjUtils.isUnset(d)?"":""+d}catch(f){return""+d}return b},setValue:function(c){var b=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),c);if(this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange){this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),c)}return b},createEditWidget:function(c){var d=this.getValue();var b=this.doCreateEditWidget(c,d);if(b&&b.setIsDirty){b.setIsDirty(false)}this._editWidget=b;return b},doCreateEditWidget:function(b){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var b=this.doSaveEditValue();if(this._editWidget.setIsDirty){this._editWidget.setIsDirty(false)}return b}else{return false}}else{return false}},doSaveEditValue:function(){},notifyChildEditorValueChange:function(c,b){}});Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var a=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[];this._defaultItems=[]},register:function(b,f,c,e,g){var d={editorClass:b,propType:f,objClass:c,propName:e,matchFunc:g};this._registeredItems.push(d);if(!f&&!c&&!e&&!g){this._defaultItems.push(d)}return this},unregister:function(b){var c=this._registeredItems;for(var d=c.length-1;d>=0;--d){var e=c[d];if(e.editorClass===b){c.splice(d,1)}}var c=this._defaultItems;for(var d=c.length-1;d>=0;--d){var e=c[d];if(e.editorClass===b){c.splice(d,1)}}return this},_getDefaultItem:function(){var b=this._defaultItems;return b[b.length-1]},_getSuperiorItem:function(e,d){var b=["matchFunc","propName","objClass","propType"];for(var f=0,c=b.length;f<c;++f){if(!!e[b]===!!d[b]){continue}else{return e[b]?e:d}}return e},_isMatchedPropType:function(e,d){var c=(e===d);if(!c){if(DataType.isObjectExType(e)&&DataType.isObjectExType(d)){var b=ClassEx.findClass(e);var f=ClassEx.findClass(d);c=ClassEx.isOrIsDescendantOf(b,f)}}return c},_testOnPropType:function(c,b){if(!c.propType||!b.dataType){return 0}if(this._isMatchedPropType(b.dataType,c.propType)){return 1}else{return -1}},_testOnObjClass:function(b,c){if(!b.objClass||!c){return 0}else{if(ClassEx.isOrIsDescendantOf(c,b.objClass)){return 1}else{return -1}}},_testOnPropName:function(c,b){if(!c.propName||!b.name){return 0}else{if(c.propName===b.name){return 1}else{return -1}}},_testOnMatchFunc:function(c,d,b){if(!c.matchFunc){return 0}else{if(c.matchFunc(d,b)){return 1}else{return -1}}},findEditorClass:function(o,l){var p=null;var m=this._registeredItems;var d=false;var h=[];for(var g=m.length-1;g>=0;--g){var n=m[g];var f=this._testOnPropType(n,l);if(f<0){continue}var e=this._testOnObjClass(n,o);if(e<0){continue}var c=this._testOnPropName(n,l);if(c<0){continue}var b=this._testOnMatchFunc(n,o,l);if(b<0){continue}d=(f+e+c+b)>0;if(d){if(p){p=this._getSuperiorItem(p,n.editorClass)}else{p=n.editorClass}if(p&&n.matchFunc){break}}}if(!p){var n=this._getDefaultItem();p=n?n.editorClass:null}return p},findEditorClassForType:function(d,c){var b={dataType:d,name:c};return this.findEditorClass(null,b)}});Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger);Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(c,b){if(DataType.isSimpleType(b)){if(!c&&this.getAllowEmpty()){return null}else{return Kekule.StrUtils.convertToType(c,b)}}else{return c}},setValueText:function(b){if(b===this._originValueText){return false}var d;var c=this.getPropertyType();if(c&&!DataType.isSimpleType(c)){return false}if(c){d=this.convertStrToValue(b,c)}else{d=b}this.setValue(d);return true},doCreateEditWidget:function(c){var d=this.getValueText();this._originValueText=d;var b=new Kekule.Widget.TextBox(c,d);return b},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor);Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(b){return b.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(b){return b.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(c){this._parentWidget=c;var d=this.getValueText();this._originValueText=d;var b=new Kekule.Widget.ButtonTextBox(c,this.textToSingleLine(d));this._textbox=b;b.setButtonKind(Kekule.Widget.Button.Kinds.POPUP);b.addEventListener("buttonExecute",this.reactButtonExecute,this);return b},reactButtonExecute:function(b){this.openPopupEditor()},openPopupEditor:function(){var c=this._popupDialog;if(!c){c=this.createPopupDialog();this._popupDialog=c}var d=this._popupEditor;d.setValue(this.getValueText());var b=this;c.openPopup(function(e){if(e===Kekule.Widget.DialogButtons.OK){b._textbox.setValue(b.textToSingleLine(d.getValue()))}},this._textbox)},createPopupDialog:function(){var e=this._parentWidget.getDocument();var c=new Kekule.Widget.Dialog(e,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);c.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var b=Kekule.Widget.TextArea;var f=new b(e);var d=f.getElement().style;d.width="40em";d.height="20em";f.appendToWidget(c);this._popupEditor=f;return c},doSaveEditValue:function(){var b=this.getEditWidget().getValue();b=this.textToMultiLine(b);if(b!==this._originValueText){this.setValueText(b);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING);Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(b){return Kekule.StrUtils.boolToStr(b)},doCreateEditWidget:function(c){this._originValue=this.getValue();var b=new Kekule.Widget.CheckBox(c,this._originValue);b.setText(this.boolToStr(this._originValue));var d=this;b.addEventListener("valueChange",function(g){var f=b.getChecked();b.setText(d.boolToStr(f))});return b},getValueText:function($super){var b=this.getValue();if(Kekule.ObjUtils.isUnset(b)){return Kekule.WidgetTexts.S_VALUE_UNSET}else{return $super()}},doSaveEditValue:function(){var b=this.getEditWidget().getChecked();if(b!==this._originValue){this.setValue(b);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL);Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function($super){var d=this.getValue();var c=this.getSelectItems()||[];for(var e=0,b=c.length;e<b;++e){var f=c[e];if(f.value===d){return f.text}}return $super()},getSelectItems:function(){return[]},doCreateEditWidget:function(c){var b=new Kekule.Widget.SelectBox(c,this.getSelectItems());this._originalValue=this.getValue();b.setValue(this._originalValue);return b},doSaveEditValue:function(){var b=this.getEditWidget().getValue();if(b!==this._originalValue){this.setValue(b);return true}else{return false}}});Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function($super){$super();this.enumInfos=[]},setPropertyInfo:function($super,e){$super(e);if(e){var f=e.enumSource;if(f&&DataType.isObjectValue(f)){var b=Kekule.ObjUtils.getOwnedFieldNames(f);this.enumInfos=[];for(var d=0,c=b.length;d<c;++d){this.enumInfos.push({text:b[d],value:f[b[d]]})}}}},getSelectItems:function(){var c=this.getValue();if(Kekule.ObjUtils.isUnset(c)){var b=Kekule.ArrayUtils.clone(this.enumInfos);b.unshift({text:Kekule.WidgetTexts.S_VALUE_UNSET,value:c});return b}return this.enumInfos}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(c,b){return !!b.enumSource});Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function($super){var b=$super();b=b|a.SUBPROPS;return b},hasSubPropertyEditors:function($super){return $super()&&this.getValue()},getSubPropertyEditors:function(b){var n=[];var d=this.getValue();if(d&&(d instanceof ObjectEx)){var m=d.getClass();var o=d.getPropListOfScopes(b);for(var e=0,c=o.getLength();e<c;++e){var h=o.getPropInfoAt(e);var f=Kekule.PropertyEditor.findEditorClass(m,h);if(f){var g=new f();g.setObjects([d]);g.setPropertyInfo(h);g.setValueTextMode(this.getValueTextMode());n.push(g)}}}return n},getValueText:function($super){var b=this.getValue();if(Kekule.ObjUtils.notUnset(b)){if(b.getClassName){return"["+b.getClassName()+"]"}else{return $super()}}else{return Kekule.WidgetTexts.S_OBJECT_UNSET}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx");Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function($super,c){if(!this.getPropertyType()){var d=this.getValue();this.getPropertyInfo().dataType=DataType.getType(d)}var b=$super(c);return b}});Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function($super){$super();this._initialObjValue=undefined},getFieldEditorClass:function(c,b){return Kekule.PropertyEditor.findEditorClass(null,b)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(c,d){var b=c[d];if(Kekule.ObjUtils.notUnset(b)){return DataType.getType(b)}else{return null}},createFieldEditor:function(e,d){var f=this.getFieldEditorClass(e,d);var b=new f();b.setParentEditor(this);b.setReadOnly(false);b.setAllowEmpty(this.getAllowEmpty());b.setPropertyInfo(d);b.setObjects(e);b.setValueTextMode(this.getValueTextMode());return b},getObjFields:function(b){if(b){return Kekule.ObjUtils.getOwnedFieldNames(b)}else{return[]}},getObjFieldInfos:function(g){var c=this.getObjFields(g);var b=[];for(var e=0,d=c.length;e<d;++e){var f={name:c[e],dataType:this.getFieldValueType(g,c[e])};b.push(f)}return b},notifyChildEditorValueChange:function(d,c){var b=this.getValue()||this._initialObjValue;b[d]=c;this.setValue(b)},getAttributes:function($super){var b=$super();b=b|a.SUBPROPS;return b},hasSubPropertyEditors:function($super){return $super()&&this.getObjFieldInfos(this.getValue()).length},getValueText:function($super){var b=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===b.JSON){return $super()}var c=this.getValue();if(c){return"["+Kekule.WidgetTexts.S_OBJECT+"]"}else{return""}},setValue:function($super,c){var b=$super(c);this._initialObjValue=c;return b},getSubPropertyEditors:function(g){var b=[];var h=this.getValue();if(!h){this._initialObjValue={}}else{this._initialObjValue=h}var m=this.getObjFieldInfos(h);var d=[this._initialObjValue];for(var e=0,c=m.length;e<c;++e){var f=this.createFieldEditor(d,m[e]);b.push(f)}return b}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT);Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function($super){var b=$super();b=b|a.SUBPROPS;return b},hasSubPropertyEditors:function($super){var b=this.getValue();return $super()&&b&&b.length},getSubPropertyEditors:function(b){var p=[];var n=this.getValue();if(DataType.isArrayValue(n)&&n.length){var h=this.getPropertyInfo().elementType;for(var d=0,c=n.length;d<c;++d){var o=n[d];var g=h||DataType.getType(o);var e=Kekule.PropertyEditor.findEditorClassForType(g);if(e){var f=new e();f.setParentEditor(this);f.setObjects([n]);var m={name:d,title:d,dataType:g};f.setPropertyInfo(m);f.setValueTextMode(this.getValueTextMode());p.push(f)}}}return p},getValueText:function($super){var b=this.getValue();if(DataType.isArrayValue(b)){return"["+b.length+" "+Kekule.WidgetTexts.S_ITEMS+"]"}else{return $super()}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY);Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(c){this._parentWidget=c;var d=this.getValue();this._originValue=d;var b=new Kekule.Widget.ColorDropTextBox(c,d);b.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]);b.addEventListener("valueSet",function(f){this.saveEditValue()},this);this._textbox=b;return b},doSaveEditValue:function(){var b=this.getEditWidget().getValue();if(b===Kekule.Widget.ColorPicker.SpecialColors.UNSET){b=undefined}else{if(b===""){b=undefined}}if(b!==this._originValue){this.setValue(b);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(c,b){var d=b.name;return d&&(d.toLowerCase().indexOf("color")>=0)})})();(function(){var a=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.ChemIdEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemIdEditor",getAttributes:function($super){var b=$super();if(b&a.MULTIOBJS){b=b^a.MULTIOBJS}return b}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemIdEditor,null,Kekule.ChemObject,"id");Kekule.PropertyEditor.ChemCoordSizeFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordSizeFieldEditor",initProperties:function(){this.defineProp("parentObjects",{dataType:DataType.Object,serializable:false});this.defineProp("parentPropName",{dataType:DataType.STRING,serializable:false})},getCoordFieldValue:function(m,g,h){if(!m.length){return undefined}var e=m[0].getPropValue(g);if(!e){return undefined}var b=e[h];for(var f=1,c=m.length;f<c;++f){var d=m[f].getPropValue(g)[h];if(d!==b){return undefined}}return b},getValue:function($super){var b=this.getParentObjects();var c=this.getParentPropName();if(b&&c){return this.getCoordFieldValue(b,c,this.getPropertyName())}else{return $super()}}});Kekule.PropertyEditor.ChemCoordEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemCoordEditor",is3DCoord:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DCoord()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var m="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!m){m+=", "}m+=e[c]+": "+h}}return"{"+m+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"coord3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemCoordEditor,null,Kekule.ChemObject,"absCoord3D");Kekule.PropertyEditor.ChemSizeEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemSizeEditor",is3DSize:function(){var b=this.getPropertyName();return(b.indexOf("3")>=0)},getFieldEditorClass:function(b,c){return Kekule.PropertyEditor.ChemCoordSizeFieldEditor},createFieldEditor:function($super,d,c){var b=$super(d,c);if(b.setParentObjects){b.setParentObjects(this.getObjects())}if(b.setParentPropName){b.setParentPropName(this.getPropertyName())}return b},getFieldValueType:function(b,c){return DataType.FLOAT},getObjFields:function(b){return this.is3DSize()?["x","y","z"]:["x","y"]},getValueText:function($super){var f=Kekule.Widget.ValueListEditor.ValueDisplayMode;var d=this.getValueTextMode();if(d===f.JSON){return $super()}var g=this.getValue();if(g){var e=this.getObjFields();var m="";for(var c=0,b=e.length;c<b;++c){var h=g[e[c]];if(Kekule.ObjUtils.notUnset(h)){if(!!m){m+=", "}m+=e[c]+": "+h}}return"{"+m+"}"}else{return""}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size2D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"size3D");Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemSizeEditor,null,Kekule.ChemObject,"screenSize");Kekule.PropertyEditor.ChemOptionObjectEditor=Class.create(Kekule.PropertyEditor.ObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemOptionObjectEditor",CHILD_FIELD_INFOS:null,initialize:function($super){$super();this.setAllowEmpty(true)},getObjFieldInfos:function(g){var e=ClassEx.getCommonSuperClass(this.getObjects());var b=[];var h=this.CHILD_FIELD_INFOS;for(var d=0,c=h.length;d<c;++d){var f=h[d];if(!f.targetClass||!e||ClassEx.isOrIsDescendantOf(e,f.targetClass)){b.push(f)}}b.sort(function(l,i){return(l.name>i.name)?1:(l.name<i.name)?-1:0});return b},notifyChildEditorValueChange:function($super,d,c){var b=this.getValue()||this._initialObjValue;b=Object.extend({},b);if(Kekule.ObjUtils.notUnset(c)){b[d]=c}else{delete b[d]}this.setValue(b)}});Kekule.PropertyEditor.ChemRender2DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender2DOptionsEditor",CHILD_FIELD_INFOS:[{name:"expanded",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"moleculeDisplayType",dataType:DataType.INT,enumSource:Kekule.Render.MoleculeDisplayType,targetClass:Kekule.StructureFragment},{name:"renderType",dataType:DataType.INT,enumSource:Kekule.Render.BondRenderType,targetClass:Kekule.ChemStructureConnector},{name:"nodeDisplayMode",dataType:DataType.INT,enumSource:Kekule.Render.NodeLabelDisplayMode,targetClass:Kekule.ChemStructureNode},{name:"hydrogenDisplayLevel",dataType:DataType.INT,enumSource:Kekule.Render.HydrogenDisplayLevel,targetClass:Kekule.ChemStructureNode},{name:"showCharge",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkType",dataType:DataType.INT,enumSource:Kekule.Render.ChargeMarkRenderType,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkFontSize",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkMargin",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"chargeMarkCircleWidth",dataType:DataType.FLOAT,targetClass:Kekule.ChemStructureNode},{name:"fontSize",dataType:DataType.NUMBER},{name:"fontFamily",dataType:DataType.STRING},{name:"supFontSizeRatio",dataType:DataType.FLOAT},{name:"subFontSizeRatio",dataType:DataType.FLOAT},{name:"superscriptOverhang",dataType:DataType.FLOAT},{name:"subscriptOversink",dataType:DataType.FLOAT},{name:"textBoxXAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxXAlignment},{name:"textBoxYAlignment",dataType:DataType.INT,enumSource:Kekule.Render.BoxYAlignment},{name:"horizontalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"verticalAlign",dataType:DataType.INT,enumSource:Kekule.Render.TextAlign},{name:"charDirection",dataType:DataType.INT,enumSource:Kekule.Render.TextDirection},{name:"customLabel",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"boldBondLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"hashSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondSpacingAbs",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"multipleBondMaxAbsSpacing",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowLength",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondArrowWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"bondWedgeHashMinWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureNode},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"opacity",dataType:DataType.FLOAT,targetClass:Kekule.ChemObject},{name:"fillColor",dataType:DataType.STRING},{name:"strokeColor",dataType:DataType.STRING},{name:"strokeWidth",dataType:DataType.NUMBER},{name:"atomRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender2DOptionsEditor,null,Kekule.ChemObject,"renderOptions");Kekule.PropertyEditor.ChemRender3DOptionsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.ChemRender3DOptionsEditor",CHILD_FIELD_INFOS:[{name:"displayMultipleBond",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"useVdWRadius",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureNode},{name:"nodeRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadius",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"nodeRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureNode},{name:"connectorRadiusRatio",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"connectorLineWidth",dataType:DataType.NUMBER,targetClass:Kekule.ChemStructureObject},{name:"color",dataType:DataType.STRING},{name:"atomColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"bondColor",dataType:DataType.STRING,targetClass:Kekule.ChemStructureObject},{name:"useAtomSpecifiedColor",dataType:DataType.BOOL,targetClass:Kekule.ChemStructureObject},{name:"hideHydrogens",dataType:DataType.BOOL,targetClass:Kekule.StructureFragment},{name:"bondSpliceMode",dataType:DataType.INT,enumSource:Kekule.Render.Bond3DSpliceMode,targetClass:Kekule.ChemStructureObject}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ChemRender3DOptionsEditor,null,Kekule.ChemObject,"render3DOptions");Kekule.PropertyEditor.GlyphPathParamsEditor=Class.create(Kekule.PropertyEditor.ChemOptionObjectEditor,{CLASS_NAME:"Kekule.PropertyEditor.GlyphPathParamsEditor",CHILD_FIELD_INFOS:[{name:"lineCount",dataType:DataType.INT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"lineGap",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowType",dataType:DataType.STRING,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"startArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowType",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowType,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowSide",dataType:DataType.INT,enumSource:Kekule.Glyph.ArrowSide,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowLength",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector},{name:"endArrowWidth",dataType:DataType.FLOAT,targetClass:Kekule.Glyph.PathGlyphConnector}]});Kekule.PropertyEditor.register(Kekule.PropertyEditor.GlyphPathParamsEditor,null,Kekule.Glyph.PathGlyphConnector,"pathParams")})();(function(){Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function($super,b,c,a){$super();this.setPropEditor(b);this.setNewValue(c);this.setOldValue(a)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:false});this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:false})},doExecute:function(){var a=this.getPropEditor();if(this.getOldValue()===undefined){this.setOldValue(a.getValue())}a.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,b){this.setPropStoreFieldValue("widget",b);this._objInspector=null;$super(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function($super){return $super()+" "+a.WIDGET_CONFIGURATOR},doCreateRootElement:function(c){var b=c.createElement("div");return b},doCreateSubElements:function($super,q,h){var r=[];var d=q.createElement("div");d.className=a.WIDGET_CONFIGURATOR_CLIENT;r.push(d);var p=new Kekule.Widget.ObjectInspector(this);p.setShowObjsInfoPanel(false);p.setSortField(null);p.appendToElem(d);this._objInspector=p;p.addEventListener("propertyChange",function(c){this.invokeEvent("configChange",{obj:p.getObjects()[0],propertyName:c.propertyInfo.name,oldValue:c.oldValue,newValue:c.newValue})},this);var m=this.getCategoryInfos();var f=new Kekule.Widget.TabButtonGroup(this);f.setTabButtonPosition(Kekule.Widget.Position.RIGHT);var n;for(var g=0,e=m.length;g<e;++g){var o=m[g];var b=new Kekule.Widget.RadioButton(f);b.setText(o.title||o.name);b.setHint(o.description||"");b[this.TAB_BTN_DATA_FIELD]=o.obj;b.appendToWidget(f);if(g===0){n=b}}f.addEventListener("execute",function(i){var c=i.widget;if(c instanceof Kekule.Widget.RadioButton){this._switchToTab(c)}},this);f.appendToElem(d);n.setChecked(true);this._switchToTab(n);h.appendChild(d);return r},getCategoryInfos:function(){var e=this.getWidget();var b=[];var d=e.getSettingFacade();if(d){var c=e.getPropInfo("settingFacade");b.push({obj:d,name:c.name,title:c.title,descrption:c.description})}return b},_switchToTab:function(c){var b=c[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(b)}});Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:a.ACTION_OPEN_CONFIGURATOR,initialize:function($super,b){$super();this.setWidget(b);this.setText(Kekule.WidgetTexts.CAPTION_CONFIG);this.setHint(Kekule.WidgetTexts.HINT_CONFIG)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},doUpdate:function(){var b=this.getWidget();this.setEnabled(b&&b.getEnabled())},doExecute:function(b){this.getWidget().openConfigurator(b)}});ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Settings";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},getConfiguratorClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Configurator";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},createConfigurator:function(){var b=this.getConfiguratorClass();return new b(this)},getConfigurator:function(){if(!this._configurator){this._configurator=this.createConfigurator()}return this._configurator},openConfigurator:function(b){var d=this.getConfigurator();d.show(b||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}});ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var b=this.getPropStoreFieldValue("settingFacade");if(!b){var d=this.getSettingFacadeClass();if(d){b=new d(this);this.setPropStoreFieldValue("settingFacade",b)}}return b}});Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function($super,b){this._basedClass=null;$super();this.setWidget(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var c=this.getClassName();var b=c.split(".");b.pop();c=b.join(".");this._basedClass=ClassEx.findClass(c)}return this._basedClass},defineDelegatedProp:function(d,e){if(!e){e=d}var b=ClassEx.getPropInfo(this.getBasedClass(),e);var c=Object.create(b);c.setter=null;c.getter=null;if(b.getter){c.getter=function(){return this.getWidget().getPropValue(e)}}if(b.setter){c.setter=function(f){this.getWidget().setPropValue(e,f)}}this.defineProp(d,c)},defineDelegatedProps:function(g,d){if(!d){d=[]}for(var c=0,b=g.length;c<b;++c){var e=g[c];var f=d[c]||e;this.defineDelegatedProp(e,f)}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"});Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function($super,c){$super(c);this.setMaxMsgCount(6);this.setMsgFlashTime(6000)},doGetWidgetClassName:function($super){return $super()+" "+a.SYSMSGGROUP}});Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getPropStoreFieldValue("document")||document}});this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("sysMsgGroup");if(!c){c=new Kekule.Widget.SysMsgGroup(this.getDocument());c.appendToElem(this.getDocument().body);this.setPropStoreFieldValue("sysMsgGroup",c)}return c}})},throwException:function($super,h,f){var g=Kekule.ExceptionLevel;var d=Kekule.Widget.MsgType;if(!f){f=g.ERROR}var i;if(typeof(h)==="string"){i=h}else{i=h.message}if(i){var c=(f===g.ERROR)||!f?d.ERROR:(f===g.WARNING)?d.WARNING:(f===g.NOTE)?d.INFO:d.NORMAL;this.getSysMsgGroup().addMessage(i,c)}return $super(h,f)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler);Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})();(function(){var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"});Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setOperHistory(c)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",c);this.operHistoryChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},_installRootEventHandler:function(b){b.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(c){if(this.getEnableLiveUpdate()){var b=c.target;this._fillTree(c.target)}},_fillTree:function(c){if(c){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),c);var d=c.getCurrOperation();var b=d?this.getObjMap().get(d):null;this.select(b)}},_getOperChildCount:function(b){if(b instanceof Kekule.OperationHistory){return b.getOperationCount()}else{if(b instanceof Kekule.MacroOperation){return b.getChildCount()}else{return 0}}},_getChildOperAt:function(c,b){if(c instanceof Kekule.OperationHistory){return c.getOperationAt(b)}else{if(c instanceof Kekule.MacroOperation){return c.getChildAt(b)}else{return null}}},_updateTreeItem:function(h,d){var n=this._getOperDisplayTitle(d);var f={text:n,obj:d};this.setItemData(h,f);this.getObjMap().set(d,h);var b=this.getChildItemCount(h);var e=this._getOperChildCount(d);for(var g=0;g<e;++g){var c=this._getChildOperAt(d,g);var m;if(g<b){m=this.getChildItemAt(h,g)}else{m=this.appendChildItem(h)}this._updateTreeItem(m,c)}if(b>e){for(var g=b-1;g>=e;--g){this.removeChildItemAt(h,g)}}},_getOperDisplayTitle:function(d){var b=d.getClassName();var c=d.getTarget?d.getTarget():null;if(c&&c.getId){b+="(target: "+c.getId()+")"}return b}})})();Kekule.ChemWidget={};Kekule.ChemWidget.AbstractWidget=Kekule.Widget.BaseWidget;Kekule.ChemWidget.ComponentWidgetNames={newDoc:"newDoc",loadFile:"loadFile",loadData:"loadData",saveFile:"saveFile",zoomIn:"zoomIn",zoomOut:"zoomOut",rotateRight:"rotateRight",rotateLeft:"rotateLeft",rotateX:"rotateX",rotateY:"rotateY",rotateZ:"rotateZ",reset:"reset",molDisplayType:"molDisplayType",molHideHydrogens:"molHideHydrogens",openEditor:"openEditor",config:"config",objInspector:"objInspector",undo:"undo",redo:"redo",copy:"copy",cut:"cut",paste:"paste",cloneSelection:"cloneSelection",erase:"erase",manipulate:"manipulate",molBond:"bond",molAtom:"atom",molCharge:"charge",textBlock:"textBlock",molRing:"ring",glyph:"glyph",fontName:"fontName",fontSize:"fontSize",color:"color",textDirection:"textDirection",textAlign:"textAlign"};Kekule.ChemWidget.HtmlClassNames={PREFIX:"K-Chem-",INNER_TOOLBAR:"K-Chem-InnerToolbar"};(function(){var b=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var c=Kekule.ChemWidgetTexts;var a=Kekule.Widget.HtmlClassNames;var e=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{PERIODIC_TABLE:"K-Chem-Periodic-Table",PERIODIC_TABLE_MINI:"K-Chem-Periodic-Table-Mini",PERIODIC_TABLE_LEGEND:"K-Chem-Periodic-Table-Legend",PERIODIC_TABLE_LEGEND_CONTENT:"K-Chem-Periodic-Table-Legend-Content",PERIODIC_TABLE_LEGEND_COLORS:"K-Chem-Periodic-Table-Legend-Colors",PERIODIC_TABLE_LEGEND_COLOR:"K-Chem-Periodic-Table-Legend-Color",PERIODIC_TABLE_MAINTABLE:"K-Chem-Periodic-Table-MainTable",PERIODIC_TABLE_EXTRATABLE:"K-Chem-Periodic-Table-ExtraTable",PERIODIC_TABLE_ELEM_CELL:"K-Chem-Periodic-Table-Elem-Cell",PERIODIC_TABLE_ELEM_STUBSCELL:"K-Chem-Periodic-Table-Elem-StubsCell",PERIODIC_TABLE_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT:"K-Chem-Periodic-Table-Elem-Cell-Content",PERIODIC_TABLE_HEAD_CELL:"K-Chem-Periodic-Table-Head-Cell",PERIODIC_TABLE_HEAD_CELL_CONTENT:"K-Chem-Periodic-Table-Head-Cell-Content",PERIODIC_TABLE_HEAD_CELL_GROUP:"K-Chem-Periodic-Table-Head-Cell-Group",PERIODIC_TABLE_HEAD_CELL_PERIOD:"K-Chem-Periodic-Table-Head-Cell-Period",ELEM_SYMBOL:"K-Chem-Elem-Symbol",ELEM_SYMBOL_STUBS:"K-Chem-Elem-Symbol-Stubs",ELEM_NAME:"K-Chem-Elem-Name",ATOMIC_NUM:"K-Chem-Atomic-Num",ATOMIC_WEIGHT:"K-Chem-Atomic-Weight"});Kekule.ChemWidget.PeriodicTable=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.PeriodicTable",BINDABLE_TAG_NAMES:["span","div"],ELEM_DATA_FIELD:"__$elemData__",MAX_GROUP:18,MAX_PERIOD:7,LA_SERIES:["La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu"],AC_SERIES:["Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr"],initialize:function($super,f,g){this.setPropStoreFieldValue("displayedComponents",g||this.getDefaultDisplayedComponents());this._elemCells=[];this._selectedElemCells=[];$super(f);this.setEnableSelect(true);this.setEnableMultiSelect(true)},initProperties:function(){this.defineProp("displayedComponents",{dataType:DataType.ARRAY,getter:function(){return this.getPropStoreFieldValue("displayedComponents")||this.getDefaultDisplayedComponents()}});this.defineProp("startingAtomNum",{dataType:DataType.INT});this.defineProp("endingAtomNum",{dataType:DataType.INT});this.defineProp("useMiniMode",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("useMiniMode",f);if(f){this.addClassName(e.PERIODIC_TABLE_MINI)}else{this.removeClassName(e.PERIODIC_TABLE_MINI)}}});this.defineProp("enableSelect",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableSelect")||this.getEnableMultiSelect()}});this.defineProp("enableMultiSelect",{dataType:DataType.BOOL});this.defineProp("selected",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){return this.getSelection()?this.getSelection()[0]:null}});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,setter:null,getter:function(){var f=[];var h=this._selectedElemCells||[];for(var m=0,g=h.length;m<g;++m){var n=h[m][this.ELEM_DATA_FIELD];if(n){f.push(n)}}return f}});this.defineProp("selectedSymbol",{dataType:DataType.STRING,getter:function(){return this.getSelectedSymbols()[0]},setter:function(f){this.setSelectedSymbols([f])}});this.defineProp("selectedSymbols",{dataType:DataType.ARRAY,getter:function(){var m=this.getSelection();if(m){var f=[];for(var h=0,g=m.length;h<g;++h){f.push(m[h].symbol)}return f}return[]},setter:function(f){this.selectSymbols(f)}})},doGetWidgetClassName:function($super){return $super()+" "+e.PERIODIC_TABLE},doCreateRootElement:function(g){var f=g.createElement("div");return f},doCreateSubElements:function($super,h,f){$super(h,f);var g=this.createMainTable(h,f);return[g]},doObjectChange:function(f){var g=["displayedComponents","startingAtomNum","endingAtomNum"];if(Kekule.ArrayUtils.intersect(f,g).length){this.recreateMainTable()}},getDefaultDisplayedComponents:function(){return["symbol","name","atomicNumber","groupHead","legend"]},getShowElemSymbol:function(){var f=this.getDisplayedComponents();return f.indexOf("symbol")>=0},getShowElemName:function(){var f=this.getDisplayedComponents();return f.indexOf("name")>=0},getShowAtomicNum:function(){var f=this.getDisplayedComponents();return f.indexOf("atomicNumber")>=0},getShowAtomicWeight:function(){var f=this.getDisplayedComponents();return f.indexOf("atomicWeight")>=0},getShowGroupHead:function(){var f=this.getDisplayedComponents();return f.indexOf("groupHead")>=0},getShowPeriodHead:function(){var f=this.getDisplayedComponents();return f.indexOf("periodHead")>=0},getShowLegend:function(){var f=this.getDisplayedComponents();return f.indexOf("legend")>=0},recreateMainTable:function(){this.deselectAll();var f=this.getElement();b.clearChildContent(f);this.createMainTable(f.ownerDocument,f)},createMainTable:function(O,B){var H=Kekule.chemicalElementsData;var h=[];this._elemCells=[];var u=[];var x=[];var z=O.createElement("table");for(var q=0;q<=this.MAX_PERIOD;++q){var n=O.createElement("tr");var r=[];for(var m=0;m<=this.MAX_GROUP;++m){var v=O.createElement("td");n.appendChild(v);r.push(v)}z.appendChild(n);h.push(r)}var f=O.createElement("table");for(var q=0;q<2;++q){var n=O.createElement("tr");var r=[];for(var m=0;m<this.LA_SERIES.length;++m){var v=O.createElement("td");n.appendChild(v);r.push(v)}f.appendChild(n);u.push(r)}var M=this.getStartingAtomNum()||0;var g=this.getEndingAtomNum()||300000;for(var F=0,D=H.length;F<D;++F){var J=H[F];var t=J.atomicNumber;if(t<M||t>g){continue}var E=J.symbol;var G=J.period;var s=J.group;var o=J.chemicalSerie.replace(/\s/g,"");Kekule.ArrayUtils.pushUnique(x,J.chemicalSerie);var v;var y=this.LA_SERIES.indexOf(E);var w=this.AC_SERIES.indexOf(E);if(y>=0){v=u[0][y]}else{if(w>=0){v=u[1][w]}else{if(G&&s){v=h[G][s]}}}if(v){v.className=e.PERIODIC_TABLE_ELEM_CELL;v.appendChild(this.createElemCellContent(O,J,o.upperFirst()));v[this.ELEM_DATA_FIELD]=J;this._elemCells.push(v)}if((y===0)||(w===0)){v=h[G][s];v.className=e.PERIODIC_TABLE_ELEM_STUBSCELL;v.appendChild(this.createElemCellStubsContent(O,J,o.upperFirst()))}}if(this.getShowGroupHead()){var p=["IA","IIA","IIIB","IVB","VB","VIB","VIIB","","VIII","","IB","IIB","IIIA","IVA","VA","VIA","VIIA","VIIIA"];for(var m=1;m<=this.MAX_GROUP;++m){var q=(m===1)||(m===18)?0:(m===2)||(m>=13)?1:3;var v=h[q][m];v.className=e.PERIODIC_TABLE_HEAD_CELL+" "+e.PERIODIC_TABLE_HEAD_CELL_GROUP;v.appendChild(this.createHeadContent(O,p[m-1]))}}if(this.getShowPeriodHead()){for(var q=1;q<=this.MAX_PERIOD;++q){var v=h[q][0];v.className=e.PERIODIC_TABLE_HEAD_CELL+" "+e.PERIODIC_TABLE_HEAD_CELL_PERIOD;v.appendChild(this.createHeadContent(O,q))}}B.appendChild(z);if(this.getShowLegend()){var N=O.createElement("a");N.href="javascript:void(0)";N.className=e.PERIODIC_TABLE_LEGEND+" "+a.CORNER_ALL;b.setElementText(N,c.LEGEND_CAPTION);var A=O.createElement("div");A.className=e.PERIODIC_TABLE_LEGEND_CONTENT+" "+a.CORNER_ALL;var C={symbol:c.LEGEND_ELEM_SYMBOL,atomicNumber:c.LEGEND_ATOMIC_NUM,naturalMass:c.LEGEND_ATOMIC_WEIGHT,name:c.LEGEND_ELEM_NAME};var K=this.createElemCellContent(O,C,e.PERIODIC_TABLE_LEGEND_ELEM_CELL_CONTENT);A.appendChild(K);var L=O.createElement("div");L.className=e.PERIODIC_TABLE_LEGEND_COLORS;for(var F=0,D=x.length;F<D;++F){var I=O.createElement("div");I.className=e.PERIODIC_TABLE_LEGEND_COLOR+" "+x[F].replace(/\s/g,"");b.setElementText(I,x[F]);L.appendChild(I)}A.appendChild(L);N.appendChild(A);B.appendChild(N)}B.appendChild(f);return z},createElemCellContent:function(m,h,n){var f=m.createElement("div");var l=e.PERIODIC_TABLE_ELEM_CELL_CONTENT;if(n){l+=" "+n}f.className=l;if(this.getShowAtomicNum()){f.appendChild(this.createElemContentComponent(m,h.atomicNumber,e.ATOMIC_NUM))}if(this.getShowAtomicWeight()){var i=h.naturalMass;if(i){var g=(typeof(i)==="number")?i.toFixed(3):i;f.appendChild(this.createElemContentComponent(m,g,e.ATOMIC_WEIGHT))}else{f.appendChild(this.createElemContentComponent(m,"\u00a0",e.ATOMIC_WEIGHT))}}if(this.getShowElemSymbol()){f.appendChild(this.createElemContentComponent(m,h.symbol,e.ELEM_SYMBOL))}if(this.getShowElemName()){f.appendChild(this.createElemContentComponent(m,h.name,e.ELEM_NAME))}return f},createElemCellStubsContent:function(l,g,n){var f=l.createElement("div");f.className=e.PERIODIC_TABLE_ELEM_CELL_CONTENT+" "+(n||"");var m,i,h;h=g.chemicalSerie;if(g.symbol==="La"){m="57-71";i="La-Lu"}else{m="89-103";i="Ac-Lr"}if(this.getShowAtomicNum()){f.appendChild(this.createElemContentComponent(l,m,e.ATOMIC_NUM))}if(this.getShowElemSymbol()){f.appendChild(this.createElemContentComponent(l,i,e.ELEM_SYMBOL_STUBS,true))}if(this.getShowElemName()){f.appendChild(this.createElemContentComponent(l,h,e.ELEM_NAME))}return f},createElemContentComponent:function(i,h,f,m){var g=i.createElement("span");g.className=f;if(m){var l=i.createElement("span");g.appendChild(l)}b.setElementText(l||g,h);return g},createHeadContent:function(g,h,i){var f=g.createElement("div");f.className=e.PERIODIC_TABLE_HEAD_CELL_CONTENT+" "+(i||"");b.setElementText(f,h);return f},_getAtomCellElem:function(g){var f=b.getNearestAncestorByTagName(g,"td",true);if(f&&(this._elemCells.indexOf(f)>=0)){return f}else{return null}},_getCellElemOfSymbol:function(o){var h=this._elemCells;for(var m=0,g=h.length;m<g;++m){var f=h[m];var n=f[this.ELEM_DATA_FIELD];if(n.symbol===o){return f}}return null},isCellSelected:function(f){return this._selectedElemCells.indexOf(f)>=0},selectCell:function(f){if(f){d.addClass(f,a.STATE_SELECTED);Kekule.ArrayUtils.pushUnique(this._selectedElemCells,f);this.invokeEvent("select",{elemData:f[this.ELEM_DATA_FIELD]})}},deselectCell:function(f){if(f){d.removeClass(f,a.STATE_SELECTED);Kekule.ArrayUtils.remove(this._selectedElemCells,f);this.invokeEvent("deselect",{elemData:f[this.ELEM_DATA_FIELD]})}},toggleCell:function(f){if(this.isCellSelected(f)){this.deselectCell(f)}else{this.selectCell(f)}},deselectAll:function(){var f=this._selectedElemCells;for(var g=f.length-1;g>=0;--g){this.deselectCell(f[g])}return this},selectSymbols:function(h){this.deselectAll();var n=Kekule.ArrayUtils.toArray(h);for(var m=0,g=n.length;m<g;++m){var f=this._getCellElemOfSymbol(n[m]);if(f){this.selectCell(f)}}return this},react_click:function($super,h){if(this.getEnableSelect()){var g=h.getTarget();var f=this._getAtomCellElem(g);if(f){if(!this.getEnableMultiSelect()){this.deselectAll();this.selectCell(f)}else{this.toggleCell(f)}return true}}$super(h)}})})();(function(){var g=Class.PropertyScope;var d=Kekule.DomUtils;var c=Kekule.ZoomUtils;var b=Kekule.ChemWidget;var e=Kekule.ChemWidgetTexts;var a=Kekule.Widget.HtmlClassNames;var f=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{DISPLAYER_DRAWCONTEXT_PARENT:"K-Chem-Displayer-DrawContext-Parent",ACTION_MOL_DISPLAY_TYPE:"K-Chem-MolDisplayType",ACTION_MOL_DISPLAY_SKELETAL:"K-Chem-MolDisplaySkeletal",ACTION_MOL_DISPLAY_CONDENSED:"K-Chem-MolDisplayCondensed",ACTION_MOL_DISPLAY_WIRE:"K-Chem-MolDisplayWire",ACTION_MOL_DISPLAY_BALLSTICK:"K-Chem-MolDisplayBallStick",ACTION_MOL_DISPLAY_STICKS:"K-Chem-MolDisplaySticks",ACTION_MOL_DISPLAY_SPACEFILL:"K-Chem-MolDisplaySpaceFill",ACTION_MOL_HIDE_HYDROGENS:"K-Chem-MolHideHydrogens",ACTION_ZOOMIN:"K-Chem-ZoomIn",ACTION_ZOOMOUT:"K-Chem-ZoomOut",ACTION_RESET:"K-Chem-Reset",ACTION_RESET_ZOOM:"K-Chem-ResetZoom",ACTION_LOADFILE:"K-Chem-LoadFile",ACTION_LOADDATA:"K-Chem-LoadData",ACTION_SAVEFILE:"K-Chem-SaveFile",ACTION_CONFIG:"K-Chem-Config",DIALOG_LOADDATA:"K-Chem-Dialog-LoadData",DIALOG_LOADDATA_FORMATBOX:"K-Chem-Dialog-LoadData-FormatBox",DIALOG_LOADDATA_SRCEDITOR:"K-Chem-Dialog-LoadData-SrcEditor",DIALOG_LOADDATA_BTN_LOADFROMFILE:"K-Chem-Dialog-LoadData-Btn-LoadFromFile",DIALOG_CHOOSE_FILE_FORAMT:"K-Chem-Dialog-Choose-File-Format",DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX:"K-Chem-Dialog-Choose-File-Format-FormatBox",DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER:"K-Chem-Dialog-Choose-File-Format-Previewer"});Kekule.ChemWidget.ChemObjDisplayerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerConfigs",initProperties:function(){this.addConfigProp("ioConfigs","Kekule.ChemWidget.ChemObjDisplayerIOConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("ioConfigs",new Kekule.ChemWidget.ChemObjDisplayerIOConfigs())}});Kekule.ChemWidget.ChemObjDisplayerIOConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayerIOConfigs",initProperties:function(){this.addBoolConfigProp("canonicalizeBeforeSave",true)}});Kekule.ChemWidget.ChemObjDisplayer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer",initialize:function($super,h,m,i,l){this.setPropStoreFieldValue("renderType",i||Kekule.Render.RendererType.R2D);$super(h);if(m){this.setChemObj(m)}this.setEnableLoadNewFile(true);this.setPropStoreFieldValue("displayerConfigs",l||this.createDefaultConfigs());this._paintFlag=0},doFinalize:function($super){this.setChemObj(null);this.getPainter().finalize();var h=this.getPropStoreFieldValue("drawBridge");var i=this.getPropStoreFieldValue("drawContext");if(i&&h){h.releaseContext(i)}if(h.finalize){h.finalize()}this.setPropStoreFieldValue("drawBridge",null);this.setPropStoreFieldValue("drawContext",null);$super()},initProperties:function(){this.defineProp("displayerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,scope:g.PUBLIC});this.defineProp("enableLoadNewFile",{dataType:DataType.BOOL,serializable:false});this.defineProp("chemObj",{dataType:"Kekule.ChemObject",serializable:false,scope:g.PUBLIC,setter:function(i){var h=this.getPropStoreFieldValue("chemObj");this.setPropStoreFieldValue("chemObj",i);this.chemObjChanged(i,h)}});this.defineProp("chemObjLoaded",{dataType:DataType.BOOL,serializable:false,scope:g.PUBLIC,setter:null,getter:function(){return this.getChemObj()&&this.getPropStoreFieldValue("chemObjLoaded")}});this.defineProp("renderType",{dataType:DataType.INT,serializable:false,setter:null,scope:g.PUBLIC});this.defineProp("renderConfigs",{dataType:DataType.OBJECT,serializable:false,scope:g.PUBLIC,getter:function(){var h=this.getPropStoreFieldValue("renderConfigs");if(!h){h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Render3DConfigs.getInstance():Kekule.Render.Render2DConfigs.getInstance()}return h}});this.defineProp("drawOptions",{dataType:DataType.HASH,serializable:false,scope:g.PUBLIC,getter:function(){var h=this.getPropStoreFieldValue("drawOptions");if(!h){h={};this.setPropStoreFieldValue("drawOptions",h)}return h}});this.defineProp("zoom",{dataType:DataType.FLOAT,serializable:false,getter:function(){var h=this.getDrawOptions()||{};return h.zoom},setter:function(h){this.zoomTo(h);return this}});this.defineProp("autofit",{dataType:DataType.BOOL,serializable:false,getter:function(){var h=this.getDrawOptions()||{};return h.autofit},setter:function(h){var i=this.getDrawOptions()||{};i.autofit=h;return this.setDrawOptions(i)}});this.defineProp("moleculeDisplayType",{dataType:DataType.INT,serializable:false,getter:function(){var h=this.getDrawOptions()||{};return h.moleculeDisplayType},setter:function(h){this.getDrawOptions().moleculeDisplayType=h;this.drawOptionChanged();return this}});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL,serializable:false,scope:g.PUBLIC,getter:function(){return Kekule.oneOf(this.getDrawOptions().allowCoordBorrow,this.getRenderConfigs().getGeneralConfigs().getAllowCoordBorrow())}});this.defineProp("autoSize",{dataType:DataType.BOOL,serializable:false,setter:function(h){if(h!=this.getAutoSize()){this.setPropStoreFieldValue("autoSize",h);if(h&&this.allowAutoSize()){this.drawOptionChanged()}}}});this.defineProp("padding",{dataType:DataType.INT,serializable:false,setter:function(h){if(h!=this.getPadding()){this.setPropStoreFieldValue("padding",h);this.getDrawOptions().autofitContextPadding=h;this.drawOptionChanged()}}});this.defineProp("baseCoordOffset",{dataType:DataType.Hash,serializable:false,setter:function(h){this.setPropStoreFieldValue("baseCoordOffset",h);if(this.getChemObjLoaded()){this.repaint()}}});this.defineProp("drawBridge",{dataType:DataType.OBJECT,serializable:false,scope:g.PRIVATE,setter:null,getter:function(){var h=this.getPropStoreFieldValue("drawBridge");if(!h){h=this.createDrawBridge();this.setPropStoreFieldValue("drawBridge",h)}return h}});this.defineProp("drawContext",{dataType:DataType.OBJECT,serializable:false,scope:g.PRIVATE,setter:null,getter:function(){var h=this.getPropStoreFieldValue("drawContext");if(!h){var m=this.getDrawBridge();if(m){var i=this.getDrawContextParentElem();if(!i){return null}else{var l=Kekule.HtmlElementUtils.getElemOffsetDimension(i);h=m.createContext(i,l.width,l.height);this.setPropStoreFieldValue("drawContext",h)}}}return h}});this.defineProp("painter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,scope:g.PRIVATE,setter:null,getter:function(){var h=this.getPropStoreFieldValue("painter");if(!h){h=this.createNewPainter()}return h}});this.defineProp("rootRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,scope:g.PRIVATE,setter:null,getter:function(){var h=this.getPainter();return h?h.getRenderer():null}})},createDefaultConfigs:function(){return new Kekule.ChemWidget.ChemObjDisplayerConfigs()},doWidgetShowStateChanged:function($super,h){$super(h);if(h){this.setChemObj(this.getChemObj())}},getCoordMode:function(){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D},loadPredefinedResDataToProp:function(i,h,m){if(i==="chemObj"){if(m){try{var n=Kekule.IO.loadTypedData(h.data,h.resType,h.resUri);this.setChemObj(n)}catch(l){this.reportException(l)}}else{this.reportException(Kekule.ErrorMsg.CANNOT_LOAD_RES_OF_URI+h.resUri||"")}}},reportException:function(i,h){Kekule.raise(i,h||Kekule.ExceptionLevel.ERROR)},createDrawBridge:function(){var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.DrawBridge3DMananger:Kekule.Render.DrawBridge2DMananger;var h=i.getPreferredBridgeInstance();if(!h){Kekule.error(Kekule.ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED)}return h},getDrawContextParentElem:function(){var h=this._drawContextParentElem;if(!h){h=this.getDocument().createElement("div");this._drawContextParentElem=h;Kekule.HtmlElementUtils.addClass(h,a.DYN_CREATED);Kekule.HtmlElementUtils.addClass(h,f.DISPLAYER_DRAWCONTEXT_PARENT);h.style.width="100%";h.style.height="100%";var i=this.getElement();var l=Kekule.DomUtils.getFirstChildElem(i);if(l){i.insertBefore(h,l)}else{i.appendChild(h)}}return h},allowAutoSize:function(){return this.getRenderType()===Kekule.Render.RendererType.R2D},doInsertedToDom:function(){this.refitDrawContext()},doResize:function(){this.refitDrawContext(this.isPainting())},refitDrawContext:function(i){if(this.getDrawBridge()&&this.getDrawContext()){var h=Kekule.HtmlElementUtils.getElemClientDimension(this.getDrawContextParentElem());var l=this.changeContextDimension(h);if(!i&&l){this.repaint()}}},changeContextDimension:function(h){if(this.getDrawBridge()&&this.getDrawContext()){this.getDrawBridge().setContextDimension(this.getDrawContext(),h.width,h.height);return true}else{return false}},clearContext:function(){var i=this.getPropStoreFieldValue("drawContext");if(i){var h=this.getPropStoreFieldValue("painter");if(h){h.clear(i)}this.getDrawBridge().clearContext(i)}},createNewPainter:function(l){var i=this.getPropStoreFieldValue("painter");if(i){i.finalize()}var h=new Kekule.Render.ChemObjPainter(this.getRenderType(),l,this.getDrawBridge());this.setPropStoreFieldValue("painter",h);return h},chemObjChanged:function(i,h){this.doLoad(i)},load:function(h){this.setChemObj(h)},doLoad:function(l){this.refitDrawContext(true);this.setPropStoreFieldValue("chemObjLoaded",false);try{if(l){var h=this.createNewPainter(l);h.setRenderConfigs(this.getRenderConfigs());this.repaint();this.setPropStoreFieldValue("chemObjLoaded",true)}else{this.clearContext()}this.invokeEvent("load",{obj:l})}catch(i){this.clearContext();this.reportException(i)}finally{this.doLoadEnd(this.getChemObj())}},doLoadEnd:function(h){},loadFromData:function(h,m,l){try{var n=Kekule.IO.loadTypedData(h,m,l);if(n){this.setChemObj(n)}else{Kekule.error(Kekule.ErrorMsg.LOAD_CHEMDATA_FAILED)}return n}catch(i){this.reportException(i)}},loadFromFile:function(i){var h=this;try{Kekule.IO.loadFileData(i,function(n,m){if(m){h.setChemObj(n)}})}catch(l){this.reportException(l)}},saveData:function(o,h,m){var m=m||this.getChemObj();this.prepareSaveData(m);var l=Kekule.IO.ChemDataWriterManager.getWriterByFormat(o,null,m);if(l){var n=this.getDisplayerConfigs().getIoConfigs().getCanonicalizeBeforeSave();if(n&&m.canonicalize){var m=m.clone?m.clone(true):m;m.canonicalize()}if(!h){var p=Kekule.IO.DataFormatsManager.getFormatInfo(o);h=p.dataType}var i=l.writeData(m,h,o);return i}else{Kekule.error(Kekule.ErrorMsg.NO_SUITABLE_WRITER_FOR_FORMAT);return null}},prepareSaveData:function(h){},getDrawClientDimension:function(){var h=Kekule.HtmlElementUtils.getElemClientDimension(this.getCoreElement());return h},calcDrawBaseCoord:function(t){var q;var i=this.getDrawContext();var r=this.getPainter();var l;if((!this._isContinuousRepainting)&&this.getAutoSize()&&this.allowAutoSize()){var p=this.getPadding()||0;var n=r.estimateScreenBox(i,q,t,this.getAllowCoordBorrow());var h=n.x2-n.x1+p*2;var s=n.y2-n.y1+p*2;this.getDrawBridge().setContextDimension(i,h,s);this.setDimension(h,s);l={width:h,height:s};q={x:h/2,y:s/2}}else{q=t?t.baseCoord:null;if(!q){var o=this.getDrawClientDimension();q={x:o.width/2,y:o.height/2};var m=this.getBaseCoordOffset();if(m){q=Kekule.CoordUtils.add(q,m)}}}q=this.getDrawBridge().transformScreenCoordToContext(i,q);return{baseCoord:q,newWidgetDimension:l}},getActualDrawOptions:function(){return this.getDrawOptions()},calcDrawParams:function(l){var i=this.getActualDrawOptions();if(l){i=Object.extend(i,l)}var h=this.calcDrawBaseCoord(i);return{drawOptions:i,baseCoord:h.baseCoord,newWidgetDimension:h.newWidgetDimension}},repaint:function(m){this.beginPaint();try{this.clearContext();if(!this.getChemObj()){return}var h=this.getPainter();var i=this.calcDrawParams();var l=this.getDrawContext();this._lastBaseCoord=i.baseCoord;h.draw(l,i.baseCoord,i.drawOptions)}finally{this.endPaint()}},beginPaint:function(){++this._paintFlag},endPaint:function(){if(this._paintFlag>0){--this._paintFlag}},isPainting:function(){return this._paintFlag>0},drawOptionChanged:function(){this.repaint()},geometryOptionChanged:function(){var h=this.getPainter();var i=this.getDrawOptions();if(h.supportGeometryOptionChange()){h.changeGeometryOptions(this.getDrawContext(),i.baseCoord||this._lastBaseCoord,i)}else{this.drawOptionChanged()}},beginContinuousRepainting:function(){this._isContinuousRepainting=true},endContinuousRepainting:function(){if(this._isContinuousRepainting){this._isContinuousRepainting=false;this.repaint()}},resetDisplay:function(){var h=this.getDrawOptions();h.zoom=1;h.rotateX=0;h.rotateY=0;h.rotateZ=0;h.rotateAngle=0;h.rotateAxisVector=null;h.rotateMatrix=null;this.setBaseCoordOffset(null);this.geometryOptionChanged();return this},getCurrZoom:function(){return this.getDrawOptions().zoom||1},zoomTo:function(i,h){this.getDrawOptions().zoom=i;if(!h){this.geometryOptionChanged()}return this},zoomIn:function(i){var l=this.getCurrZoom();var h=c.getNextZoomInRatio(l,i||1);return this.zoomTo(h)},zoomOut:function(i){var l=this.getCurrZoom();var h=c.getNextZoomOutRatio(l,i||1);return this.zoomTo(h)},resetZoom:function(){return this.zoomTo(1)},getCurrMoleculeDisplayType:function(){var h=this.getDrawOptions().moleculeDisplayType;if(!h){h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.Render.Molecule3DDisplayType.DEFAULT:Kekule.Render.Molecule2DDisplayType.DEFAULT}return h},setHideHydrogens:function(h){this.getDrawOptions().hideHydrogens=h;this.drawOptionChanged();return this},exportToDataUrl:function(h,i){return this.getDrawBridge().exportToDataUrl(this.getDrawContext(),h,i)},createConfigurator:function($super){var h=$super();h.addEventListener("configChange",function(i){this.repaint()},this);return h}});Kekule.ChemWidget.ChemObjDisplayer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Settings",initialize:function($super,h){$super(h)},initProperties:function(){this.defineDelegatedProps(["enableLoadNewFile"])},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ChemObjDisplayer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.ChemWidget.ChemObjDisplayer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,h){$super(h)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var v=$super();var u=this.getDisplayer();var o=[u.getDisplayerConfigs(),u.getRenderConfigs()];for(var p=0,n=o.length;p<n;++p){var h=o[p];var t=h.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var r=0,m=t.getLength();r<m;++r){var s=t.getPropInfoAt(r);var q=h.getPropValue(s.name);if(q){v.push({obj:q,name:s.name,title:s.title,description:s.description})}}}return v},getDisplayer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionDisplayerLoadFile=Class.create(Kekule.ActionFileOpen,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadFile",HTML_CLASSNAME:f.ACTION_LOADFILE,initialize:function($super,h){$super();this.setDisplayer(h);this.setText(e.CAPTION_LOADFILE);this.setHint(e.HINT_LOADFILE)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function($super){$super();var h=this.getDisplayer();this.setEnabled(this.getEnabled()&&h&&h.getEnabled()&&h.getEnableLoadNewFile())},doFileOpened:function(i){if(i&&i.length){var h=i[0];this.getDisplayer().loadFromFile(h)}}});Kekule.ChemWidget.ActionOnDisplayer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionOnDisplayer",initialize:function($super,i,h,l){$super();this.setDisplayer(i);this.setText(h);this.setHint(l)},initProperties:function(){this.defineProp("displayer",{dataType:"Kekule.ChemWidget.ChemObjDisplayer",serializable:false})},doUpdate:function(){var h=this.getDisplayer();this.setEnabled(h&&h.getChemObj()&&h.getChemObjLoaded()&&h.getEnabled())}});Kekule.ChemWidget.ActionDisplayerLoadData=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerLoadData",HTML_CLASSNAME:f.ACTION_LOADDATA,initialize:function($super,h){$super(h,e.CAPTION_LOADDATA,e.HINT_LOADDATA);this._openFileAction=new Kekule.ActionFileOpen();this._openFileAction.update();this._openFileAction.addEventListener("open",this.reactFileLoad,this);this._sBtnLoadFromFile=e.CAPTION_LOADDATA_FROM_FILE},finalize:function($super){this._openFileAction.finalize();$super()},initProperties:function(){this.defineProp("dataDialog",{dataType:"Kekule.Widget.Dialog",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("dataDialog");if(!h){h=this.createDataDialog();this.setPropStoreFieldValue("dataDialog",h)}return h}});this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:false})},createDataDialog:function(){var q=this.getDisplayer().getDocument();var h=new Kekule.Widget.Dialog(q,e.CAPTION_LOADDATA,[this._sBtnLoadFromFile,Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);h.addClassName(f.DIALOG_LOADDATA);var n=h.getDialogButton(this._sBtnLoadFromFile);n.setAction(this._openFileAction);n.linkStyleResource(Kekule.Widget.StyleResourceNames.BUTTON_LOAD_FILE);n.addClassName(f.DIALOG_LOADDATA_BTN_LOADFROMFILE);n.setEnabled(this._openFileAction.getEnabled());var m=q.createElement("div");m.innerHTML=e.CAPTION_DATA_FORMAT;h.getClientElem().appendChild(m);m=q.createElement("div");h.getClientElem().appendChild(m);var i=new Kekule.Widget.SelectBox(h);i.addClassName(f.DIALOG_LOADDATA_FORMATBOX);i.appendToElem(m);h._formatSelector=i;var p=this.getAvailableReaderInfos();var l=this.getFormatSelectorItems(p);i.setItems(l);var m=q.createElement("div");m.innerHTML=e.CAPTION_DATA_SRC;h.getClientElem().appendChild(m);m=q.createElement("div");h.getClientElem().appendChild(m);var o=new Kekule.Widget.TextEditor(h);o.setWrap("off");o.setToolbarPos(Kekule.Widget.Position.BOTTOM);o.addClassName(f.DIALOG_LOADDATA_SRCEDITOR);o.appendToElem(m);h._dataEditor=o;return h},reactFileLoad:function(l){var i=l.files;if(i&&i.length){var h=i[0];this.getDisplayer().loadFromFile(h);this.getDataDialog().close()}},getAvailableReaderInfos:function(){return Kekule.IO.ChemDataReaderManager.getAvailableReaderInfos()},getFormatSelectorItems:function(h){var w=[];var t=[];for(var r=0,o=h.length;r<o;++r){var n=h[r];Kekule.ArrayUtils.pushUnique(t,n.formatId)}for(var r=0,o=t.length;r<o;++r){var m=Kekule.IO.DataFormatsManager.getFormatInfo(t[r]);if(m){var s=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(m.fileExts));for(var q=0,p=s.length;q<p;++q){s[q]="*."+s[q]}var v=s.join(", ");var u=m.title;if(v){u+=" ("+v+")"}w.push({value:m.mimeType,text:u,title:m.mimeType,data:m})}}w.sort(function(l,i){return(l.text<i.text)?-1:(l.text>i.text)?1:0});return w},doUpdate:function($super){$super();var h=this.getDisplayer();this.setEnabled(h&&h.getEnabled()&&h.getEnableLoadNewFile())},doExecute:function(m){var h=this;var l=this.getDataDialog();var i=l._formatSelector;l.openModal(function(n){if(n===Kekule.Widget.DialogButtons.OK){var p=l._dataEditor.getValue();var q=l._formatSelector.getValue();var o=h.getDisplayer();o.loadFromData(p,q)}},m)}});Kekule.ChemWidget.ActionDisplayerSaveFile=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerSaveFile",HTML_CLASSNAME:f.ACTION_SAVEFILE,initialize:function($super,h){$super(h,e.CAPTION_SAVEFILE,e.HINT_SAVEFILE);this._saveAction=new Kekule.ActionFileSave()},finalize:function($super){this._saveAction.finalize();$super()},initProperties:function(){this.defineProp("formatDialog",{dataType:"Kekule.Widget.Dialog",serializable:false,setter:null,getter:function(){var h=this.getPropStoreFieldValue("formatDialog");if(!h){h=this.createFormatDialog();this.setPropStoreFieldValue("formatDialog",h)}return h}});this.defineProp("lastFormat",{dataType:DataType.STRING,serializable:false});this.defineProp("currSaveData",{dataType:DataType.VARIANT,serializable:false})},getChemObjSrcInfo:function(i){var h=this.getDisplayer();return h.getChemObjSrcInfo?h.getChemObjSrcInfo(i):i.getSrcInfo?i.getSrcInfo():null},getChemObjSrcFormat:function(i){var h=this.getChemObjSrcInfo(i);return h?h.format:null},createFormatDialog:function(){var n=this.getDisplayer().getDocument();var h=new Kekule.Widget.Dialog(n,e.CAPTION_CHOOSEFILEFORMAT,[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);h.addClassName(f.DIALOG_CHOOSE_FILE_FORAMT);var m=n.createElement("div");m.innerHTML=e.CAPTION_SELECT_FORMAT;h.getClientElem().appendChild(m);m=n.createElement("div");h.getClientElem().appendChild(m);var l=new Kekule.Widget.SelectBox(h);l.addClassName(f.DIALOG_CHOOSE_FILE_FORAMT_FORMATBOX);l.appendToElem(m);l.addEventListener("valueChange",this.reactFormatSelectorChange,this);h._formatSelector=l;var m=n.createElement("div");m.innerHTML=e.CAPTION_PREVIEW_FILE_CONTENT;h.getClientElem().appendChild(m);m=n.createElement("div");h.getClientElem().appendChild(m);var i=new Kekule.Widget.TextEditor(h);i.setReadOnly(true);i.setWrap("off");i.setToolbarPos(Kekule.Widget.Position.BOTTOM);i.addClassName(f.DIALOG_CHOOSE_FILE_FORAMT_PREVIEWER);i.appendToElem(m);h._previewTextArea=i;return h},getAvailableWriterInfos:function(h){if(!h){return[]}else{return Kekule.IO.ChemDataWriterManager.getAvailableWriterInfos(null,h)}},getFormatSelectorItems:function(x,u){var A=[];var v=[];var r=this.getChemObjSrcInfo(x);var y=(r)?r.format:null;for(var s=0,n=u.length;s<n;++s){var m=u[s];Kekule.ArrayUtils.pushUnique(v,m.formatId)}for(var s=0,n=v.length;s<n;++s){var h=Kekule.IO.DataFormatsManager.getFormatInfo(v[s]);if(h){var t=Kekule.ArrayUtils.clone(Kekule.ArrayUtils.toArray(h.fileExts));for(var q=0,o=t.length;q<o;++q){t[q]="*."+t[q]}var z=t.join(", ");var w=h.title;if(z){w+=" ("+z+")"}var p=y?(v[s]===y):this.getLastFormat()?(this.getLastFormat()===v[s]):s===0;A.push({value:h.id,text:w,title:h.mimeType,data:h,selected:p})}}A.sort(function(l,i){return(l.text<i.text)?-1:(l.text>i.text)?1:0});return A},reactFormatSelectorChange:function(){var h=this.getFormatDialog()._formatSelector.getValue();this.updatePreview(h,this.getFormatDialog())},updatePreview:function(m,p){var l=p._previewTextArea;l.setValue("");if(m){var o=Kekule.IO.DataFormatsManager.getFormatInfo(m);var i=this.getTargetObj();var n=this.getChemObjSrcInfo(i);if(n&&n.format===m){l.setValue(n.data)}else{var h=this.getDisplayer().saveData(m,o.dataType,i);l.setValue(h);this.setCurrSaveData(h)}}},getTargetObj:function(h){return this.getDisplayer().getChemObj()},doUpdate:function($super){$super();var h=this.getDisplayer();this.setEnabled(h&&h.getEnabled()&&h.getChemObj()&&this._saveAction.getEnabled())},doExecute:function(o){var i=this;var m=this.getFormatDialog();var p=this.getDisplayer().getChemObj();var l=m._formatSelector;var h=this.getAvailableWriterInfos(p);var n=this.getFormatSelectorItems(p,h);l.setItems(n);this.reactFormatSelectorChange();m.openModal(function(r){if(r===Kekule.Widget.DialogButtons.OK){var t=i.getCurrSaveData();i._saveAction.setData(t);var u=m._formatSelector.getValue();i.setLastFormat(u);var q=Kekule.IO.DataFormatsManager.getFileExts(u);var s=q[0]||q;var v=e.S_DEF_SAVE_FILENAME+"."+s;i._saveAction.setFileName(v);i._saveAction.execute(o)}},o)}});Kekule.ChemWidget.ActionDisplayerReset=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerReset",HTML_CLASSNAME:f.ACTION_RESET,initialize:function($super,h){$super(h,e.CAPTION_RESETVIEW,e.HINT_RESETVIEW)},doExecute:function(){this.getDisplayer().resetDisplay()}});Kekule.ChemWidget.ActionDisplayerZoomIn=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomIn",HTML_CLASSNAME:f.ACTION_ZOOMIN,initialize:function($super,h){$super(h,e.CAPTION_ZOOMIN,e.HINT_ZOOMIN)},doExecute:function(){this.getDisplayer().zoomIn()}});Kekule.ChemWidget.ActionDisplayerZoomOut=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerZoomOut",HTML_CLASSNAME:f.ACTION_ZOOMOUT,initialize:function($super,h){$super(h,e.CAPTION_ZOOMOUT,e.HINT_ZOOMOUT)},doExecute:function(){this.getDisplayer().zoomOut()}});Kekule.ChemWidget.ActionDisplayerResetZoom=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerResetZoom",HTML_CLASSNAME:f.ACTION_RESETZOOM,initialize:function($super,h){$super(h,e.CAPTION_RESETZOOM,e.HINT_RESETZOOM)},doExecute:function(){this.getDisplayer().resetZoom()}});Kekule.ChemWidget.ActionDisplayerHideHydrogens=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerHideHydrogens",HTML_CLASSNAME:f.ACTION_MOL_HIDE_HYDROGENS,initialize:function($super,h){$super(h,e.CAPTION_HIDEHYDROGENS,e.HINT_HIDEHYDROGENS)},doUpdate:function($super){$super();var i=this.getDisplayer();var h=i&&(i.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(this.getDisplayed()&&h).setEnabled(this.getEnabled()&&h)},doExecute:function(){var h=!this.getChecked();this.setChecked(h);this.getDisplayer().setHideHydrogens(h)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase",initialize:function($super,i,h,m,l){$super(i,h,m);this._displayType=l},doExecute:function(){this.getDisplayer().setMoleculeDisplayType(this._displayType)},getMolDisplayType:function(){return this._displayType}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D",doUpdate:function($super){$super();var i=this.getDisplayer();var h=i&&(i.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(this.getDisplayed()&&h).setEnabled(this.getEnabled()&&h)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D",doUpdate:function($super){$super();var i=this.getDisplayer();var h=i&&(i.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(this.getDisplayed()&&h).setEnabled(this.getEnabled()&&h)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_SKELETAL,initialize:function($super,h){$super(h,e.CAPTION_SKELETAL,e.HINT_SKELETAL,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSkeletal.TYPE=Kekule.Render.Molecule2DDisplayType.SKELETAL;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_CONDENSED,initialize:function($super,h){$super(h,e.CAPTION_CONDENSED,e.HINT_CONDENSED,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeCondensed.TYPE=Kekule.Render.Molecule2DDisplayType.CONDENSED;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_WIRE,initialize:function($super,h){$super(h,e.CAPTION_WIRE,e.HINT_WIRE,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeWire.TYPE=Kekule.Render.Molecule3DDisplayType.WIRE;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_STICKS,initialize:function($super,h){$super(h,e.CAPTION_STICKS,e.HINT_STICKS,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSticks.TYPE=Kekule.Render.Molecule3DDisplayType.STICKS;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_BALLSTICK,initialize:function($super,h){$super(h,e.CAPTION_BALLSTICK,e.HINT_BALLSTICK,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBallStick.TYPE=Kekule.Render.Molecule3DDisplayType.BALL_STICK;Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill=Class.create(Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill",HTML_CLASSNAME:f.ACTION_MOL_DISPLAY_SPACEFILL,initialize:function($super,h){$super(h,e.CAPTION_SPACEFILL,e.HINT_SPACEFILL,Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE)}});Kekule.ChemWidget.ActionDisplayerChangeMolDisplayTypeSpaceFill.TYPE=Kekule.Render.Molecule3DDisplayType.SPACE_FILL})();(function(){var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEM_STRUCT_TREE_VIEW:"K-Chem-Struct-TreeView",CHEM_STRUCT_TREE_VIEW_ITEM_TITLE:"K-Chem-Struct-TreeView-ItemTitle",CHEM_STRUCT_TREE_VIEW_ITEM_TYPE:"K-Chem-Struct-TreeView-ItemType"});Kekule.ChemWidget.StructureTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setRootObj(c)},initProperties:function(){this.defineProp("rootObj",{dataType:"Kekule.ChemObject",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("rootObj");this.setPropStoreFieldValue("rootObj",c);this.rootObjChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.CHEM_STRUCT_TREE_VIEW},rootObjChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},_installRootEventHandler:function(b){b.addEventListener("change",this.reactChemObjChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("change",this.reactChemObjChange,this)},reactChemObjChange:function(d){if(this.getEnableLiveUpdate()){var c=d.target;var b=this.getObjMap().get(c);if(b){this._updateTreeItem(b,c)}}},_fillTree:function(b){if(b){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),b)}},_updateTreeItem:function(g,n){var m=this._getChemObjDisplayTitle(n);var e={text:m,obj:n};this.setItemData(g,e);this.getObjMap().set(n,g);var b=this.getChildItemCount(g);var d=n.getChildCount();for(var f=0;f<d;++f){var c=n.getChildAt(f);if(!c.isSelectable()){continue}var h;if(f<b){h=this.getChildItemAt(g,f)}else{h=this.appendChildItem(g)}this._updateTreeItem(h,c)}if(b>d){for(var f=b-1;f>=d;--f){this.removeChildItemAt(g,f)}}},_getChemObjDisplayTitle:function(h){var b="";var g=h.getId();if(g){b+='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TITLE+'">'+g+"</span>"}var f=h.getClassName();var e=f.split(".");var d=e.length?e[e.length-1]:f;var c='<span class="'+a.CHEM_STRUCT_TREE_VIEW_ITEM_TYPE+'">('+d+")</span>";return b+c},selectChemObjs:function(d){var c=[];for(var e=0,b=d.length;e<b;++e){var g=d[e];var f=this.getObjMap().get(g);if(f){c.push(f)}}this.select(c);return this},getSelectedChemObjs:function(){var b=[];var d=this.getSelection();if(d&&d.length){for(var e=0,c=d.length;e<c;++e){var f=this.getItemData(d[e]);if(f&&f.obj){b.push(f.obj)}}}return b}})})();(function(){var a=Kekule.oneOf;Kekule.ChemWidget.AbstractUIMarker=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.AbstractUIMarker",initialize:function($super){$super();this.setVisible(true)},initProperties:function(){this.defineProp("drawStyles",{dataType:DataType.OBJECT});this.defineProp("visible",{dataType:DataType.BOOL})}});Kekule.ChemWidget.MetaShapeUIMarker=Class.create(Kekule.ChemWidget.AbstractUIMarker,{CLASS_NAME:"Kekule.ChemWidget.MetaShapeUIMarker",initialize:function($super,b){$super();if(b){this.setShapeInfo(b)}},initProperties:function(){this.defineProp("shapeInfo",{dataType:DataType.OBJECT});this.defineProp("shapeType",{dataType:DataType.INT,serializable:false,setter:null,getter:function(){var b=this.getShapeInfo();return b?b.shapeType:null}})}});Kekule.ChemWidget.UiMarkerCollection=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.UiMarkerCollection",initProperties:function(){this.defineProp("markers",{dataType:DataType.ARRAY,getter:function(){var b=this.getPropStoreFieldValue("markers");if(!b){b=[];this.setPropStoreFieldValue("markers",b)}return b},setter:null})},getMarkerCount:function(){return this.getMarkers().length},getMarkerAt:function(b){return this.getMarkers()[b]},addMarker:function(b){return this.getMarkers().push(b)},indexOfMarker:function(b){return this.getMarkers().indexOf(b)},removeMarker:function(b){var d=this.getMarkers();var c=d.indexOf(b);if(c>=0){d.splice(c,1)}},clearMarkers:function(){this.setPropStoreFieldValue("markers",[])}});Kekule.ChemWidget.UiMarkersRenderer=Class.create(Kekule.Render.Base2DRenderer,{CLASS_NAME:"Kekule.ChemWidget.UiMarkersRenderer",DRAW_ELEM_FIELD:"__$drawElem__",initialize:function($super,b,c){$super(b,c);this._drawGroup=null},initProperties:function(){this.defineProp("dummy",{dataType:DataType.OBJECT,serializable:false})},getObjDrawElem:function(b,c){return this.getExtraProp2(b,c,this.DRAW_ELEM_FIELD)},setObjDrawElem:function(b,d,c){this.setExtraProp2(b,d,this.DRAW_ELEM_FIELD,c)},doEstimateRenderBox:function(d,e,c,b){return null},doDraw:function($super,c,d,b){$super(c,d,b);var f=this.getChemObj();var e=this.createDrawGroup(c);this.setObjDrawElem(c,f,e);if(f.getMarkerCount()>0){this.doDrawMarkers(c,e,f.getMarkers(),b)}return e},doUpdate:function($super,d,g,b){if(this.canModifyGraphic(d)){var e=false;var c=Kekule.Render.ObjectUpdateType;switch(b){case c.ADD:e=this.doAddNew(d,g);break;case c.MODIFY:e=this.doModify(d,g);break;case c.REMOVE:var f=this._extractObjsOfUpdateObjDetails(g);e=this.doRemove(d,f);break;default:return $super(d,g,b)}return e}else{return $super(d,updatedObjs,b)}},doAddNew:function(b,c){if(this.canRemoveElem()){return this.doModify(b,c)}else{return false}},doModify:function(b,g){if(this.canRemoveElem()){var e=this._extractObjsOfUpdateObjDetails(g);this.remove(b,e);var f=this.getChemObj();var c=this.getObjDrawElem(f);var d=this.getDrawParams();if(e.indexOf(f)>=0){this.draw(b,d.baseCoord,d.options)}else{this.doDrawMarkers(b,c,e,d.options)}}else{return false}},doRemove:function(b,d){if(this.canRemoveElem()){var c=this.getObjDrawElem(d);if(c){var e=this.getObjDrawElem(this.getChemObj());this.doRemoveFromGroup(c,e);this.doRemoveElem(b,c);this.setObjDrawElem(d,null)}}else{return false}},doDrawMarkers:function(f,g,h,d){for(var e=0,c=h.length;e<c;++e){var b=h[e];if(b.getVisible()){this.doDrawMarker(f,g,b,d)}}},doDrawMarker:function(b,h,f,n){var m=f.getShapeInfo();if(!m){return null}var c=Object.create(n);c=Object.extend(f.getDrawStyles()||{});if(c.color){if(!c.strokeColor){c.strokeColor=c.color}if(!c.fillColor){c.fillColor=c.color}}var o;if(Kekule.ArrayUtils.isArray(m)){if(m.length>1){o=this.createDrawGroup(b);for(var e=0,d=m.length;e<d;++e){var g=m[e];this.doDrawShape(b,o,g,c)}}else{if(m.length===1){o=this.doDrawShape(b,null,m[0],c)}else{return null}}}else{o=this.doDrawShape(b,null,m,c)}if(o){this.setObjDrawElem(b,f,o);if(h){this.addToDrawGroup(o,h)}}return o},doDrawShape:function(b,q,m,s){var f=Kekule.Render.MetaShapeType;var t;if(Kekule.Render.MetaShapeUtils.isCompositeShape(m)){t=this.createDrawGroup(b);for(var g=0,e=m.length;g<e;++g){var d=this.doDrawShape(b,t,m[g],s)}}else{var p=m.coords;switch(m.shapeType){case f.POINT:t=this.drawCircle(b,p[0],1,s);break;case f.CIRCLE:t=this.drawCircle(b,p[0],m.radius,s);break;case f.LINE:var c=s;if(m.width){c=Object.create(s);c.strokeWidth=m.width}t=this.drawLine(b,p[0],p[1],c);break;case f.RECT:t=this.drawRect(b,p[0],p[1],s);break;case f.POLYGON:var n=[];for(var g=0,e=p.length;g<e;++g){var h=(g===0)?"M":"L";n.push(h);var o=[p[g].x,p[g].y];n.push(o)}n.push("L");o=[p[0].x,p[0].y];n.push(o);var r=Kekule.Render.DrawPathUtils.makePath.apply(this,n);t=this.drawPath(b,r,s);break}}if(q){this.addToDrawGroup(t,q)}return t}});Kekule.ClassDefineUtils.addExtraTwoTupleObjMapSupport(Kekule.ChemWidget.UiMarkersRenderer);Kekule.Render.Renderer2DFactory.register(Kekule.ChemWidget.UiMarkerCollection,Kekule.ChemWidget.UiMarkersRenderer)})();(function(){var b=Class.PropertyScope;var l=Kekule.ZoomUtils;var c=Kekule.ChemWidget.ComponentWidgetNames;var i=Kekule.ChemWidget;var d=Kekule.ChemWidgetTexts;var e=Kekule.Widget.EvokeMode;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{VIEWER:"K-Chem-Viewer",VIEWER2D:"K-Chem-Viewer2D",VIEWER3D:"K-Chem-Viewer3D",VIEWER_ASSOC_EDITOR:"K-Chem-Viewer-Assoc-Editor",VIEWER_CAPTION:"K-Chem-Viewer-Caption",ACTION_ROTATE_LEFT:"K-Chem-RotateLeft",ACTION_ROTATE_RIGHT:"K-Chem-RotateRight",ACTION_ROTATE_X:"K-Chem-RotateX",ACTION_ROTATE_Y:"K-Chem-RotateY",ACTION_ROTATE_Z:"K-Chem-RotateZ",ACTION_VIEWER_EDIT:"K-Chem-Viewer-Edit"});var g=Kekule.Widget.HtmlClassNames;var a=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.Viewer=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.ChemWidget.Viewer",BINDABLE_TAG_NAMES:["div","span","img"],DEF_TOOLBAR_EVOKE_MODES:[e.EVOKEE_CLICK,e.EVOKEE_MOUSE_ENTER,e.EVOKEE_TOUCH],DEF_TOOLBAR_REVOKE_MODES:[e.EVOKEE_MOUSE_LEAVE,e.EVOKER_TIMEOUT],initialize:function($super,m,p,o,n){this.setPropStoreFieldValue("renderType",o||Kekule.Render.RendererType.R2D);this.setPropStoreFieldValue("enableToolbar",false);this.setPropStoreFieldValue("toolbarEvokeModes",this.DEF_TOOLBAR_EVOKE_MODES);this.setPropStoreFieldValue("toolbarRevokeModes",this.DEF_TOOLBAR_REVOKE_MODES);this.setPropStoreFieldValue("enableDirectInteraction",true);this.setPropStoreFieldValue("enableTouchInteraction",false);this.setPropStoreFieldValue("toolbarPos",Kekule.Widget.Position.AUTO);this.setPropStoreFieldValue("toolbarMarginHorizontal",10);this.setPropStoreFieldValue("toolbarMarginVertical",10);$super(m,p,o,n);this.setPadding(this.getRenderConfigs().getLengthConfigs().getActualLength("autofitContextPadding"));this.setUseCornerDecoration(true);this._isContinuousRepainting=false;this.setModalEdit(true);this.addIaController("default",new Kekule.ChemWidget.ViewerBasicInteractionController(this),true)},doFinalize:function($super){var m=this.getToolbar();if(m){m.finalize()}$super()},initProperties:function(){this.defineProp("viewerConfigs",{dataType:"Kekule.ChemWidget.ChemObjDisplayerConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(m){return this.setDisplayerConfigs(m)}});this.defineProp("allowedMolDisplayTypes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(m){this.setPropStoreFieldValue("allowedMolDisplayTypes",m);this.updateToolbar()}});this.defineProp("enableEdit",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableEdit")&&(this.getCoordMode()!==Kekule.CoordMode.COORD3D)}});this.defineProp("modalEdit",{dataType:DataType.BOOL});this.defineProp("toolButtons",{dataType:DataType.HASH,serializable:false,scope:b.PUBLIC,getter:function(){var m=this.getPropStoreFieldValue("toolButtons");if(!m){m=this.getDefaultToolBarButtons();this.setPropStoreFieldValue("toolButtons",m)}return m},setter:function(m){this.setPropStoreFieldValue("toolButtons",m);this.updateToolbar()}});this.defineProp("toolButtonNameMapping",{dataType:DataType.HASH,serializable:false,scope:b.PRIVATE,setter:null,getter:function(){var m=this.getPropStoreFieldValue("toolButtonNameMapping");if(!m){m=this.createDefaultToolButtonNameMapping();this.setPropStoreFieldValue("toolButtonNameMapping",m)}return m}});this.defineProp("toolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,scope:b.PRIVATE,setter:function(p){var n=this.getToolbar();var m=this.getToolbarEvokeHelper();if(p!==n){if(n){n.finalize();var o=this.getToolbarEvokeHelper();if(o){o.finalize()}n=null}if(m){m.finalize()}this.setPropStoreFieldValue("toolbar",p);if(p){this.setPropStoreFieldValue("toolbarEvokeHelper",new Kekule.Widget.DynamicEvokeHelper(this,p,this.getToolbarEvokeModes(),this.getToolbarRevokeModes()))}}}});this.defineProp("enableToolbar",{dataType:DataType.BOOL,setter:function(m){this.setPropStoreFieldValue("enableToolbar",m);this.updateToolbar()}});this.defineProp("toolbarPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(m){this.setPropStoreFieldValue("toolbarPos",m);this.adjustToolbarPos()}});this.defineProp("toolbarMarginVertical",{dataType:DataType.INT,setter:function(m){this.setPropStoreFieldValue("toolbarMarginVertical",m);this.adjustToolbarPos()}});this.defineProp("toolbarMarginHorizontal",{dataType:DataType.INT,setter:function(m){this.setPropStoreFieldValue("toolbarMarginHorizontal",m);this.adjustToolbarPos()}});this.defineProp("toolbarEvokeHelper",{dataType:"Kekule.Widget.DynamicEvokeHelper",serializable:false,setter:null,scope:b.PRIVATE});this.defineProp("toolbarEvokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(m){this.setPropStoreFieldValue("toolbarEvokeModes",m||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setEvokeModes(m||[])}}});this.defineProp("toolbarRevokeModes",{dataType:DataType.ARRAY,scope:b.PUBLIC,setter:function(m){this.setPropStoreFieldValue("toolbarRevokeModes",m||[]);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setRevokeModes(m||[])}}});this.defineProp("toolbarRevokeTimeout",{dataType:DataType.INT,setter:function(m){this.setPropStoreFieldValue("toolbarRevokeTimeout",m);if(this.getToolbarEvokeHelper()){this.getToolbarEvokeHelper().setTimeout(m)}}});this.defineProp("actions",{dataType:"Kekule.ActionList",serializable:false,scope:b.PUBLIC,setter:null,getter:function(){var m=this.getPropStoreFieldValue("actions");if(!m){m=new Kekule.ActionList();this.setPropStoreFieldValue("actions",m)}return m}});this.defineProp("enableDirectInteraction",{dataType:DataType.BOOL});this.defineProp("enableTouchInteraction",{dataType:DataType.BOOL})},doObjectChange:function($super,m){$super(m);this.updateActions()},doSetElement:function($super,n){var o=n;if(o){var m=o.tagName.toLowerCase();if(m==="img"){o=Kekule.DomUtils.replaceTagName(o,"span")}}return $super(o)},doUnbindElement:function($super,m){if(this._drawContextParentElem&&this._drawContextParentElem.parentNode){this._drawContextParentElem.parentNode.removeChild(this._drawContextParentElem);this._drawContextParentElem=null}return $super(m)},doCreateRootElement:function(n){var m=n.createElement("div");return m},doGetWidgetClassName:function($super){var n=$super()+" "+a.VIEWER;var m=(this.getRenderType()===Kekule.Render.RendererType.R3D)?a.VIEWER3D:a.VIEWER2D;n+=" "+m;return n},doResize:function($super){$super();this.adjustToolbarPos()},doWidgetShowStateChanged:function(m){if(m){this.updateActions()}},refitDrawContext:function($super,m){$super(m);this.adjustToolbarPos()},doLoadEnd:function(m){this.updateActions()},openEditor:function(m){if(this.getEnableEdit()&&this.getChemObj()){var q=this.createEditorWidget();if(q){q.addClassName(a.VIEWER_ASSOC_EDITOR);var s=this.getChemObj();var o=s.clone();q.setChemObj(o);var p=new Kekule.Widget.Dialog(this.getDocument(),d.CAPTION_EDIT_OBJ,[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);q.appendToWidget(p);var n=this;var r=function(t){if(t===Kekule.Widget.DialogButtons.OK&&q.isDirty()){s.assign(o);s.setSrcInfo(null);n.setChemObj(s)}q.finalize();p.finalize()};if(this.getModalEdit()){p.openModal(r,m||this)}else{p.openPopup(r,m||this)}}}},createEditorWidget:function(){var m=new Kekule.Editor.Composer(this.getDocument());var n=m.getEditor();n.setEnableCreateNewDoc(false);n.setEnableLoadNewFile(false);n.setAllowCreateNewChild(false);n.addClassName(g.DYN_CREATED);return m},resetView:function(){return this.resetDisplay()},getCurr2DRotationAngle:function(){return this.getDrawOptions().rotateAngle||0},rotate2DBy:function(n,m){return this.rotate2DTo(this.getCurr2DRotationAngle()+n,m)},rotate2DTo:function(n,m){this.getDrawOptions().rotateAngle=n;if(!m){this.geometryOptionChanged()}return this},getCurr3DRotationInfo:function(){var n={};var m=["rotateMatrix","rotateX","rotateY","rotateZ","rotateAngle"];var q=this.getDrawOptions();for(var p=0,o=m.length;p<o;++p){var r=m[p];n[r]=q[r]||0}n.rotateAxisVector=q.rotateAxisVector||null;return n},setRotate3DMatrix:function(m,n){this.getDrawOptions().rotateMatrix=m;if(!n){this.geometryOptionChanged()}return this},rotate3DBy:function(n,m,t,q){var r=this.getCurr3DRotationInfo();var s=r.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var p=Kekule.CoordUtils.calcRotate3DMatrix({rotateX:n,rotateY:m,rotateZ:t});var o=Kekule.MatrixUtils.multiply(p,s);this.setRotate3DMatrix(o,q);return this},rotate3DByAxis:function(s,q,o){var p=this.getCurr3DRotationInfo();var r=p.rotateMatrix||Kekule.MatrixUtils.createIdentity(4);var n=Kekule.CoordUtils.calcRotate3DMatrix({rotateAngle:s,rotateAxisVector:q});var m=Kekule.MatrixUtils.multiply(n,r);this.setRotate3DMatrix(m,o);return this},getDefaultToolBarButtons:function(){var m=[c.loadData,c.saveFile,c.molDisplayType,c.molHideHydrogens,c.zoomIn,c.zoomOut,];if(this.getRenderType()===Kekule.Render.RendererType.R3D){m=m.concat([c.rotateX,c.rotateY,c.rotateZ])}else{m=m.concat([c.rotateLeft,c.rotateRight])}m.push(c.reset);m.push(c.openEditor);m.push(c.config);return m},createDefaultToolButtonNameMapping:function(){var m={};m[c.loadFile]=i.ActionDisplayerLoadFile;m[c.loadData]=i.ActionDisplayerLoadData;m[c.saveFile]=i.ActionDisplayerSaveFile;m[c.zoomIn]=i.ActionDisplayerZoomIn;m[c.zoomOut]=i.ActionDisplayerZoomOut;m[c.rotateLeft]=i.ActionViewerRotateLeft;m[c.rotateRight]=i.ActionViewerRotateRight;m[c.rotateX]=i.ActionViewerRotateX;m[c.rotateY]=i.ActionViewerRotateY;m[c.rotateZ]=i.ActionViewerRotateZ;m[c.reset]=i.ActionDisplayerReset;m[c.molHideHydrogens]=i.ActionDisplayerHideHydrogens;m[c.openEditor]=i.ActionViewerEdit;m[c.config]=Kekule.Widget.ActionOpenConfigWidget;return m},adjustToolbarPos:function(){var y=this.getToolbar();if(y){var p=Kekule.Widget.Position;var u=this.getBoundingClientRect();var s=y.getBoundingClientRect();var x=this.getToolbarPos();var m=this.getToolbarMarginHorizontal();var t=this.getToolbarMarginVertical();var n="left",w="top";var o="right",r="bottom";var v=(u.width-s.width)/2;var z=(u.height-s.height)/2;if(x===p.AUTO||!x){var q=((m>0)?m:0)*2+s.width;var A=((t>0)?t:0)*2+s.height;if(q>u.width){x|=p.LEFT;m=0}else{x|=p.RIGHT}if(A>u.height){x|=p.BOTTOM;t=-1}else{x|=p.BOTTOM}}if(x&p.LEFT){n="left";o="right";v=(m>=0)?m:m-s.width}else{if(x&p.RIGHT){n="right";o="left";v=(m>=0)?m:m-s.width}}if(x&p.TOP){w="top";r="bottom";z=(t>=0)?t:t-s.height}else{if(x&p.BOTTOM){w="bottom";r="top";z=(t>=0)?t:t-s.height}}y.removeStyleProperty(o);y.removeStyleProperty(r);y.setStyleProperty(n,v+"px");y.setStyleProperty(w,z+"px")}},updateToolbar:function(){if(this.getEnableToolbar()){this.createToolbar();this.adjustToolbarPos()}else{this.setToolbar(null)}},updateActions:function(){if(this.getActions()){this.getActions().updateAll()}},getToolButtonActionClass:function(m){return this.getToolButtonNameMapping()[m]},createToolbar:function(){this.getActions().clear();var n=new Kekule.Widget.ButtonGroup(this);n.addClassName(g.DYN_CREATED);n.setDisplayed(false);var r=this.getToolButtons();for(var q=0,m=r.length;q<m;++q){var o=r[q];var p=this.createToolButton(o,n)}n.addClassName(a.INNER_TOOLBAR);n.setShowText(false);n.doSetShowGlyph(true);n.appendToElem(this.getElement());this.setToolbar(n);return n},createToolButton:function(t,s){var u=null;var p=this.beginContinuousRepainting.bind(this);var n=this.endContinuousRepainting.bind(this);var q=[c.rotateX,c.rotateY,c.rotateZ,c.rotateLeft,c.rotateRight];if(t===c.molDisplayType){this.createMolDisplayTypeButton(s)}var r=this.getToolButtonActionClass(t);var m=Kekule.Widget.Button;if(t===c.molHideHydrogens){m=Kekule.Widget.CheckButton}if(r){u=new m(s);var o=new r(this);this.getActions().add(o);u.setAction(o);if(q.indexOf(t)>=0){u.setPeriodicalExecInterval(20);u.setEnablePeriodicalExec(true);u.addEventListener("activate",p);u.addEventListener("deactivate",n)}}return u},createMolDisplayTypeButton:function(t){var v=new Kekule.Widget.CompactButtonSet(t);v.getButtonSet().addClassName(a.INNER_TOOLBAR);v.setShowText(false);var o=new Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub(this);v.setAction(o);this.getActions().add(o);var u=this.getDocument();var s=(this.getRenderType()===Kekule.Render.RendererType.R3D)?i.Viewer.molDisplayType3DActionClasses:i.Viewer.molDisplayType2DActionClasses;var r=this.getAllowedMolDisplayTypes();for(var q=0,n=s.length;q<n;++q){var p=s[q].TYPE;if(r&&(r.indexOf(p)<0)&&(p!==this.getCurrMoleculeDisplayType())){continue}var m=new Kekule.Widget.RadioButton(u);o=new s[q](this);this.getActions().add(o);m.setAction(o);v.append(m,p===this.getCurrMoleculeDisplayType())}return v}});var h=Kekule.X.Event;Kekule.ChemWidget.ViewerBasicInteractionController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.ChemWidget.ViewerBasicInteractionController",initialize:function($super,m){$super(m);this._enableMouseRotate=true;this._transformInfo={isTransforming:false,lastCoord:null,lastZoom:null}},initProperties:function(){this.defineProp("viewer",{dataType:"Kekule.ChemWidget.Viewer",serializable:false,getter:function(){return this.getWidget()},setter:function(m){this.setWidget(m)}})},getViewerRenderType:function(){return this.getViewer().getRenderType()},getEnableInteraction:function(){var n=this.getViewer();var m=!!(n&&n.getEnableDirectInteraction()&&n.getChemObjLoaded());return m},getEnableTouchInteraction:function(){var n=this.getViewer();var m=!!(n&&n.getEnableDirectInteraction()&&n.getEnableTouchInteraction()&&n.getChemObjLoaded());return m},_initTransform:function(){var o=this.getViewer();var m=Math.min(o.getOffsetWidth(),o.getOffsetHeight());var n=this._transformInfo;n.angleRatio=1/m*Math.PI},zoomViewer:function(n){var m=this.getViewer();if(!m||!m.getChemObj()){return}if(n>0){if(m.zoomIn){m.zoomIn(n)}}else{if(n<0){if(m.zoomOut){m.zoomOut(-n)}}}},react_mousewheel:function(m){if(this.getEnableInteraction()){var n=m.wheelDeltaY||m.wheelDelta;if(n){n/=120}this.zoomViewer(n);m.preventDefault();return true}},react_mousedown:function(n){if(!this.getEnableInteraction()){return}if(n.getButton()===h.MouseButton.LEFT){var o=this.getViewer();if(o&&o.getChemObj()){var m=this._transformInfo;m.isTransforming=true;m.lastCoord={x:n.getScreenX(),y:n.getScreenY()};this._initTransform()}}},react_mouseleave:function(m){this._transformInfo.isTransforming=false},react_mouseup:function(m){if(m.getButton()===h.MouseButton.LEFT){this._transformInfo.isTransforming=false}},react_mousemove:function(m){if(!this.getEnableInteraction()){return}if(this.getViewerRenderType()===Kekule.Render.RendererType.R3D){this.rotateByXYDistance(m.getScreenX(),m.getScreenY())}else{this.moveByXYDistance(m.getScreenX(),m.getScreenY())}},moveByXYDistance:function(o,n){var q=this._transformInfo;if(q&&q.isTransforming&&(!q.calculating)){var r=this.getViewer();if(r.getRenderType()===Kekule.Render.RendererType.R3D){return}q.calculating=true;try{var p={x:o,y:n};var s=Kekule.CoordUtils.substract(p,q.lastCoord);var m=r.getBaseCoordOffset()||{};m=Kekule.CoordUtils.add(m,s);r.setBaseCoordOffset(m);q.lastCoord=p}finally{q.calculating=false}}},rotateByXYDistance:function(o,n){var p=this._transformInfo;if(p&&p.isTransforming&&(!p.calculating)){var s=this.getViewer();if(s.getRenderType()!==Kekule.Render.RendererType.R3D){return}p.calculating=true;try{var m={x:o,y:n};var v=Kekule.CoordUtils.substract(m,p.lastCoord);v.y=-v.y;var q=Kekule.CoordUtils.getDistance({x:0,y:0},v);var r=q*p.angleRatio;var u={x:-v.y,y:v.x,z:0};s.rotate3DByAxis(r,u);p.lastCoord=m;p.calculating=false}catch(t){}finally{p.calculating=false}}},react_transformstart:function(n){if(!this.getEnableTouchInteraction()){return}var o=this.getViewer();if(o){var m=this._transformInfo;m.isTransforming=true;m.lastZoom=o.getCurrZoom();m.lastCoord={x:0,y:0};this._initTransform()}},react_transformend:function(m){if(!this.getEnableTouchInteraction()){return}this._transformInfo.isTransforming=false},react_transform:function(q){if(!this.getEnableTouchInteraction()){return}var s=this.getViewer();var p=this._transformInfo;if(s&&p.isTransforming&&(!p.calculating)){try{var o=q.gesture;if(o){var r=q.gesture.scale;s.zoomTo((p.lastZoom||1)*r,true);var n=o.deltaX;var m=o.deltaY;this.rotateByXYDistance(n,m);q.gesture.preventDefault();q.gesture.stopPropagation()}}finally{}}},doTestMouseCursor:function(p,o){var m="";var n=this._transformInfo;if(n.isTransforming){m="move"}return m}});Kekule.ChemWidget.Viewer2D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer2D",initialize:function($super,m,n){$super(m,n,Kekule.Render.RendererType.R2D)}});Kekule.ChemWidget.Viewer3D=Class.create(Kekule.ChemWidget.Viewer,{CLASS_NAME:"Kekule.ChemWidget.Viewer3D",initialize:function($super,m,n){$super(m,n,Kekule.Render.RendererType.R3D)}});var f=Kekule.ObjPropSettingManager;f.register("Kekule.ChemWidget.Viewer.fullFunc",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:true,enableEdit:true,toolButtons:null});f.register("Kekule.ChemWidget.Viewer.basic",{enableToolbar:true,enableDirectInteraction:true,enableTouchInteraction:false,toolButtons:[c.saveFile,c.molDisplayType,c.zoomIn,c.zoomOut]});f.register("Kekule.ChemWidget.Viewer.static",{enableToolbar:false,enableDirectInteraction:false,enableTouchInteraction:false,toolButtons:[]});Kekule.ChemWidget.Viewer.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.ChemWidget.Viewer.Settings",initProperties:function(){this.defineDelegatedProps(["enableDirectInteraction","enableTouchInteraction","enableToolbar","toolbarPos","toolbarMarginHorizontal","toolbarMarginVertical","enableEdit","modalEdit"])},getViewer:function(){return this.getWidget()}});Kekule.ChemWidget.ActionOnViewer=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionOnViewer",initialize:function($super,o,m,n){$super(o,m,n)},doUpdate:function(){var m=this.getDisplayer();this.setEnabled(m&&m.getChemObj()&&m.getChemObjLoaded()&&m.getEnabled())},getViewer:function(){var m=this.getDisplayer();return(m instanceof Kekule.ChemWidget.Viewer)?m:null}});Kekule.ChemWidget.ActionViewerRotateBase=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase",initialize:function($super,o,m,n){$super(o,m,n);this.setDelta(2*Math.PI/180)},initProperties:function(){this.defineProp("delta",{dataType:DataType.FLOAT})}});Kekule.ChemWidget.ActionViewerRotateBase2D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase2D",doUpdate:function($super){$super();var n=this.getViewer();var m=n&&(n.getRenderType()===Kekule.Render.RendererType.R2D);this.setDisplayed(this.getDisplayed()&&m).setEnabled(this.getEnabled()&&m)}});Kekule.ChemWidget.ActionViewerRotateBase3D=Class.create(Kekule.ChemWidget.ActionViewerRotateBase,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateBase3D",doUpdate:function($super){$super();var n=this.getViewer();var m=n&&(n.getRenderType()===Kekule.Render.RendererType.R3D);this.setDisplayed(this.getDisplayed()&&m).setEnabled(this.getEnabled()&&m)}});Kekule.ChemWidget.ActionViewerRotateLeft=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateLeft",HTML_CLASSNAME:a.ACTION_ROTATE_LEFT,initialize:function($super,m){$super(m,d.CAPTION_ROTATELEFT,d.HINT_ROTATELEFT)},doExecute:function(){this.getViewer().rotate2DBy(this.getDelta())}});Kekule.ChemWidget.ActionViewerRotateRight=Class.create(Kekule.ChemWidget.ActionViewerRotateBase2D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateRight",HTML_CLASSNAME:a.ACTION_ROTATE_RIGHT,initialize:function($super,m){$super(m,d.CAPTION_ROTATERIGHT,d.HINT_ROTATERIGHT)},doExecute:function(){this.getViewer().rotate2DBy(-this.getDelta())}});Kekule.ChemWidget.ActionViewerRotateX=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateX",HTML_CLASSNAME:a.ACTION_ROTATE_X,initialize:function($super,m){$super(m,d.CAPTION_ROTATEX,d.HINT_ROTATEX)},doExecute:function(){this.getViewer().rotate3DBy(-this.getDelta(),0,0)}});Kekule.ChemWidget.ActionViewerRotateY=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateY",HTML_CLASSNAME:a.ACTION_ROTATE_Y,initialize:function($super,m){$super(m,d.CAPTION_ROTATEY,d.HINT_ROTATEY)},doExecute:function(){this.getViewer().rotate3DBy(0,-this.getDelta(),0)}});Kekule.ChemWidget.ActionViewerRotateZ=Class.create(Kekule.ChemWidget.ActionViewerRotateBase3D,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerRotateZ",HTML_CLASSNAME:a.ACTION_ROTATE_Z,initialize:function($super,m){$super(m,d.CAPTION_ROTATEZ,d.HINT_ROTATEZ)},doExecute:function(){this.getViewer().rotate3DBy(0,0,-this.getDelta())}});Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerChangeMolDisplayTypeStub",initialize:function($super,m){$super(m,d.CAPTION_MOL_DISPLAY_TYPE,d.HINT_MOL_DISPLAY_TYPE)},doExecute:function(m){}});Kekule.ChemWidget.ActionViewerEdit=Class.create(Kekule.ChemWidget.ActionOnViewer,{CLASS_NAME:"Kekule.ChemWidget.ActionViewerEdit",HTML_CLASSNAME:a.ACTION_VIEWER_EDIT,initialize:function($super,m){$super(m,d.CAPTION_OPENEDITOR,d.HINT_OPENEDITOR)},doUpdate:function($super){$super();var m=this.getViewer();this.setEnabled(this.getEnabled()&&m.getChemObj()&&m.getEnableEdit());this.setDisplayed(m.getEnableEdit())},doExecute:function(m){var n=this.getViewer();n.openEditor(m)}});Kekule.ChemWidget.Viewer.rotate2DActionClasses=[i.ActionViewerRotateLeft,i.ActionViewerRotateRight];Kekule.ChemWidget.Viewer.rotate3DActionClasses=[i.ActionViewerRotateX,i.ActionViewerRotateY,i.ActionViewerRotateZ];Kekule.ChemWidget.Viewer.molDisplayType2DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeSkeletal,i.ActionDisplayerChangeMolDisplayTypeCondensed];Kekule.ChemWidget.Viewer.molDisplayType3DActionClasses=[i.ActionDisplayerChangeMolDisplayTypeWire,i.ActionDisplayerChangeMolDisplayTypeSticks,i.ActionDisplayerChangeMolDisplayTypeBallStick,i.ActionDisplayerChangeMolDisplayTypeSpaceFill]})();(function(){var a=Kekule;var b=Kekule.CoordMode;ClassEx.extend(Kekule.ChemObject,{isStandalone:function(){return true},getStandaloneAncestor:function(){var c=this;while(c.isStandalone&&(!c.isStandalone())&&c.getParent&&c.getParent()){c=c.getParent()}return c},getCascadeDeleteObjs:function(){return[]},cascadeRemove:function(d){var c=this.getParent();if(c&&c.notifyBeforeCascadeRemove){c.notifyBeforeCascadeRemove(this)}if(d){this.finalize()}else{this.removeSelf()}if(c&&c.notifyAfterCascadeRemove){c.notifyAfterCascadeRemove(this)}},notifyBeforeCascadeRemove:function(c,d){},notifyAfterCascadeRemove:function(c,d){if((!this.getKeepEmptyEvenOnCascadeRemove())&&this.isEmpty()){this.cascadeRemove(d)}},getAllContainingConnectors:function(){return[]},transformAbsCoordByMatrix:function(g,m,f,o,d,r){if(this.getChildCount&&(o||Kekule.ObjUtils.isUnset(o))){for(var h=0,e=this.getChildCount();h<e;++h){var c=this.getChildAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(m,m,f,o,d,true)}}}var q=(f===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.transform3DByMatrix:Kekule.CoordUtils.transform2DByMatrix;if(r){if(this.getCoordOfMode&&this.setCoordOfMode){var n=this.getCoordOfMode(f,d);var p=q(n,g);this.setCoordOfMode(p,f)}}else{if(this.getAbsCoordOfMode&&this.setAbsCoordOfMode){var n=this.getAbsCoordOfMode(f,d);var p=q(n,g);this.setAbsCoordOfMode(p,f)}}},scaleSize:function(e,g,n,d){if(this.getSizeOfMode&&this.setSizeOfMode){var o=this.getSizeOfMode(g,d);var m=Kekule.CoordUtils.multiply(o,e);this.setSizeOfMode(m,g)}if(this.getChildCount&&(n||Kekule.ObjUtils.isUnset(n))){for(var h=0,f=this.getChildCount();h<f;++h){var c=this.getChildAt(h);if(c&&c.scaleSize){c.scaleSize(e,g,n,d)}}}}});ClassEx.defineProps(Kekule.ChemObject,[{name:"keepEmptyEvenOnCascadeRemove",dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC}]);ClassEx.extend(Kekule.ChemStructureObject,{getCascadeDeleteObjs:function($super){var c=$super();var h=this.getLinkedConnectors?this.getLinkedConnectors():[];for(var g=0,e=h.length;g<e;++g){var d=h[g];if(d.getConnectedObjs().length<=2){Kekule.ArrayUtils.pushUnique(c,d);var f=d.getCascadeDeleteObjs();Kekule.ArrayUtils.pushUnique(c,f)}}return c},isStandalone:function(){return false},isCoordDependent:function(){return false},getCoordDependentObjects:function(){return[this]},getCoordDeterminateObjects:function(){return this.getLinkedConnectors()}});ClassEx.extend(Kekule.BaseStructureNode,{getCascadeDeleteObjs:function($super){return $super()},isCoordDependent:function(){return false},move:function(f,e){var d=this.getCoordOfMode(e);var c=Kekule.CoordUtils.add(d,f);this.setCoordOfMode(c,e);return c},move2D:function(c){return this.move(c,b.COORD2D)},move3D:function(c){return this.move(c,b.COORD3D)}});ClassEx.extend(Kekule.BaseStructureConnector,{getCascadeDeleteObjs:function($super){var c=$super();var g=this.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f instanceof Kekule.BaseStructureNode){if(f.getLinkedConnectors().length<=1){Kekule.ArrayUtils.pushUnique(c,f)}}}return c},isCoordDependent:function(){return true},getCoordDependentObjects:function(){var c=[];var g=this.getConnectedObjs();for(var e=0,d=g.length;e<d;++e){var f=g[e];if(f.isExposed){if(f.isExposed()){c.push(f)}else{c.push(f.getExposedAncestor())}}else{c.push(f)}}return c},move:function(g,e){for(var d=0,c=this.getConnectedObjCount();d<c;++d){var f=this.getConnectedObjAt(d);if(f.move){f.move(g,e)}}},move2D:function(c){return this.move(c,b.COORD2D)},move3D:function(c){return this.move(c,b.COORD3D)},setAbsBaseCoord:function(e,d){var c=this.getAbsBaseCoord();var f=Kekule.CoordUtils.substract(e,c);this.move(f,d)},setAbsBaseCoord2D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD2D)},setAbsBaseCoord3D:function(c){this.setAbsCoordOfMode(c,Kekule.CoordMode.COORD3D)}});ClassEx.extend(Kekule.Glyph.PathGlyphNode,{getCascadeDeleteObjs:function($super){var c=[this.getParent()];return c}});ClassEx.extend(Kekule.Glyph.PathGlyphConnector,{getCascadeDeleteObjs:function($super){var c=[this.getParent()];return c}});ClassEx.extend(Kekule.StructureFragment,{isStandalone:function(){return !this.getCrossConnectors().length},notifyBeforeCascadeRemove:function($super,e,g){var c=this._getObjsNeedToBeCascadeRemoved(e);if(c&&c.length){for(var d=c.length-1;d>=0;--d){var f=c[d];if(g){f.finalize()}else{f.removeSelf()}}}$super(e,g)},getCoordDependentObjects:function(){if(this.isExpanded&&!this.isExpanded()){return[this]}else{if(!this.hasCtab()){return[this]}else{var c=[];var d=this.getNodeCount();for(var e=0;e<d;++e){var f=this.getNodeAt(e);c.push(f)}return c}}},transformAbsCoordByMatrix:function($super,g,m,f,n,d,o){if(n||Kekule.ObjUtils.isUnset(n)){for(var h=0,e=this.getNodeCount();h<e;++h){var c=this.getNodeAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(m,m,f,n,d,true)}}}$super(g,m,f,false,d,o)}});ClassEx.extend(Kekule.Glyph.Base,{isStandalone:function(){return true}});ClassEx.extend(Kekule.Glyph.PathGlyph,{getCoordDependentObjects:function(){var c=[];var d=this.getNodeCount();for(var e=0;e<d;++e){var f=this.getNodeAt(e);c.push(f)}return c},transformAbsCoordByMatrix:function($super,g,m,f,n,d,o){if(n||Kekule.ObjUtils.isUnset(n)){for(var h=0,e=this.getNodeCount();h<e;++h){var c=this.getNodeAt(h);if(c&&c.transformAbsCoordByMatrix){c.transformAbsCoordByMatrix(m,m,f,n,d,true)}}}$super(g,m,f,false,d,o)}})})();(function(){var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var d=Kekule.ChemWidget.HtmlClassNames;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{EDITOR:"K-Chem-Editor",EDITOR_CLIENT:"K-Chem-Editor-Client",EDITOR_UIEVENT_RECEIVER:"K-Chem-Editor-UiEvent-Receiver",EDITOR2D:"K-Chem-Editor2D",EDITOR3D:"K-Chem-Editor3D"});Kekule.ChemWidget.Editor={};Kekule.Editor=Kekule.ChemWidget.Editor;Kekule.Editor.CoordSys=Kekule.Render.CoordSystem;Kekule.Editor.BoxRegion={OUTSIDE:0,CORNER_TL:1,CORNER_TR:2,CORNER_BL:3,CORNER_BR:4,EDGE_TOP:11,EDGE_LEFT:12,EDGE_BOTTOM:13,EDGE_RIGHT:14,INSIDE:20};Kekule.Editor.BaseEditor=Class.create(Kekule.ChemWidget.ChemObjDisplayer,{CLASS_NAME:"Kekule.Editor.BaseEditor",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,h,g,f){this._objSelectFlag=0;this._objectUpdateFlag=0;this._uiMarkerUpdateFlag=0;this._updatedObjectDetails=[];this._operatingObjs=[];this._operatingRenderers=[];this._initialRenderTransformParams=null;this._objChanged=false;this.setPropStoreFieldValue("enableCreateNewDoc",true);this.setPropStoreFieldValue("enableOperHistory",true);this.setPropStoreFieldValue("enableOperContext",true);this.setPropStoreFieldValue("initOnNewDoc",true);$super(e,h,g);if(!h&&this.getInitOnNewDoc()&&this.getEnableCreateNewDoc()){this.newDoc()}this.setPropStoreFieldValue("editorConfigs",f||this.createDefaultConfigs())},initProperties:function(){this.defineProp("editorConfigs",{dataType:"Kekule.Editor.BaseEditorConfigs",serializable:false,getter:function(){return this.getDisplayerConfigs()},setter:function(e){return this.setDisplayerConfigs(e)}});this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,getter:function(){var e=this.getPropStoreFieldValue("operHistory");if(!e){e=new Kekule.OperationHistory();this.setPropStoreFieldValue("operHistory",e);e.addEventListener("push",this.reactOperHistoryPush,this);e.addEventListener("pop",this.reactOperHistoryPop,this);e.addEventListener("undo",this.reactOperHistoryUndo,this);e.addEventListener("redo",this.reactOperHistoryRedo,this);e.addEventListener("clear",this.reactOperHistoryClear,this);e.addEventListener("change",this.reactOperHistoryChange,this)}return e},setter:null});this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,getter:function(){var e=this.getPropStoreFieldValue("selection");if(!e){e=[];this.setPropStoreFieldValue("selection",e)}return e},setter:function(e){this.setPropStoreFieldValue("selection",e);this.selectionChanged()}});this.defineProp("hotTrackedObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(m){var n=m?Kekule.ArrayUtils.toArray(m):[];if(this.getEditorConfigs()&&this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setPropStoreFieldValue("hotTrackedObjs",n);var h;if(n&&n.length){h=[];for(var f=0,e=n.length;f<e;++f){var g=this.getBoundInfoRecorder().getBound(this.getObjContext(),n[f]);if(h){Kekule.ArrayUtils.pushUnique(h,g)}}}if(h){this.changeHotTrackMarkerBounds(h)}else{if(this.getUiHotTrackMarker().getVisible()){this.hideHotTrackMarker()}}}}});this.defineProp("hotTrackedObj",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getHotTrackedObjs()&&this.getHotTrackedObjs()[0]},setter:function(e){this.setHotTrackedObjs(e)}});this.defineProp("enableOperContext",{dataType:DataType.BOOL,setter:function(g){this.setPropStoreFieldValue("enableOperContext",!!g);if(!g){var f=this.getPropStoreFieldValue("operContext");var e=this.getPropStoreFieldValue("drawBridge");if(e&&f){e.releaseContext(f)}}}});this.defineProp("uiEventReceiverElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("operContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("uiContextParentElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("objContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawContext()}});this.defineProp("operContext",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){if(!this.getEnableOperContext()){return null}else{var e=this.getPropStoreFieldValue("operContext");if(!e){var h=this.getDrawBridge();if(h){var f=this.getOperContextParentElem();if(!f){return null}else{var g=Kekule.HtmlElementUtils.getElemScrollDimension(f);e=h.createContext(f,g.width,g.height);this.setPropStoreFieldValue("operContext",e)}}}return e}}});this.defineProp("uiContext",{dataType:DataType.OBJECT,serializable:false,getter:function(){var e=this.getPropStoreFieldValue("uiContext");if(!e){var h=this.getUiDrawBridge();if(h){var f=this.getUiContextParentElem();if(!f){return null}else{var g=Kekule.HtmlElementUtils.getElemScrollDimension(f);e=h.createContext(f,g.width,g.height);this.setPropStoreFieldValue("uiContext",e)}}}return e}});this.defineProp("objDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){return this.getDrawBridge()}});this.defineProp("uiDrawBridge",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiDrawBridge");if(!e){e=this.createUiDrawBridge();this.setPropStoreFieldValue("uiDrawBridge",e)}return e}});this.defineProp("uiPainter",{dataType:"Kekule.Render.ChemObjPainter",serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiPainter");if(!e){var f=this.getUiMarkers();e=new Kekule.Render.ChemObjPainter(Kekule.Render.RendererType.R2D,f,this.getUiDrawBridge());this.setPropStoreFieldValue("uiPainter",e);return e}return e}});this.defineProp("uiRenderer",{dataType:"Kekule.Render.AbstractRenderer",serializable:false,setter:null,getter:function(){var f=this.getUiPainter();if(f){var e=f.getRenderer();if(!e){f.prepareRenderer()}return f.getRenderer()||null}else{return null}}});this.defineProp("uiMarkers",{dataType:"Kekule.ChemWidget.UiMarkerCollection",serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("uiMarkers");if(!e){e=new Kekule.ChemWidget.UiMarkerCollection();this.setPropStoreFieldValue("uiMarkers",e)}return e}});this._defineUiMarkerProp("uiHotTrackMarker");this._defineUiMarkerProp("uiSelectionAreaMarker");this._defineUiMarkerProp("uiSelectingMarker");this.defineProp("uiSelectionAreaContainerBox",{dataType:DataType.Object,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("objRendererMap",{dataType:"Kekule.MapEx",serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("objRendererMap");if(!e){e=new Kekule.MapEx(true);this.setPropStoreFieldValue("objRendererMap",e)}return e}});this.defineProp("boundInfoRecorder",{dataType:"Kekule.Render.BoundInfoRecorder",serializable:false,setter:null})},_defineUiMarkerProp:function(e,f){return this.defineProp(e,{dataType:"Kekule.ChemWidget.AbstractUIMarker",serializable:false,getter:function(){var g=this.getPropStoreFieldValue(e);if(!g){g=this.createShapeBasedMarker(e,null,null,false)}return g},setter:function(h){if(!f){f=this.getUiMarkers()}var g=this.getPropValue(e);if(g){f.removeMarker(g);g.finalize()}f.addMarker(h);this.setPropStoreFieldValue(e,h)}})},doFinalize:function($super){var i=this.getPropStoreFieldValue("operHistory");if(i){i.finalize();this.setPropStoreFieldValue("operHistory",null)}var f=this.getPropStoreFieldValue("objDrawBridge");var g=this.getPropStoreFieldValue("operContext");if(f&&g){f.releaseContext(g)}this.setPropStoreFieldValue("operContext",null);var f=this.getPropStoreFieldValue("uiDrawBridge");var g=this.getPropStoreFieldValue("uiContext");if(f&&g){f.releaseContext(g)}this.setPropStoreFieldValue("uiDrawBridge",null);this.setPropStoreFieldValue("uiContext",null);var l=this.getPropStoreFieldValue("boundInfoRecorder");if(l){l.finalize()}this.setPropStoreFieldValue("boundInfoRecorder",null);var e=this.getPropStoreFieldValue("objRendererMap");if(e){e.finalize()}this.setPropStoreFieldValue("objRendererMap",null);$super()},createDefaultConfigs:function(){return new Kekule.Editor.BaseEditorConfigs()},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function(g,e){var f=g.createElement("div");f.className=d.EDITOR_CLIENT;e.appendChild(f);this._editClientElem=f;return[f]},getCoreElement:function($super){return this._editClientElem||$super()},getEditClientElem:function(){return this._editClientElem},doGetWidgetClassName:function($super){var f=$super()+" "+d.EDITOR;var e=(this.getRenderType()===Kekule.Render.RendererType.R3D)?d.EDITOR3D:d.EDITOR2D;f+=" "+e;return f},doBindElement:function(e){this.createContextParentElems();this.createUiEventReceiverElem()},changeClientSize:function(g,s,o){this._initialRenderTransformParams=null;var m=this.getCoreElement();var f=m.style;if(!o){o=1}var r=g*o;var q=s*o;if(r){f.width=r+"px"}if(q){f.height=q+"px"}var e=[this.getObjContext(),this.getOperContext(),this.getUiContext()];for(var p=0,n=e.length;p<n;++p){var t=e[p];if(t){this.getDrawBridge().setContextDimension(t,r,q)}}this.repaint()},isDirty:function(){if(this.getEnableOperHistory()){return this.getOperHistory().getCurrIndex()>=0}else{return this._objChanged}},getChemObjSrcInfo:function(e){if(this.isDirty()){return null}else{return e.getSrcInfo?e.getSrcInfo():null}},getActualDrawOptions:function($super){var f=$super();if(this._initialRenderTransformParams){var e=Object.extend({},this._initialRenderTransformParams);e=Object.extend(e,f);return e}else{return f}},repaint:function($super,g){var f=g;var e=$super(f);if(!this._initialRenderTransformParams){this._initialRenderTransformParams=this.getPainter().getActualInitialRenderTransformOptions(this.getObjContext())}this.recalcUiMarkers();return e},newDoc:function(){if(this.getEnableCreateNewDoc()){this.load(this.doCreateNewDocObj())}},doCreateNewDocObj:function(){return new Kekule.Molecule()},getExportableClasses:function(){var e=this.getChemObj();if(!e){return[]}else{return e.getClass?e.getClass():null}},exportObj:function(e){var f=this.getChemObj();if(!e){return f}else{return(f&&(f instanceof e))?f:null}},doLoad:function($super,e){this.deselectAll();this._initialRenderTransformParams=null;this.getObjRendererMap().clear();if(this.getOperHistory()){this.getOperHistory().clear()}$super(e);this._objChanged=false},doLoadEnd:function($super,e){$super();if(!e){this._initialRenderTransformParams=null}},doResize:function($super){this._initialRenderTransformParams=null;$super()},geometryOptionChanged:function($super){var e=this.getDrawOptions().zoom;this.zoomChanged(e);$super()},zoomChanged:function(e){},chemObjChanged:function($super,f,e){$super(f,e);if(f!==e){if(e){this._uninstallChemObjEventListener(e)}if(f){this._installChemObjEventListener(f)}}},_installChemObjEventListener:function(e){e.addEventListener("change",this.reactChemObjChange,this)},_uninstallChemObjEventListener:function(e){e.removeEventListener("change",this.reactChemObjChange,this)},createUiEventReceiverElem:function(){var f=this.getCoreElement();if(f){var e=f.ownerDocument.createElement("div");e.className=d.EDITOR_UIEVENT_RECEIVER;f.appendChild(e);c.addClass(e,a.DYN_CREATED);this.setPropStoreFieldValue("uiEventReceiverElem",e);return e}},createContextParentElems:function(){var e=this.getCoreElement();if(e){var f=e.ownerDocument;this._createContextParentElem(f,e,"objContextParentElem");this._createContextParentElem(f,e,"operContextParentElem");this._createContextParentElem(f,e,"uiContextParentElem")}},_createContextParentElem:function(h,f,g){var e=h.createElement("div");e.style.position="absolute";e.style.width="100%";e.style.height="100%";e.className=g+" "+a.DYN_CREATED;this.setPropStoreFieldValue(g,e);f.appendChild(e);return e},createNewPainter:function($super,f){var e=$super(f);if(e){this.installPainterEventHandlers(e);this.createNewBoundInfoRecorder(this.getPainter())}return e},createNewBoundInfoRecorder:function(g){var e=this.getPropStoreFieldValue("boundInfoRecorder");if(e){e.finalize()}var f=new Kekule.Render.BoundInfoRecorder(g);this.setPropStoreFieldValue("boundInfoRecorder",f)},getDrawContextParentElem:function(){return this.getObjContextParentElem()},createUiDrawBridge:function(){var e=Kekule.Render.DrawBridge2DMananger.getPreferredBridgeInstance();if(!e){Kekule.error(Kekule.ErrorMsg.DRAW_BRIDGE_NOT_SUPPORTED)}return e},canModifyPartialGraphic:function(f){var e=this.getDrawBridge();return e.canModifyGraphic?e.canModifyGraphic(f||this.getObjContext()):false},changeContextDimension:function($super,f){var e=$super(f);if(e){this._resizeContext(this.getOperContext(),this.getObjDrawBridge(),f.width,f.height);this._resizeContext(this.getUiContext(),this.getUiDrawBridge(),f.width,f.height)}return e},_resizeContext:function(f,h,g,e){if(f&&h){h.setContextDimension(f,g,e)}},_clearSpecContext:function(e,f){if(f&&e){f.clearContext(e)}},clearObjContext:function(){this._clearSpecContext(this.getObjContext(),this.getDrawBridge());if(this.getBoundInfoRecorder()){this.getBoundInfoRecorder().clear(this.getObjContext())}},clearOperContext:function(){this._clearSpecContext(this.getOperContext(),this.getDrawBridge())},clearUiContext:function(){this._clearSpecContext(this.getUiContext(),this.getUiDrawBridge())},clearContext:function(){this.clearObjContext();if(this._operatingRenderers){this.clearOperContext()}},repaintOperContext:function(){if(this._operatingRenderers&&this._operatingObjs){var e={partialDrawObjs:this._operatingObjs};this.repaint(e)}},installPainterEventHandlers:function(e){e.addEventListener("draw",this.reactChemObjDraw,this);e.addEventListener("clear",this.reactChemObjClear,this)},reactChemObjDraw:function(i){var f=i.context;var h=i.obj;if(h&&((f===this.getObjContext())||(f===this.getOperContext()))){var g=i.target;this.getObjRendererMap().set(h,g)}},reactChemObjClear:function(i){var f=i.context;var h=i.obj;if(h&&((f===this.getObjContext())||(f===this.getOperContext()))){var g=i.target;this.getObjRendererMap().remove(h)}},reactChemObjChange:function(g){var f=g.target;var i=g.changedPropNames;var h=["owner","ownedObjs"];i=Kekule.ArrayUtils.exclude(i,h);if(i.length){this.objectChanged(f,i)}},reactOperHistoryPush:function(f){this.invokeEvent("operPush",f)},reactOperHistoryPop:function(f){this.invokeEvent("operPop",f)},reactOperHistoryUndo:function(f){this.invokeEvent("operUndo",f)},reactOperHistoryRedo:function(f){this.invokeEvent("operRedo",f)},reactOperHistoryClear:function(f){this.invokeEvent("operHistoryClear",f)},reactOperHistoryChange:function(f){this.invokeEvent("operChange",f)},beginUpdateObject:function(){--this._objectUpdateFlag},endUpdateObject:function(){++this._objectUpdateFlag;if(!this.isUpdatingObject()){if((this._updatedObjectDetails&&this._updatedObjectDetails.length)){this.objectsChanged(this._updatedObjectDetails);this._updatedObjectDetails=[]}}},isUpdatingObject:function(){return(this._objectUpdateFlag<0)},objectChanged:function(h,f){var g={obj:h,propNames:f};var e=this.objectsChanged(g);this.invokeEvent("editObjChanged",Object.extend({},g));return e},objectsChanged:function(f){var e=DataType.isArrayValue(f)?f:[f];if(this.isUpdatingObject()){Kekule.ArrayUtils.pushUnique(this._updatedObjectDetails,e)}else{this.doObjectsChanged(e)}this._objChanged=true;this.invokeEvent("editObjsChanged",Object.extend({},f))},doObjectsChanged:function(n){var f=Kekule.ArrayUtils.clone(n);var i=Kekule.Render.UpdateObjUtils._extractObjsOfUpdateObjDetails(f);var m=this._getAdditionalRenderRelatedObjs(i);if(m.length){var h=Kekule.Render.UpdateObjUtils._createUpdateObjDetailsFromObjs(m);Kekule.ArrayUtils.pushUnique(f,h)}Kekule.ArrayUtils.pushUnique(i,m);var e=this._operatingRenderers;var g=e&&this._isAllObjsRenderedByRenderers(this.getObjContext(),i,e);var l=this.canModifyPartialGraphic();if(l){this.getRootRenderer().modify(this.getObjContext(),f);this.recalcUiMarkers()}else{if(g){this.repaintOperContext()}else{this.repaint()}}},_getAdditionalRenderRelatedObjs:function(n){var e=[];for(var g=0,f=n.length;g<f;++g){var h=n[g];var m=h.getCoordDeterminateObjects?h.getCoordDeterminateObjects():[];Kekule.ArrayUtils.pushUnique(e,m)}return e},_isAllObjsRenderedByRenderers:function(e,o,p){for(var n=0,f=o.length;n<f;++n){var m=o[n];var r=false;for(var h=0,g=p.length;h<g;++h){var q=p[h];if(q.isChemObjRenderedBySelf(e,m)){r=true;break}}if(!r){return false}}return true},prepareOperatingObjs:function(e){if(this._operatingRenderers&&this._operatingRenderers.length){this.endOperatingObjs(true)}if(this.getEnableOperContext()){this._prepareRenderObjsInOperContext(e);this._operatingObjs=e}this.repaint()},endOperatingObjs:function(e){if(this.getEnableOperContext()){this._endRenderObjsInOperContext();this._operatingObjs=null;if(!e){this.repaint()}}},_prepareRenderObjsInOperContext:function(r){var g=[];var e=this.getObjRendererMap();var n=e.getValues();var f=this.getObjContext();for(var q=0,h=r.length;q<h;++q){var p=r[q];for(var o=0,m=n.length;o<m;++o){var s=n[o];if(s.isChemObjRenderedDirectlyBySelf(f,p)){Kekule.ArrayUtils.pushUnique(g,s)}}}if(g.length>0){for(var q=0,h=g.length;q<h;++q){var s=g[q];s.setRedirectContext(this.getOperContext())}this._operatingRenderers=g}else{this._operatingRenderers=null}},_endRenderObjsInOperContext:function(){var f=this._operatingRenderers;if(f&&f.length){for(var g=0,e=f.length;g<e;++g){var h=f[g];h.setRedirectContext(null)}this.clearOperContext()}this._operatingRenderers=null},clearBoundMap:function(){this.getBoundInfoRecorder().clear(this.getObjContext())},findTopmostBoundInfo:function(h,g){if(h&&h.length){var e=null;var f=h.length-1;e=h[f];while((f>=0)&&(g&&(g.indexOf(e.obj)>=0))){--f;e=h[f]}return e}else{return null}},getBoundInfosAtCoord:function(f){var e=this.getBoundInfoRecorder();var l=this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackInflation();var i=this.screenCoordToContext(f);var h=(this.getRenderType()===Kekule.Render.RendererType.R3D)?{x:0,y:0}:null;var g=e.getIntersectionInfos(this.getObjContext(),i,h,l);return g},getTopmostBoundInfoAtCoord:function(e,f){return this.findTopmostBoundInfo(this.getBoundInfosAtCoord(e),f)},getTopmostBasicObjectAtCoord:function(e){var f=this.getTopmostBoundInfoAtCoord(e);return f?f.obj:null},beginUpdateUiMarkers:function(){--this._uiMarkerUpdateFlag},endUpdateUiMarkers:function(){++this._uiMarkerUpdateFlag;if(!this.isUpdatingUiMarkers()){this.repaintUiMarker()}},isUpdatingUiMarkers:function(){return(this._uiMarkerUpdateFlag<0)},recalcUiMarkers:function(){this.beginUpdateUiMarkers();try{this.recalcHotTrackMarker();this.recalcSelectionAreaMarker()}finally{this.endUpdateUiMarkers()}},repaintUiMarker:function(){if(this.isUpdatingUiMarkers()){return}this.clearUiContext();var e=this.calcDrawParams();this.getUiPainter().draw(this.getUiContext(),e.baseCoord,e.drawOptions)},createShapeBasedMarker:function(h,g,i,f){var e=new Kekule.ChemWidget.MetaShapeUIMarker();if(g){e.setShapeInfo(g)}if(i){e.setDrawStyles(i)}this.setPropStoreFieldValue(h,e);this.getUiMarkers().addMarker(e);if(f){this.repaintUiMarker()}return e},modifyShapeBasedMarker:function(f,g,i,h){var e=Kekule.Render.ObjectUpdateType.MODIFY;f.setShapeInfo(g);if(i){f.setDrawStyles(i)}if(h){this.repaintUiMarker()}},hideUiMarker:function(e,f){e.setVisible(false);if(f){this.repaintUiMarker()}},showUiMarker:function(e,f){e.setVisible(true);if(f){this.repaintUiMarker()}},removeUiMarker:function(e){if(e){this.getUiMarkers().removeMarker(e);this.repaintUiMarker()}},clearUiMarkers:function(){this.getUiMarkers().clearMarkers();this.repaintUiMarker()},changeHotTrackMarkerBounds:function(r){var p=Kekule.ArrayUtils.toArray(r);var f=this.getEditorConfigs().getUiMarkerConfigs();var o={color:f.getHotTrackerColor(),opacity:f.getHotTrackerOpacity()};var s=this.getEditorConfigs().getInteractionConfigs().getObjBoundTrackInflation();var e=[];for(var m=0,g=p.length;m<g;++m){var n=p[m];var h=s?Kekule.Render.MetaShapeUtils.inflateShape(n,s):n;if(h){e.push(h)}}var q=this.getUiHotTrackMarker();q.setVisible(true);this.modifyShapeBasedMarker(q,e,o,true);return this},hideHotTrackMarker:function(){var e=this.getUiHotTrackMarker();if(e){this.hideUiMarker(e,true)}return this},showHotTrackMarker:function(){var e=this.getUiHotTrackMarker();if(e){this.showUiMarker(e,true)}return this},hotTrackOnCoord:function(e){if(this.getEditorConfigs().getInteractionConfigs().getEnableHotTrack()){this.setHotTrackedObj(this.getTopmostBasicObjectAtCoord(e))}return this},hotTrackOnObj:function(e){this.setHotTrackedObj(e);return this},hideHotTrack:function(){this.hideHotTrackMarker();return this},addHotTrackedObj:function(f){var e=this.getHotTrackedObjs()||[];Kekule.ArrayUtils.pushUnique(e,f);this.setHotTrackedObjs(e);return this},recalcHotTrackMarker:function(){this.setHotTrackedObjs(this.getHotTrackedObjs())},changeSelectionAreaMarkerBound:function(h){var f=this.getEditorConfigs().getUiMarkerConfigs();var g={strokeColor:f.getSelectionMarkerStrokeColor(),strokeWidth:f.getSelectionMarkerStrokeWidth(),fillColor:f.getSelectionMarkerFillColor(),opacity:f.getSelectionMarkerOpacity()};var e=this.getUiSelectionAreaMarker();e.setVisible(true);this.modifyShapeBasedMarker(e,h,g,true);return this},hideSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();if(e){this.hideUiMarker(e,true)}},showSelectionAreaMarker:function(){var e=this.getUiSelectionAreaMarker();if(e){this.showUiMarker(e,true)}},recalcSelectionAreaMarker:function(n){this.beginUpdateUiMarkers();try{var u=this.getSelection();var s=u.length;if(s<=0){this.hideSelectionAreaMarker()}else{var e=[];var f=null;var v=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerInflation();for(var q=0;q<s;++q){var p=u[q];var t=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),p);if(t&&t.length){for(var o=0,m=t.length;o<m;++o){var g=t[o];var l=g.boundInfo;if(l){l=Kekule.Render.MetaShapeUtils.inflateShape(l,v);e.push(l);var r=Kekule.Render.MetaShapeUtils.getContainerBox(l);f=f?Kekule.BoxUtils.getContainerBox(f,r):r}}}}this.setUiSelectionAreaContainerBox(f);if(f){var h=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:f.x1,y:f.y1},{x:f.x2,y:f.y2}]);e.push(h)}else{this.hideSelectionAreaMarker()}if(e.length){this.changeSelectionAreaMarkerBound(e)}}}finally{this.endUpdateUiMarkers()}},startSelectingBoxDrag:function(e,f){this._selectingBoxStartCoord=e;if(!f){this.deselectAll()}},dragSelectingBoxToCoord:function(e){var g=this._selectingBoxStartCoord;var f=e;this.changeSelectingMarkerBox(g,f)},endSelectingBoxDrag:function(e,i){var g=this._selectingBoxStartCoord;this._selectingBoxEndCoord=e;var h=Kekule.BoxUtils.createBox(g,e);var f=this.getEditorConfigs().getInteractionConfigs().getEnablePartialAreaSelecting();if(i){this.toggleSelectingStateOfObjectsInScreenBox(h,f)}else{this.selectObjectsInScreenBox(h,f)}this.hideSelectingMarker()},selectOnCoord:function(g,f){var e=this.getTopmostBasicObjectAtCoord(g);if(e){if(f){this.toggleSelectingState(e)}else{this.select(e)}}},changeSelectingMarkerBound:function(h){var f=this.getEditorConfigs().getUiMarkerConfigs();var g={strokeColor:f.getSelectingMarkerStrokeColor(),strokeWidth:f.getSelectingMarkerStrokeWidth(),strokeDash:f.getSelectingMarkerStrokeDash(),fillColor:f.getSelectingMarkerFillColor(),opacity:f.getSelectingMarkerOpacity()};var e=this.getUiSelectingMarker();e.setVisible(true);this.modifyShapeBasedMarker(e,h,g,true);return this},changeSelectingMarkerBox:function(g,e){var h=this.screenCoordToContext(g);var f=this.screenCoordToContext(e);var i=Kekule.Render.MetaShapeUtils.createShapeInfo(Kekule.Render.MetaShapeType.RECT,[{x:Math.min(h.x,f.x),y:Math.min(h.y,f.y)},{x:Math.max(h.x,f.x),y:Math.max(h.y,f.y)}]);return this.changeSelectingMarkerBound(i)},hideSelectingMarker:function(){var e=this.getUiSelectingMarker();if(e){this.hideUiMarker(e,true)}},showSelectingMarker:function(){var e=this.getUiSelectingMarker();if(e){this.showUiMarker(e,true)}},getCoordRegionInSelectionMarker:function(o,u){var h=Kekule.Editor.BoxRegion;var v=Kekule.CoordUtils;var p=this.screenCoordToContext(o);var i=this.getUiSelectionAreaMarker();if(i&&i.getVisible()){var m=this.getUiSelectionAreaContainerBox();if(Kekule.ObjUtils.isUnset(u)){u=this.getEditorConfigs().getInteractionConfigs().getSelectionMarkerEdgeInflation()}var g=(u/2)||0;var r=v.substract({x:m.x1,y:m.y1},{x:g,y:g});var q=v.add({x:m.x2,y:m.y2},{x:g,y:g});if((p.x<r.x)||(p.y<r.y)||(p.x>q.x)||(p.y>q.y)){return h.OUTSIDE}var f=v.substract(p,r);var e=v.substract(q,p);var t=f.x;var s=e.x;var n=f.y;var l=e.y;if(n<l){if(t<s){if(n<=u){return(t<=u)?h.CORNER_TL:h.EDGE_TOP}else{if(t<=u){return h.EDGE_LEFT}else{return h.INSIDE}}}else{if(n<=u){return(s<=u)?h.CORNER_TR:h.EDGE_TOP}else{if(s<=u){return h.EDGE_RIGHT}else{return h.INSIDE}}}}else{if(t<s){if(l<=u){return(t<=u)?h.CORNER_BL:h.EDGE_BOTTOM}else{if(t<=u){return h.EDGE_LEFT}else{return h.INSIDE}}}else{if(l<=u){return(s<=u)?h.CORNER_BR:h.EDGE_BOTTOM}else{if(s<=u){return h.EDGE_RIGHT}else{return h.INSIDE}}}}}return h.OUTSIDE},isCoordInSelectionMarkerBound:function(e){return(this.getCoordRegionInSelectionMarker(e)!==Kekule.Editor.BoxRegion.OUTSIDE)},getObjSelectedRenderOptions:function(){return this._selectedRenderOptions},_getObjRenderOptionItemAppendMethod:function(e){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?e.addOverrideRender3DOptionItem:e.addOverrideRenderOptionItem},_getObjRenderOptionItemRemoveMethod:function(e){return(this.getRenderType()===Kekule.Render.RendererType.R3D)?e.removeOverrideRender3DOptionItem:e.removeOverrideRenderOptionItem},_addSelectRenderOptions:function(f){var e=this._getObjRenderOptionItemAppendMethod(f);return e.apply(f,[this.getObjSelectedRenderOptions()])},_removeSelectRenderOptions:function(f){var e=this._getObjRenderOptionItemRemoveMethod(f);return e.apply(f,[this.getObjSelectedRenderOptions()])},beginUpdateSelection:function(){this.beginUpdateObject();--this._objSelectFlag},endUpdateSelection:function(){++this._objSelectFlag;if(this._objSelectFlag>=0){this.selectionChanged()}this.endUpdateObject()},isUpdatingSelection:function(){return(this._objSelectFlag<0)},selectionChanged:function(){if(!this.isUpdatingSelection()){this.notifyPropSet("selection",this.getSelection());this.invokeEvent("selectionChange");return this.doSelectionChanged()}},doSelectionChanged:function(){this.recalcSelectionAreaMarker()},isInSelection:function(e){return this.getSelection().indexOf(e)>=0},addObjToSelection:function(f){var e=this.getSelection();Kekule.ArrayUtils.pushUnique(e,f.getNearestSelectableObject());this._addSelectRenderOptions(f);this.selectionChanged();return this},removeObjFromSelection:function(f){var e=this.getSelection();Kekule.ArrayUtils.remove(e,f);this._removeSelectRenderOptions(f);this.selectionChanged();return this},deselectAll:function(){var e=this.getSelection();return this.removeFromSelection(e)},select:function(e){this.beginUpdateSelection();try{this.deselectAll();this.addToSelection(e)}finally{this.endUpdateSelection()}return this},addToSelection:function(h){if(!h){return}var g=DataType.isArrayValue(h)?h:[h];this.beginUpdateSelection();try{for(var f=0,e=g.length;f<e;++f){this.addObjToSelection(g[f])}}finally{this.endUpdateSelection()}return this},removeFromSelection:function(g){if(!g){return}var f=DataType.isArrayValue(g)?g:[g];this.beginUpdateSelection();try{for(var e=f.length-1;e>=0;--e){this.removeObjFromSelection(f[e])}}finally{this.endUpdateSelection()}return this},toggleSelectingState:function(m){if(!m){return}var h=DataType.isArrayValue(m)?m:[m];this.beginUpdateSelection();try{for(var f=0,e=h.length;f<e;++f){var g=h[f];if(this.isInSelection(g)){this.removeObjFromSelection(g)}else{this.addObjToSelection(g)}}}finally{this.endUpdateSelection()}return this},hasSelection:function(){return !!this.getSelection().length},deleteSelectedObjs:function(){},getObjectsInScreenBox:function(r,g){var o=this.screenBoxToContext(r);var n=[];var f=this.getBoundInfoRecorder().getAllRecordedInfoOfContext(this.getObjContext());var e=g?Kekule.Render.MetaShapeUtils.isIntersectingBox:Kekule.Render.MetaShapeUtils.isInsideBox;for(var m=0,h=f.length;m<h;++m){var p=f[m];var q=p.boundInfo;if(q){if(e(q,o)){n.push(p.obj)}}}return n},selectObjectsInScreenBox:function(e,g){var f=this.getObjectsInScreenBox(e,g);if(f&&f.length){this.select(f)}return f},addObjectsInScreenBoxToSelection:function(e,g){var f=this.getObjectsInScreenBox(e,g);if(f&&f.length){this.addToSelection(f)}return f},removeObjectsInScreenBoxFromSelection:function(e,g){var f=this.getObjectsInScreenBox(e,g);if(f&&f.length){this.removeFromSelection(f)}return f},toggleSelectingStateOfObjectsInScreenBox:function(e,g){var f=this.getObjectsInScreenBox(e,g);if(f&&f.length){this.toggleSelectingState(f)}return f},getObjectsContainerBox:function(w,u){var t=Kekule.ArrayUtils.toArray(w);var g=u||0;var e=[];var f=null;for(var r=0,m=t.length;r<m;++r){var q=t[r];var v=this.getBoundInfoRecorder().getBelongedInfos(this.getObjContext(),q);if(v&&v.length){for(var p=0,o=v.length;p<o;++p){var h=v[p];var n=h.boundInfo;if(n){if(g){n=Kekule.Render.MetaShapeUtils.inflateShape(n,g)}var s=Kekule.Render.MetaShapeUtils.getContainerBox(n);f=f?Kekule.BoxUtils.getContainerBox(f,s):s}}}}return f},getSelectionContainerBox:function(e){return this.getObjectsContainerBox(this.getSelection(),e)},getObjSize:function(e){return this.doGetObjSize(e)},doGetObjSize:function(f){var e=this.getCoordMode();return f.getSizeOfMode?f.getSizeOfMode(e):null},setObjSize:function(f,e){this.doSetObjSize(f,e);this.objectChanged(f)},doSetObjSize:function(f,e){if(f.setSizeOfMode){f.setSizeOfMode(dimension,this.getCoordMode())}},getObjCoord:function(e){return this.doGetObjCoord(e)},doGetObjCoord:function(g){var f=this.getCoordMode();var e=this.getAllowCoordBorrow();return g.getAbsBaseCoord?g.getAbsBaseCoord(f,e):g.getAbsCoordOfMode?g.getAbsCoordOfMode(f,e):g.getCoordOfMode?g.getCoordOfMode(f,e):null},setObjCoord:function(e,f){this.doSetObjCoord(e,f);this.objectChanged(e)},doSetObjCoord:function(f,g){var e=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;if(f.setAbsBaseCoord){f.setAbsBaseCoord(g,e)}else{if(f.setAbsCoordOfMode){f.setAbsCoordOfMode(g,e)}else{if(f.setAbsCoordOfMode){f.setCoordOfMode(g,e)}}}},getObjectContextCoord:function(e){var f=this.getObjCoord(e);return this.objCoordToContext(f)},setObjectContextCoord:function(f,e){var g=this.contextCoordToObj(e);if(g){this.setObjCoord(f,g)}},getObjectScreenCoord:function(e){var f=this.getObjCoord(e);return this.objCoordToScreen(f)},setObjectScreenCoord:function(f,e){var g=this.screenCoordToObj(e);if(g){this.setObjCoord(f,g)}},getCoord:function(g,e){var f=this.getObjCoord(g);return this.translateCoord(f,Kekule.Editor.CoordSys.OBJ,e)},setCoord:function(h,g,e){var f=this.translateCoord(g,e,Kekule.Editor.CoordSys.OBJ);this.setObjCoord(h,f)},translateCoord:function(i,f,g){if(!i){return null}var h=Kekule.Editor.CoordSys;if(f===h.SCREEN){if(g===h.SCREEN){return i}else{if(g===h.CONTEXT){return this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),i)}else{var e=this.getObjDrawBridge().transformScreenCoordToContext(this.getObjContext(),i);return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),e)}}}else{if(f===h.CONTEXT){if(g===h.SCREEN){return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),i)}else{if(g===h.CONTEXT){return i}else{return this.getRootRenderer().transformCoordToObj(this.getObjContext(),this.getChemObj(),i)}}}else{if(g===h.SCREEN){var e=this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),i);return this.getObjDrawBridge().transformContextCoordToScreen(this.getObjContext(),e)}else{if(g===h.CONTEXT){return this.getRootRenderer().transformCoordToContext(this.getObjContext(),this.getChemObj(),i)}else{return i}}}}},objCoordToContext:function(f){var e=Kekule.Editor.CoordSys;return this.translateCoord(f,e.OBJ,e.CONTEXT)},contextCoordToObj:function(e){var f=Kekule.Editor.CoordSys;return this.translateCoord(e,f.CONTEXT,f.OBJ)},objCoordToScreen:function(f){var e=Kekule.Editor.CoordSys;return this.translateCoord(f,e.OBJ,e.SCREEN)},screenCoordToObj:function(e){var f=Kekule.Editor.CoordSys;return this.translateCoord(e,f.SCREEN,f.OBJ)},screenCoordToContext:function(e){var f=Kekule.Editor.CoordSys;return this.translateCoord(e,f.SCREEN,f.CONTEXT)},contextCoordToScreen:function(e){var f=Kekule.Editor.CoordSys;return this.translateCoord(e,f.CONTEXT,f.SCREEN)},screenBoxToContext:function(e){var g=this.screenCoordToContext({x:e.x1,y:e.y1});var f=this.screenCoordToContext({x:e.x2,y:e.y2});return{x1:g.x,y1:g.y,x2:f.x,y2:f.y}},createDefaultNode:function(i,e,f){var h=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId();var g=new Kekule.Atom();g.setIsotopeId(h);if(f){f.appendNode(g)}this.setCoord(g,i,e);return g},operationDone:function(e){this.doOperationDone(e)},doOperationDone:function(e){},clearOperHistory:function(){var e=this.getOperHistory();if(e){e.clear()}},pushOperation:function(e,g){var f=this.getOperHistory();if(f&&e){f.push(e)}if(g){e.execute()}},popOperation:function(e){var g;var f=this.getOperHistory();if(f){g=f.pop(operation);if(e){g.reverse()}}else{return null}},undo:function(){var f;var e=this.getOperHistory();if(e){this.beginUpdateObject();try{f=e.undo()}finally{this.endUpdateObject();if(f){this.operationDone(f)}}}return f},redo:function(){var f;var e=this.getOperHistory();if(e){this.beginUpdateObject();try{f=e.redo()}finally{this.endUpdateObject();if(f){this.operationDone(f)}}}return f},undoAll:function(){var f;var e=this.getOperHistory();if(e){this.beginUpdateObject();try{f=e.undoAll()}finally{this.endUpdateObject()}}return f},canUndo:function(){var e=this.getOperHistory();return e?e.canUndo():false},canRedo:function(){var e=this.getOperHistory();return e?e.canRedo():false},modifyObjects:function(e,h,q){var p=Kekule.ArrayUtils.toArray(e);try{var f=new Kekule.MacroOperation();for(var o=0,m=p.length;o<m;++o){var n=p[o];var g=new Kekule.ChemObjOperation.Modify(n,h);f.add(g)}f.execute()}finally{if(q&&this.getEnableOperHistory()&&f.getChildCount()){this.pushOperation(f)}}return this},modifyObjectsRenderOptions:function(g,q,p,v){var u=Kekule.ArrayUtils.toArray(g);var f=p?"render3DOptions":"renderOptions";var w=p?"getRender3DOptions":"getRenderOptions";try{var m=new Kekule.MacroOperation();for(var t=0,o=u.length;t<o;++t){var s=u[t];if(s[w]){var h=s[w]();var e=Object.extend({},h);e=Object.extend(e,q);var r={};r[f]=e;var n=new Kekule.ChemObjOperation.Modify(s,r);m.add(n)}}m.execute()}finally{if(v&&this.getEnableOperHistory()&&m.getChildCount()){this.pushOperation(m)}}return this},getClientScrollPosition:function(){var e=this.getEditClientElem().parentNode;return e?{x:e.scrollLeft,y:e.scrollTop}:null},scrollClientTo:function(f,g){var e=this.getEditClientElem().parentNode;if(Kekule.ObjUtils.notUnset(f)){e.scrollTop=f}if(Kekule.ObjUtils.notUnset(g)){e.scrollLeft=g}return this},scrollClientToTop:function(){return this.scrollClientTo(0,null)}});Kekule.Editor.BaseEditor.Settings=Class.create(Kekule.ChemWidget.ChemObjDisplayer.Settings,{CLASS_NAME:"Kekule.Editor.BaseEditor.Settings",initProperties:function(){this.defineProp("enableCreateNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableCreateNewDoc()},setter:function(e){this.getEditor().setEnableCreateNewDoc(e)}});this.defineProp("initOnNewDoc",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getInitOnNewDoc()},setter:function(e){this.getEditor().setInitOnNewDoc(e)}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getEnableOperHistory()},setter:function(e){this.getEditor().setEnableOperHistory(e)}})},getEditor:function(){return this.getDisplayer()}});Kekule.Editor.IaControllerManager={_controllerMap:new Kekule.MapEx(true),register:function(f,e){b._controllerMap.set(f,e)},unregister:function(e){b._controllerMap.remove(e)},getAllControllerClasses:function(){return b._controllerMap.getKeys()},getAvailableControllerClasses:function(f){var e=[];var n=b.getAllControllerClasses();for(var m=0,g=n.length;m<g;++m){var o=n[m];var h=b._controllerMap.get(o);if(!h||ClassEx.isOrIsDescendantOf(f,h)){e.push(o)}}return e}};var b=Kekule.Editor.IaControllerManager;Kekule.Editor.BaseEditorIaController=Class.create(Kekule.Widget.InteractionController,{CLASS_NAME:"Kekule.Editor.BaseEditorIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("manuallyHotTrack",{dataType:DataType.BOOL,serializable:false})},getDefId:function(){return Kekule.ClassUtils.getLastClassName(this.getClassName())},getEditor:function(){return this.getWidget()},setEditor:function(e){return this.setWidget(e)},getEditorConfigs:function(){var e=this.getEditor();return e?e.getEditorConfigs():null},handleUiEvent:function($super,i){var g=false;var h=i.getTarget();var f=this.getEditor().getUiEventReceiverElem();if(f){if((h===f)||Kekule.DomUtils.isDescendantOf(h,f)){g=true}}else{g=true}if(g){$super(i)}},canInteractWithObj:function(e){return !!e},zoomEditor:function(e){if(e>0){this.getEditor().zoomIn(e)}else{if(e<0){this.getEditor().zoomOut(-e)}}},react_mousemove:function(g){var h=this._getEventMouseCoord(g);var f=this.getEditor().getTopmostBasicObjectAtCoord(h);if(!this.getManuallyHotTrack()){if(f&&this.canInteractWithObj(f)){this.getEditor().hotTrackOnObj(f)}else{this.getEditor().hotTrackOnObj(null)}}return true},react_mousewheel:function(f){if(f.getCtrlKey()){var g=f.wheelDeltaY||f.wheelDelta;if(g){g/=120}this.zoomEditor(g);f.preventDefault();return true}},_getEventMouseCoord:function($super,h,g){var f=g||this.getWidget().getCoreElement();return $super(h,f)}});Kekule.Editor.BasicEraserIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicEraserIaController",initialize:function($super,e){$super(e);this._isExecuting=false},canInteractWithObj:function(e){return !!e},removeObjs:function(e){if(e&&e.length){var f=this.doGetActualRemovedObjs(e);this.doRemoveObjs(f)}},doRemoveObjs:function(e){},doGetActualRemovedObjs:function(e){return e},removeSelection:function(){var e=this.getEditor();this.removeObjs(e.getSelection());e.deselectAll()},removeOnScreenCoord:function(f){var e=this.getEditor().getTopmostBasicObjectAtCoord(f);if(e){this.removeObjs([e]);return true}else{return false}},startRemove:function(){this._isExecuting=true},endRemove:function(){this._isExecuting=false},isRemoving:function(){return this._isExecuting},react_mousedown:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.startRemove();var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g)}else{if(f.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT){this.endRemove()}}},react_mouseup:function(f){if(f.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.endRemove()}},react_mousemove:function($super,f){$super(f);if(this.isRemoving()){var g=this._getEventMouseCoord(f);this.removeOnScreenCoord(g)}return true}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicEraserIaController,Kekule.Editor.BaseEditor);Kekule.Editor.BasicManipulationIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.BasicManipulationIaController",initialize:function($super,e){$super(e);this.setState(Kekule.Editor.BasicManipulationIaController.State.NORMAL);this.setEnableSelect(true);this.setEnableMove(true);this.setEnableResize(true);this.setEnableConstrainedResize(true);this.setEnableRotate(true);this._suppressConstrainedResize=false},initProperties:function(){this.defineProp("enableSelect",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("startCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("endCoord",{dataType:DataType.HASH,serializable:false});this.defineProp("startBox",{dataType:DataType.HASH,serializable:false});this.defineProp("endBox",{dataType:DataType.HASH,serializable:false});this.defineProp("rotateCenter",{dataType:DataType.HASH,serializable:false,getter:function(){var e=this.getPropStoreFieldValue("rotateCenter");if(!e){var f=this.getStartBox();e=f?{x:(f.x1+f.x2)/2,y:(f.y1+f.y2)/2}:null}return e}});this.defineProp("resizeStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("enableConstrainedResize",{dataType:DataType.BOOL,serializable:false});this.defineProp("rotateStartingRegion",{dataType:DataType.INT,serializable:false});this.defineProp("manipulateOriginObjs",{dataType:DataType.ARRAY,serializable:false});this.defineProp("manipulateObjs",{dataType:DataType.ARRAY,serializable:false,setter:function(e){this.setPropStoreFieldValue("manipulateObjs",e);if(!e){this.getEditor().endOperatingObjs()}else{this.getEditor().prepareOperatingObjs(e)}}});this.defineProp("manipulateObjInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");if(!e){e=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjInfoMap",e)}return e}});this.defineProp("manipulateObjCurrInfoMap",{dataType:DataType.OBJECT,serializable:false,setter:null,getter:function(){var e=this.getPropStoreFieldValue("manipulateObjCurrInfoMap");if(!e){e=new Kekule.MapEx(true);this.setPropStoreFieldValue("manipulateObjCurrInfoMap",e)}return e}});this.defineProp("manipulationType",{dataType:DataType.INT,serializable:false});this.defineProp("isManipulatingSelection",{dataType:DataType.BOOL,serializable:false});this.defineProp("moveOperations",{dataType:DataType.ARRAY,serializable:false});this.defineProp("objOperationMap",{dataType:"Kekule.MapEx",serializable:false,getter:function(){var e=this.getPropStoreFieldValue("objOperationMap");if(!e){e=new Kekule.MapEx(true);this.setPropStoreFieldValue("objOperationMap",e)}return e}})},doFinalize:function($super){var e=this.getPropStoreFieldValue("manipulateObjInfoMap");if(e){e.clear()}e=this.getPropStoreFieldValue("objOperationMap");if(e){e.clear()}$super()},isConstrainedResize:function(){return this.getEnableConstrainedResize()&&(!this._suppressConstrainedResize)},getCoordOnSelectionRotationRegion:function(p){var m=Kekule.Editor.BoxRegion;var q=this.getEditor();var s=q.getCoordRegionInSelectionMarker(p);if(s!==m.OUTSIDE){return false}var e=q.getEditorConfigs().getInteractionConfigs().getRotationRegionInflation();var n=q.getUiSelectionAreaContainerBox();if(n&&q.hasSelection()){var o=[m.CORNER_TL,m.CORNER_TR,m.CORNER_BR,m.CORNER_BL];var w=[{x:n.x1,y:n.y1},{x:n.x2,y:n.y1},{x:n.x2,y:n.y2},{x:n.x1,y:n.y2}];var x=false;var v=e;for(var h=0,g=o.length;h<g;++h){var u=o[h];var t=w[h];var f=Kekule.CoordUtils.getDistance(t,p);if(f<=v){x=u;v=f}}return x}else{return false}},createManipulateOperation:function(){var n=[];this.setMoveOperations(n);var p=this.getManipulateObjs();var f=this.getManipulateObjInfoMap();var g=this.getObjOperationMap();g.clear();for(var o=0,h=p.length;o<h;++o){var m=p[o];var q=f.get(m);var e=new Kekule.ChemObjOperation.MoveAndResize(m,null,null,this.getEditor().getCoordMode(),true);e.setAllowCoordBorrow(this.getEditor().getAllowCoordBorrow());e.setOldCoord(q.objCoord);e.setOldDimension(q.dimension);n.push(e)}return n},updateChildMoveOperation:function(g,e,f){var h=this.getMoveOperations()[g];h.setNewCoord(f)},updateChildResizeOperation:function(g,f,e){var h=this.getMoveOperations()[g];h.setNewDimension(e)},getAllObjOperations:function(){var e=this.getMoveOperations();return e},getActiveOperation:function(){var e=this.getAllObjOperations();e=Kekule.ArrayUtils.toUnique(e);if(e.length<=0){return null}else{if(e.length===1){return e[0]}else{var f=new Kekule.MacroOperation(e);return f}}},reverseActiveOperation:function(){return this.getActiveOperation().reverse()},addOperationToEditor:function(){var e=this.getEditor();if(e&&e.getEnableOperHistory()){e.pushOperation(this.getActiveOperation())}},getActualManipulatingObjects:function(m){var e=[];for(var g=0,f=m.length;g<f;++g){var h=m[g];var n=h.getCoordDependentObjects?h.getCoordDependentObjects():[h];Kekule.ArrayUtils.pushUnique(e,n)}return e},prepareManipulating:function(q,r,o,h,t){this.setManipulationType(q);var p=this.getActualManipulatingObjects(r);this.setManipulateOriginObjs(r);this.setManipulateObjs(p);var e=this.getManipulateObjInfoMap();e.clear();this.getManipulateObjCurrInfoMap().clear();var s=this.getEditor();for(var n=0,g=p.length;n<g;++n){var m=p[n];var f=this.createManipulateObjInfo(m,o);e.set(m,f)}this.setStartBox(h);this.setRotateCenter(t);this.createManipulateOperation()},cancelManipulatingObjs:function(){var e=this.getEditor();var f=this.getManipulateObjs();this.reverseActiveOperation();this.notifyCoordChangeOfObjects(this.getManipulateObjs())},_maniplateObjsFrameEnd:function(e){},_addManipultingObjNewInfo:function(h,f){var e=this.getManipulateObjCurrInfoMap();var g=e.get(h)||{};g=Object.extend(g,f);e.set(h,g)},applyManipulatingObjsInfo:function(o){var n=this.getManipulateObjs();var h=this.getManipulateObjCurrInfoMap();for(var f=0,e=n.length;f<e;++f){var m=n[f];var g=h.get(m);this.applySingleManipulatingObjInfo(f,m,g,o)}},applySingleManipulatingObjInfo:function(h,f,e,g){if(e){if(e.screenCoord){this.doMoveManipulatedObj(h,f,e.screenCoord,g)}if(e.size){this.doResizeManipulatedObj(h,f,e.Size)}}},_calcActualRotateAngle:function(e,f){return f},_calcManipulateObjsRotationInfo:function(e,z){var q=Kekule.CoordUtils;var A;var g=false;var m=this.getRotateCenter();var s=this.getStartCoord();var h=this.getEditorConfigs().getInteractionConfigs().getRotationLocationPointDistanceThreshold();if(h){var u=q.getDistance(s,m);if(u<h){A=0;g=true;this.setStartCoord(z)}var y=q.getDistance(z,m);if(y<h){A=0;g=true;return}}if(!g){var f=q.substract(z,m);var t=Math.atan2(f.y,f.x);f=q.substract(s,m);var w=Math.atan2(f.y,f.x);A=t-w;A=this._calcActualRotateAngle(e,A)}var n=Kekule.CoordUtils.calcTransform2DMatrix({center:m,rotateAngle:A});for(var x=0,v=e.length;x<v;++x){var p=e[x];var B=this.getManipulateObjInfoMap().get(p);if(!B.hasNoCoord){var r=B.screenCoord;var o=q.transform2DByMatrix(r,n);this._addManipultingObjNewInfo(p,{screenCoord:o})}if(B.size){}}},rotateManipulatedObjs:function(m){var h=Kekule.Editor.BoxRegion;var l=Kekule.CoordUtils;var g=this.getEditor();var i=this.getManipulateObjs();var f=[];this._calcManipulateObjsRotationInfo(i,m);var e=this.getManipulateObjCurrInfoMap();g.beginUpdateObject();try{this.applyManipulatingObjsInfo(m);this._maniplateObjsFrameEnd(i);this.notifyCoordChangeOfObjects(i)}finally{g.endUpdateObject()}},_calcManipulateObjsResizeInfo:function(f,h,D){var m=Kekule.Editor.BoxRegion;var v=Kekule.CoordUtils;var p=this.getStartBox();var E=v.substract(D,this.getStartCoord());var q;if(h===m.EDGE_TOP){E.x=0;q={x:(p.x1+p.x2)/2,y:p.y2}}else{if(h===m.EDGE_BOTTOM){E.x=0;q={x:(p.x1+p.x2)/2,y:p.y1}}else{if(h===m.EDGE_LEFT){E.y=0;q={x:p.x2,y:(p.y1+p.y2)/2}}else{if(h===m.EDGE_RIGHT){E.y=0;q={x:p.x1,y:(p.y1+p.y2)/2}}else{if(this.isConstrainedResize()){var B=(p.x2-p.x1)/(p.y2-p.y1);var A=E.x/E.y;if(Math.abs(A)>B){E.x=E.y*B*Math.sign(A)}else{E.y=E.x/B*Math.sign(A)}}q=(h===m.CORNER_TL)?{x:p.x2,y:p.y2}:(h===m.CORNER_TR)?{x:p.x1,y:p.y2}:(h===m.CORNER_BL)?{x:p.x2,y:p.y1}:{x:p.x1,y:p.y1}}}}}var s=(h===m.CORNER_TL)||(h===m.CORNER_BL)||(h===m.EDGE_LEFT);var r=(h===m.CORNER_TL)||(h===m.CORNER_TR)||(h===m.EDGE_TOP);var H=1+E.x/(p.x2-p.x1)*(s?-1:1);var G=1+E.y/(p.y2-p.y1)*(r?-1:1);var y={center:q,scaleX:H,scaleY:G};var g=false;var o=g?v.calcTransform3DMatrix(y):v.calcTransform2DMatrix(y);for(var z=0,x=f.length;z<x;++z){var u=f[z];var F=this.getManipulateObjInfoMap().get(u);var n={};if(!F.hasNoCoord){var w=F.screenCoord;var t=g?v.transform3DByMatrix(w,o):v.transform2DByMatrix(w,o);n.screenCoord=t}if(F.size){var e={x:F.size.x*Math.abs(H),y:F.size.y*Math.abs(G)};n.size=e}this._addManipultingObjNewInfo(u,n)}},resizeManipulatedObjs:function(h){var e=this.getEditor();var g=this.getManipulateObjs();this._calcManipulateObjsResizeInfo(g,this.getResizeStartingRegion(),h);e.beginUpdateObject();var f=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(h);this._maniplateObjsFrameEnd(g);this.notifyCoordChangeOfObjects(g)}finally{e.endUpdateObject()}},_calcActualMovedScreenCoord:function(g,f,e){return e},_calcManipulateObjsMoveInfo:function(p,q){var e=Kekule.CoordUtils;var g=this.getManipulateObjCurrInfoMap();for(var n=0,h=p.length;n<h;++n){var m=p[n];var f=this.getManipulateObjInfoMap().get(m);if(f.hasNoCoord){continue}var o=e.add(q,f.screenCoordOffset);o=this._calcActualMovedScreenCoord(m,f,o);this._addManipultingObjNewInfo(m,{screenCoord:o})}},moveManipulatedObjs:function(l){var i=Kekule.CoordUtils;var f=this.getEditor();var h=this.getManipulateObjs();var e=[];this._calcManipulateObjsMoveInfo(h,l);f.beginUpdateObject();var g=this.getManipulateObjCurrInfoMap();try{this.applyManipulatingObjsInfo(l);this._maniplateObjsFrameEnd(h);this.notifyCoordChangeOfObjects(h)}finally{f.endUpdateObject()}},doMoveManipulatedObj:function(i,h,f,e){var g=this.getEditor();this.updateChildMoveOperation(i,h,g.screenCoordToObj(f));g.setObjectScreenCoord(h,f)},doResizeManipulatedObj:function(g,f,e){this.updateChildResizeOperation(g,f,e);if(f.setSizeOfMode){f.setSizeOfMode(e,this.getEditor().getCoordMode())}},startDirectManipulate:function(i,g,e,l,f){var h=Kekule.ArrayUtils.toArray(g);this.setState(Kekule.Editor.BasicManipulationIaController.State.MANIPULATING);this.setStartCoord(e);this.setIsManipulatingSelection(false);this.prepareManipulating(i||Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE,h,e,l,f)},stopManipulate:function(){this.setManipulateObjs(null);this.getManipulateObjInfoMap().clear();this.getObjOperationMap().clear()},createManipulateObjInfo:function(h,e){var f=this.getEditor();var g={objCoord:f.getObjCoord(h),screenCoord:f.getObjectScreenCoord(h),size:f.getObjSize(h)};g.hasNoCoord=!g.objCoord;if(!g.hasNoCoord){g.screenCoordOffset=Kekule.CoordUtils.substract(g.screenCoord,e)}return g},notifyCoordChangeOfObjects:function(o){var h=[];var g=this.getEditor();for(var f=0,e=o.length;f<e;++f){var m=o[f];Kekule.ArrayUtils.pushUnique(h,m);var n=m.getCoordDeterminateObjects?m.getCoordDeterminateObjects():[m];Kekule.ArrayUtils.pushUnique(h,n)}g.objectsChanged(h)},canInteractWithObj:function(e){return(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL)&&e},doTestMouseCursor:function(n,i){var f="";var m=this._getEventMouseCoord(i,this.getEditor().getEditClientElem());if(this.getState()===Kekule.Editor.BasicManipulationIaController.State.NORMAL){if(this.getEnableResize()){var g=Kekule.Editor.BoxRegion;var h=this.getEditor().getCoordRegionInSelectionMarker(m);var f=(h===g.INSIDE)?"move":(h===g.CORNER_TL)?"nwse-resize":(h===g.CORNER_TR)?"nesw-resize":(h===g.CORNER_BL)?"nesw-resize":(h===g.CORNER_BR)?"nwse-resize":(h===g.EDGE_TOP)||(h===g.EDGE_BOTTOM)?"ns-resize":(h===g.EDGE_LEFT)||(h===g.EDGE_RIGHT)?"ew-resize":""}if(!f){if(this.getEnableRotate()){var h=this.getCoordOnSelectionRotationRegion(m);if(!!h){var l=Kekule.Widget.StyleResourceNames;f=(h===g.CORNER_TL)?l.CURSOR_ROTATE_NW:(h===g.CORNER_TR)?l.CURSOR_ROTATE_NE:(h===g.CORNER_BL)?l.CURSOR_ROTATE_SW:(h===g.CORNER_BR)?l.CURSOR_ROTATE_SE:l.CURSOR_ROTATE}}}}return f},react_mousemove:function($super,l){$super(l);if(this._isBusy){return true}var n=this._getEventMouseCoord(l);if(this._lastMouseMoveCoord){var f=Kekule.CoordUtils.getDistance(n,this._lastMouseMoveCoord);if(f<2){return true}}this._lastMouseMoveCoord=n;var h=Kekule.Editor.BasicManipulationIaController.State;var g=Kekule.Editor.BasicManipulationIaController.ManipulationType;var i=this.getState();if(i===h.SELECTING){if(this.getEnableSelect()){this.getEditor().dragSelectingBoxToCoord(n)}}else{if(i===h.MANIPULATING){var m=this.getManipulationType();try{this._isBusy=true;if(m===g.MOVE){this.moveManipulatedObjs(n)}else{if(m===g.RESIZE){this._suppressConstrainedResize=l.getAltKey();this.resizeManipulatedObjs(n)}else{if(m===g.ROTATE){this.rotateManipulatedObjs(n)}}}}finally{this._isBusy=false}}}return true},react_mousedown:function(p){var l=Kekule.Editor.BasicManipulationIaController.State;var h=Kekule.Editor.BasicManipulationIaController.ManipulationType;if(p.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this._lastMouseMoveCoord=null;var o=this._getEventMouseCoord(p);if((this.getState()===l.NORMAL)){this.setStartCoord(o);var i=this.getEditor().getCoordRegionInSelectionMarker(o);var n=Kekule.Editor.BoxRegion;var q=this.getEnableResize()&&(i!==n.INSIDE)&&(i!==n.OUTSIDE);var r=!q&&this.getEnableMove()&&(i!==n.OUTSIDE);var g=this.getCoordOnSelectionRotationRegion(o);var s=!q&&!r&&this.getEnableRotate()&&!!g;if(q){this.setState(l.MANIPULATING);this.setIsManipulatingSelection(true);this.setResizeStartingRegion(i);this.prepareManipulating(h.RESIZE,this.getEditor().getSelection(),o,this.getEditor().getSelectionContainerBox())}else{if(r){this.setState(l.MANIPULATING);this.setIsManipulatingSelection(true);this.prepareManipulating(h.MOVE,this.getEditor().getSelection(),o)}else{if(s){this.setState(l.MANIPULATING);this.setIsManipulatingSelection(true);this.setRotateStartingRegion(g);this.prepareManipulating(h.ROTATE,this.getEditor().getSelection(),o,this.getEditor().getSelectionContainerBox())}else{var m=this.getEditor().getTopmostBasicObjectAtCoord(o);if(m){m=m.getNearestSelectableObject();if(this.getEnableMove()){this.startDirectManipulate(null,m,o)}}else{if(this.getEnableSelect()){var f=p.getShiftKey();this.getEditor().startSelectingBoxDrag(o,f);this.setState(l.SELECTING)}}}}}}}else{if(p.getButton()===Kekule.X.Event.MOUSE_BTN_RIGHT){if(this.getState()===l.MANIPULATING){this.cancelManipulatingObjs();this.setState(l.NORMAL);p.stopPropagation()}}}return true},react_mouseup:function(m){if(m.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var n=this._getEventMouseCoord(m);this.setEndCoord(n);var h=this.getStartCoord();var f=n;var l=m.getShiftKey();var i=this.getState();var g=Kekule.Editor.BasicManipulationIaController.State;if(i===g.SELECTING){this.getEditor().endSelectingBoxDrag(n,l);this.setState(g.NORMAL)}else{if(i===g.MANIPULATING){if(Kekule.CoordUtils.isEqual(h,f)){if(this.getEnableSelect()){this.getEditor().selectOnCoord(h,l)}}else{if(this.getEnableMove()){this.addOperationToEditor()}}this.stopManipulate();this.setState(g.NORMAL)}}}return true}});Kekule.Editor.BasicManipulationIaController.State={NORMAL:0,SELECTING:1,MANIPULATING:2};Kekule.Editor.BasicManipulationIaController.ManipulationType={MOVE:0,ROTATE:1,RESIZE:2};Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicManipulationIaController,Kekule.Editor.BaseEditor)})();(function(){Kekule.ChemObjOperation={};Kekule.ChemObjOperation.Base=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemObjOperation.Base",initialize:function($super,a){$super();this.setTarget(a)},initProperties:function(){this.defineProp("target",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("allowCoordBorrow",{dataType:DataType.BOOL})}});Kekule.ChemObjOperation.Modify=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Modify",initialize:function($super,b,a){$super(b);if(a){this.setNewPropValues(a)}},initProperties:function(){this.defineProp("newPropValues",{dataType:DataType.HASH});this.defineProp("oldPropValues",{dataType:DataType.HASH})},doExecute:function(){var a={};var d=this.getNewPropValues();var c=this.getTarget();for(var e in d){var b=d[e];a[e]=c.getPropValue(e);c.setPropValue(e,b)}this.setOldPropValues(a)},doReverse:function(){var c=this.getOldPropValues();var b=this.getTarget();for(var d in c){var a=c[d];b.setPropValue(d,a)}}});Kekule.ChemObjOperation.MoveTo=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.MoveTo",initialize:function($super,d,a,b,c){$super(d);if(a){this.setNewCoord(a)}this.setCoordMode(b||Kekule.CoordMode.COORD2D);this.setUseAbsCoord(!!c)},initProperties:function(){this.defineProp("newCoord",{dataType:DataType.HASH});this.defineProp("oldCoord",{dataType:DataType.HASH});this.defineProp("coordMode",{dataType:DataType.INT});this.defineProp("useAbsCoord",{dataType:DataType.BOOL})},setObjCoord:function(c,e,b){if(c&&e&&b){var d=false;if(this.getUseAbsCoord()){if(c.setAbsCoordOfMode){c.setAbsCoordOfMode(e,b);d=true}}else{if(c.setCoordOfMode){c.setCoordOfMode(e,b);d=true}}if(!d){var a=c.getClassName?c.getClassName():(typeof c);Kekule.warn(Kekule.ErrorMsg.CAN_NOT_SET_COORD_OF_CLASS.format(a))}}},getObjCoord:function(b,a){if(this.getUseAbsCoord()){if(b.getAbsCoordOfMode){return b.getAbsCoordOfMode(a,this.getAllowCoordBorrow())}}else{if(b.getCoordOfMode){return b.getCoordOfMode(a,this.getAllowCoordBorrow())}}return null},doExecute:function(){var a=this.getTarget();if(!this.getOldCoord()){this.setOldCoord(this.getObjCoord(a,this.getCoordMode()))}if(this.getNewCoord()){this.setObjCoord(this.getTarget(),this.getNewCoord(),this.getCoordMode())}},doReverse:function(){if(this.getOldCoord()){this.setObjCoord(this.getTarget(),this.getOldCoord(),this.getCoordMode())}}});Kekule.ChemObjOperation.MoveAndResize=Class.create(Kekule.ChemObjOperation.MoveTo,{CLASS_NAME:"Kekule.ChemObjOperation.MoveAndResize",initialize:function($super,e,b,a,c,d){$super(e,a,c,d)},initProperties:function(){this.defineProp("newDimension",{dataType:DataType.HASH});this.defineProp("oldDimension",{dataType:DataType.HASH})},setObjSize:function(d,c,b){if(d&&c){if(d.setSizeOfMode){d.setSizeOfMode(c,b)}else{var a=d.getClassName?d.getClassName():(typeof d);Kekule.warn(Kekule.ErrorMsg.CAN_NOT_SET_DIMENSION_OF_CLASS.format(a))}}},getObjSize:function(b,a){if(b.getSizeOfMode){return b.getSizeOfMode(a,this.getAllowCoordBorrow())}else{return null}},doExecute:function($super){$super();var a=this.getTarget();if(!this.getOldDimension()){this.setOldDimension(this.getObjSize(a,this.getCoordMode()))}if(this.getNewDimension()){this.setObjSize(this.getTarget(),this.getNewDimension(),this.getCoordMode())}},doReverse:function($super){if(this.getOldDimension()){this.setObjSize(this.getTarget(),this.getOldDimension(),this.getCoordMode())}$super()}});Kekule.ChemObjOperation.Add=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Add",initialize:function($super,c,b,a){$super(c);this.setParentObj(b);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var b=this.getParentObj();var c=this.getTarget();if(b&&c){var a=this.getRefSibling()||null;b.insertBefore(c,a)}},doReverse:function(){var c=this.getTarget();var b=this.getParentObj();if(b&&c){var a=this.getRefSibling();if(!a){a=c.getNextSibling();this.setRefSibling(a)}b.removeChild(c)}}});Kekule.ChemObjOperation.Remove=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemObjOperation.Remove",initialize:function($super,c,b,a){$super(c);this.setParentObj(b);this.setRefSibling(a)},initProperties:function(){this.defineProp("parentObj",{dataType:"Kekule.ChemObject",serializable:false});this.defineProp("refSibling",{dataType:"Kekule.ChemObject",serializable:false})},doExecute:function(){var c=this.getTarget();var b=this.getParentObj();if(!b&&c.getParent){b=c.getParent();this.setParentObj(b)}if(b&&c){if(!this.getRefSibling()){var a=c.getNextSibling?c.getNextSibling():null;this.setRefSibling(a)}b.removeChild(c)}},doReverse:function(){var b=this.getParentObj();var c=this.getTarget();if(b&&c){var a=this.getRefSibling();b.insertBefore(c,a)}}});Kekule.ChemStructOperation={};Kekule.ChemStructOperation.AddNode=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddNode"});Kekule.ChemStructOperation.RemoveNode=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveNode",initProperties:function(){this.defineProp("linkedConnectors",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getLinkedConnectors()){this.setLinkedConnectors(Kekule.ArrayUtils.clone(this.getTarget().getLinkedConnectors()))}$super()},doReverse:function($super){$super();var d=this.getLinkedConnectors();if(d&&d.length){var c=this.getTarget();for(var b=0,a=d.length;b<a;++b){c.appendLinkedConnector(d[b])}}}});Kekule.ChemStructOperation.ReplaceNode=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.ChemStructOperation.ReplaceNode",initialize:function($super,c,a,b){$super();this.setOldNode(c);this.setNewNode(a);this.setParentObj(b)},initProperties:function(){this.defineProp("oldNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("newNode",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("parentObj",{dataType:"Kekule.ChemStructureFragment",serializable:false})},doExecute:function(){var c=this.getOldNode();var a=this.getNewNode();if(c&&a){var b=this.getParentObj();if(!b){b=c.getParent();this.setParentObj(b)}if(b.replaceNode){b.replaceNode(c,a)}}},doReverse:function(){var c=this.getOldNode();var a=this.getNewNode();if(c&&a){var b=this.getParentObj()||a.getParent();if(b.replaceNode){b.replaceNode(a,c)}}}});Kekule.ChemStructOperation.AddConnector=Class.create(Kekule.ChemObjOperation.Add,{CLASS_NAME:"Kekule.ChemStructOperation.AddConnector",initialize:function($super,d,b,a,c){$super(d);this.setParentObj(b);this.setRefSibling(a);this.setConnectedObjs(c)},initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){$super();var a=Kekule.ArrayUtils.clone(this.getConnectedObjs());if(a&&a.length){this.getTarget().setConnectedObjs(a)}},doReverse:function($super){$super()}});Kekule.ChemStructOperation.RemoveConnector=Class.create(Kekule.ChemObjOperation.Remove,{CLASS_NAME:"Kekule.ChemStructOperation.RemoveConnector",initProperties:function(){this.defineProp("connectedObjs",{dataType:DataType.ARRAY,serializable:false})},doExecute:function($super){if(!this.getConnectedObjs()){this.setConnectedObjs(Kekule.ArrayUtils.clone(this.getTarget().getConnectedObjs()))}$super()},doReverse:function($super){$super();var a=this.getConnectedObjs();if(a&&a.length){this.getTarget().setConnectedObjs(a)}}});Kekule.ChemStructOperation.MergeNodes=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeNodes",initialize:function($super,c,b,a){$super(c);this.setDest(b);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._structFragmentMergeOperation=null;this._removeConnectorOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureNode",serializable:false});this.defineProp("changedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("removedConnectors",{dataType:DataType.ARRAY,serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL})},getCommonSiblings:function(c,b){var a=c.getLinkedObjs();var d=b.getLinkedObjs();return Kekule.ArrayUtils.intersect(a,d)},doExecute:function(){var p=this.getTarget();var h=this.getDest();var o=p.getParent();var q=h.getParent();if(o!==q){if(this.getEnableStructFragmentMerge()){this._structFragmentMergeOperation=new Kekule.ChemStructOperation.MergeStructFragment(o,q);this._structFragmentMergeOperation.execute();o=q}else{return null}}this._nodeParent=o;var e=this.getRemovedConnectors();if(!e){var b=this.getCommonSiblings(p,h);var e=[];if(b.length){for(var g=0,f=b.length;g<f;++g){var r=b[g];var d=p.getConnectorTo(r);if(d&&(d.getConnectedObjCount()==2)){e.push(d)}}}var n=p.getConnectorTo(h);if(n){e.push(n)}this.setRemovedConnectors(e)}var a=this.getChangedConnectors();if(!a){var a=Kekule.ArrayUtils.clone(p.getLinkedConnectors())||[];a=Kekule.ArrayUtils.exclude(a,e);this.setChangedConnectors(a)}this._refSibling=p.getNextSibling();for(var g=0,f=a.length;g<f;++g){var d=a[g];var m=d.indexOfConnectedObj(p);d.removeConnectedObj(p);d.insertConnectedObjAt(h,m)}this._removeConnectorOperations=[];for(var g=0,f=e.length;g<f;++g){var d=e[g];var c=new Kekule.ChemStructOperation.RemoveConnector(d);c.execute();this._removeConnectorOperations.push(c)}o.removeNode(p)},doReverse:function(){var m=this.getTarget();var f=this.getDest();var h=this._nodeParent;h.insertBefore(m,this._refSibling);if(this._removeConnectorOperations.length){for(var e=this._removeConnectorOperations.length-1;e>=0;--e){var b=this._removeConnectorOperations[e];b.reverse()}}this._removeConnectorOperations=[];var a=this.getChangedConnectors();for(var e=0,c=a.length;e<c;++e){var d=a[e];var g=d.indexOfConnectedObj(f);d.removeConnectedObj(f);d.insertConnectedObjAt(m,g)}if(this._structFragmentMergeOperation){this._structFragmentMergeOperation.reverse()}}});Kekule.ChemStructOperation.MergeNodes.canMerge=function(e,b,g,d){var f=e.getParent();var c=b.getParent();var a=(f===c)||g;if(!d){a=a&&(!e.getConnectorTo(b))}return a};Kekule.ChemStructOperation.MergeConnectors=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeConnectors",initialize:function($super,d,b,c,a){$super(d);this.setDest(b);this.setCoordMode(c||Kekule.CoordMode.COORD2D);this.setEnableStructFragmentMerge(a||false);this._refSibling=null;this._nodeParent=null;this._nodeMergeOperations=[]},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.ChemStructureConnector",serializable:false});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("coordMode",{dataType:DataType.INT})},doExecute:function(){var u=Kekule.ChemStructOperation.MergeConnectors.canMerge(this.getTarget(),this.getDest(),this.getEnableStructFragmentMerge());if(!u){Kekule.error(Kekule.ErrorMsg.CAN_NOT_MERGE_CONNECTORS)}var m=this.getCoordMode();var c=[this.getTarget(),this.getDest()];var r=Kekule.ArrayUtils;var q=r.clone(this.getTarget().getConnectedObjs());var s=r.clone(this.getDest().getConnectedObjs());var e=this.getAllowCoordBorrow();for(var n=0,h=c.length;n<h;++n){var g=c[n];var p=g.getConnectedObjAt(0).getAbsCoordOfMode(m,e);var o=g.getConnectedObjAt(1).getAbsCoordOfMode(m,e);var a=Kekule.CoordUtils.substract(p,o);var t=Math.abs(a.x)>Math.abs(a.y)?"x":"y";if(Kekule.ObjUtils.notUnset(p.z)){if(Math.abs(a.z)>Math.abs(a.x)){t="z"}}var b=(n===0)?q:s;b.sort(function(l,i){var w=l.getAbsCoordOfMode(m,e);var v=i.getAbsCoordOfMode(m,e);return(w[t]-v[t])||0})}var d=r.intersect(q,s);q=r.exclude(q,d);s=r.exclude(s,d);this._nodeMergeOperations=[];for(var n=0,h=q.length;n<h;++n){if(q[n]!==s[n]){var f=new Kekule.ChemStructOperation.MergeNodes(q[n],s[n],this.getEnableStructFragmentMerge());f.execute()}this._nodeMergeOperations.push(f)}},doReverse:function(){for(var a=this._nodeMergeOperations.length-1;a>=0;--a){var b=this._nodeMergeOperations[a];b.reverse()}this._nodeMergeOperations=[]}});Kekule.ChemStructOperation.MergeConnectors.canMerge=function(d,c,e){if(!e&&(d.getParent()!==c.getParent())){return false}if(d.isConnectingConnector()||c.isConnectingConnector()){return false}var a=d.getConnectedExposedObjs();var b=c.getConnectedObjs();if(a.length!==b.length){return false}if(a.length!==2){return false}if(Kekule.ArrayUtils.intersect(a,b).length>=1){return false}return true};Kekule.ChemStructOperation.MergeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.MergeStructFragment",initialize:function($super,b,a){$super(b);this.setDest(a);this._removeOperation=null},initProperties:function(){this.defineProp("dest",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("mergedNodes",{dataType:DataType.ARRAY,serializable:false});this.defineProp("mergedConnectors",{dataType:DataType.ARRAY,serializable:false})},moveChildBetweenStructFragment:function(d,c,b,a){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(d,c,b,a)},doExecute:function(){var e=this.getTarget();var c=this.getDest();if(e&&c){var b=Kekule.ArrayUtils.clone(e.getNodes());this.setMergedNodes(b);var a=Kekule.ArrayUtils.clone(e.getConnectors());this.setMergedConnectors(a);this.moveChildBetweenStructFragment(e,c,b,a);var d=e.getParent();if(d){this._removeOperation=new Kekule.ChemObjOperation.Remove(e,d);this._removeOperation.execute()}}},doReverse:function(){var d=this.getTarget();var c=this.getDest();if(d&&c){if(this._removeOperation){this._removeOperation.reverse();this._removeOperation=null}var b=this.getMergedNodes();var a=this.getMergedConnectors();this.moveChildBetweenStructFragment(c,d,b,a)}}});Kekule.ChemStructOperation.SplitStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.SplitStructFragment",initialize:function($super,a){$super(a)},initProperties:function(){this.defineProp("splittedFragments",{dataType:DataType.ARRAY,serializable:false,setter:null})},doExecute:function(){var f=Kekule.ChemStructureUtils.splitStructFragment(this.getTarget());if(f.length>1){this.setPropStoreFieldValue("splittedFragments",f);var c=this.getTarget().getParent();var d=this.getTarget().getNextSibling();c.beginUpdate();try{if(c){for(var b=1,a=f.length;b<a;++b){var e=f[b];c.insertBefore(e,d)}}}finally{c.endUpdate()}}else{this.setPropStoreFieldValue("splittedFragments",null)}},doReverse:function(){var a=this.getSplittedFragments();if(a&&a.length){var e=this.getTarget();for(var c=0,b=a.length;c<b;++c){var f=a[c];if(f!==e){Kekule.ChemStructureUtils.moveChildBetweenStructFragment(f,e,Kekule.ArrayUtils.clone(f.getNodes()),Kekule.ArrayUtils.clone(f.getConnectors()));var d=f.getParent();if(d){d.removeChild(f)}f.finalize()}}}}});Kekule.ChemStructOperation.StandardizeStructFragment=Class.create(Kekule.ChemObjOperation.Base,{CLASS_NAME:"Kekule.ChemStructOperation.StandardizeStructFragment",initialize:function($super,a){$super(a);this.setEnableSplit(true);this.setEnableRemove(true);this._concreteOper=null},initProperties:function(){this.defineProp("enableRemove",{dataType:DataType.BOOL});this.defineProp("enableSplit",{dataType:DataType.BOOL})},doExecute:function(){var b=this.getTarget();var a=b.getNodeCount();this._concreteOper=null;if(a<=0){if(this.getEnableRemove()){this._concreteOper=new Kekule.ChemObjOperation.Remove(b)}}else{if(this.getEnableSplit()){this._concreteOper=new Kekule.ChemStructOperation.SplitStructFragment(b)}}if(this._concreteOper){return this._concreteOper.execute()}else{return null}},doReverse:function(){return this._concreteOper?this._concreteOper.reverse():null}})})();(function(){Kekule.Editor.StructureUtils={getCascadeDeleteObjs:function(a){return Kekule.ChemStructureUtils.getCascadeDeleteObjs(a)},getSurroundingObjs:function(c){var b=c.getLinkedObjs();if(c instanceof Kekule.ChemStructureConnector){var a=c.getConnectedObjs();Kekule.ArrayUtils.pushUnique(b,a)}return b},calcMostEmptyDirectionAngleOfChemObj:function(h,d,e){var p=[];if(!d){d=h.getLinkedObjs()}var r=h.getAbsBaseCoord2D(e);for(var m=0,g=d.length;m<g;++m){var o=d[m].getAbsBaseCoord2D(e);o=Kekule.CoordUtils.substract(o,r);var f=Math.atan2(o.y,o.x);if(f<0){f=Math.PI*2+f}p.push(f)}p.sort();var g=p.length;if(g===0){return 0}else{if(g===1){return -p[0]}else{var q=0;var n=0;for(var m=0;m<g;++m){var b=p[m];var a=p[(m+1)%g];var s=a-b;if(s<0){s+=Math.PI*2}if(s>q){q=s;n=m}}var t=p[n]+q/2;return t}}},calcPreferred2DBondGrowingDirection:function(e,b,d){var c=e.getAbsBaseCoord2D(d);var f=Kekule.Editor.StructureUtils.getSurroundingObjs(e);var o=f?f.length:0;switch(o){case 0:return b;case 1:var a=f[0];var p=a.getAbsBaseCoord2D(d);var q=Kekule.CoordUtils.substract(p,c);var n=Math.atan2(q.y,q.x);var i=n-b;var h=n+b;if(i<0){i+=Math.PI*2}if(h<0){h+=Math.PI*2}var g;if(i!==h){var m=Math.min((i>Math.PI)?Math.abs(i-Math.PI*2):i,Math.abs(i-Math.PI));var l=Math.min((h>Math.PI)?Math.abs(h-Math.PI*2):h,Math.abs(h-Math.PI));g=(m<=l)?i:h}else{g=i}return g;default:var g=Kekule.Editor.StructureUtils.calcMostEmptyDirectionAngleOfChemObj(e,f,d);return g}},calcPreferred2DBondGrowingLocation:function(a,e,f,b){var c=a.getAbsBaseCoord2D(b);var d=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(a,f,b);return Kekule.CoordUtils.add(c,{x:e*Math.cos(d),y:e*Math.sin(d)})}}})();(function(){var a=Class.PropertyScope;Kekule.Editor.BaseEditorConfigs=Class.create(Kekule.ChemWidget.ChemObjDisplayerConfigs,{CLASS_NAME:"Kekule.Editor.BaseEditorConfigs",initProperties:function(){this.addConfigProp("uiMarkerConfigs","Kekule.EditorConfigs.UiMarkerConfigs");this.addConfigProp("interactionConfigs","Kekule.EditorConfigs.InteractionConfigs");this.addConfigProp("structureConfigs","Kekule.Editor.StructureConfigs")},initPropValues:function($super){$super();this.setPropStoreFieldValue("uiMarkerConfigs",new Kekule.Editor.UiMarkerConfigs());this.setPropStoreFieldValue("interactionConfigs",new Kekule.Editor.InteractionConfigs());this.setPropStoreFieldValue("structureConfigs",new Kekule.Editor.StructureConfigs())}});Kekule.Editor.ChemSpaceEditorConfigs=Class.create(Kekule.Editor.BaseEditorConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditorConfigs",initProperties:function(){this.addConfigProp("chemSpaceConfigs","Kekule.Editor.ChemSpaceConfigs");this.addConfigProp("styleSetterConfigs","Kekule.Editor.StyleSetterConfigs",undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();this.setPropStoreFieldValue("chemSpaceConfigs",new Kekule.Editor.ChemSpaceConfigs());this.setPropStoreFieldValue("styleSetterConfigs",new Kekule.Editor.StyleSetterConfigs())}});Kekule.Editor.InteractionConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.InteractionConfigs",initProperties:function(){this.addBoolConfigProp("enableHotTrack",true);this.addIntConfigProp("objBoundTrackInflation",5);this.addBoolConfigProp("enablePartialAreaSelecting",false);this.addIntConfigProp("selectionMarkerInflation",5,{scope:a.PUBLIC});this.addIntConfigProp("selectionMarkerEdgeInflation",5,{scope:a.PUBLIC});this.addIntConfigProp("rotationRegionInflation",10,{scope:a.PUBLIC});this.addFloatConfigProp("constrainedRotateStep",Math.PI/18*1.5,{scope:a.PUBLIC});this.addIntConfigProp("rotationLocationPointDistanceThreshold",10);this.addIntConfigProp("directedMoveDistanceThreshold",10);this.addIntConfigProp("clonedObjectScreenOffset",10);this.addIntConfigProp("atomSetterFontSize",14)}});Kekule.Editor.UiMarkerConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.UiMarkerConfigs",initProperties:function(){this.addStrConfigProp("hotTrackerColor","#0000FF");this.addFloatConfigProp("hotTrackerOpacity",0.5);this.addStrConfigProp("selectionMarkerStrokeColor","#0000FF");this.addFloatConfigProp("selectionMarkerStrokeWidth",2);this.addStrConfigProp("selectionMarkerFillColor","#0000FF");this.addFloatConfigProp("selectionMarkerOpacity",0.2);this.addFloatConfigProp("selectionTransformMarkerSize",8,{scope:a.PUBLIC});this.addFloatConfigProp("selectionTransformMarkerOpacity",0.4,{scope:a.PUBLIC});this.addStrConfigProp("selectingMarkerStrokeColor","#000000");this.addFloatConfigProp("selectingMarkerStrokeWidth",1);this.addStrConfigProp("selectingMarkerStrokeDash",true);this.addStrConfigProp("selectingMarkerFillColor",null);this.addFloatConfigProp("selectingMarkerOpacity",0.7)}});Kekule.Editor.StructureConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StructureConfigs",initProperties:function(){this.addStrConfigProp("defBondType",Kekule.BondType.DEFAULT,{enumSource:Kekule.BondType});this.addIntConfigProp("defBondOrder",Kekule.BondOrder.SINGLE,{enumSource:Kekule.BondOrder});this.addFloatConfigProp("defBondLength",0.8);this.addConfigProp("defBondAngles",DataType.ARRAY,undefined,{scope:a.PUBLIC});this.addFloatConfigProp("bondConstrainedDirectionDelta",undefined,{scope:a.PUBLIC});this.addFloatConfigProp("initialBondDirection",undefined,{scope:a.PUBLIC});this.addStrConfigProp("defIsotopeId","C");this.addConfigProp("primaryOrgChemAtoms",DataType.ARRAY,undefined,{scope:a.PUBLIC})},initPropValues:function($super){$super();var c=[];var b=Kekule.BondOrder;var d=Math.PI*2/3;c[0]=d;c[b.EXPLICIT_AROMATIC]=[d];c[b.TRIPLE]=[Math.PI];c[b.DOUBLE]=[d];c[b.DOUBLE][b.DOUBLE]=Math.PI;c[b.SINGLE]=[d];this.setDefBondAngles(c);this.setBondConstrainedDirectionDelta(10*Math.PI/180);this.setInitialBondDirection(30*Math.PI/180);this.setPrimaryOrgChemAtoms(["C","H","O","N","P","S","F","Cl","Br","I"])},getDefAngleOfBonds:function(f,d){var c=f||0;var b=d||0;if(c>b){c=d||0;b=f||0}var h=this.getDefBondAngles();var g=h[b];if(!g){return h[0]}else{var e=g[c];return e||g[0]}},getNewBondDefAngle:function(d,e){if(Kekule.ObjUtils.isUnset(e)){e=this.getDefBondOrder()}var c;var f=Kekule.Editor.StructureUtils.getSurroundingObjs(d);if(f.length===1){var b=d.getLinkedConnectorAt(0);if(b&&(b.getConnectedObjs().indexOf(f[0])>=0)){var g=b.getBondOrder?b.getBondOrder():null;if(Kekule.ObjUtils.notUnset(g)){c=this.getDefAngleOfBonds(e,g)}}}else{if(f.length===0){c=this.getInitialBondDirection()}else{c=this.getDefAngleOfBonds(e,0)}}return c}});Kekule.Editor.ChemSpaceConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.ChemSpaceConfigs",initProperties:function(){this.addHashConfigProp("defScreenSize2D");this.addHashConfigProp("defScreenSize3D");this.addNumConfigProp("defPadding",50)},initPropValues:function($super){$super();this.setDefScreenSize2D({x:900,y:1500});this.setDefScreenSize3D({x:600,y:600,z:600})}});Kekule.Editor.StyleSetterConfigs=Class.create(Kekule.AbstractConfigs,{CLASS_NAME:"Kekule.Editor.StyleSetterConfigs",initProperties:function(){this.defineProp("listedFontSizes",{dataType:DataType.ARRAY});this.defineProp("listedFontNames",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setListedFontSizes([8,9,10,11,12,14,16,18,20,24,28,32,36,40,44,48,54,60,66,72,80,88,96]);this.setListedFontNames(Kekule.Widget.FontEnumerator.getAvailableFontFamilies())}})})();(function(){Kekule.Editor.AbstractRepositoryItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Editor.AbstractRepositoryItem",initialize:function($super){$super()},initProperties:function(){},getAvailableCoordModes:function(){return[]},createObjects:function(a){},getRefLength:function(){},isOneStructureFragmentObj:function(){return false}});Kekule.Editor.MolRingRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.MolRingRepositoryItem2D",initialize:function($super,b,a){$super();this.setRingAtomCount(b);this.setBondLength(a||1)},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT});this.defineProp("bondLength",{dataType:DataType.FLOAT});this.defineProp("isAromatic",{dataType:DataType.BOOL})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},getRefLength:function(){return this.getBondLength()},isOneStructureFragmentObj:function(){return true},createObjects:function(c){var b=this.generateRing();var a=null;var e=null;var d={x:0,y:0};if(c){a=(c instanceof Kekule.ChemStructureNode)?b.getNodeAt(0):(c instanceof Kekule.ChemStructureConnector)?b.getConnectorAt(0):null;if(a){e=c}d=a.getAbsBaseCoord2D()}return{objects:[b],mergeObj:a,mergeDest:e,baseObjCoord:d,centerCoord:{x:0,y:0}}},generateRing:function(n,o){if(!o){o=Kekule.Molecule}var s;if(n){s=n}else{s=new o()}var v=this.getRingAtomCount();var m=this.getBondLength();var e=Math.PI/v;var d=Math.sin(e);var u=2*e;var l=m/2/d;var g=((v===4)||(v===8))?-Math.PI/2-u/2:-Math.PI/2;var p;var r;var b;for(var q=0;q<v;++q){var a=this._generateAtom(q);var t=g+u*q;var h=l*Math.cos(t);var f=l*Math.sin(t);a.setCoord2D({x:h,y:f});s.appendNode(a);if(q===0){b=a}if(p){var c=this._generateBond(r,q);s.appendConnector(c);c.appendConnectedObj(p);c.appendConnectedObj(a)}p=a;r=q}var c=this._generateBond(v-1,0);s.appendConnector(c);c.appendConnectedObj(p);c.appendConnectedObj(b);return s},_generateAtom:function(a){return new Kekule.Atom(null,"C")},_generateBond:function(c,b){var a=Kekule.BondOrder.SINGLE;if(this.getIsAromatic()){if(c%2){a=Kekule.BondOrder.DOUBLE}}return new Kekule.Bond(null,null,a)}});Kekule.Editor.PathGlyphRepositoryItem2D=Class.create(Kekule.Editor.AbstractRepositoryItem,{CLASS_NAME:"Kekule.Editor.PathGlyphRepositoryItem2D",initialize:function($super,b,c,a){$super();this.setGlyphClass(b);this.setGlyphRefLength(c||1);this.setGlyphInitialParams(a)},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("glyphInitialParams",{dataType:DataType.HASH})},getAvailableCoordModes:function(){return Kekule.CoordMode.COORD2D},getRefLength:function(){return this.getGlyphRefLength()},createObjects:function(a){var b=this.generateGlyph();var c={x:0,y:0};return{objects:[b],mergeObj:null,mergeDest:null,baseObjCoord:c,centerCoord:c}},generateGlyph:function(){var a=this.getGlyphClass();var b=new a(null,this.getGlyphRefLength(),this.getGlyphInitialParams());return b}})})();(function(){var a=Kekule.ArrayUtils;var d=Kekule.ChemWidget.HtmlClassNames;var b=Kekule.ChemWidgetTexts;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{CHEMSPACE_EDITOR:"K-Chem-Space-Editor",CHEMSPACE_EDITOR2D:"K-Chem-Space-Editor2D",CHEMSPACE_EDITOR3D:"K-Chem-Space-Editor3D",CHEMEDITOR_TEXT_SETTER:"K-ChemEditor-Text-Setter"});Kekule.Editor.ChemSpaceEditor=Class.create(Kekule.Editor.BaseEditor,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor",initialize:function($super,e,h,g,f){this.setPropStoreFieldValue("allowCreateNewChild",true);this.setPropStoreFieldValue("autoCreateNewStructFragment",true);$super(e,h,g,f);this._containerChemSpace=null},initProperties:function(){this.defineProp("chemSpace",{dataType:"Kekule.ChemSpace",serializable:false,getter:function(){return this.getChemObj()},setter:function(e){this.setChemObj(e)}});this.defineProp("defBondLength",{dataType:DataType.FLOAT,serializable:false,getter:function(){var e=this.getPropStoreFieldValue("defBondLength");if(!e){e=this.getEditorConfigs().getStructureConfigs().getDefBondLength()}return e}});this.defineProp("autoCreateNewStructFragment",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("autoCreateNewStructFragment")&&this.canCreateNewChild()}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL})},canCreateNewChild:function(){return this.getChemSpace()&&(this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0))},getActualDrawOptions:function($super){var e=$super();e.useExplicitSpaceSize=true;return e},doSetChemObj:function($super,g){var e=this.getChemObj();if(e&&this._containerChemSpace){e.finalize();this._containerChemSpace=null}if(g){if(g instanceof Kekule.ChemSpace){this._initChemSpaceDefProps(g);return $super(g)}else{var f=this.createContainerChemSpace(null,g);this._containerChemSpace=f;$super(f)}}else{$super(g)}},getExportableClasses:function($super){var e=$super();var h=this.getChemSpace();if(h){for(var g=0,f=h.getChildCount();g<f;++g){var m=h.getChildAt(g);if(m&&m.getClass){Kekule.ArrayUtils.pushUnique(e,m.getClass())}}}return e},exportObj:function($super,g){var e=$super(g);if(!e&&g){var m=this.getChemSpace();if(m){for(var h=0,f=m.getChildCount();h<f;++h){var n=m.getChildAt(h);if(n&&(n instanceof g)){return n}}}}return e},createDefaultConfigs:function(){return new Kekule.Editor.ChemSpaceEditorConfigs()},doCreateNewDocObj:function(){return this.createContainerChemSpace()},doLoadEnd:function($super,m){var e=$super(m);var g=null;if(m){var f=m.getAllContainingConnectors();if(f&&f.length){var i=(this.getRenderType()===Kekule.Render.RendererType.R3D)?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;g=Kekule.ChemStructureUtils.getConnectorLengthMedian(f,i,this.getAllowCoordBorrow())}}this.setDefBondLength(g);var l=this.getChemObj();if(l){var h=l.getScreenSize();this.changeClientSize(h.x,h.y,this.getCurrZoom());this.scrollClientToTop()}return e},zoomChanged:function($super,g){$super();var f=this.getChemObj();var e=f.getScreenSize();this.changeClientSize(e.x,e.y,g)},createNewBoundInfoRecorder:function($super,f){$super(f);var e=this.getBoundInfoRecorder();if(e){e.addEventListener("updateBasicDrawObject",this.reactUpdateBasicDrawObject,this)}},reactUpdateBasicDrawObject:function(h){var g=h.obj;if(g&&(g instanceof Kekule.TextBlock)){var f=h.boundInfo;this.updateTextBlockSize(g,f)}},objectChanged:function($super,f,e){if(this.getCoordMode()===Kekule.CoordMode.COORD2D){if(f instanceof Kekule.TextBlock){f.setPropStoreFieldValue("size2D",{x:null,y:null})}}return $super(f,e)},updateTextBlockSize:function(f,i){if(this.getCoordMode()!==Kekule.CoordMode.COORD2D){return}var l=f.getSize2D();if(Kekule.ObjUtils.notUnset(l.x)||Kekule.ObjUtils.notUnset(l.y)){return}var e=i.shapeType;if(e===Kekule.Render.BoundShapeType.RECT){var m=i.coords;var h=this.contextCoordToObj(m[0]);var g=this.contextCoordToObj(m[1]);var n=Kekule.CoordUtils.substract(g,h);f.setPropStoreFieldValue("size2D",{x:Math.abs(n.x),y:Math.abs(n.y)})}},createContainerChemSpace:function(e,g){var o=new Kekule.ChemDocument(e);this._initChemSpaceDefProps(o,g);if(g){o.appendChild(g);var f=o.getSizeOfMode(this.getCoordMode(),this.getAllowCoordBorrow());var l,m;if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var n=this.getEditorConfigs().getChemSpaceConfigs().getDefPadding();var m=o.getObjScreenLengthRatio();var h=Kekule.Render.ObjUtils.getContainerBox(g,this.getCoordMode(),this.getAllowCoordBorrow())}if(m&&h){var i=g.getCoordOfMode(this.getCoordMode())||{};l=Kekule.CoordUtils.divide(f,2);l.y=f.y-n*m-h.y2;l.x+=(i.x||0)-(h.x2+h.x1)/2}else{var i=g.getCoordOfMode(this.getCoordMode())||{};l=Kekule.CoordUtils.divide(f,2);l.x-=(h.x2+h.x1)/2;l.y-=(h.y2+h.y1)/2;if(this.getCoordMode()===Kekule.CoordMode.COORD3D){l.z-=(h.z2+h.z1)/2}l=Kekule.CoordUtils.add(l,i)}g.setCoordOfMode(l,this.getCoordMode())}return o},_initChemSpaceDefProps:function(h,i){var l=this.getEditorConfigs();var e=l.getChemSpaceConfigs();if(this.getCoordMode()===Kekule.CoordMode.COORD2D){var f=h.getScreenSize();if(!f.x&&!f.y){f=e.getDefScreenSize2D();h.setScreenSize(f)}if(!h.getDefAutoScaleRefLength()){var o;if(i&&i.getAllAutoScaleRefLengths){var g=i.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());o=g&&g.length?Kekule.ArrayUtils.getMedian(g):null}else{var g=h.getAllAutoScaleRefLengths(this.getCoordMode(),this.getAllowCoordBorrow());o=g.length?Kekule.ArrayUtils.getMedian(g):null}if(!o){o=l.getStructureConfigs().getDefBondLength()}h.setDefAutoScaleRefLength(o)}if(!h.getSize2D()){var n=this.getRenderConfigs().getLengthConfigs().getDefBondLength();var m=h.getDefAutoScaleRefLength()/n;h.setObjScreenLengthRatio(m);h.setSize2D({x:f.x*m,y:f.y*m})}}},createNewStructFragmentAnchor:function(f){if(this.getAutoCreateNewStructFragment()){var e=new Kekule.Molecule(f);this.getChemSpace().appendChild(e);return e}else{return null}},createStructStartingAtom:function(g,i,e,f){this.beginUpdateObject();try{if(g){if(!f){f=this.getEditorConfigs().getStructureConfigs().getDefIsotopeId()}var h=new Kekule.Atom(null,f);g.appendNode(h);h.setAbsCoordOfMode(e,this.getCoordMode());return h}else{return null}}finally{this.endUpdateObject()}},createNewStructFragmentAndStartingAtom:function(h,e,f){this.beginUpdateObject();try{var g;g=this.createNewStructFragmentAnchor(h);if(g){return this.createStructStartingAtom(g,h,e,f)}else{return null}}finally{this.endUpdateObject()}},hasOnlyOneBlankStructFragment:function(){var e=false;if(this.getChemSpace().getChildCount()===1){var f=this.getChemSpace().getChildAt(0);if(f instanceof Kekule.StructureFragment){if(f.getNodeCount()<=0&&f.getConnectorCount()<=0&&!f.hasFormula()){e=true}}}return e},getOnlyOneBlankStructFragment:function(){if(this.hasOnlyOneBlankStructFragment()){return this.getChemSpace().getChildAt(0)}},canAddNewStandaloneObject:function(){return this.getAllowCreateNewChild()||(this.getChemSpace().getChildCount()<=0)},canAddUnconnectedStructFragment:function(){return this.canAddNewStandaloneObject()||this.hasOnlyOneBlankStructFragment()},canCloneObjects:function(){return this.getAllowCreateNewChild()},cloneObjects:function(e,f,o){if(!this.getChemSpace()){return null}var w=this.getAllowCreateNewChild();var s=function(H,G){for(var F=0,E=G.length;F<E;++F){var I=G[F];if((I.isChildOf(H))){return true}}return false};var r=function(H,G,E){if(E.indexOf(G)>=0){a.remove(E,G);return}if(H.getChildAt&&G.getChildAt){var l=G.getChildCount();for(var F=l-1;F>=0;--F){var J=H.getChildAt(F);if(!E.length){H.removeChild(J);continue}var I=G.getChildAt(F);if(E.indexOf(I)>=0){a.remove(E,I)}else{if(s(I,E)){if(I.getChildObjs){r(J,I,E)}}else{H.removeChild(J)}}}}};var B=Kekule.ArrayUtils.toArray(e);var C=[];var t=new Kekule.MapEx();for(var x=0,v=B.length;x<v;++x){var q=B[x];var D=q.getStandaloneAncestor?q.getStandaloneAncestor():q;if(D.clone){Kekule.ArrayUtils.pushUnique(C,D);var p=t.get(D);if(!p){p=[];t.set(D,p)}p.push(q)}}var z=this.getChemSpace();var m=[];var y=this.getCoordMode();var A=this.getAllowCoordBorrow();var g=C.length;for(var x=0;x<g;++x){var q=C[x];var h=q.clone();if(h.clearIds){h.clearIds()}r(h,q,t.get(q));if(o&&w){z.appendChild(h);if(f){var u=this.getObjectScreenCoord(h);var n=Kekule.CoordUtils.add(u,f);this.setObjectScreenCoord(h,n)}}m.push(h)}t.finalize();return m},cloneSelection:function(g,f){if(g===undefined){g=this.getDefaultCloneScreenCoordOffset()}var h=this.getSelection();var e=this.cloneObjects(h,g,f);if(f){this.setSelection(e)}return e},getDefaultCloneScreenCoordOffset:function(){var g=this.getEditorConfigs().getInteractionConfigs().getClonedObjectScreenOffset()||0;var e=this.getCoordMode();var f={x:g,y:g};if(e===Kekule.CoordMode.COORD3D){f.z=g}return f}});Kekule.Editor.ChemSpaceEditor.Settings=Class.create(Kekule.Editor.BaseEditor.Settings,{CLASS_NAME:"Kekule.Editor.ChemSpaceEditor.Settings",initProperties:function(){this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getEditor().getAllowCreateNewChild()},setter:function(e){this.getEditor().setAllowCreateNewChild(e)}})}});Kekule.Editor.BasicMolEraserIaController=Class.create(Kekule.Editor.BasicEraserIaController,{CLASS_NAME:"Kekule.Editor.BasicMolEraserIaController",initialize:function($super,e){$super(e)},doGetActualRemovedObjs:function(m){var e=[];Kekule.ArrayUtils.pushUnique(e,m);for(var h=0,g=m.length;h<g;++h){var f=m[h].getCascadeDeleteObjs?m[h].getCascadeDeleteObjs():[];Kekule.Editor.StructureUtils.getCascadeDeleteObjs(m[h]);if(f){Kekule.ArrayUtils.pushUnique(e,f)}}return e},doRemoveObjs:function(p){if(!p.length){return}var e=new Kekule.MacroOperation();var r=[];for(var o=0,g=p.length;o<g;++o){var n=p[o];var s=n.getParent();var q=this.getEditor();var f;if(n instanceof Kekule.BaseStructureNode){f=new Kekule.ChemStructOperation.RemoveNode(n);Kekule.ArrayUtils.pushUnique(r,n.getParent())}else{if(n instanceof Kekule.BaseStructureConnector){f=new Kekule.ChemStructOperation.RemoveConnector(n);Kekule.ArrayUtils.pushUnique(r,n.getParent())}else{f=new Kekule.ChemObjOperation.Remove(n)}}if(f){e.add(f)}}for(var o=0,g=r.length;o<g;++o){var m=r[o];if(m&&(m instanceof Kekule.StructureFragment)){var h=new Kekule.ChemStructOperation.StandardizeStructFragment(m);h.setEnableSplit(this.getEditor().canCreateNewChild());e.add(h)}}e.execute();if(q&&q.getEnableOperHistory()){q.pushOperation(e)}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolEraserIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.BasicMolManipulationIaController=Class.create(Kekule.Editor.BasicManipulationIaController,{CLASS_NAME:"Kekule.Editor.BasicMolManipulationIaController",initialize:function($super,e){$super(e);this.setEnableMagneticMerge(true);this.setEnableNodeMerge(true);this.setEnableNeighborNodeMerge(true);this.setEnableConnectorMerge(true);this.setEnableStructFragmentMerge(true);this.setEnableConstrainedMove(true);this.setEnableConstrainedRotate(true);this.setEnableDirectedMove(true);this._suppressConstrainedMoving=false;this._suppressConstrainedRotating=false;this._isInDirectedMoving=false;this._directedMovingDirection=null},initProperties:function(){this.defineProp("enableMagneticMerge",{dataType:DataType.BOOL});this.defineProp("enableNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableNeighborNodeMerge",{dataType:DataType.BOOL});this.defineProp("enableConnectorMerge",{dataType:DataType.BOOL});this.defineProp("enableStructFragmentMerge",{dataType:DataType.BOOL});this.defineProp("allManipulateObjsMerged",{dataType:DataType.BOOL,serializable:false});this.defineProp("isMergeDone",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableConstrainedRotate",{dataType:DataType.BOOL,serializable:false});this.defineProp("enableDirectedMove",{dataType:DataType.BOOL,serializable:false});this.defineProp("mergeOperations",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){return $super(e)||(this._isMerging&&e)},isConstrainedMove:function(){if(!this.getEnableConstrainedMove()){return false}var g=this.getManipulateObjs();if(g.length===1){var f=g[0];var e=this.getEditor().getSelection();if(e&&(e.indexOf(f)<0)){if(f instanceof Kekule.ChemStructureNode){return(f.getLinkedObjs().length===1)}}}return false},isConstrainedRotate:function(){return this.getEnableConstrainedMove()},isDirectedMove:function(){return(this.getEnableDirectedMove()&&(!this.isConstrainedMove())&&this._isInDirectedMoving)},createManipulateObjInfo:function($super,h,i){var l=this.getEditor();var f=$super(h,i);var m=this.isConstrainedMove();if(m){var g=h.getLinkedConnectors()[0];var e=h.getLinkedObjs()[0];if(g&&e){f.isConstrained=true;if(!f.hasNoCoord){f.originScreenCoord=l.getObjectScreenCoord(h);f.refScreenCoord=l.getObjectScreenCoord(e);f.connectorScreenLength=Kekule.CoordUtils.getDistance(f.screenCoord,f.refScreenCoord);f.connectorObjLength=g.getLength(this.getEditor().getCoordMode(),this.getEditor().getAllowCoordBorrow());var n=Kekule.CoordUtils.substract(f.originScreenCoord,f.refScreenCoord);f.originBondDirectionAngle=Math.atan2(n.y,n.x);f.constrainedBondDirectionDelta=this.getEditorConfigs().getStructureConfigs().getBondConstrainedDirectionDelta()}}}return f},_calcActualMovedScreenCoord:function($super,n,l,o){var e=Kekule.CoordUtils;var q;var p=o;if(l.isConstrained&&(!this._suppressConstrainedMoving)){var h=l.constrainedBondDirectionDelta||null;var g;var f=e.substract(o,l.refScreenCoord);var m=Math.atan2(f.y,f.x);if(h){var i=Math.round((m-l.originBondDirectionAngle)/h);g=l.originBondDirectionAngle+i*h}else{g=m}q=e.add(l.refScreenCoord,{x:l.connectorScreenLength*Math.cos(g),y:l.connectorScreenLength*Math.sin(g)})}else{q=p}return q},_calcActualRotateAngle:function($super,g,h){var e=(this.isConstrainedRotate()&&(!this._suppressConstrainedRotating))?this.getEditorConfigs().getInteractionConfigs().getConstrainedRotateStep():null;if(e){var f=Math.floor(h/e);return f*e}else{return $super(g,h)}},prepareManipulating:function($super,h,f,e,i,g){this.setMergeOperations([]);$super(h,f,e,i,g);this._directedMovingDirection=null},stopManipulate:function($super){$super()},createManipulateOperation:function($super){$super();this.setMergeOperations([])},getAllObjOperations:function($super){var e=$super()||[];var f=this.getMergeOperations();if(f&&f.length){Kekule.ArrayUtils.pushUnique(e,f)}return e},_canMergeNodes:function(g,h){var f=this.getEnableStructFragmentMerge();var e=this.getEnableNeighborNodeMerge();if(this.getEnableNodeMerge()){return Kekule.ChemStructOperation.MergeNodes.canMerge(g,h,f,e)}else{return false}},_canMergeConnectors:function(f,g){var e=this.getEnableStructFragmentMerge();if(this.getEnableConnectorMerge()){return Kekule.ChemStructOperation.MergeConnectors.canMerge(f,g,e)}else{return false}},_findSuitableMergeTargetBoundInfo:function(f,l,h,e){for(var g=f.length-1;g>=0;--g){var n=f[g];var m=n.obj;if(l.indexOf(m)>=0){continue}if(!(m instanceof h)){continue}if(e&&!e(m)){continue}return n}return null},_getMagneticNodeMergeDest:function(l,m,i){var h=this.getEditor();var f=this;if(m){var e=h.getBoundInfosAtCoord(m);var g=this._findSuitableMergeTargetBoundInfo(e,i,Kekule.ChemStructureNode,function(n){return f._canMergeNodes(l,n)});return g?g.obj:null}else{return null}},moveManipulatedObjs:function($super,i){var e;if(this.isDirectedMove()){var h=Kekule.CoordUtils;var g=this.getStartCoord();var m=h.getDistance(g,i);var l=h.substract(i,g);var f=this._directedMovingDirection;if(this._directedMovingDirection){}else{f=(Math.abs(l.x)>=Math.abs(l.y))?"x":"y";if(m<this.getEditor().getEditorConfigs().getInteractionConfigs().getDirectedMoveDistanceThreshold()){}else{this._directedMovingDirection=f}}e=Object.extend({},g);e[f]=i[f]}else{e=i}return $super(e)},applyManipulatingObjsInfo:function($super,n){this.setAllManipulateObjsMerged(false);var ag=Kekule.Editor.BasicManipulationIaController.ManipulationType;var D=this.getManipulationType();var v=this.getManipulateOriginObjs();var s=this.getManipulateObjs();var f=this.getEditor();var X=[].concat(v);Kekule.ArrayUtils.pushUnique(X,s);var u=this.getMergeOperations();var r=this;var S=(v.length===1)&&(v[0] instanceof Kekule.ChemStructureConnector);var ad=(s.length===1)&&(s[0] instanceof Kekule.ChemStructureNode);if(!S&&this.getEnableMagneticMerge()){var e=this.getManipulateObjCurrInfoMap();var g=this.getManipulateObjInfoMap();var r=this;var x=[];var Y=[];var h=[];for(var aa=0,Z=s.length;aa<Z;++aa){var m=s[aa];var B=e.get(m);var G=B.screenCoord;if(G){var Q=f.getBoundInfosAtCoord(G);var M=this._getMagneticNodeMergeDest(m,G,X);if(M){x.push(aa);Y.push(m);h.push(M)}else{}}}if(Y.length){var ae=Y.length;this.setAllManipulateObjsMerged(ae===s.length);var af=(ae<=1);if(!af){for(var aa=0,Z=Y.length;aa<Z;++aa){var m=Y[aa];var N=h[aa];var P=x[aa];var E=u[P];if(!E||!this.isSameNodeMerge(E,m,N)){af=true;break}}}if(af){this.reverseMergeOpers();var t=Kekule.CoordUtils;if((ae===1)||(f.getCoordMode()===Kekule.CoordMode.COORD3D)){var B=e.get(Y[0]);var G=B.screenCoord;var T=f.getObjectScreenCoord(h[0]);var W=t.substract(T,G);var ab=false;for(var aa=0,Z=s.length;aa<Z;++aa){var m=s[aa];if(m!==Y[0]){var ac=e.get(m);if(ac.screenCoord){var z=t.add(ac.screenCoord,W);ac.screenCoord=z;if(this._getMagneticNodeMergeDest(m,z,X)){ab=true}}}}if(ab){return this.applyManipulatingObjsInfo(n)}else{for(var aa=0,Z=s.length;aa<Z;++aa){var m=s[aa];if(m!==Y[0]){var ac=e.get(m);this.applySingleManipulatingObjInfo(aa,m,ac,n)}}}}else{if((ae>1)&&(f.getCoordMode()!==Kekule.CoordMode.COORD3D)){var p=Y[0];var o=Y[1];var L=g.get(p).screenCoord;var J=g.get(o).screenCoord;var O=f.getObjectScreenCoord(h[0]);var K=f.getObjectScreenCoord(h[1]);var V=t.calcCoordGroup2DTransformParams(L,J,O,K);var I=t.calcTransform2DMatrix(V);var ab=false;for(var aa=0,Z=s.length;aa<Z;++aa){var m=s[aa];if(Y.indexOf(m)<0){var ac=g.get(m);var B=e.get(m);if(ac.screenCoord){var z=t.transform2DByMatrix(ac.screenCoord,I);B.screenCoord=z;if(this._getMagneticNodeMergeDest(m,z,X)){ab=true}}if(ac.size){B.size=t.multiply(ac.size,V.scale)}}}if(ab){return this.applyManipulatingObjsInfo(n)}else{for(var aa=0,Z=s.length;aa<Z;++aa){var m=s[aa];if(Y.indexOf(m)<0){var B=e.get(m);this.applySingleManipulatingObjInfo(aa,m,B,n)}}}}}for(var aa=0,Z=ae;aa<Z;++aa){var m=Y[aa];var N=h[aa];var P=x[aa];var A=this.createNodeMergeOperation(m,N);this.getMergeOperations()[P]=A}this.executeMergeOpers()}f.hotTrackOnObj(h);return}}if(D===ag.MOVE){var y=false;if((S&&this.getEnableConnectorMerge())||(ad&&this.getEnableNodeMerge())){var F;var Q=f.getBoundInfosAtCoord(n);var H=S?Kekule.ChemStructureConnector:Kekule.ChemStructureNode;var q=S?v[0]:s[0];var R=S?function(i){return r._canMergeConnectors(q,i)}:function(i){return r._canMergeNodes(q,i)};var C=this._findSuitableMergeTargetBoundInfo(Q,X,H,R);if(C){var w=C.obj;if(w){this.setAllManipulateObjsMerged(true);f.hotTrackOnObj(w);var E=u[0];if((S&&this.isSameConnectorMerge(E,q,w))||(ad&&this.isSameNodeMerge(E,q,w))){return}else{if(E){this.reverseMergeOpers()}var A=S?this.createConnectorMergeOperation(q,w):this.createNodeMergeOperation(q,w);this.getMergeOperations()[0]=A;A.execute();return}}}}}this.reverseMergeOpers();$super(n)},doMoveManipulatedObj_old:function($super,r,o,l,h){var f=this.getEditor();var A=this.getManipulateObjInfoMap().get(o);var w=l;var e=this.getManipulateOriginObjs();var v=this.getManipulationType();var s=(v===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)&&(e.length===1)&&(e[0] instanceof Kekule.ChemStructureConnector);var u=w;var q=null;var C=this.getMergeOperations();var m=C[r];var D=this.getManipulateObjs();if(!s&&this.getEnableMagneticMerge()&&(o instanceof Kekule.ChemStructureNode)){var g=f.getBoundInfosAtCoord(u);if(g&&g.length){for(var x=g.length-1;x>=0;--x){var A=g[x];var t=A.obj;if(t===o){continue}if(D.indexOf(t)>=0){continue}if(t instanceof Kekule.ChemStructureNode){if(this._canMergeNodes(o,t)){f.addHotTrackedObj(t);if(this.isSameNodeMerge(m,o,t)){return}q=this.createNodeMergeOperation(o,t);break}}}if(!q){f.hotTrackOnObj(null)}else{if(m){this.reverseMergeOpers(r)}this.getMergeOperations()[r]=q;q.execute()}}}var u=h;var B=false;if((v===Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE)){var p=e[0];if(e&&(e.length===1)){var z=f.getTopmostBoundInfoAtCoord(u,[p]);if(z){var n=z.obj;if(n&&(D.indexOf(n)<0)){if(s&&(p instanceof Kekule.ChemStructureConnector)&&(n instanceof Kekule.ChemStructureConnector)){if(this.getEnableConnectorMerge()){f.hotTrackOnObj(n);if(this.getEnableStructFragmentMerge()){B=true}else{B=(p.getParent()===n.getParent())}if(B){q=this.createConnectorMergeOperation(p,n)}}}else{if((p instanceof Kekule.ChemStructureNode)&&(n instanceof Kekule.ChemStructureNode)){if(this._canMergeNodes(p,n)){f.hotTrackOnObj(n);if(this.isSameNodeMerge(m,p,n)){return}else{}q=this.createNodeMergeOperation(p,n)}}}if(q){var m=C[r];if(m){this.reverseMergeOpers(r)}this.getMergeOperations()[r]=q;q.execute();return}}}}}if(!q){f.hideHotTrack();var y=!!this.getMergeOperations().length;if(y){this.reverseMergeOpers(r)}$super(r,o,l,h)}},_maniplateObjsFrameEnd:function($super,e){$super(e)},createNodeMergeOperation:function(g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeNodes.canMerge(g,f,e,this.getEnableNeighborNodeMerge())){return null}else{var h=new Kekule.ChemStructOperation.MergeNodes(g,f,e);return h}},createConnectorMergeOperation:function(g,f){var e=this.getEnableStructFragmentMerge();if(!Kekule.ChemStructOperation.MergeConnectors.canMerge(g,f,e)){return null}else{var h=new Kekule.ChemStructOperation.MergeConnectors(g,f,this.getEditor().getCoordMode(),e);return h}},isSameConnectorMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeConnectors)&&(g===f.getTarget())&&(e===f.getDest())},isSameNodeMerge:function(f,g,e){return f&&(f instanceof Kekule.ChemStructOperation.MergeNodes)&&(g===f.getTarget())&&(e===f.getDest())},executeMergeOpers:function(){var g=Kekule.ArrayUtils.toUnique(this.getMergeOperations());for(var f=0,e=g.length;f<e;++f){if(g[f]){g[f].execute()}}},reverseMergeOpers:function(g){var f=Kekule.ArrayUtils.toUnique(this.getMergeOperations());if(!g){g=0}for(var e=f.length-1;e>=g;--e){if(f[e]){f[e].reverse()}}this.getMergeOperations().length=g},react_mousemove:function($super,f){this._suppressConstrainedMoving=f.getAltKey();this._suppressConstrainedRotating=f.getAltKey();this._isInDirectedMoving=f.getShiftKey();return $super(f)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.BasicMolManipulationIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolBondIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.MolBondIaController",initialize:function($super,e){$super(e);this.setState(c.State.INITIAL);this.setBondOrder(Kekule.BondOrder.SINGLE);this.setAllowBondingToBond(false);this.setEnableBondModification(true);this.setEnableSelect(false);this.setEnableMove(true);this.setAutoSwitchBondOrder(false);this.setEnableNeighborNodeMerge(false)},initProperties:function(){this.defineProp("allowBondingToBond",{dataType:DataType.BOOL,serializable:false});this.defineProp("state",{dataType:DataType.INT,serializable:false});this.defineProp("enableBondModification",{dataType:DataType.BOOL,serializable:false});this.defineProp("autoSwitchBondOrder",{dataType:DataType.BOOL,serializable:false});this.defineProp("startingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("endingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("structFragment",{dataType:"Kekule.ChemStructureFragment",serializable:false});this.defineProp("autoCreatedStructFragment",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("autoCreatedStartingObj",{dataType:"Kekule.ChemStructureObject",serializable:false});this.defineProp("bond",{dataType:"Kekule.Bond",serializable:false});this.defineProp("bondType",{dataType:DataType.STRING,serializable:false});this.defineProp("bondOrder",{dataType:DataType.INT,serializable:false});this.defineProp("bondStereo",{dataType:DataType.INT,serializable:false});this.defineProp("initialBondDirection",{dataType:DataType.FLOAT})},_isBondDifferent:function(g){var e=this.getBondStereo();var f=Kekule.BondStereo;if(e===f.UP||e===f.UP_INVERTED||e===f.DOWN||e===f.DOWN_INVERTED){return true}else{return(g.getBondType()!==this.getBondType())||(g.getBondOrder()!==this.getBondOrder())||(g.getStereo()!==this.getBondStereo())}},canInteractWithObj:function($super,f){var e=this.getState();if(e===c.State.INITIAL){if(f instanceof Kekule.ChemStructureNode){return true}else{if(f instanceof Kekule.ChemStructureConnector){if(this.getAllowBondingToBond()){return true}else{if(this.getEnableBondModification()){if(f instanceof Kekule.Bond){return this._isBondDifferent(f)}}else{return false}}}}}else{return $super(f)}},doTestMouseCursor:function(g,f){return""},isObjValidBondTerminator:function(e){if(!e){return false}if(!this.getAllowBondingToBond()){return(e instanceof Kekule.ChemStructureNode)}else{return((e instanceof Kekule.ChemStructureNode)||(e instanceof Kekule.ChemStructureConnector))}},isBond:function(e){return(e instanceof Kekule.Bond)},getNewBondDefAngle:function(e,f){var g=this.getEditorConfigs().getStructureConfigs();return g.getNewBondDefAngle(e,f)},addDefBond:function(t,i,l){var w;var n=this.getEditor();n.beginUpdateObject();try{if(!i){if(!this.getEditor().canAddUnconnectedStructFragment()){return null}var g=this.getEditor().screenCoordToObj(t);var u=this.getEditor().getOnlyOneBlankStructFragment();if(!u){i=this.getEditor().createNewStructFragmentAndStartingAtom(null,g);this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(i?i.getParent():null)}else{i=this.getEditor().createStructStartingAtom(u,null,g);this.setAutoCreatedStructFragment(null);this.setAutoCreatedStartingObj(i)}}else{this.setAutoCreatedStartingObj(null);this.setAutoCreatedStructFragment(null)}if(this.isObjValidBondTerminator(i)){var n=this.getEditor();this.setStartingObj(i);var q=i.getParent();this.setStructFragment(q);var e=this.getEditorConfigs().getStructureConfigs();var o=Kekule.oneOf(this.getBondType(),e.getDefBondType());var s=Kekule.oneOf(this.getBondOrder(),e.getDefBondOrder());var p=Kekule.oneOf(this.getBondStereo(),Kekule.BondStereo.NONE);var f=n.getDefBondLength?n.getDefBondLength():e.getDefBondLength();var r=this.getNewBondDefAngle(i,s);var m=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingLocation(i,f,r,this.getEditor().getAllowCoordBorrow());var h=this.getEditor().createDefaultNode(m,Kekule.Editor.CoordSys.OBJ,q);this.setEndingObj(h);var v=new Kekule.Bond();v.setBondType(o);v.setBondOrder(s);v.setStereo(p);q.appendConnector(v);v.appendConnectedObj(i);v.appendConnectedObj(h);this.setBond(v);if(l){this.getEditor().objectsChanged([v,h])}w=m}else{w=null}}finally{n.endUpdateObject()}return w},addOperationToEditor:function($super){return $super()},getAllObjOperations:function($super){var e=$super()||[];var f=this.getAddBondOperation();if(f){e.unshift(f)}return e},getAddBondOperation:function(){var p=new Kekule.MacroOperation();var l=this.getEditor();var i=this.getAutoCreatedStructFragment();if(i){var e=new Kekule.ChemObjOperation.Add(i,this.getEditor().getChemObj(),null);p.add(e)}var h=this.getStartingObj();var o=this.getEndingObj();var q=this.getBond();var n=this.getStructFragment();var g=this.getAutoCreatedStartingObj();if(g){var f=new Kekule.ChemStructOperation.AddNode(g,n);p.add(f)}var f=new Kekule.ChemStructOperation.AddNode(o,n);p.add(f);var m=new Kekule.ChemStructOperation.AddConnector(q,n,null,[h,o]);p.add(m);return p},modifyBond:function(u){var p=this.getBondType();var r;var o=Kekule.BondOrder;var h=[o.SINGLE,o.DOUBLE,o.TRIPLE];if(this.getAutoSwitchBondOrder()&&(p===Kekule.BondType.COVALENT)&&(u.getBondType===Kekule.BondType.COVALENT)){var l=u.getBondOrder();var n=h.indexOf(l);if(n>=0){n=(++n)%h.length}else{n=0}r=h[n]}else{r=this.getBondOrder()}var s=u.getStereo();var q=this.getBondStereo();if(s===q){q=Kekule.BondStereo.getInvertedDirection(q)}var t={bondType:p,bondOrder:r,stereo:q};var v=false;for(var g in t){var e=u.getPropValue(g);if(e!==t[g]){v=true;break}}if(v){var m=this.getEditor();m.beginUpdateObject();try{var i=new Kekule.ChemObjOperation.Modify(u,t);i.execute();m.pushOperation(i);var f=[u].concat(u.getConnectedObjs());this.getEditor().objectsChanged(f)}finally{m.endUpdateObject()}}},react_mousedown:function(m){if(m.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var h=c.State;var n=this._getEventMouseCoord(m);var i=this.getState();if(i===h.INITIAL){var f=this.getEditor().getTopmostBoundInfoAtCoord(n);if(f){var l=f.obj;if(this.isObjValidBondTerminator(l)){var g=this.addDefBond(n,l,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),n)}return true}else{if(this.isBond(l)&&this.getEnableBondModification()){this.modifyBond(l);return true}}}else{if(this.getEditor().canAddUnconnectedStructFragment()){var g=this.addDefBond(n,null,true);if(g){this.startDirectManipulate(null,this.getEndingObj(),n)}return true}}}}},react_mouseup:function($super,l){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(l);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(l.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);return true}}return $super(l)}});Kekule.Editor.MolBondIaController.State={INITIAL:0,START_NODE_SET:21,ADJUSTING:22};var c=Kekule.Editor.MolBondIaController;Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolBondIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolAtomIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolAtomIaController",initialize:function($super,e){$super(e);this._createNonAtomLabelInfos()},finalize:function($super){if(this.getAtomSetter()){this.getAtomSetter().finalize()}$super()},initProperties:function(){this.defineProp("currAtom",{dataType:DataType.OBJECT,serializable:false});this.defineProp("atomSetter",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTable",{dataType:DataType.OBJECT,serializable:false});this.defineProp("periodicTableDialog",{dataType:DataType.OBJECT,serializable:false});this.defineProp("nonAtomLabelInfos",{dataType:DataType.ARRAY,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},getNodeLabel:function(f){var g=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();if(f.getIsotopeId){return f.getIsotopeId()}else{if(f instanceof Kekule.SubGroup){return g.getRgroup()}else{var e=f.getCoreDisplayRichTextItem(g);return Kekule.Render.RichTextUtils.toText(e)}}},_getVarAtomListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return e.getVariableAtom()},_getVarAtomNotListLabel:function(){var e=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();return"~"+e.getVariableAtom()},_createNonAtomLabelInfos:function(){var e=[];var f=this.getEditor().getRenderConfigs().getDisplayLabelConfigs();e.push({nodeLabel:f.getRgroup(),nodeClass:Kekule.RGroup,description:Kekule.ChemWidgetTexts.CAPTION_RGROUP});e.push({nodeLabel:f.getDummyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.DUMMY},description:Kekule.ChemWidgetTexts.CAPTION_DUMMY_ATOM});e.push({nodeLabel:f.getHeteroAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.HETERO},description:Kekule.ChemWidgetTexts.CAPTION_HETERO_ATOM});e.push({nodeLabel:f.getAnyAtom(),nodeClass:Kekule.Pseudoatom,props:{atomType:Kekule.PseudoatomType.ANY},description:Kekule.ChemWidgetTexts.CAPTION_ANY_ATOM});e.push({nodeLabel:this._getVarAtomListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.ChemWidgetTexts.CAPTION_VARIABLE_ATOM});e.push({nodeLabel:this._getVarAtomNotListLabel(),nodeClass:Kekule.VariableAtom,description:Kekule.ChemWidgetTexts.CAPTION_VARIABLE_NOT_ATOM});this.setNonAtomLabelInfos(e);return e},_indexOfNonAtomLabel:function(m){var h=this.getNonAtomLabelInfos();for(var f=0,e=h.length;f<e;++f){var g=h[f];if(g.nodeLabel===m){return f}}return -1},_getNonAtomInfo:function(f){var e=this._indexOfNonAtomLabel(f);return(e<0)?null:this.getNonAtomLabelInfos()[e]},getAtomSetterWidget:function(h){var f=this.getAtomSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createAtomSetterWidget(g,e);this.setAtomSetter(f)}return f},_createAtomSetterWidget:function(q,p){var s=new Kekule.Widget.ComboBox(q);var g=this.getEditor().getEditorConfigs().getStructureConfigs().getPrimaryOrgChemAtoms();var m=[];for(var o=0,n=g.length;o<n;++o){m.push({value:g[o],data:{props:{isotopeId:g[o]}}})}m.push({value:b.CAPTION_ATOMLIST_PERIODIC_TABLE});var f=this.getNonAtomLabelInfos();for(var o=0,n=f.length;o<n;++o){var h=f[o];var e={value:h.nodeLabel,data:{props:h.props}};if(h.description){e.text=h.nodeLabel+" - "+h.description}m.push(e)}s.setItems(m);s.appendToElem(p);var r=this;s.addEventListener("keyup",function(l){var i=l.htmlEvent;if(i.getKeyCode()===Kekule.X.Event.KeyCode.ENTER){r.applySetter(s);s.dismiss()}});s.addEventListener("valueSelect",function(i){r.applySetter(s);s.dismiss()});s.addEventListener("showStateChange",function(i){if(!i.isShown&&!i.isDismissed){r.applySetter(s)}});return s},getPeriodicTableDialogWidget:function(h){var f=this.getPeriodicTableDialog();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createPeriodicTableDialogWidget(g,e);this.setPeriodicTableDialog(f)}console.log(f);return f},_createPeriodicTableDialogWidget:function(h,e){var f=new Kekule.Widget.Dialog(h,b.CAPTION_PERIODIC_TABLE_DIALOG,[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var g=new Kekule.ChemWidget.PeriodicTable(h);g.setUseMiniMode(true);g.setEnableSelect(true);g.appendToElem(f.getClientElem());this.setPeriodicTable(g);return f},openSetterUi:function(n,i){var l=this.getAtomSetter();if(l&&l.isShown()){this.applySetter(l,this.getCurrAtom())}if(!this.isValidNode(i)){return}this.setCurrAtom(i);var h=this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize()||0;var f=h/1.5;var e=this.getNodeLabel(i);var m=this.getAtomSetterWidget(true);m.setValue(e);var g=m.getElement().style;g.position="absolute";g.fontSize=h;g.left=(n.x-f)+"px";g.top=(n.y-f)+"px";m.show(null,null,Kekule.Widget.ShowHideType.POPUP);m.selectAll();m.focus()},applySetter:function(h,m){if(!m){m=this.getCurrAtom()}var e;var n=null;var q=h.getValue();var i;if(q===b.CAPTION_ATOMLIST_PERIODIC_TABLE){var i=this.getPeriodicTableDialogWidget(true);i.setCaption(b.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEM);var g=m.getSymbol?m.getSymbol():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(false).setSelectedSymbol(g)}else{if(q===this._getVarAtomListLabel()||q===this._getVarAtomNotListLabel()){var l=q===this._getVarAtomNotListLabel();var i=this.getPeriodicTableDialogWidget(true);i.setCaption(b.CAPTION_PERIODIC_TABLE_DIALOG_SEL_ELEMS);var o=m.getAllowedIsotopeIds?m.getAllowedIsotopeIds():null;var f=m.getDisallowedIsotopeIds?m.getDisallowedIsotopeIds():null;this.getPeriodicTable().setEnableSelect(true).setEnableMultiSelect(true).setSelectedSymbols(l?f:o)}}if(i){var r=this;i.openModal(function(s){if(s===Kekule.Widget.DialogButtons.OK){var v;var u;if(q===b.CAPTION_ATOMLIST_PERIODIC_TABLE){var w=r.getPeriodicTable().getSelectedSymbol();v=Kekule.Atom;u={isotopeId:w}}if(q===r._getVarAtomListLabel()){var t=r.getPeriodicTable().getSelectedSymbols();v=Kekule.VariableAtom;u={allowedIsotopeIds:t,disallowedIsotopeIds:null}}if(q===r._getVarAtomNotListLabel()){var t=r.getPeriodicTable().getSelectedSymbols();v=Kekule.VariableAtom;u={allowedIsotopeIds:null,disallowedIsotopeIds:t}}r.applyModification(m,v,u)}},this);return}var p=this._getNonAtomInfo(q);if(p){e=p.nodeClass;n=p.props}else{e=Kekule.Atom;n={isotopeId:q}}this.applyModification(m,e,n)},applyModification:function(g,r,n){var p;var h,i;var f=g.getClass();if(r!==f){h=new Kekule.MacroOperation();p=new r();p.assign(g);var q=new Kekule.ChemStructOperation.ReplaceNode(g,p);h.add(q)}else{p=g}if(n){i=new Kekule.ChemObjOperation.Modify(p,n);if(h){h.add(i)}}var m=this.getEditor();m.beginUpdateObject();try{var l=h||i;l.execute()}catch(o){Kekule.error(Kekule.ErrorMsg.NOT_A_VALID_ATOM);throw (o)}finally{m.endUpdateObject()}if(m&&m.getEnableOperHistory()&&l){m.pushOperation(l)}},react_mouseup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var l=this._getEventMouseCoord(i);var f=this.getEditor().getTopmostBoundInfoAtCoord(l);if(f){var h=f.obj;if(this.isValidNode(h)){var g=this.getEditor().getObjectScreenCoord(h);i.preventDefault();i.stopPropagation();this.openSetterUi(g,h);this.getEditor().setSelection([h])}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolAtomIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.MolNodeChargeIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.MolNodeChargeIaController",initialize:function($super,e){$super(e);this.setChargeInc(1)},initProperties:function(){this.defineProp("chargeInc",{dataType:DataType.NUMBER,serializable:false});this.defineProp("charge",{dataType:DataType.NUMBER,serializable:false});this.defineProp("radical",{dataType:DataType.INT,serializable:false});this.defineProp("currNode",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){if(this.isValidNode(e)){return true}else{return false}},isValidNode:function(e){return e instanceof Kekule.ChemStructureNode},apply:function(i){var f=false;var l={};var h=i.getCharge();if(Kekule.ObjUtils.notUnset(this.getCharge())){if(h!==this.getCharge()){l.charge=this.getCharge();f=true}}else{if(this.getChargeInc()){h+=this.getChargeInc();l.charge=h;f=true}}var e=i.getRadical();if(this.getRadical()!==e){l.radical=this.getRadical();f=true}if(f){var m=new Kekule.ChemObjOperation.Modify(i,l);m.execute();var g=this.getEditor();if(g&&g.getEnableOperHistory()){g.pushOperation(m)}}},react_mouseup:function(h){if(h.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var i=this._getEventMouseCoord(h);var f=this.getEditor().getTopmostBoundInfoAtCoord(i);if(f){var g=f.obj;if(this.isValidNode(g)){this.apply(g);h.preventDefault();h.stopPropagation()}return true}}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolNodeChargeIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.RepositoryIaController=Class.create(Kekule.Editor.BasicMolManipulationIaController,{CLASS_NAME:"Kekule.Editor.RepositoryIaController",initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("repositoryItem",{dataType:"Kekule.AbstractRepositoryItem",serializable:false});this.defineProp("addRepObjsOper",{dataType:"Kekule.MacroOperation",serializable:false})},_calcNodeMergeAdjustRotateAngle:function(z,p){var o=0;var y=this.getEditor().getCoordMode();if(y!==Kekule.CoordMode.COORD3D){var A=this.getEditor().getAllowCoordBorrow();var q=this.getEditorConfigs().getStructureConfigs();var m=Kekule.Editor.StructureUtils.getSurroundingObjs(z);var h=Kekule.Editor.StructureUtils.getSurroundingObjs(p);if(m.length===1){var e=z.getLinkedConnectorAt(0);var t=e.getBondOrder?e.getBondOrder():0;var v=q.getNewBondDefAngle(p,t);B=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(p,v,A);var f=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(z,m[0],y,A);var g=Math.atan2(f.y,f.x);o=B-g}else{if(h.length===1){var e=p.getLinkedConnectorAt(0);var t=e.getBondOrder?e.getBondOrder():0;var v=q.getNewBondDefAngle(z,t);var B=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(z,v,A);var f=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(p,h[0],y,A);var s=Math.atan2(f.y,f.x);o=s-B}else{var v=q.getNewBondDefAngle(p,null);var B=Kekule.Editor.StructureUtils.calcPreferred2DBondGrowingDirection(p,v,A);var r={};for(var w=0,u=m.length;w<u;++w){var f=Kekule.ChemStructureUtils.getAbsCoordVectorBetweenObjs(z,m[w],y,A);var x=Math.atan2(f.y,f.x);if(Kekule.ObjUtils.isUnset(r.min)||(x<r.min)){r.min=x}if(Kekule.ObjUtils.isUnset(r.max)||(x>r.max)){r.max=x}}var n=(r.max+r.min)/2;o=B-n}}}return o},_calcConnectorMergeTransformParams:function(f,o){var l=f.getConnectedObjAt(0);var i=f.getConnectedObjAt(1);var n=o.getConnectedObjAt(0);var m=o.getConnectedObjAt(1);var h=this.getEditor();var g=h.getObjCoord(l);var e=h.getObjCoord(i);var r=h.getObjCoord(n);var p=h.getObjCoord(m);var q=Kekule.CoordUtils.calcCoordGroup2DTransformParams(g,e,p,r);return q},calcInitialTransformParams:function(l,g,m,h){var q=this.getEditor();var o=g.baseObjCoord;var f=q.getDefBondLength();var p=f/l.getRefLength();var n;var e=o;if(g.mergeObj){var m=g.mergeDest||m;if(m){h=q.getObjectScreenCoord(m);if((g.mergeObj instanceof Kekule.ChemStructureNode)&&(m instanceof Kekule.ChemStructureNode)){n=this._calcNodeMergeAdjustRotateAngle(g.mergeObj,m)}else{if((g.mergeObj instanceof Kekule.ChemStructureConnector)&&(m instanceof Kekule.ChemStructureConnector)){return this._calcConnectorMergeTransformParams(g.mergeObj,m)}}}}var i=q.translateCoord(h,Kekule.Editor.CoordSys.SCREEN,Kekule.Editor.CoordSys.OBJ);if(o){i=Kekule.CoordUtils.substract(i,o)}var r={scale:p,translateX:i.x,translateY:i.y,translateZ:i.z,rotateAngle:n,center:e};return r},addRepositoryObj:function(v,t){var u=this.getEditor();this.setAddRepObjsOper(null);var f=null;u.beginUpdateObject();try{var h=u.getChemSpace();var o=this.getRepositoryItem();f=o.createObjects(v);var y=f.objects;var e=o.isOneStructureFragmentObj();var g=false;var w=this.getEditor().getOnlyOneBlankStructFragment();if(!this.getEditor().canCreateNewChild()&&!f.mergeObj){if(!e||!this.getEditor().canAddUnconnectedStructFragment()){return null}else{g=true}}var s=new Kekule.MacroOperation();for(var r=0,n=y.length;r<n;++r){var q=y[r];var m;if(g){m=new Kekule.ChemStructOperation.MergeStructFragment(q,w)}else{m=new Kekule.ChemObjOperation.Add(q,h)}s.add(m)}s.execute();this.setAddRepObjsOper(s);var p=g?[w]:y;var x=this.calcInitialTransformParams(o,f,v,t);this._transformObjectsCoordAndSize(p,x);f.objects=p}finally{u.endUpdateObject()}return f},_transformObjectsCoordAndSize:function(r,q){var m=this.getEditor().getCoordMode();var g=this.getEditor().getAllowCoordBorrow();var p=(m===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(q):Kekule.CoordUtils.calcTransform2DMatrix(q);var e=Object.extend({},q);e=Object.extend(e,{translateX:0,translateY:0,translateZ:0,center:{x:0,y:0,z:0}});var f=(m===Kekule.CoordMode.COORD3D)?Kekule.CoordUtils.calcTransform3DMatrix(e):Kekule.CoordUtils.calcTransform2DMatrix(e);for(var o=0,h=r.length;o<h;++o){var n=r[o];n.transformAbsCoordByMatrix(p,f,m,true,g);n.scaleSize(q.scale,m,true,g)}},getAllObjOperations:function($super){var f=$super()||[];var e=this.getAddRepObjsOper();if(e){f.unshift(e)}return f},addOperationToEditor:function($super){if(this.getAllManipulateObjsMerged()){return null}else{return $super()}},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE},react_mousedown:function(r){if(r.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){var m=c.State;var p=this._getEventMouseCoord(r);var f=this.getState();if(f===m.INITIAL){var i=this.getEditor().getTopmostBoundInfoAtCoord(p);var o=i?i.obj:null;var h=this.addRepositoryObj(o,p);if(h){var g=h.objects;var q=null;var l=this.getInitManipulationType();if(h.mergeObj){q=this.getEditor().getObjectScreenCoord(h.mergeObj);l=Kekule.Editor.BasicManipulationIaController.ManipulationType.ROTATE}var n=this.getEditor().getObjectsContainerBox(g);this.startDirectManipulate(l,g,p,n,q);this.moveManipulatedObjs(p)}else{}return true}}},react_mouseup:function($super,l){var i=this.getState();var h=this.getStartCoord();var f=this._getEventMouseCoord(l);var g=Kekule.Editor.BasicManipulationIaController.State;if((i===g.MANIPULATING)&&(l.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT)){if(Kekule.CoordUtils.isEqual(h,f)){this.addOperationToEditor();this.stopManipulate();this.setState(g.NORMAL);return true}}return $super(l)}});Kekule.Editor.MolRingIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.MolRingIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.MolRingRepositoryItem2D())},initProperties:function(){this.defineProp("ringAtomCount",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getRingAtomCount()},setter:function(e){this.getRepositoryItem().setRingAtomCount(e)}});this.defineProp("isAromatic",{dataType:DataType.INT,getter:function(){return this.getRepositoryItem().getIsAromatic()},setter:function(e){this.getRepositoryItem().setIsAromatic(e)}})}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.MolRingIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.ArrowLineIaController=Class.create(Kekule.Editor.RepositoryIaController,{CLASS_NAME:"Kekule.Editor.ArrowLineIaController",initialize:function($super,e){$super(e);this.setRepositoryItem(new Kekule.Editor.PathGlyphRepositoryItem2D())},initProperties:function(){this.defineProp("glyphRefLength",{dataType:DataType.FLOAT,getter:function(){return this.getRepositoryItem().getGlyphRefLength()},setter:function(e){this.getRepositoryItem().setGlyphRefLength(e)}});this.defineProp("glyphClass",{dataType:DataType.CLASS,serializable:false,getter:function(){return this.getRepositoryItem().getGlyphClass()},setter:function(e){this.getRepositoryItem().setGlyphClass(e)}});this.defineProp("glyphInitialParams",{dataType:DataType.HASH,getter:function(){return this.getRepositoryItem().getGlyphInitialParams()},setter:function(e){this.getRepositoryItem().setGlyphInitialParams(e)}})},getInitManipulationType:function(){return Kekule.Editor.BasicManipulationIaController.ManipulationType.MOVE},addRepositoryObj:function($super,f,e){this.getRepositoryItem().setGlyphRefLength(this.getEditor().getChemSpace().getDefAutoScaleRefLength());return $super(f,e)}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.ArrowLineIaController,Kekule.Editor.ChemSpaceEditor);Kekule.Editor.TextBlockIaController=Class.create(Kekule.Editor.BaseEditorIaController,{CLASS_NAME:"Kekule.Editor.TextBlockIaController",initialize:function($super,e){$super(e);this._operAddBlock=null},initProperties:function(){this.defineProp("currBlock",{dataType:DataType.OBJECT,serializable:false});this.defineProp("textSetter",{dataType:DataType.OBJECT,serializable:false})},canInteractWithObj:function($super,e){if(e&&this.isValidBlock(e)){return true}else{return false}},isValidBlock:function(e){return e instanceof Kekule.TextBlock},getBlockText:function(e){return e.getText()},createNewBlock:function(g,i){var f=this.getEditor();if(!f.canCreateNewChild()){return null}f.beginUpdateObject();try{var h=new Kekule.TextBlock();g.appendChild(h);f.setObjectScreenCoord(h,i);var e=new Kekule.ChemObjOperation.Add(h,g,null);this._operAddBlock=e}finally{f.endUpdateObject()}return h},getTextSetterWidget:function(h){var f=this.getTextSetter();if(!f&&h){var e=this.getEditor().getCoreElement();var g=e.ownerDocument;f=this._createTextSetterWidget(g,e);this.setTextSetter(f)}return f},_createTextSetterWidget:function(h,f){var e=new Kekule.Widget.TextArea(h);e.setAutoSizeX(true);e.setAutoSizeY(true);e.addClassName(d.CHEMEDITOR_TEXT_SETTER);e.appendToElem(f);var g=this;e.addEventListener("keyup",function(m){var i=m.htmlEvent;var l=i.getKeyCode();if((l===Kekule.X.Event.KeyCode.ENTER)&&(i.getCtrlKey())){g.applySetter(e);e.dismiss()}else{if(l===Kekule.X.Event.KeyCode.ESC){e.dismiss();if(g._operAddBlock){g._operAddBlock.reverse();g._operAddBlock=null}}}});e.addEventListener("showStateChange",function(i){if(!i.isShown&&!i.isDismissed){g.applySetter(e)}});return e},applySetter:function(l,h){if(l._applied){return}if(!h){h=this.getCurrBlock()}var g=l.getText();var i=new Kekule.ChemObjOperation.Modify(h,{text:g});i.execute();var e=this.getEditor();if(e&&e.getEnableOperHistory()){if(this._operAddBlock){var f=new Kekule.MacroOperation();f.add(this._operAddBlock);f.add(i);e.pushOperation(f);this._operAddBlock=null}else{e.pushOperation(i)}}l._applied=true},openSetterUi:function(n,l){var i=this.getTextSetter();if(i&&i.isShown()){this.applySetter(i,this.getCurrBlock())}if(!l){l=this.createNewBlock(this.getEditor().getChemObj(),n)}if(!this.isValidBlock(l)){return}this.setCurrBlock(l);this.getEditor().setSelection([l]);var g=l.getCascadedRenderOption("fontSize")||this.getEditor().getEditorConfigs().getInteractionConfigs().getAtomSetterFontSize();var h=this.getBlockText(l);var m=this.getTextSetterWidget(true);m._applied=false;var e=h||Kekule.ChemWidgetTexts.CAPTION_TEXTBLOCK_INIT;m.setValue(e);var f=m.getElement().style;f.position="absolute";f.fontSize=g+"px";f.left=n.x+"px";f.top=n.y+"px";m.show(null,null,Kekule.Widget.ShowHideType.POPUP);m.selectAll();m.focus()},react_mouseup:function(i){if(i.getButton()===Kekule.X.Event.MOUSE_BTN_LEFT){this.getEditor().setSelection(null);var m=this._getEventMouseCoord(i);var l;var f=this.getEditor().getTopmostBoundInfoAtCoord(m);if(f){var h=f.obj;if(this.isValidBlock(h)){l=h}}var g=l?this.getEditor().getObjectScreenCoord(l):m;i.preventDefault();i.stopPropagation();this.openSetterUi(g,l);return true}}});Kekule.Editor.IaControllerManager.register(Kekule.Editor.TextBlockIaController,Kekule.Editor.ChemSpaceEditor)})();(function(){Kekule.Editor.EditorNexus=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemWidget.StructureTreeView",initialize:function($super,a){$super();this._currInvoker=null;if(a){if(a.editor){this.setEditor(a.editor)}if(a.structureTreeView){this.setStructureTreeView(a.structureTreeView)}if(a.objectInspector){this.setObjectInspector(a.objectInspector)}}},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("editor");this.setPropStoreFieldValue("editor",b);this.editorChanged(b,a)}});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("structureTreeView");this.setPropStoreFieldValue("structureTreeView",b);this.structureTreeViewChanged(b,a)}});this.defineProp("objectInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:function(b){var a=this.getPropStoreFieldValue("objectInspector");this.setPropStoreFieldValue("objectInspector",b);this.objectInspectorChanged(b,a)}})},editorChanged:function(b,a){if(a){this._uninstallEditorEventHandler(a)}if(b){this._installEditorEventHandler(b)}},structureTreeViewChanged:function(b,a){if(a){this._uninstallStructureTreeViewEventHandler(a)}if(b){this._installStructureTreeViewEventHandler(b);this._updateByEditor()}},objectInspectorChanged:function(c,a){var b=this.getEditor();if(b){if(a){if(a.getOperHistory()===b.getOperHistory()){a.setOperHistory(null)}}if(c){c.setOperHistory(b.getOperHistory());c.setEnableOperHistory(b.getEnableOperHistory());this._updateByEditor()}}},_installEditorEventHandler:function(a){a.addEventListener("change",this._reactEditorChanged,this)},_uninstallEditorEventHandler:function(a){a.removeEventListener("change",this._reactEditorChanged,this)},_installStructureTreeViewEventHandler:function(a){a.addEventListener("change",this._reactStructureTreeViewChanged,this)},_uninstallStructureTreeViewEventHandler:function(a){a.removeEventListener("change",this._reactStructureTreeViewChanged,this)},_reactEditorChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getEditor()){return}var d=b.changedPropNames;if(d.indexOf("chemObj")>=0){this.changeRootObj(a.getChemObj(),a)}if(d.indexOf("selection")>=0){this.changeSelection(a.getSelection(),a)}if((d.indexOf("operHistory")>=0)||(d.indexOf("enableOperHistory")>=0)){var c=this.getObjectInspector();if(c){c.setOperHistory(a.getOperHistory());c.setEnableOperHistory(a.getEnableOperHistory())}}},_updateByEditor:function(){this._reactEditorChanged({target:this.getEditor(),changedPropNames:["chemObj","selection","operHistory"]})},_reactStructureTreeViewChanged:function(b){if(this._currInvoker){return}var a=b.target;if(a!==this.getStructureTreeView()){return}var d=b.changedPropNames;if(d.indexOf("selection")>=0){var c=a.getSelectedChemObjs();this.changeSelection(c,a)}},changeSelection:function(d,b){this._currInvoker=b;try{var c=this.getEditor();if(c){if(this._currInvoker!==c){c.setSelection(d)}}var a=this.getStructureTreeView();if(a){if(this._currInvoker!==a){a.selectChemObjs(d)}}var e=this.getObjectInspector();if(e){if(this._currInvoker!==e){e.setObjects(d)}}}finally{this._currInvoker=null}},changeRootObj:function(a,c){this._currInvoker=c;try{var d=this.getEditor();if(d&&this._currInvoker!==d){d.setChemObj(a)}var b=this.getStructureTreeView();if(b&&this._currInvoker!==b){b.setRootObj(a)}}finally{this._currInvoker=null}}})})();(function(){var h=Class.PropertyScope;var c=Kekule.ChemWidget;var f=Kekule.Editor;var b=Kekule.Widget.HtmlClassNames;var g=Kekule.ChemWidget.HtmlClassNames;var d=Kekule.ChemWidget.ComponentWidgetNames;var e=Kekule.ChemWidgetTexts;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{COMPOSER:"K-Chem-Composer",COMPOSER_EDITOR_STAGE:"K-Chem-Composer-Editor-Stage",COMPOSER_ADV_PANEL:"K-Chem-Composer-Adv-Panel",COMPOSER_TOOLBAR:"K-Chem-Composer-Toolbar",COMPOSER_COMMON_TOOLBAR:"K-Chem-Composer-Common-Toolbar",COMPOSER_CHEM_TOOLBAR:"K-Chem-Composer-Chem-Toolbar",COMPOSER_ASSOC_TOOLBAR:"K-Chem-Composer-Assoc-Toolbar",COMPOSER_STYLE_TOOLBAR:"K-Chem-Composer-Style-Toolbar",COMPOSER_FONTNAME_BOX:"K-Chem-Composer-FontName-Box",COMPOSER_FONTSIZE_BOX:"K-Chem-Composer-FontSize-Box",COMPOSER_COLOR_BOX:"K-Chem-Composer-Color-Box",COMPOSER_TEXTDIRECTION_BUTTON:"K-Chem-Composer-TextDirection-Button",COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT:"K-Chem-Composer-TextDirection-Button-Default",COMPOSER_TEXTDIRECTION_BUTTON_LTR:"K-Chem-Composer-TextDirection-Button-LTR",COMPOSER_TEXTDIRECTION_BUTTON_RTL:"K-Chem-Composer-TextDirection-Button-RTL",COMPOSER_TEXTDIRECTION_BUTTON_TTB:"K-Chem-Composer-TextDirection-Button-TTB",COMPOSER_TEXTDIRECTION_BUTTON_BTT:"K-Chem-Composer-TextDirection-Button-BTT",COMPOSER_TEXTALIGN_BUTTON:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL:"K-Chem-Composer-TextAlign-Button-Horizontal",COMPOSER_TEXTALIGN_BUTTON_VERTICAL:"K-Chem-Composer-TextAlign-Button-Vertical",COMPOSER_TEXTALIGN_BUTTON_DEFAULT:"K-Chem-Composer-TextAlign-Button",COMPOSER_TEXTALIGN_BUTTON_LEADING:"K-Chem-Composer-TextAlign-Button-Leading",COMPOSER_TEXTALIGN_BUTTON_TRAILING:"K-Chem-Composer-TextAlign-Button-Trailing",COMPOSER_TEXTALIGN_BUTTON_CENTER:"K-Chem-Composer-TextAlign-Button-Center",COMPOSER_TEXTALIGN_BUTTON_LEFT:"K-Chem-Composer-TextAlign-Button-Left",COMPOSER_TEXTALIGN_BUTTON_RIGHT:"K-Chem-Composer-TextAlign-Right",COMPOSER_TEXTALIGN_BUTTON_TOP:"K-Chem-Composer-TextAlign-Top",COMPOSER_TEXTALIGN_BUTTON_BOTTOM:"K-Chem-Composer-TextAlign-Bottom"});Kekule.Editor.ComposerStyleToolbar=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Editor.ComposerStyleToolbar",ATOM_COLOR_SPECIAL_VALUE_INFO:{value:"(use atom custom color)",text:"Atom",className:b.COLORPICKER_SPEC_COLOR_MIXED},LINKED_VALUE_FIELD:"__$value__",initialize:function($super,i){$super(i);this.setPropStoreFieldValue("composer",i);this.createChildWidgets();this.appendToWidget(i);this._relatedPropNames=(i.getCoordMode()===Kekule.CoordMode.COORD3D)?["renderOptions","render3DOptions"]:["renderOptions"];this.getEditor().addEventListener("selectionChange",function(l){if(!this._isApplying){this.updateStyleValues()}},this);this.getEditor().addEventListener("editObjChanged",function(l){var m=l.propNames;if(!m||!m.length||!Kekule.ArrayUtils.intersect(this._relatedPropNames,m).length){return}if(!this._isApplying){this.updateStyleValues()}},this);this._isApplying=false},doFinalize:function($super){this.clearWidgets();$super()},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false,setter:null});this.defineProp("fontNameBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("fontSizeBox",{dataType:"Kekule.Widget.ComboBox",serializable:false,setter:null});this.defineProp("colorBox",{dataType:"Kekule.Widget.ColorDropButton",serializable:false,setter:null});this.defineProp("textDirectionButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textHorizontalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("textVerticalAlignButtonSet",{dataType:"Kekule.Widget.CompactButtonSet",serializable:false,setter:null});this.defineProp("fontName",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getFontNameBox()?this.getFontNameBox().getValue():null},setter:function(i){if(this.getFontNameBox()){this.getFontNameBox().setValue(i)}}});this.defineProp("fontSize",{dataType:DataType.NUMBER,serializable:false,getter:function(){return this.getFontSizeBox()?parseFloat(this.getFontSizeBox().getValue()):null},setter:function(i){if(this.getFontSizeBox()){this.getFontSizeBox().setValue(i)}}});this.defineProp("color",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getColorBox()?this.getColorBox().getValue():undefined},setter:function(i){if(this.getColorBox()){this.getColorBox().setValue(i)}}});this.defineProp("textDirection",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextDirectionButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextDirectionButtonSet(),i)}});this.defineProp("textHorizontalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextHorizontalAlignButtonSet(),i)}});this.defineProp("textVerticalAlign",{dataType:DataType.INT,serializable:false,getter:function(){return this._getButtonSetLinkedValue(this.getTextVerticalAlignButtonSet())},setter:function(i){this._setButtonSetLinkedValue(this.getTextVerticalAlignButtonSet(),i)}});this.defineProp("componentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var i=this.getPropStoreFieldValue("componentNames");if(!i){i=this.getDefaultComponentNames();this.setPropStoreFieldValue("componentNames",i)}return i},setter:function(i){this.setPropStoreFieldValue("componentNames",i);this.recreateComponents()}})},initPropValues:function($super){$super();this.setShowGlyph(true)},removeWidget:function($super,l,i){if(l===this.getFontNameBox()){this.setPropStoreFieldValue("fontNameBox",null)}if(l===this.getFontSizeBox()){this.setPropStoreFieldValue("fontSizeBox",null)}$super(l,i)},doGetWidgetClassName:function($super){var i=$super()+" "+g.COMPOSER_TOOLBAR+" "+g.COMPOSER_STYLE_TOOLBAR;return i},getEditor:function(){return this.getComposer().getEditor()},getEditorConfigs:function(){return this.getEditor().getEditorConfigs()},createChildWidgets:function(q){if(!q){q=this.getComponentNames()}for(var p=0,o=q.length;p<o;++p){var m=q[p];if(m===d.fontName){var u=new Kekule.Widget.ComboBox(this);this.fillFontNameBox(u);u.addClassName(g.COMPOSER_FONTNAME_BOX);u.setHint(e.HINT_FONTNAME);u.addEventListener("valueChange",function(i){this.applyFontName()},this);this.setPropStoreFieldValue("fontNameBox",u)}else{if(m===d.fontSize){u=new Kekule.Widget.ComboBox(this);this.fillFontSizeBox(u);u.addClassName(g.COMPOSER_FONTSIZE_BOX);u.setHint(e.HINT_FONTSIZE);u.addEventListener("valueChange",function(i){this.applyFontSize()},this);this.setPropStoreFieldValue("fontSizeBox",u)}else{if(m===d.color){var s=new Kekule.Widget.ColorDropButton(this);s.setHint(e.HINT_PICK_COLOR);s.setShowText(false);s.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET,this.ATOM_COLOR_SPECIAL_VALUE_INFO]);s.addClassName(g.COMPOSER_COLOR_BOX);s.addEventListener("valueChange",function(i){this.applyColor()},this);this.setPropStoreFieldValue("colorBox",s)}else{if(m===d.textDirection){var t=Kekule.Render.TextDirection;var r=[{value:t.DEFAULT,text:e.CAPTION_TEXT_DIRECTION_DEFAULT,className:g.COMPOSER_TEXTDIRECTION_BUTTON_DEFAULT},{value:t.LTR,text:e.CAPTION_TEXT_DIRECTION_LTR,className:g.COMPOSER_TEXTDIRECTION_BUTTON_LTR},{value:t.RTL,text:e.CAPTION_TEXT_DIRECTION_RTL,className:g.COMPOSER_TEXTDIRECTION_BUTTON_RTL},{value:t.TTB,text:e.CAPTION_TEXT_DIRECTION_TTB,className:g.COMPOSER_TEXTDIRECTION_BUTTON_TTB},{value:t.BTT,text:e.CAPTION_TEXT_DIRECTION_BTT,className:g.COMPOSER_TEXTDIRECTION_BUTTON_BTT}];var n=this._createStyleButtonSet(e.CAPTION_TEXT_DIRECTION,e.HINT_TEXT_DIRECTION,g.COMPOSER_TEXTDIRECTION_BUTTON,r);n.addEventListener("select",function(i){this.applyTextDirection()},this);this.setPropStoreFieldValue("textDirectionButtonSet",n)}else{if(m===d.textAlign){var v=Kekule.Render.TextAlign;var r=[{value:v.DEFAULT,text:e.CAPTION_TEXT_ALIGN_DEFAULT,className:g.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:v.LEADING,text:e.CAPTION_TEXT_ALIGN_LEADING,className:g.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:v.TRAILING,text:e.CAPTION_TEXT_ALIGN_TRAILING,className:g.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:v.CENTER,text:e.CAPTION_TEXT_ALIGN_CENTER,className:g.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:v.LEFT,text:e.CAPTION_TEXT_ALIGN_LEFT,className:g.COMPOSER_TEXTALIGN_BUTTON_LEFT},{value:v.RIGHT,text:e.CAPTION_TEXT_ALIGN_RIGHT,className:g.COMPOSER_TEXTALIGN_BUTTON_RIGHT}];var n=this._createStyleButtonSet(e.CAPTION_TEXT_HORIZONTAL_ALIGN,e.HINT_TEXT_HORIZONTAL_ALIGN,g.COMPOSER_TEXTALIGN_BUTTON_HORIZONTAL,r);n.addEventListener("select",function(i){this.applyTextHorizontalAlign()},this);this.setPropStoreFieldValue("textHorizontalAlignButtonSet",n);var v=Kekule.Render.TextAlign;var r=[{value:v.DEFAULT,text:e.CAPTION_TEXT_ALIGN_DEFAULT,className:g.COMPOSER_TEXTALIGN_BUTTON_DEFAULT},{value:v.LEADING,text:e.CAPTION_TEXT_ALIGN_LEADING,className:g.COMPOSER_TEXTALIGN_BUTTON_LEADING},{value:v.TRAILING,text:e.CAPTION_TEXT_ALIGN_TRAILING,className:g.COMPOSER_TEXTALIGN_BUTTON_TRAILING},{value:v.CENTER,text:e.CAPTION_TEXT_ALIGN_CENTER,className:g.COMPOSER_TEXTALIGN_BUTTON_CENTER},{value:v.TOP,text:e.CAPTION_TEXT_ALIGN_TOP,className:g.COMPOSER_TEXTALIGN_BUTTON_TOP},{value:v.BOTTOM,text:e.CAPTION_TEXT_ALIGN_BOTTOM,className:g.COMPOSER_TEXTALIGN_BUTTON_BOTTOM}];var n=this._createStyleButtonSet(e.CAPTION_TEXT_ALIGN,e.HINT_TEXT_VERTICAL_ALIGN,g.COMPOSER_TEXTALIGN_BUTTON_VERTICAL,r);n.addEventListener("select",function(i){this.applyTextVerticalAlign()},this);this.setPropStoreFieldValue("textVerticalAlignButtonSet",n)}}}}}}this.updateStyleValues()},_createStyleButtonSet:function(u,q,s,t){var n=new Kekule.Widget.CompactButtonSet(this);n.setText(u);n.setHint(q);n.addClassName(s);n.setShowText(false);n.setShowCompactMark(false);n.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);n.getButtonSet().addClassName(g.COMPOSER_STYLE_TOOLBAR);n.getButtonSet().setShowText(true);if(t){for(var r=0,p=t.length;r<p;++r){var o=t[r];var m=new Kekule.Widget.RadioButton(n,o.text||"");m.setHint(o.hint||"");m.addClassName(o.className);m[this.LINKED_VALUE_FIELD]=o.value;n.append(m,o.selected)}}return n},_getButtonSetLinkedValue:function(i){var l=i?i.getSelected():null;return l?l[this.LINKED_VALUE_FIELD]:undefined},_setButtonSetLinkedValue:function(n,q){if(n){var r=n.getButtonSet();var p=r.getChildWidgets();n.setSelected(null);for(var o=0,m=p.length;o<m;++o){var s=p[o];if(s.hasOwnProperty(this.LINKED_VALUE_FIELD)){if(s[this.LINKED_VALUE_FIELD]==q){n.setSelected(s);break}}}}},getDefaultComponentNames:function(){return[d.fontName,d.fontSize,d.color,d.textDirection,d.textAlign]},recreateComponents:function(){var i=this.getComponentNames();this.clearWidgets();this.createChildWidgets(i)},fillFontSizeBox:function(q){var p=this.getEditorConfigs().getStyleSetterConfigs().getListedFontSizes();var n=[{text:Kekule.ChemWidgetTexts.S_VALUE_DEFAULT,value:undefined}];for(var o=0,m=p.length;o<m;++o){n.push({text:p[o]+" px",value:p[o]})}q.setItems(n)},fillFontNameBox:function(q){var p=this.getEditorConfigs().getStyleSetterConfigs().getListedFontNames();var n=[{text:Kekule.ChemWidgetTexts.S_VALUE_DEFAULT,value:""}];for(var o=0,m=p.length;o<m;++o){n.push({text:p[o],value:p[o]})}q.setItems(n)},applyStyle:function(i,m,n){this._isApplying=true;try{var l=this.getEditor();l.modifyObjectsRenderOptions(i,m,n,true)}finally{this._isApplying=false}},getStyleValue:function(i,m,l){return Kekule.Render.RenderOptionUtils.getCascadeRenderOptionValueOfObjs(i,m,l)},applyStyleToEditorSelection:function(i,l){var m=this.getEditor().getSelection();if(m&&m.length){return this.applyStyle(m,i,l)}},applyFontName:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getFontName();this.applyStyle(l,{fontFamily:i})}},applyFontSize:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getFontSize();this.applyStyle(l,{fontSize:i})}},applyColor:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getColor();if(i===this.ATOM_COLOR_SPECIAL_VALUE_INFO.value){this.applyStyle(l,{useAtomSpecifiedColor:true,color:undefined})}else{if(i==Kekule.Widget.ColorPicker.SpecialColors.UNSET){i=undefined}this.applyStyle(l,{useAtomSpecifiedColor:false,color:i})}}},applyTextDirection:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getTextDirection();this.applyStyle(l,{charDirection:i})}},applyTextHorizontalAlign:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getTextHorizontalAlign();this.applyStyle(l,{horizontalAlign:i})}},applyTextVerticalAlign:function(l){if(!l){l=this.getEditor().getSelection()}if(l&&l.length){var i=this.getTextVerticalAlign();this.applyStyle(l,{verticalAlign:i})}},updateStyleValues:function(i){if(!i){i=this.getEditor().getSelection()}if(i&&i.length){this.updateFontName(i);this.updateFontSize(i);this.updateColor(i);this.updateTextDirection(i);this.updateTextHorizontalAlign(i);this.updateTextVerticalAlign(i)}},updateFontName:function(l){if(l&&l.length&&this.getFontNameBox()){var i=this.getStyleValue(l,"fontFamily");this.setFontName(i||"")}},updateFontSize:function(l){if(l&&l.length&&this.getFontSizeBox()){var i=this.getStyleValue(l,"fontSize");this.setFontSize(i||undefined)}},updateColor:function(m){if(m&&m.length&&this.getColorBox()){var i;var l=this.getStyleValue(m,"useAtomSpecifiedColor");var i=this.getStyleValue(m,"color");this.getColorBox().setColorClassName(null);if(i){this.getColorBox().setColorClassName(null)}else{if(l){i=this.ATOM_COLOR_SPECIAL_VALUE_INFO.value;this.getColorBox().setColorClassName(this.ATOM_COLOR_SPECIAL_VALUE_INFO.className)}}this.setColor(i||undefined)}},updateTextDirection:function(l){if(l&&l.length&&this.getTextDirectionButtonSet()){var i=this.getStyleValue(l,"charDirection");this.setTextDirection(i)}},updateTextHorizontalAlign:function(l){if(l&&l.length&&this.getTextHorizontalAlignButtonSet()){var i=this.getStyleValue(l,"horizontalAlign");this.setTextHorizontalAlign(i)}},updateTextVerticalAlign:function(l){if(l&&l.length&&this.getTextVerticalAlignButtonSet()){var i=this.getStyleValue(l,"verticalAlign");this.setTextVerticalAlign(i)}},updateState:function(){var l=this.getEditor();var i=(l&&l.hasSelection());if(this.getFontNameBox()){this.getFontNameBox().setEnabled(i)}if(this.getFontSizeBox()){this.getFontSizeBox().setEnabled(i)}if(this.getColorBox()){this.getColorBox().setEnabled(i)}if(this.getTextDirectionButtonSet()){this.getTextDirectionButtonSet().setEnabled(i)}if(this.getTextHorizontalAlignButtonSet()){this.getTextHorizontalAlignButtonSet().setEnabled(i)}if(this.getTextVerticalAlignButtonSet()){this.getTextVerticalAlignButtonSet().setEnabled(i)}}});Kekule.Editor.Composer=Class.create(Kekule.ChemWidget.AbstractWidget,{CLASS_NAME:"Kekule.Editor.Composer",BINDABLE_TAG_NAMES:["div"],initialize:function($super,i,l){this.setPropStoreFieldValue("editor",l);$super(i);this.setPropStoreFieldValue("editorNexus",new Kekule.Editor.EditorNexus());this.bindEditor();this.createCommonToolbar();this.createChemToolbar();this.setEnableStyleToolbar(true);this.uiLayoutChanged();this.updateStyleToolbarStateBind=this.updateStyleToolbarState.bind(this)},doFinalize:function($super){var i=this.getCommonBtnGroup();if(i){i.finalize()}var i=this.getChemBtnGroup();if(i){i.finalize()}var l=this.getPropStoreFieldValue("editor");if(l){l.finalize()}this.getEditorNexus().finalize();$super()},initProperties:function(){this.defineProp("editor",{dataType:"Kekule.Editor.BaseEditor",serializable:false,setter:null,getter:function(){var i=this.getPropStoreFieldValue("editor");if(!i){i=this.createDefaultEditor();this.setPropStoreFieldValue("editor",i)}return i}});this.defineProp("showInspector",{dataType:DataType.BOOL,setter:function(i){if(this.getShowInspector()!==i){this.setPropStoreFieldValue("showInspector",i);this.showInspectorChanged()}}});this.defineProp("editorStageElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("advPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("editorNexus",{dataType:"Kekule.Editor.EditorNexus",serializable:false,setter:null});this.defineProp("objInspector",{dataType:"Kekule.Widget.ObjectInspector",serializable:false,setter:null});this.defineProp("structureTreeView",{dataType:"Kekule.ChemWidget.StructureTreeView",serializable:false,setter:null});this.defineProp("commonBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("chemBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("assocBtnGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false});this.defineProp("styleToolbar",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,getter:function(){var i=this.getPropStoreFieldValue("styleToolbar");if(!i){if(this.getEnableStyleToolbar()){i=this.createStyleToolbar();this.setPropStoreFieldValue("styleToolbar",i)}}return i}});this.defineProp("styleToolComponentNames",{dataType:DataType.ARRAY,serializable:false,getter:function(){var i=this.getStyleToolbar();return i?i.getComponentNames():null},setter:function(l){var i=this.getStyleToolbar();if(i){i.setComponentNames(l)}return this}});this.defineProp("enableStyleToolbar",{dataType:DataType.BOOL,setter:function(i){this.setPropStoreFieldValue("enableStyleToolbar",i)}});this.defineProp("commonToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var i=this.getPropStoreFieldValue("commonToolButtons");if(!i){i=this.getDefaultCommonToolBarButtons();this.setPropStoreFieldValue("commonToolButtons",i)}return i},setter:function(i){this.setPropStoreFieldValue("commonToolButtons",i);this.updateCommonToolbar()}});this.defineProp("chemToolButtons",{dataType:DataType.HASH,serializable:false,getter:function(){var i=this.getPropStoreFieldValue("chemToolButtons");if(!i){i=this.getDefaultChemToolBarButtons();this.setPropStoreFieldValue("chemToolButtons",i)}return i},setter:function(i){this.setPropStoreFieldValue("chemToolButtons",i);this.updateChemToolbar()}});this.defineProp("styleBarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var i=this.getPropStoreFieldValue("styleBarComponents");if(!i){i=null;this.setPropStoreFieldValue("styleBarComponents",i)}return i},setter:function(i){this.setPropStoreFieldValue("styleBarComponents",i);if(this.getStyleToolbar()){this.getStyleToolbar().setComponentNames(i)}}});this.defineProp("toolButtonNameMapping",{dataType:DataType.HASH,serializable:false,setter:null,getter:function(){var i=this.getPropStoreFieldValue("toolButtonNameMapping");if(!i){i=this._createDefaultToolButtonNameMapping();this.setPropStoreFieldValue("toolButtonNameMapping",i)}return i}});this.defineProp("commonActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var i=this.getPropStoreFieldValue("commonActions");if(!i){i=new Kekule.ActionList();this.setPropStoreFieldValue("commonActions",i)}return i}});this.defineProp("chemActions",{dataType:"Kekule.ActionList",serializable:false,setter:null,getter:function(){var i=this.getPropStoreFieldValue("chemActions");if(!i){i=new Kekule.ActionList();this.setPropStoreFieldValue("chemActions",i)}return i}});this.defineProp("allowCreateNewChild",{dataType:DataType.BOOL,getter:function(){var i=this.getEditor();return(i&&i.getAllowCreateNewChild)?i.getAllowCreateNewChild():null},setter:function(l){var i=this.getEditor();if(i.setAllowCreateNewChild){i.setAllowCreateNewChild(l)}return this}});this._defineEditorDelegatedProp("chemObj");this._defineEditorDelegatedProp("chemObjLoaded");this._defineEditorDelegatedProp("renderType");this._defineEditorDelegatedProp("renderConfigs");this._defineEditorDelegatedProp("drawOptions");this._defineEditorDelegatedProp("allowCoordBorrow");this._defineEditorDelegatedProp("editorConfigs");this._defineEditorDelegatedProp("operHistory");this._defineEditorDelegatedProp("enableOperHistory");this._defineEditorDelegatedProp("selection");this._defineEditorDelegatedProp("hotTrackedObjs");this._defineEditorDelegatedProp("enableOperContext");this._defineEditorDelegatedProp("enableCreateNewDoc");this._defineEditorDelegatedProp("enableLoadNewFile");this._defineEditorDelegatedProp("initOnNewDoc")},_defineEditorDelegatedProp:function(n,i){if(!i){i=n}var m=ClassEx.getPropInfo(Kekule.Editor.BaseEditor,i);var l=Object.create(m);l.getter=null;l.setter=null;if(m.getter){l.getter=function(){return this.getEditor().getPropValue(i)}}if(m.setter){l.setter=function(o){this.getEditor().setPropValue(i,o)}}return this.defineProp(n,l)},doCreateRootElement:function(l){var i=l.createElement("div");return i},doCreateSubElements:function(n,l){var i=[];var m=n.createElement("div");m.className=g.COMPOSER_EDITOR_STAGE;l.appendChild(m);this.setPropStoreFieldValue("editorStageElem",m);i.push(m);var m=n.createElement("div");m.className=g.COMPOSER_ADV_PANEL;l.appendChild(m);this.setPropStoreFieldValue("advPanelElem",m);i.push(m);return i},doGetWidgetClassName:function($super){var i=$super()+" "+g.COMPOSER;return i},doWidgetShowStateChanged:function($super,i){$super(i);if(i){this.adjustComponentPositions()}},getCoordMode:function(){return this.getEditor().getCoordMode()},isDirty:function(){return this.getEditor().isDirty()},uiLayoutChanged:function(){this.adjustComponentPositions()},adjustComponentPositions:function(){var p=this.getCommonBtnGroup()?this.getCommonBtnGroup().getElement():null;var q=this.getChemBtnGroup()?this.getChemBtnGroup().getElement():null;if(!p||!q){return}if(p){var t=Kekule.HtmlElementUtils.getElemBoundingClientRect(p)}if(q){var m=Kekule.HtmlElementUtils.getElemBoundingClientRect(q)}var l=p.style;l.top="0px";l.left=m.width+"px";l=q.style;l.top=t.height+"px";l.left="0px";var s,o,v,i;var n=this.getCommonBtnGroup().getElement();var r=Kekule.HtmlElementUtils.getElemBoundingClientRect(n);s=r.height;var n=this.getChemBtnGroup().getElement();var r=Kekule.HtmlElementUtils.getElemBoundingClientRect(n);o=r.width;var i=0;if(!this.getShowInspector()){v=0}else{var n=this.getAdvPanelElem();var r=Kekule.HtmlElementUtils.getElemBoundingClientRect(n);v=r.width}var u=this.getEditorStageElem();var l=u.style;l.position="absolute";l.top=s+"px";l.left=o+"px";l.bottom=i+"px";l.right=v+"px";n=this.getAdvPanelElem();l=n.style;l.position="absolute";l.top=s+"px";l.bottom=i+"px"},adjustAssocToolbarPositions:function(){var m=this.getChemBtnGroup().getElement();var i=Kekule.HtmlElementUtils.getElemBoundingClientRect(m);if(this.isAssocToolbarShown()){var l=this.getAssocBtnGroup().getElement();l.style.left=i.width+"px"}if(this.isStyleToolbarShown()){var l=this.getStyleToolbar().getElement();l.style.left=i.width+"px"}},bindEditor:function(n){if(!n){n=this.getEditor()}var l=this;var i=this.getCommonActions();var m=this.getChemActions();this.createIaControllers(n);n.addEventListener("load",function(p){this.updateAllActions();this.updateUiWidgets();var q=this.getChemActions();var o=q.getActionAt(0);if(o){o.execute()}},this);n.addEventListener("operChange",function(o){i.updateAll();this.updateUiWidgets()},this);n.addEventListener("selectionChange",function(o){i.updateAll();this.updateUiWidgets()},this);n.appendToElem(this.getEditorStageElem());this.getEditorNexus().setEditor(n)},createDefaultEditor:function(){var i=new Kekule.Editor.ChemSpaceEditor(this,null,Kekule.Render.RendererType.R2D);i.addClassName(b.DYN_CREATED);return i},createIaControllers:function(q){var p=Kekule.Editor.IaControllerManager.getAvailableControllerClasses(q.getClass());for(var o=0,n=p.length;o<n;++o){var r=p[o];var m=new r(q);q.addIaController(m.getDefId(),m)}},showInspectorChanged:function(){var i=this.getShowInspector();if(i){if(!this.getObjInspector()){this.createAdvControls()}this.showAdvPanel()}else{this.hideAdvPanel()}this.uiLayoutChanged()},createAdvControls:function(i){if(!i){i=this.getAdvPanelElem()}var n=this.getDocument();var l=new Kekule.ChemWidget.StructureTreeView(n);l.setItemInitialExpanded(true);l.appendToElem(i);this.setPropStoreFieldValue("structureTreeView",l);var o=new Kekule.Widget.ObjectInspector(n);o.setShowPropInfoPanel(false);o.appendToElem(i);this.setPropStoreFieldValue("objInspector",o);var m=this.getEditorNexus();m.setObjectInspector(o);m.setStructureTreeView(l)},showAdvPanel:function(){this.getAdvPanelElem().style.display="block"},hideAdvPanel:function(){this.getAdvPanelElem().style.display="none"},_createDefaultToolButtonNameMapping:function(){var i={};i[d.newDoc]=f.ActionEditorNewDoc;i[d.loadFile]=c.ActionDisplayerLoadFile;i[d.loadData]=c.ActionDisplayerLoadData;i[d.saveFile]=c.ActionDisplayerSaveFile;i[d.zoomIn]=c.ActionDisplayerZoomIn;i[d.zoomOut]=c.ActionDisplayerZoomOut;i[d.reset]=c.ActionDisplayerReset;i[d.config]=Kekule.Widget.ActionOpenConfigWidget;i[d.undo]=f.ActionEditorUndo;i[d.redo]=f.ActionEditorRedo;i[d.cloneSelection]=f.ActionCloneSelection;i[d.copy]=f.ActionCopySelection;i[d.cut]=f.ActionCutSelection;i[d.paste]=f.ActionPaste;i[d.manipulate]=f.ActionComposerSetManipulateController;i[d.erase]=f.ActionComposerSetEraserController;i[d.molAtom]=f.ActionComposerSetAtomController;i[d.molBond]=f.ActionComposerSetBondController;i[d.molCharge]=f.ActionComposerSetNodeChargeController;i[d.textBlock]=f.ActionComposerSetTextBlockController;i[d.molRing]=f.ActionComposerSetRepositoryRingController;i[d.glyph]=f.ActionComposerSetRepositoryGlyphController;i[d.objInspector]=f.ActionComposerToggleInspector;return i},getDefaultCommonToolBarButtons:function(){var i=[d.newDoc,d.loadData,d.saveFile,d.undo,d.redo,d.copy,d.cut,d.paste,d.zoomIn,d.zoomOut,d.reset,d.config,d.objInspector];return i},getDefaultChemToolBarButtons:function(){var i=[d.manipulate,d.erase,d.molBond,d.molAtom,d.molRing,d.molCharge,d.glyph,d.textBlock];return i},getToolButtonActionClass:function(i){return this.getToolButtonNameMapping()[i]},_getActionTargetWidget:function(i){if(ClassEx.isOrIsDescendantOf(i,Kekule.Editor.ActionOnComposer)||ClassEx.isOrIsDescendantOf(i,Kekule.Widget.ActionOpenConfigWidget)){return this}else{return this.getEditor()}},createToolButton:function(r,p,n,q){var s=null;var o=this.getToolButtonActionClass(r);if(o){var i=(r===d.objInspector)?Kekule.Widget.CheckButton:(!!q)?Kekule.Widget.RadioButton:Kekule.Widget.Button;s=new i(p);var l=this._getActionTargetWidget(o);var m=new o(l);if(q){m.setCheckGroup(q)}n.add(m);s.setAction(m)}return s},createInnerToolbar:function(){var i=new Kekule.Widget.ButtonGroup(this);i.addClassName(g.COMPOSER_TOOLBAR);i.addClassName(g.INNER_TOOLBAR);i.addClassName(b.DYN_CREATED);i.setShowText(false);i.doSetShowGlyph(true);i.appendToElem(this.getElement());return i},createCommonToolbar:function(){var s=this.createInnerToolbar();s.addClassName(g.COMPOSER_COMMON_TOOLBAR);var r=this.getCommonToolButtons();var t=this.getCommonActions();var q=this.getEditor();t.clear();for(var p=0,m=r.length;p<m;++p){var n=r[p];var o=this.createToolButton(n,s,t)}this.setCommonBtnGroup(s);s.addClassName(b.DYN_CREATED);this.adjustComponentPositions();return s},updateCommonToolbar:function(){var i=this.getCommonBtnGroup();if(i){i.finalize()}this.createCommonToolbar()},createChemToolbar:function(){var s=this.createInnerToolbar();s.addClassName(g.COMPOSER_CHEM_TOOLBAR);s.setLayout(Kekule.Widget.Layout.VERTICAL);var r=this.getChemToolButtons();var t=this.getChemActions();t.clear();var q="chemTools";for(var p=0,m=r.length;p<m;++p){var n=r[p];var o=this.createToolButton(n,s,t,q)}this.setChemBtnGroup(s);s.addClassName(b.DYN_CREATED);this.adjustComponentPositions();return s},updateChemToolbar:function(){var i=this.getChemBtnGroup();if(i){i.finalize()}this.createChemToolbar()},createAssocToolbar:function(){var i=this.createInnerToolbar();i.addClassName(g.COMPOSER_ASSOC_TOOLBAR);this.setAssocBtnGroup(i);this.adjustAssocToolbarPositions();i.addClassName(b.DYN_CREATED);return i},showAssocToolbar:function(){var l=this.getAssocBtnGroup();if(!l){l=this.createAssocToolbar()}var i=this;l.show(null,function(){i.uiLayoutChanged();setTimeout(i.updateStyleToolbarStateBind,0)});return this},hideAssocToolbar:function(){var l=this.getAssocBtnGroup();if(l){var i=this;l.hide(null,function(){i.uiLayoutChanged();setTimeout(i.updateStyleToolbarStateBind,0)})}return this},isAssocToolbarShown:function(){var i=this.getAssocBtnGroup();return i&&i.isShown()},bindAssocActions:function(t){var q=this.getAssocBtnGroup();if(!q){q=this.createAssocToolbar()}q.clearWidgets();for(var o=0,m=t.getActionCount();o<m;++o){var r=t.getActionAt(o);var p=r.getCheckGroup();var s=(!!p)?Kekule.Widget.RadioButton:Kekule.Widget.Button;var n=new s(q);n.setAction(r)}},createStyleToolbar:function(){if(this.getEnableStyleToolbar()){var i=new Kekule.Editor.ComposerStyleToolbar(this);i.setComponentNames(this.getStyleBarComponents());this.setStyleToolbar(i);this.adjustAssocToolbarPositions();return i}else{return null}},showStyleToolbar:function(){if(this.getEnableStyleToolbar()){var l=this.getStyleToolbar();if(!l.isShown()){var i=this;l.show(null,function(){i.uiLayoutChanged()})}}return this},hideStyleToolbar:function(){var l=this.getPropStoreFieldValue("styleToolbar");if(l){if(l.isShown()){var i=this;l.hide(null,function(){i.uiLayoutChanged()})}}return this},isStyleToolbarShown:function(){var i=this.getPropStoreFieldValue("styleToolbar");return(i&&i.isShown())},needShowStyleToolbar:function(){var i=this.getEditor();return i&&i.hasSelection()&&(!this.isAssocToolbarShown())},updateStyleToolbarState:function(){if(this.getEnableStyleToolbar()&&this.needShowStyleToolbar()){this.showStyleToolbar();this.getStyleToolbar().updateState()}else{this.hideStyleToolbar()}},updateAllActions:function(){this.getCommonActions().updateAll();this.getChemActions().updateAll()},updateUiWidgets:function(){this.updateStyleToolbarState()},createConfigurator:function($super){var i=$super();i.addEventListener("configChange",function(l){this.getEditor().repaint()},this);return i}});Kekule.Editor.Composer.Settings=Class.create(Kekule.Widget.BaseWidget.Settings,{CLASS_NAME:"Kekule.Editor.Composer.Settings",initialize:function($super,i){$super(i)},initProperties:function(){this.defineDelegatedProps(["enableCreateNewDoc","enableLoadNewFile","initOnNewDoc","enableOperHistory","allowCreateNewChild","enableStyleToolbar"])}});Kekule.Editor.Composer.Configurator=Class.create(Kekule.Widget.Configurator,{CLASS_NAME:"Kekule.Editor.Composer.Configurator",TAB_BTN_DATA_FIELD:"__$data__",initialize:function($super,i){$super(i)},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},getCategoryInfos:function($super){var x=$super();var m=this.getComposer();var u=m.getEditor();var q=[u.getDisplayerConfigs(),u.getRenderConfigs()];for(var r=0,p=q.length;r<p;++r){var n=q[r];var w=n.getPropListOfScopes([Class.PropertyScope.PUBLISHED]);for(var t=0,o=w.getLength();t<o;++t){var v=w.getPropInfoAt(t);var s=n.getPropValue(v.name);if(s){x.push({obj:s,name:v.name,title:v.title,description:v.description})}}}return x},getComposer:function(){return this.getWidget()},getEditor:function(){return this.getComposer().getEditor()}});var a=Kekule.ObjPropSettingManager;a.register("Kekule.Editor.Composer.fullFunc",{enableStyleToolbar:true,enableOperHistor:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:null,styleToolComponentNames:null});a.register("Kekule.Editor.Composer.molOnly",{enableStyleToolbar:true,enableOperHistor:true,enableLoadNewFile:true,enableCreateNewDoc:true,allowCreateNewChild:true,commonToolButtons:null,chemToolButtons:[d.manipulate,d.erase,d.molBond,d.molAtom,d.molRing,d.molCharge],styleToolComponentNames:null})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.ChemWidget.HtmlClassNames;var b=Kekule.ChemWidgetTexts;Kekule.ChemWidget.HtmlClassNames=Object.extend(Kekule.ChemWidget.HtmlClassNames,{ACTION_UNDO:"K-Chem-Undo",ACTION_REDO:"K-Chem-Redo",ACTION_NEWDOC:"K-Chem-NewDoc",ACTION_CLONE_SELECTION:"K-Chem-Clone-Selection",ACTION_COPY:"K-Chem-Copy",ACTION_CUT:"K-Chem-Cut",ACTION_PASTE:"K-Chem-Paste",ACTION_TOGGLE_INSPECTOR:"K-Chem-Toggle-Inspector"});Kekule.Editor.ActionOperUtils={addObjectsToChemSpaceEditor:function(p,n,d){var e=p.getChemSpace&&p.getChemSpace();if(p&&e&&p.canAddNewStandaloneObject&&p.canAddNewStandaloneObject()){p.beginUpdateObject();try{var r=new Kekule.MacroOperation();for(var m=0,g=n.length;m<g;++m){var h=n[m];var f=new Kekule.ChemObjOperation.Add(n[m],e);r.add(f)}r.execute();if(d){for(var m=0,g=n.length;m<g;++m){var h=n[m];var o=p.getObjectScreenCoord(h);var q=Kekule.CoordUtils.add(o,d);p.setObjectScreenCoord(h,q)}}p.pushOperation(r);p.select(n)}finally{p.endUpdateObject()}}}};Kekule.Editor.ActionOnEditor=Class.create(Kekule.ChemWidget.ActionOnDisplayer,{CLASS_NAME:"Kekule.Editor.ActionOnEditor",initialize:function($super,e,d,f){$super(e,d,f)},doUpdate:function(){var d=this.getDisplayer();this.setEnabled(d&&d.getChemObj()&&d.getChemObjLoaded()&&d.getEnabled())},getEditor:function(){var d=this.getDisplayer();return(d instanceof Kekule.Editor.BaseEditor)?d:null}});Kekule.Editor.ActionEditorUndo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorUndo",HTML_CLASSNAME:c.ACTION_UNDO,initialize:function($super,d){$super(d,b.CAPTION_UNDO,b.HINT_UNDO)},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canUndo())}},doExecute:function(){var d=this.getEditor();if(d){d.undo()}}});Kekule.Editor.ActionEditorRedo=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorRedo",HTML_CLASSNAME:c.ACTION_REDO,initialize:function($super,d){$super(d,b.CAPTION_REDO,b.HINT_REDO)},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().canRedo())}},doExecute:function(){var d=this.getEditor();if(d){d.redo()}}});Kekule.Editor.ActionEditorNewDoc=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionEditorNewDoc",HTML_CLASSNAME:c.ACTION_NEWDOC,initialize:function($super,d){$super(d,b.CAPTION_NEWDOC,b.HINT_NEWDOC)},doUpdate:function(){var d=this.getDisplayer();this.setEnabled(d&&d.getEnabled()&&d.getEnableCreateNewDoc())},doExecute:function(){var d=this.getEditor();if(d){d.newDoc()}}});Kekule.Editor.ActionCloneSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCloneSelection",HTML_CLASSNAME:c.ACTION_CLONE_SELECTION,initialize:function($super,d){$super(d,b.CAPTION_CLONE_SELECTION,b.HINT_CLONE_SELECTION)},_hasCloneMethod:function(){var d=this.getEditor();return d&&d.cloneSelection},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this._hasCloneMethod()&&this.getEditor().hasSelection())}this.setDisplayed(this._hasCloneMethod()&&this.getEditor().canCloneObjects())},doExecute:function(){var d=this.getEditor();if(d&&d.getChemSpace){var e=d.getDefaultCloneScreenCoordOffset&&d.getDefaultCloneScreenCoordOffset();var f=d.cloneSelection();Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(d,f,e)}}});Kekule.Editor.ActionCopySelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCopySelection",HTML_CLASSNAME:c.ACTION_COPY,initialize:function($super,d){$super(d,b.CAPTION_COPY,b.HINT_COPY)},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var d=this.getEditor();var e=d.getChemSpace&&d.getChemSpace();if(d&&e){var f=d.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,f)}}});Kekule.Editor.ActionCutSelection=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionCutSelection",HTML_CLASSNAME:c.ACTION_CUT,initialize:function($super,d){$super(d,b.CAPTION_CUT,b.HINT_CUT)},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(this.getEditor().hasSelection())}},doExecute:function(){var e=this.getEditor();var f=e.getChemSpace&&e.getChemSpace();if(e&&f){var g=e.cloneSelection();Kekule.Widget.clipboard.setObjects(Kekule.IO.MimeType.JSON,g);var d=e.getIaController("BasicMolEraserIaController");if(d){d.removeSelection()}}}});Kekule.Editor.ActionPaste=Class.create(Kekule.Editor.ActionOnEditor,{CLASS_NAME:"Kekule.Editor.ActionPaste",HTML_CLASSNAME:c.ACTION_PASTE,initialize:function($super,d){$super(d,b.CAPTION_PASTE,b.HINT_PASTE);Kekule.Widget.clipboard.addEventListener("setData",this._reactClipboardChange,this)},finalize:function($super){Kekule.Widget.clipboard.removeEventListener("setData",this._reactClipboardChange,this);$super()},_reactClipboardChange:function(){this.update()},doUpdate:function($super){$super();if(this.getEnabled()){this.setEnabled(Kekule.Widget.clipboard.hasData(Kekule.IO.MimeType.JSON)&&this.getEditor().canAddNewStandaloneObject())}},getObjsCenterScreenCoord:function(m,o){var f=Kekule.BoxUtils;var r=Kekule.CoordUtils;var d=null;for(var g=0,e=o.length;g<e;++g){var h=Kekule.Render.ObjUtils.getContainerBox(o[g],m.getCoordMode(),m.getAllowCoordBorrow());if(!d){d=h}else{d=f.getContainerBox(h,d)}}var n=f.getMinMaxCoords(d);var q={min:m.objCoordToScreen(n.min),max:m.objCoordToScreen(n.max)};var p=r.add(q.min,q.max);var p=r.divide(p,2);return p},doExecute:function(){var g=this.getEditor();if(g&&g.getChemSpace){var l=Kekule.Widget.clipboard.getObjects(Kekule.IO.MimeType.JSON);var i=null;var m=g.getSelection();if(m&&m.length){i=g.getDefaultCloneScreenCoordOffset?g.getDefaultCloneScreenCoordOffset():null;var h=a.clone(m);if(h&&h.length&&i){var e=this.getObjsCenterScreenCoord(g,h);var f=this.getObjsCenterScreenCoord(g,l);var d=Kekule.CoordUtils.substract(e,f);i=Kekule.CoordUtils.add(i,d)}}Kekule.Editor.ActionOperUtils.addObjectsToChemSpaceEditor(g,l,i)}}});Kekule.Editor.ActionOnComposer=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Editor.ActionOnComposer",initialize:function($super,e,d,f){$super();this.setText(d);this.setHint(f);this.setComposer(e)},initProperties:function(){this.defineProp("composer",{dataType:"Kekule.Editor.Composer",serializable:false})},doUpdate:function(){var d=this.getComposer();var e=this.getEditor();this.setEnabled(d&&d.getEnabled()&&e&&e.getChemObj()&&e.getChemObjLoaded()&&e.getEnabled())},getEditor:function(){var d=this.getComposer();return d?d.getEditor():null}});Kekule.Editor.ActionOnComposerAdv=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionOnComposerAdv",initialize:function($super,e,d,g){var f=new Kekule.ActionList();f.setOwnActions(true);this.setPropStoreFieldValue("attachedActions",f);$super(e,d,g)},finalize:function($super){this.getAttachedActions().finalize();$super()},initProperties:function(){this.defineProp("attachedActions",{dataType:"Kekule.ActionList",serializable:false,setter:null});this.defineProp("defaultAttachedAction",{dataType:"Kekule.Action",serializable:false})},checkedChanged:function($super){$super();var e=this.getChecked();if(this.hasAttachedActions()){var d=this.getComposer();if(d){if(e){d.bindAssocActions(this.getAttachedActions());d.showAssocToolbar();var f=this.getDefaultAttachedAction();if(f){if(f.getCheckGroup()&&!this.getAttachedActions().hasActionChecked(f.getCheckGroup())){f.execute()}}}else{d.hideAssocToolbar()}}}},hasAttachedActions:function(){return !!this.getAttachedActions().getActionCount()},addAttachedActions:function(e,d){this.getAttachedActions().add(e);if(d){this.setDefaultAttachedAction(e)}return this},removeAttachedActions:function(d){if(this.getDefaultAttachedAction()===d){this.setDefaultAttachedAction(null)}this.getAttachedActions().remove(d);return this},clearAttachedActions:function(){this.setDefaultAttachedAction(null);var d=this.getAttachedActions();d.clear()},doExecute:function(){},update:function($super){$super();this.getAttachedActions().updateAll()}});Kekule.Editor.ActionComposerToggleInspector=Class.create(Kekule.Editor.ActionOnComposer,{CLASS_NAME:"Kekule.Editor.ActionComposerToggleInspector",HTML_CLASSNAME:c.ACTION_TOGGLE_INSPECTOR,initialize:function($super,d){$super(d,b.CAPTION_TOGGLE_INSPECTOR,b.HINT_TOGGLE_INSPECTOR)},doUpdate:function(){var d=this.getComposer();if(d){this.setChecked(d.getShowInspector())}},doExecute:function(){var d=this.getComposer();if(d){this.setChecked(!this.getChecked());d.setShowInspector(this.getChecked())}}});Kekule.Editor.ActionComposerSetIaController=Class.create(Kekule.Editor.ActionOnComposerAdv,{CLASS_NAME:"Kekule.Editor.ActionComposerSetIaController",initialize:function($super,e,d,g,f){$super(e,d,g);this.setPropStoreFieldValue("iaControllerId",f)},initProperties:function(){this.defineProp("iaControllerId",{dataType:DataType.STRING,serializable:false,setter:null})},doExecute:function(){this.getEditor().setActiveIaControllerId(this.getIaControllerId())}});Kekule.Editor.createComposerIaControllerActionClass=function(m,n,g,l,i,f,d,e){if(!i){i=l}if(!i.startsWith(Kekule.ChemWidget.HtmlClassNames.PREFIX)){i=Kekule.ChemWidget.HtmlClassNames.PREFIX+i}var h={CLASS_NAME:m,HTML_CLASSNAME:i,initialize:function($super,o){$super(o,n,g,l);if(this.initAttachedActions){this.initAttachedActions()}}};if(f){h.doExecute=function($super){var p=this.getEditor();var o=p.getIaController(l);if(o){o.setPropValues(f)}}}if(d){h.initAttachedActions=function(){var p=this.getComposer();var r=this.getClassName();for(var q=0,o=d.length;q<o;++q){var s=new d[q](p);s.setCheckGroup(r);this.addAttachedActions(s,q===0)}}}if(e){h=Object.extend(h,e)}return Class.create(Kekule.Editor.ActionComposerSetIaController,h)};Kekule.Editor.ActionComposerSetManipulateController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetManipulateController",Kekule.ChemWidgetTexts.CAPTION_MANIPULATE,Kekule.ChemWidgetTexts.HINT_MANIPULATE,"BasicMolManipulationIaController",null,null);Kekule.Editor.ActionComposerSetEraserController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetEraserController",Kekule.ChemWidgetTexts.CAPTION_ERASE,Kekule.ChemWidgetTexts.HINT_ERASE,"BasicMolEraserIaController",null,null,null,{doExecute:function($super){$super();var d=this.getEditor();if(d.hasSelection()){d.getActiveIaController().removeSelection()}}});Kekule.Editor.ActionComposerSetBondControllerSingle=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerSingle",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_SINGLE,Kekule.ChemWidgetTexts.HINT_MOL_BOND_SINGLE,"MolBondIaController","MolBondIaController-Single",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.NONE});Kekule.Editor.ActionComposerSetBondControllerDouble=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerDouble",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_DOUBLE,Kekule.ChemWidgetTexts.HINT_MOL_BOND_DOUBLE,"MolBondIaController","MolBondIaController-Double",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.DOUBLE,bondStereo:Kekule.BondStereo.NONE});Kekule.Editor.ActionComposerSetBondControllerTriple=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerTriple",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_TRIPLE,Kekule.ChemWidgetTexts.HINT_MOL_BOND_TRIPLE,"MolBondIaController","MolBondIaController-Triple",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.TRIPLE,bondStereo:Kekule.BondStereo.NONE});Kekule.Editor.ActionComposerSetBondControllerWedgeUp=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUp",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEUP,Kekule.ChemWidgetTexts.HINT_MOL_BOND_WEDGEUP,"MolBondIaController","MolBondIaController-WedgeUp",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP});Kekule.Editor.ActionComposerSetBondControllerWedgeDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeDown",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_WEDGEDOWN,Kekule.ChemWidgetTexts.HINT_MOL_BOND_WEDGEDOWN,"MolBondIaController","MolBondIaController-WedgeDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.DOWN});Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND_WAVY,Kekule.ChemWidgetTexts.HINT_MOL_BOND_WAVY,"MolBondIaController","MolBondIaController-WedgeUpOrDown",{bondType:Kekule.BondType.COVALENT,bondOrder:Kekule.BondOrder.SINGLE,bondStereo:Kekule.BondStereo.UP_OR_DOWN});Kekule.Editor.ActionComposerSetBondController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetBondController",Kekule.ChemWidgetTexts.CAPTION_MOL_BOND,Kekule.ChemWidgetTexts.HINT_MOL_BOND,"MolBondIaController",null,null,[Kekule.Editor.ActionComposerSetBondControllerSingle,Kekule.Editor.ActionComposerSetBondControllerDouble,Kekule.Editor.ActionComposerSetBondControllerTriple,Kekule.Editor.ActionComposerSetBondControllerWedgeUp,Kekule.Editor.ActionComposerSetBondControllerWedgeDown,Kekule.Editor.ActionComposerSetBondControllerWedgeUpOrDown]);Kekule.Editor.ActionComposerSetAtomController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetAtomController",Kekule.ChemWidgetTexts.CAPTION_MOL_ATOM,Kekule.ChemWidgetTexts.HINT_MOL_ATOM,"MolAtomIaController",null,null);Kekule.Editor.ActionComposerSetNodeChargeControllerClear=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerClear",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_CLEAR,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_CLEAR,"MolNodeChargeIaController","MolNodeChargeIaController-Clear",{charge:0,chargeInc:0,radical:Kekule.RadicalOrder.NONE});Kekule.Editor.ActionComposerSetNodeChargeControllerPositive=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerPositive",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_POSITIVE,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_POSITIVE,"MolNodeChargeIaController","MolNodeChargeIaController-Positive",{charge:null,chargeInc:1});Kekule.Editor.ActionComposerSetNodeChargeControllerNegative=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerNegative",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_NEGATIVE,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_NEGATIVE,"MolNodeChargeIaController","MolNodeChargeIaController-Negative",{charge:null,chargeInc:-1});Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_SINGLET,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_SINGLET,"MolNodeChargeIaController","MolNodeChargeIaController-Singlet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.SINGLET});Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_TRIPLET,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_TRIPLET,"MolNodeChargeIaController","MolNodeChargeIaController-Triplet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.TRIPLET});Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE_DOUBLET,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE_DOUBLET,"MolNodeChargeIaController","MolNodeChargeIaController-Doublet",{charge:null,chargeInc:0,radical:Kekule.RadicalOrder.DOUBLET});Kekule.Editor.ActionComposerSetNodeChargeController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetNodeChargeController",Kekule.ChemWidgetTexts.CAPTION_MOL_CHARGE,Kekule.ChemWidgetTexts.HINT_MOL_CHARGE,"MolNodeChargeIaController",null,null,[Kekule.Editor.ActionComposerSetNodeChargeControllerClear,Kekule.Editor.ActionComposerSetNodeChargeControllerPositive,Kekule.Editor.ActionComposerSetNodeChargeControllerNegative,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalSinglet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalTriplet,Kekule.Editor.ActionComposerSetNodeChargeControllerRadicalDoublet]);Kekule.Editor.ActionComposerSetTextBlockController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetTextBlockController",Kekule.ChemWidgetTexts.CAPTION_TEXT_BLOCK,Kekule.ChemWidgetTexts.HINT_TEXT_BLOCK,"TextBlockIaController",null,null);Kekule.Editor.ActionComposerSetRepositoryRing3Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing3Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_3,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_3,"MolRingIaController","MolRingIaController-3",{ringAtomCount:3,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRing4Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing4Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_4,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_4,"MolRingIaController","MolRingIaController-4",{ringAtomCount:4,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRing5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing5Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_5,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_5,"MolRingIaController","MolRingIaController-5",{ringAtomCount:5,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRing6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing6Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_6,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_6,"MolRingIaController","MolRingIaController-6",{ringAtomCount:6,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRing7Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing7Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_7,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_7,"MolRingIaController","MolRingIaController-7",{ringAtomCount:7,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRing8Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRing8Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_8,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_8,"MolRingIaController","MolRingIaController-8",{ringAtomCount:8,isAromatic:false});Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_6,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_AR_6,"MolRingIaController","MolRingIaController-Ar-6",{ringAtomCount:6,isAromatic:true});Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING_AR_5,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING_AR_5,"MolRingIaController","MolRingIaController-Ar-5",{ringAtomCount:5,isAromatic:true});Kekule.Editor.ActionComposerSetRepositoryRingController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryRingController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_RING,Kekule.ChemWidgetTexts.HINT_REPOSITORY_RING,"MolRingIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryRing3Controller,Kekule.Editor.ActionComposerSetRepositoryRing4Controller,Kekule.Editor.ActionComposerSetRepositoryRing5Controller,Kekule.Editor.ActionComposerSetRepositoryRing6Controller,Kekule.Editor.ActionComposerSetRepositoryRing7Controller,Kekule.Editor.ActionComposerSetRepositoryRing8Controller,Kekule.Editor.ActionComposerSetRepositoryRingAr6Controller,Kekule.Editor.ActionComposerSetRepositoryRingAr5Controller]);Kekule.Editor.ActionComposerSetRepositoryPathLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathGlyphLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_LINE,"ArrowLineIaController","ArrowLineIaController-Line",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:null,lineLength:1.5});Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_LINE,"ArrowLineIaController","ArrowLineIaController-OpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}});Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_TRIANGLE_ARROW_LINE,"ArrowLineIaController","ArrowLineIaController-TriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}});Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_OPEN_ARROW_LINE,"ArrowLineIaController","ArrowLineIaController-DiOpenArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}});Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_DI_TRIANGLE_ARROW_LINE,"ArrowLineIaController","ArrowLineIaController-DiTriangleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.TRIANGLE,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.TRIANGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5}});Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_REV_ARROW_LINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_REV_ARROW_LINE,"ArrowLineIaController","ArrowLineIaController-ReversibleArrowLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{startArrowType:Kekule.Glyph.ArrowType.OPEN,startArrowSide:Kekule.Glyph.ArrowSide.REVERSED,startArrowWidth:0.25,startArrowLength:0.25,endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowSide:Kekule.Glyph.ArrowSide.SINGLE,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}});Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_GLYPH_OPEN_ARROW_DILINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_GLYPH_OPEN_ARROW_DILINE,"ArrowLineIaController","ArrowLineIaController-OpenArrowDiLine",{glyphClass:Kekule.Glyph.StraightLine,glyphInitialParams:{endArrowType:Kekule.Glyph.ArrowType.OPEN,endArrowWidth:0.25,endArrowLength:0.25,lineLength:1.5,lineGap:0.1,lineCount:2}});Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_HEAT_SYMBOL,Kekule.ChemWidgetTexts.HINT_REPOSITORY_HEAT_SYMBOL,"ArrowLineIaController","ArrowLineIaController-HeatSymbol",{glyphClass:Kekule.Glyph.HeatSymbol,glyphInitialParams:{lineLength:1}});Kekule.Editor.ActionComposerSetRepositoryAddSymbolController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryAddSymbolController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_ADD_SYMBOL,Kekule.ChemWidgetTexts.HINT_REPOSITORY_ADD_SYMBOL,"ArrowLineIaController","ArrowLineIaController-AddSymbol",{glyphClass:Kekule.Glyph.AddSymbol,glyphInitialParams:{lineLength:1}});Kekule.Editor.ActionComposerSetRepositoryGlyphController=Kekule.Editor.createComposerIaControllerActionClass("Kekule.Editor.ActionComposerSetRepositoryGlyphController",Kekule.ChemWidgetTexts.CAPTION_REPOSITORY_ARROWLINE,Kekule.ChemWidgetTexts.HINT_REPOSITORY_ARROWLINE,"ArrowLineIaController",null,null,[Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiOpenArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathDiTriangleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathReversibleArrowLineController,Kekule.Editor.ActionComposerSetRepositoryPathOpenArrowDblLineController,Kekule.Editor.ActionComposerSetRepositoryPathLineController,Kekule.Editor.ActionComposerSetRepositoryHeatSymbolController,Kekule.Editor.ActionComposerSetRepositoryAddSymbolController])})();Kekule.PredefinedResLoader=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PredefinedResLoader",initialize:function($super,c,b,a){$super();if(!b){Kekule.Error(Kekule.ErrorMsg.EMPTY_RESURI)}else{this.setPropStoreFieldValue("resUri",b);this.setDoc(c);if(a){this.setResType(a)}}},initProperties:function(){this.defineProp("doc",{dataType:DataType.OBJECT,serializable:false});this.defineProp("resUri",{dataType:DataType.STRING,serializable:false,setter:null});this.defineProp("resType",{dataType:DataType.STRING,serializable:false})},getLinkedResUrl:function(b){var a=b.tagName.toLowerCase();if(a==="link"){return b.getAttribute("href")}else{if(a==="script"){return b.getAttribute("src")}else{return null}}},getElemResType:function(a){return a.getAttribute("type")},load:function(i){var d=this.getResUri();var f,a;var c=Kekule.PredefinedResReferer.ID_MARK;if(d.startsWith(c)){var b=d.substr(c.length).trim();f=this.getDoc().getElementById(b);if(f){a=this.getLinkedResUrl(f);var h=this.getElemResType(f);if(h){this.setResType(h)}}}else{a=d}var e={resType:this.getResType(),resUri:d};if(a){Kekule.X.Ajax.sendRequest(a,function(m,l,n){if(n){e=Object.extend(e,{data:m,text:l.responseText,resType:e.resType||Kekule.X.Ajax.getResponseMimeType(l),success:true});i(e,n)}else{i(e,false)}},null,null,this.getResType()||null)}else{if(f){var g=f.innerHTML;g=g.ltrim();e=Object.extend(e,{data:g,text:g,resType:e.resType||"text/plain",success:true});i(e,true)}else{i(e,false)}}}});Kekule.PredefinedResReferer={REFER_PATTERN:/^\s*url\((\S+)\)\s*$/,ID_MARK:"#",isResValue:function(a){return Kekule.PredefinedResReferer.isResReferrer(a)},isResReferrer:function(a){return Kekule.PredefinedResReferer.REFER_PATTERN.test(a)},extractReferedValue:function(c){var a=Kekule.PredefinedResReferer.REFER_PATTERN.exec(c);if(a){var b=a[1];if(b){b=Kekule.StrUtils.unquote(b);return b}}return null},loadResource:function(d,g,b,e){if(!e){e=document}var c=Kekule.PredefinedResReferer;var a=c.extractReferedValue(d);var f;f=new Kekule.PredefinedResLoader(e,a);if(f){if(b){f.setResType(b)}f.load(g)}}};(function(){var a=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function($super){$super();this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(b){this._data=b||{}}})},getData:function(b){return b?this._data[b]:this._data},setData:function(b,c){if(b){this._data[b]=c}return this},removeData:function(b){if(this._data[b]){delete this._data[b]}return this}});Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function($super){$super();this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){var b=[];var d=this.getEdges();for(var e=0,c=d.length;e<c;++e){var f=d[e].getVertexes();a.pushUnique(b,a.exclude(f,this))}return b},getNeighborOnEdge:function(d){var e=d.getVertexes();for(var c=0,b=e.length;c<b;++c){if(e[c]!==this){return e[c]}}},getEdgeTo:function(c){var d=this.getEdges();for(var e=0,b=d.length;e<b;++e){var f=d[e].getVertexes();if(f.indexOf(c)>=0){return d[e]}}return null},doAppendEdge:function(b){Kekule.ArrayUtils.pushUnique(this.getEdges(),b);return this},doRemoveEdge:function(b){Kekule.ArrayUtils.remove(this.getEdges(),b);return this},doClearEdges:function(){var b=this.getEdges();for(var c=b.length-1;c>=0;--c){this.removeEdge(b[c])}return this}});Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null})}});Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1};Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[]);this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},addVertex:function(b){Kekule.ArrayUtils.pushUnique(this.getVertexes(),b);return this},newVertex:function(){var b=new Kekule.GraphVertex();this.addVertex(b);return b},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e)){var c=e.getEdges();for(var d=0,b=c.length;d<b;++d){this.removeEdge(c[d])}}},addEdge:function(d,c,b){if(Kekule.ArrayUtils.pushUnique(this.getEdges(),d)){d.setPropStoreFieldValue("vertexes",[c,b]);c.doAppendEdge(d);b.doAppendEdge(d)}return this},newEdge:function(d,c){var b=new Kekule.GraphEdge();this.addEdge(b,d,c);return b},removeEdge:function(e){var f=e.getVertexes();for(var d=0,b=f.length;d<b;++d){var c=f[d];c.doRemoveEdge(e)}Kekule.ArrayUtils.remove(this.getEdges(),e);return this},traverse:function(h,f,b){var o=[];var g=a.clone(this.getVertexes());for(var e=0,c=g.length;e<c;++e){g[e].setData(this.VISITED_KEY,false)}while(g.length){var m={vertexes:[],edges:[]};var d;if(b&&(g.indexOf(b)>=0)){d=b}else{d=g[0]}var n=this._doTravers(h,f,d);m.vertexes=m.vertexes.concat(n.vertexes);m.edges=m.edges.concat(n.edges);g=a.exclude(g,n.vertexes);o.push(m)}return o},_doTravers:function(r,h,c){var s={vertexes:[],edges:[]};var m=c;if(!m.getData(this.VISITED_KEY)){s.vertexes.push(m);m.setData(this.VISITED_KEY,true);if(r){r(m,false)}}var e=m.getEdges();var n=[];var o=h===Kekule.GraphTraverseMode.BREADTH_FIRST;for(var f=0,d=e.length;f<d;++f){var b=e[f];var q=m.getNeighborOnEdge(b);if(!q.getData(this.VISITED_KEY)){s.vertexes.push(q);s.edges.push(b);q.setData(this.VISITED_KEY,true);if(r){r(b,true);r(q,false)}if(o){n.push(q)}else{var g=this._doTravers(r,h,q);s.vertexes=s.vertexes.concat(g.vertexes);s.edges=s.edges.concat(g.edges)}}}if(o){for(var f=0,d=n.length;f<d;++f){var p=n[f];var g=this._doTravers(r,h,p);s.vertexes=s.vertexes.concat(g.vertexes);s.edges=s.edges.concat(g.edges)}}return s}});Kekule.GraphAdaptUtils={ctabToGraph:function(m,c,d){var n=Object.extend({expandSubStructures:true},d||{});var F=m;var f=Kekule.ArrayUtils;var r=null;var u=n.expandSubStructures;if(F){var r=c||new Kekule.Graph();var z=u?F.getAllContainingConnectors():F.getConnectors();var x=u?F.getLeafNodes():F.getNodes();var g=[];var G=new Kekule.MapEx();for(var C=0,y=z.length;C<y;++C){var b=z[C];if(n.connectorClasses){var w=b.getClass();if(!ClassEx.isOrIsDescendantOfClasses(w,n.connectorClasses)){continue}}if(b.getBondType&&n.bondTypes){if(n.bondTypes.indexOf(b.getBondType())<0){continue}}var h=[];var o=u?b.getConnectedObjs():b.getConnectedSiblings();for(var B=0,A=o.length;B<A;++B){var D=o[B];if(x.indexOf(D)>=0){h.push(D);if(h.length>=2){var q=f.exclude(h,g);for(var t=0,p=q.length;t<p;++t){var s=r.newVertex();s.setData("object",q[t]);G.set(q[t],s)}var E=r.newEdge(G.get(h[0]),G.get(h[1]));E.setData("object",b);f.pushUnique(g,h);break}}}}G.finalize()}return r},molToGraph:function(g,f,d){var c=Kekule.ArrayUtils;var b=null;if(!g||!g.hasCtab()){return null}var e=g.getCtab();if(e){return Kekule.GraphAdaptUtils.ctabToGraph(e,f,d)}return b}};Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(c,b){return c.traverse(null,b)},findCycleBlocks:function(b){var v=[];var m=Kekule.GraphAlgorithmUtils;var c=m.SEQ_KEY;var e=m.RESD_DEGREE_KEY;var u=m.VISIT_EDGE_DEGREE_KEY;var h=m.TYPE_KEY;var p=m.TYPE_CYCLE;var n=m.TYPE_BRIDGE;var d=b.getEdges();for(var D=0,A=d.length;D<A;++D){d[D].removeData(c)}var r=b.getVertexes();for(var D=0,A=r.length;D<A;++D){r[D].removeData(h)}var E=1;var w=1;var K=[];var g=[];var z=[];var f=b.traverse(function(l,i){if(i){l.setData(c,E);g.push(l);++E}else{l.setData(c,w);++w;K.push(l)}});for(var D=0,A=K.length;D<A;++D){var x=K[D];var G=x.getEdges();x.setData(e,G.length);var I=0;for(var C=0,B=G.length;C<B;++C){var o=G[C];if(o.getData(c)){++I}}x.setData(u,I);if(I<G.length){z.push(x)}}var s=function(T,R){if(R&&T.getData(c)<=1){return null}var P=T.getEdges();var V=null;var S=null;for(var Q=0,N=P.length;Q<N;++Q){var O=P[Q].getData(c);if(O){if(!S){V=P[Q];S=O}else{if(O<S){V=P[Q];S=O}}}}if(V){return V}else{return null}};var t=function(Q){var O=Q.getEdges();for(var P=0,N=O.length;P<N;++P){if(!O[P].getData(c)&&!O[P].getData(h)){return O[P]}}return null};var H=function(P){var l=[],Y=[];var N=P.getData(u);var V=P.getData(e);var T=V-N;if(T>0){P.setData(h,p);a.pushUnique(l,P);for(var R=0;R<T;++R){P.setData(e,V+1);var O=t(P);if(O){O.setData(h,p);a.pushUnique(Y,O);var X=P.getNeighborOnEdge(O);X.setData(e,X.getData(e)+1);X.setData(h,p);a.pushUnique(l,X);do{var N=X.getData(u);var V=X.getData(e);if(N<V){var Q=H(X);a.pushUnique(l,Q.vertexes);a.pushUnique(Y,Q.edges)}var W=s(X,false);if(!W){break}W.setData(h,p);a.pushUnique(Y,W);var S=X.getNeighborOnEdge(W);if(!S.getData(h)){S.setData(h,p);a.pushUnique(l,S);X=S}else{break}}while(true)}}}return{vertexes:l,edges:Y}};var y=K.shift();while(y){if(y.getData(h)){}else{var M=y.getData(u);var L=y.getData(e);var J=L-M;if(J>0){var F=H(y);v.push(F)}else{y.setData(h,n);var q=s(y,true);if(q){q.setData(h,n)}}}y=K.shift()}return v},findEndChains:function(q){var o=Kekule.ArrayUtils;var h="__$currConnectivity__";var s={vertexes:[],edges:[]};var m=o.clone(q.getVertexes());var b=[];for(var g=0,d=m.length;g<d;++g){var p=m[g];var c=p.getEdgeCount();p.setData(h,c);if(c<=1){b.push(p)}}if(b.length){var f=b.pop();o.remove(m,f);s.vertexes.push(f);while(m.length){var n=false;var e=o.exclude(f.getEdges(),s.edges);if(e.length){s.edges=s.edges.concat(e);var r=f.getNeighborOnEdge(e[0]);var c=r.getData(h)-1;r.setData(h,c);if(c<=1){f=r;o.remove(m,f);s.vertexes.push(f);n=true}}if(!n){if(b.length){var f=b.pop();o.remove(m,f);s.vertexes.push(f)}else{break}}}}return s},removeEndChains:function(e){var d=Kekule.GraphAlgorithmUtils.findEndChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(d.vertexes[c])}return d},findBridgeChains:function(f){var h=f.getVertexes();var g=f.getEdges();var e=Kekule.GraphAlgorithmUtils.findCycleBlocks(f);for(var d=0,c=e.length;d<c;++d){h=a.exclude(h,e[d].vertexes);g=a.exclude(g,e[d].edges)}var b={vertexes:h,edges:g};return b},removeBridgeChains:function(e){var d=Kekule.GraphAlgorithmUtils.findBridgeChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(chainElems.vertexes[c])}return d},findAllRings:function(w){var f=Kekule.GraphAlgorithmUtils;var g="__$path_detail__";var r="__$vertextPartDegree__";var n=[];var h;if(w instanceof Kekule.Graph){h=f.findCycleBlocks(w)}else{h=[w]}var s=function(i){return i.vertexes.length===i.edges.length};var o=function(i,y){var z=i.vertexes;var x=z.length;return x&&((z[0]===y)||(z[x-1]===y))};var b=function(x,l,i){var A=a.clone(x.vertexes);var z=a.clone(l.vertexes);A.shift();A.pop();z.shift();z.pop();var y=a.intersect(A,z);return(y.length>=1)};var c=function(x,l,i){var z=a.clone(x.vertexes);var y=a.clone(l.vertexes);var C=a.clone(x.edges);var B=a.clone(l.edges);if(z[0]===i){z.reverse();C.reverse()}if(y[y.length-1]===i){y.reverse();B.reverse()}z.pop();var D=z.concat(y);var A=C.concat(B);return{vertexCount:x.vertexCount+l.vertexCount-1,vertexes:D,edges:A}};var d=function(z){var D=[];var I=a.clone(z.vertexes);var y=z.edges;for(var M=0,J=I.length;M<J;++M){var E=I[M];var O=a.intersect(E.getEdges(),y);E.setData(r,O.length)}I.sort(function(l,i){return(l.getData(r)-i.getData(r))});var N=[];for(var M=0,J=z.edges.length;M<J;++M){var A=z.edges[M];var K=A.getVertexes();N.push({vertexCount:K.length,vertexes:[K[0],K[1]],edges:[A]})}while(I.length){var G=I.shift();var F=null;var x=-1;for(var M=N.length-1;M>=0;--M){var H=N[M];if(o(H,G)){F=H;for(var L=M-1;L>=0;--L){var H=N[L];if(o(H,G)){if(!b(F,H,G)){var C=c(F,H,G);var B=C.vertexes;if(B[0]===B[B.length-1]){B.pop();D.push(C)}else{N.push(C)}}}}N.splice(M,1)}}}return D};for(var v=0,q=h.length;v<q;++v){var p=h[v];if(s(p)){n.push({vertexes:a.clone(p.vertexes),edges:a.clone(p.edges)})}else{var e=d(p);for(var u=0,t=e.length;u<t;++u){var m=e[u];n.push({vertexes:a.clone(m.vertexes),edges:a.clone(m.edges)})}}}return n},findSSSR:function(g,n){var e=Kekule.GraphAlgorithmUtils;var p=[];var o;if(g instanceof Kekule.Graph){o=e.findCycleBlocks(g);n=null}else{o=[g]}var b=1||function(y){var x=[];var r=cycleBlock.edges.length-cycleBlock.vertexes.length+1;if(r<=0){return[]}var w=e.findAllRings(cycleBlock);var z=new Kekule.MapEx(true);for(var F=0,C=w.length;F<C;++F){var q=w[F].edges.length;var v=z.get(q);if(!v){v=[];z.set(q,v)}v.push(w[F])}var B=z.getKeys();B.sort(function(l,i){return l-i});var u;var s=a.clone(cycleBlock.edges);var A=function(l,i){return a.intersect(l,i.edges).length};var t=function(i){x.push(i);s=a.exclude(s,i.edges)};for(var E=0,D=B.length;E<D;++E){var I=B[E];var H=z.get(I);if(H.length<=1){if(x.length===0){u=H.shift();t(u)}else{u=H.shift();if(!!A(s,u)){t(u)}}}else{while(H.length&&(x.length<r)&&s.length){if(x.length===0){u=H.shift();t(u)}else{for(var F=H.length-1;F>=0;--F){u=H[F];var G=A(s,u);if(G<=0){H.splice(F,1)}else{u.__uncheckedEdgeCount__=G}}H.sort(function(l,i){return l.__uncheckedEdgeCount__-i.__uncheckedEdgeCount__});u=H.shift();t(u)}}}if((x.length>=r)||(s.length<=0)){break}}return x};var h=function(w,u){var x=[];var r=w.edges.length-w.vertexes.length+1;if(r<=0){return[]}var t=u?a.clone(u):e.findAllRings(w);t.sort(function(z,y){return z.vertexes.length-y.vertexes.length});var i=function(y){x.push(y)};var v;var l=[];var s=Kekule.RingVectorUtils;s.prepareConvertRingToVector(w);var q=t.shift();i(q);v=s.convertRingToVector(q,w);l.push(v);while((x.length<r)&&t.length){q=t.shift();v=s.convertRingToVector(q,w);if(!s.isLinearDependant(v,l)){l.push(v);i(q)}}return x};for(var f=0,d=o.length;f<d;++f){var c=o[f];var m=h(c,n);p=p.concat(m)}return p},analysisRings:function(f){var c=Kekule.GraphAlgorithmUtils;var n=[];var m;if(f instanceof Kekule.Graph){m=c.findCycleBlocks(f)}else{m=[f]}for(var e=0,d=m.length;e<d;++e){var b=m[e];var g=c.findAllRings(b);var h=c.findSSSR(b,g);n.push({vertexes:b.vertexes,edges:b.edges,allRings:g,sssrRings:h})}return n}};Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){var c=e.edges;for(var d=0,b=c.length;d<b;++d){c[d][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=d}},convertRingToVector:function(e,h){var n;var b=h.edges.length;var m=e.edges;if(b<Kekule.RingVectorUtils.MAX_INT_BITNUM){n=0;for(var f=0,d=m.length;f<d;++f){var c=m[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];n+=1<<g}}else{n=[];for(var f=0,d=m.length;f<d;++f){var c=m[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];n[g]=true}}return n},vectorNotNull:function(b){if(DataType.isSimpleValue(b)){return !!b}else{for(var c=0;c<b.length;++c){if(b[c]){return true}}return false}},getVectorLength:function(b){if(DataType.isSimpleValue(b)){return b.toString(2).length}else{return b.length}},ringVectorAnd:function(f,e){if(DataType.isSimpleValue(f)){return f&e}else{var b=[];var c=Math.min(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]&&e[d]}return b}},ringVectorAndAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorAnd(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorAnd(b,f[e])}return b},ringVectorOr:function(f,e){if(DataType.isSimpleValue(f)){return f|e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]||e[d]}return b}},ringVectorOrAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorOr(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorOr(b,f[e])}return b},ringVectorXor:function(f,e){if(DataType.isSimpleValue(f)){return f^e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=!!(f[d]^e[d])}return b}},ringVectorXorAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorXor(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorXor(b,f[e])}return b},ringVectorNot:function(d){if(DataType.isSimpleValue(d)){return ~d}else{var b=[];for(var e=0,c=d.length;e<c;++e){b[e]=!d[e]}return b}},isLinearDependant:function(c,b){var s=Kekule.RingVectorUtils;var g=s.ringVectorOrAll(b);var r=s.ringVectorAnd(c,s.ringVectorNot(g));if(s.vectorNotNull(r)){return false}else{var t=b.length;var m=function(x){var l=[];for(var w=0;w<x;++w){l[w]=x-w-1}return l};var p=function(x,B,z){var w=x[B];var A=++w;if(A>=z-B){if(B>=x.length-1){return false}else{return p(x,B+1,z)}}else{x[B]=A;var l=A;for(var y=B-1;y>=0;--y){++l;x[y]=l}return true}};var q=function(i,l){return p(i,0,l)};var n=0;var v=false;for(var h=2;h<=t;++h){var d=m(h);while(true){++n;var u=[];for(var f=0,e=d.length;f<e;++f){u.push(b[d[f]])}var o=s.ringVectorXorAll(u);if(!s.vectorNotNull(s.ringVectorXor(o,c))){v=true;break}if(!q(d,t)){v=false;break}}if(v){break}}return v}},isLinearDependant_wrong:null&&function(d,g){var c=Kekule.RingVectorUtils;var m=c.ringVectorOrAll(g);var y=c.ringVectorAnd(d,c.ringVectorNot(m));if(c.vectorNotNull(y)){return false}else{var p=c.getVectorLength(d);var e=g.length;var f=[];try{var o=DataType.isSimpleValue(d);if(o){for(var w=0;w<p;++w){var s=1<<w;if(s&d){var q=[];f.push(q);for(var v=0;v<e;++v){if(g[v]&s){q.push(g[v])}}}}}else{for(var w=0;w<p;++w){if(d[w]){var q=[];f.push(q);for(var v=0;v<e;++v){if(g[v][w]){q.push(g[v])}}}}}var x=[];var h=[];for(var w=0,u=f.length;w<u;++w){x[w]=f[w].length;h[w]=0}var A=function(i,l,B){if(i[B]<l[B]-1){++i[B];return true}else{if(B>=l.length-1){return false}i[B]=0;return A(i,l,B+1)}};var b=function(i,l){return A(i,l,0)};var n=0;var r;while(true){++n;var z=[];for(var w=0,u=h.length;w<u;++w){a.pushUnique(z,f[w][h[w]])}if((f.length===4)){console.log("new vector edge count",f.length,"selVector count",z.length);console.log(z)}var t=c.ringVectorXorAll(z);if(!c.vectorNotNull(c.ringVectorXor(t,d))){r=true;break}if(!b(h,x)){r=false;break}}console.log("tried ",n,r);return r}finally{}}}}})();(function(){Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function($super){$super();this.setPropStoreFieldValue("nodes",[]);this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,setter:null})},clear:function(){this.getNodes().length=0;this.getConnectors().length=0;return this},add:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{if(c instanceof Kekule.ChemStructureNode){b=this.getNodes()}}if(!b){Kekule.error(Kekule.ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER)}else{Kekule.ArrayUtils.pushUnique(b,c)}return this},remove:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{b=this.getNodes()}Kekule.ArrayUtils.remove(b,c);return this}})})();(function(){var b=Kekule;var a=Kekule.ArrayUtils;var c=Kekule.BondType;Kekule.UnivChemStructObjComparer={NODE_CLASS_MAP:(new b.MapEx()).set(b.Atom,17).set(b.Pseudoatom,18).set(b.VariableAtom,19).set(b.AbstractAtom,16).set(b.ChemStructureNode,0),CHARGE_BASE:64,BOND_TYPE_MAP:(new b.MapEx(true)).set(c.COVALENT,1).set(c.IONIC,2).set(c.COORDINATE,3).set(c.METALLIC,4).set(c.HYDROGEN,9),_P36:Math.pow(2,36),_P48:Math.pow(2,48),_P24:Math.pow(2,24),getCompareValue:function(f,d){var e=Object.extend({compareLinkedConnectorCount:true,compareCharge:true,compareHydrogenCount:true,compareConnectedObjCount:true,compareBondType:true,compareBondOrder:true},d);if(!f){return 0}else{if(f instanceof b.ChemStructureNode){return b.UnivChemStructObjComparer.getNodeCompareValue(f,e)}else{if(f instanceof b.ChemStructureConnector){return b.UnivChemStructObjComparer.getConnectorCompareValue(f,e)}else{return 0}}}},compare:function(n,g,m){var h=b.UnivChemStructObjComparer;var r=h.getCompareValue(n,m);var q=h.getCompareValue(g,m);var t=r-q;if((t===0)&&(n.getNodes&&g.getNodes)){var s=n.getNodes();var p=g.getNodes();for(var o=0,f=s.length;o<f;++o){var t=h.compare(s[o],p[o]);if(t!==0){break}}}if((t===0)&&(n.getConnectors&&g.getConnectors)){var e=n.getConnectors();var d=g.getConnectors();for(var o=0,f=e.length;o<f;++o){var t=h.compare(e[o],d[o]);if(t!==0){break}}}return t},max:function(){var e=-1;var n=arguments;if((n.length===1)&&(DataType.isArrayValue(n))){n=n[0]}var d=null;for(var h=0,f=n.length;h<f;++h){var m=n[h];var g=Kekule.UnivChemStructObjComparer.getCompareValue(m);if(g>e){d=m}}return d},sort:function(e,d){e.sort(function(h,g){var f=Kekule.UnivChemStructObjComparer.compare(h,g);if(d){f=-f}return f});return e},getNodeCompareValue:function(e,n){var g=b.UnivChemStructObjComparer;var o=1152921504606847000;var d=e.getClass();var h=b.UnivChemStructObjComparer.NODE_CLASS_MAP.get(d);var l=0;if(b.ObjUtils.isUnset(h)){if(e instanceof b.AbstractAtom){h=(e instanceof b.Atom)?17:(e instanceof b.Pseudoatom)?18:(e instanceof b.VariableAtom)?19:16}if(e instanceof b.StructureFragment){h=(e instanceof b.SubGroup)?49:(e instanceof b.Molecule)?53:48}else{h=0}}l=b.UnivChemStructObjComparer.getAtomDetailCompareValue(e);o+=h*g._P48;o+=l;if(n.compareLinkedConnectorCount){var m=e.getLinkedConnectorCount();o+=(m<<(4*4))}if(n.compareCharge){var i=Math.round(e.getCharge()||0)+b.UnivChemStructObjComparer.CHARGE_BASE;o+=(i<<(2*4))}if(n.compareHydrogenCount){var f=e.getHydrogenCount?e.getHydrogenCount()||0:0;o+=f}return o},getAtomDetailCompareValue:function(g){var e=b.UnivChemStructObjComparer;var d=0;var i,h=0;var f=g.getClass();if(f===b.Atom){i=g.getAtomicNumber()||0;h=g.getMassNumber()||0}else{if(f===b.Pseudoatom){i=4094}else{if(f===b.VariableAtom){i=4095}else{i=0}}}d+=i*e._P36+h*e._P24;return d},getFragmentDetailCompareValue:function(e){var d=0;d+=(e.getNodeCount()||0)*U._P36+(e.getConnectorCount()||0)*U._P24;return d},getConnectorCompareValue:function(e,g){var f=b.UnivChemStructObjComparer;var d=0;var l=e instanceof Kekule.Bond;d|=l?(1<<(5*4)):0;if(g.compareBondType){var i;if(l){i=f.BOND_TYPE_MAP.get(e.getBondType());if(b.ObjUtils.isUnset(i)){i=0}}else{i=0}d|=(i<<(4*4))}if(g.compareBondOrder){var h=l?Math.round(e.getElectronCount()):0;d|=h<<(4*2)}if(g.compareConnectedObjCount){d|=(e.getConnectedObjCount()||0)}return d}};Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={};this._executorInstances={};this._defExecutorId=null},registerExecutor:function(f,e,d){this._executorClasses[f]=e;if(d){this._defExecutorId=f}},getExecutor:function(f){if(!f){return null}var d=this._executorInstances[f];if(!d){var e=this._executorClasses[f];if(e){d=new e();this._executorInstances[f]=d}}return d},canonicalize:function(e,d){var g=this.getExecutor(d||this._defExecutorId);if(!g){Kekule.error(Kekule.ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND)}else{var f=e.getCtab?e.getCtab():e;return g.execute(f)}}});Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer);Kekule.canonicalizer=Kekule.Canonicalizer.getInstance();ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){var d=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var g=0,f=d.length;g<f;++g){d[g].canonicalize(e)}return this}});ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});Kekule.CanonicalizationExecutor=Class.create({CLASS_NAME:"Kekule.CanonicalizationExecutor",execute:function(e){var d=this.doExecute(e);this.doCanonicalizeConnectedObjs(d);return d},doExecute:function(d){return d},doCanonicalizeConnectedObjs:function(f){var m=function(l,i){var o=f.indexOfChild(l);var n=f.indexOfChild(i);return o-n};for(var e=0,d=f.getConnectorCount();e<d;++e){var g=f.getConnectorAt(e);var h=g.getConnectedObjs();h.sort(m)}}});Kekule.MorganCanonicalizationExecutor=Class.create(Kekule.CanonicalizationExecutor,{CLASS_NAME:"Kekule.MorganCanonicalizationExecutor",doExecute:function(f){var g=Kekule.GraphAdaptUtils.ctabToGraph(f,null,{expandSubStructures:true});var e=this._calcGraphFinalECs(g);var d=this._sortVertexesAndEdges(g,e);this._sortNodesAndConnectors(f,d.sortedVertexes,d.sortedEdges);return f},_processECs:function(s,e,p,n){var r=[];var d=s.getVertexes();for(var m=0,f=d.length;m<f;++m){var o=d[m];var q=0;if(!n){var t=o.getNeighbors();for(var h=0,g=t.length;h<g;++h){q+=p.get(t[h])||0}}else{q=o.getEdgeCount()}e.set(o,q);a.pushUnique(r,q)}return r.length},_calcGraphFinalECs:function(i){var g=[new Kekule.MapEx(),new Kekule.MapEx()];try{var f=0;var l=g[0];var d=g[0];var h=this._processECs(i,l,d,true);var e=0;while(h>e){e=h;++f;d=l;l=g[f%2];h=this._processECs(i,l,d)}}finally{l.finalize()}return d},_sortVertexesAndEdges:function(e,s){var n=e.getVertexes();var f=e.getEdges();if(!n.length){return{sortedVertexes:n,sortedEdges:f}}var u=a.clone(n);u.sort(function(E,D){var C=s.get(E);var B=s.get(D);var i=(C-B);if(i===0){var A=E.getData("object");var l=D.getData("object");i=Kekule.UnivChemStructObjComparer.compare(A,l)}return i});var q=new Kekule.MapEx();var o=function(l,i){return u.indexOf(l)-u.indexOf(i)};try{var z=a.clone(u);var r=[];var t=u[u.length-1];r.push(t);q.set(t,0);z.splice(u.length-1,1);for(var y=0;y<r.length;++y){var t=r[y];if(y!==0){var d=z.indexOf(t);if(d>=0){r.push(t);q.set(t,r.length-1);z.splice(d,1)}}var v=t.getNeighbors();v=a.intersect(v,z);if(v.length){v.sort(o);for(var x=v.length-1;x>=0;--x){var p=v[x];d=z.indexOf(p);if(d>=0){r.push(p);q.set(v[x],r.length-1);z.splice(d,1)}}}}var m=a.clone(f);var g=function(l,i){return(q.get(l)-q.get(i))};if(m.length>1){for(var y=0,w=m.length;y<w;++y){var h=m[y];h.getVertexes().sort(g)}m.sort(function(B,A){var E=B.getVertexes();var D=A.getVertexes();var l=0;for(var C=0;C<2;++C){l=g(E[C],D[C]);if(l!==0){return l}}return l})}}finally{q.finalize()}return{sortedVertexes:r,sortedEdges:m}},_sortNodesAndConnectors:function(g,o,m){var e=[];for(var f=0,d=o.length;f<d;++f){e.push(o[f].getData("object"))}var n=[];for(var f=0,d=m.length;f<d;++f){n.push(m[f].getData("object"))}var h=new Kekule.MapEx();try{this._calcChildNodeLabels(g,h,e);this._reindexCtabNodesAndConnectors(g,h,e,n)}finally{h.finalize()}},_calcChildNodeLabels:function(g,o,p){var m=null;var d=g.getNodes();for(var h=0,f=d.length;h<f;++h){var e=d[h];var n=p.indexOf(e)+1;if(n<1){if(e.hasCtab&&e.hasCtab()){n=-this._calcChildNodeLabels(e.getCtab(),o,p)}else{}}o.set(e,n);if(n>=0){if((m===null)||(m>n)){m=n}}}return m},_reindexCtabNodesAndConnectors:function(m,h,e,o){m.sortNodes(function(l,i){var q=h.get(l);var p=h.get(i);if(q>0&&p>0){return q-p}else{if(q<0&&p<0){return -(q-p)}else{return(q>0)?-1:1}}});m.sortConnectors(function(l,i){var q=o.indexOf(l);var p=o.indexOf(i);return q-p});var f=m.getNodes();for(var g=0,d=f.length;g<d;++g){var n=f[g];if(n.hasCtab&&n.hasCtab()&&e.indexOf(n)<0){this._reindexCtabNodesAndConnectors(n.getCtab(),h,e,o)}}}});Kekule.canonicalizer.registerExecutor("morgan",Kekule.MorganCanonicalizationExecutor,true)})();(function(){var a=Kekule.GraphAlgorithmUtils;var b=Kekule.BondType;Kekule.StructureRingSearchDefOptions={bondTypes:[b.COVALENT]};ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(c){var d=Class.create(c);d.connectorClasses=[Kekule.Bond];return Kekule.GraphAdaptUtils.ctabToGraph(this,null,d)},extractStructObjs:function(g){var f=g.edges;var n=g.vertexes;var e=[],d=[];for(var h=0,c=n.length;h<c;++h){var m=n[h].getData("object");if(m instanceof Kekule.BaseStructureNode){e.push(m)}}for(var h=0,c=f.length;h<c;++h){var m=f[h].getData("object");if(m instanceof Kekule.BaseStructureConnector){d.push(m)}}return{nodes:e,connectors:d}},findCycleBlocks:function(){var c=this.getRingInfo();return c?c.cycleBlocks:[]},findAllRings:function(){var h=this.getRingInfo();var d=[];if(h){for(var f=0,e=h.cycleBlocks.length;f<e;++f){var c=h.cycleBlocks[f];var g=c.allRings;d=d.concat(g)}}return d},findSSSR:function(){var h=this.getRingInfo();var d=[];if(h){for(var f=0,e=h.cycleBlocks.length;f<e;++f){var c=h.cycleBlocks[f];var g=c.sssrRings;d=d.concat(g)}}return d},analysisRings:function(v){var o=this.getGraph(v||Kekule.StructureRingSearchDefOptions);if(o){var t=[];var c=a.analysisRings(o);for(var n=0,f=c.length;n<f;++n){var s=c[n];var p=this.extractStructObjs(s);t.push(p);p.allRings=[];var e=s.allRings;for(var m=0,h=e.length;m<h;++m){var r=e[m];var d=this.extractStructObjs(r);p.allRings.push(d)}p.sssrRings=[];var u=s.sssrRings;for(var m=0,h=u.length;m<h;++m){var r=u[m];var q=e.indexOf(r);if(q>=0){p.sssrRings.push(p.allRings[q])}else{var d=this.extractStructObjs(r);p.sssrRings.push(d)}}}return{cycleBlocks:t}}else{return null}}});ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(d){var c=this.getPropStoreFieldValue("ringInfo");if(!c&&!d){c=this.analysisRings();this.setPropStoreFieldValue("ringInfo",c)}return c},setter:null}]);ClassEx.extendMethod(Kekule.StructureConnectionTable,"objectChange",function(d,c){this.setPropStoreFieldValue("ringInfo",null);return d(c)});ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(){return this.hasCtab()?this.getCtab().analysisRings():null}});ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(c){return this.hasCtab()?this.getCtab().getRingInfo(c):null},setter:null}])})();(function(){var b=Kekule.ArrayUtils;var c=Kekule.BondType;var d=Kekule.BondOrder;var a={SATURATED_CARBON:-1,ESTER_CARBON:-16,SULFONE_OR_SULFOXIDE_SULPHUR:-32};Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64};ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if(this.getSymbol()==="S"){var f=this.getLinkedMultipleBonds();if(f.length>=1){for(var m=0,e=f;m<e;++m){var o=this.getLinkedObjsOnConnector(f[m]);for(var h=0,g=o.length;h<g;++h){var n=o[h];if((n instanceof Kekule.Atom)&&(n.getSymbol()==="O")){return true}}}}}return false},isEsterCarbon:function(){if(this.getSymbol()==="C"){var n=this.getLinkedBonds(c.COVALENT);var h,m;for(var g=0,f=n.length;g<f;++g){var e=n[g];if(e.isBondBetween("C","O")){if(!m&&(e.getBondOrder()===d.SINGLE)){m=true}else{if(!h&&(e.getBondOrder()===d.DOUBLE)){h=true}}if(m&&h){return true}}}}return false}});ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(h,f,q){var n=function(y,H,C,A){var J=y;var t=Kekule.IsotopeFactory.getIsotope(J);var G=H.getCharge();var F=H.isSaturated&&H.isSaturated();if(!F){var u=H.getLinkedMultipleBonds();if(H.isSulfoneOrSulfoxideSulphur&&H.isSulfoneOrSulfoxideSulphur()){return a.SULFONE_OR_SULFOXIDE_SULPHUR}else{if(H.isEsterCarbon&&H.isEsterCarbon()){return a.ESTER_CARBON}}var D=b.intersect(u,A);var B=D.length;if(B){if((B===2)&&(D[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)){if(t.isHetero&&t.isHetero()){return[1,2]}else{return 1}}else{if((B===1)&&(D[0].getBondOrder()===Kekule.BondOrder.DOUBLE)){return 1}else{return 0}}}else{if(J==="C"){var v=false;for(var K=0,I=u.length;K<I;++K){var z=u[K];var w=H.getLinkedObjsOnConnector(z);if(w.length===1){var E=w[0];var x=E.getPrimaryIsotope();if(x.isHetero()){v=true;break}}}if(v){return 0}else{return 1}}else{return 1}}}else{if(H.getRadical&&(H.getRadical()===Kekule.RadicalOrder.DOUBLET)){return 1}else{if(t.isHetero()){return 2}else{if(J==="C"){if(G>0){return 0}else{if(G<0){return 2}else{return a.SATURATED_CARBON}}}}}}return 0};if(h instanceof Kekule.VariableAtom){var e=h.getAllowedIsotopeIds();if(e&&e.length){var s=[];for(var p=0,o=e.length;p<o;++p){var g=e[p];var m=Kekule.IsotopeFactory.getIsotopeById(g).getSymbol();b.pushUnique(s,n(m,h,f,q))}return s}else{return[0,1,2]}}var r=h.getPrimaryIsotope();if(!r){return[0,1,2]}else{var m=r.getSymbol();return n(m,h,f,q)}},_checkRingAromaticType:function(g,e){if(e){var r=g.nodes;var w=[];var p=[];var u=r.length;for(var t=0;t<u;++t){var q=r[t];var v=e.get(q);if(b.isArray(v)){w.push(v)}else{w.push([v])}p[t]=0}var z=function(C,n){var i=n[C];var B=++i;if(B>=w[C].length){if(C>=n.length-1){return false}else{n[C]=0;return z(C+1,n)}}else{n[C]=B;return true}};var y=function(i){return z(0,i)};var h;var s=null;var o=0;do{++o;var m=0;var f=Kekule.AromaticTypes.NONAROMATIC;for(var t=0;t<u;++t){var x=w[t][p[t]];if(x>=0){m+=x}else{f=Kekule.AromaticTypes.NONAROMATIC;break}}var l=parseInt(m/4);var A=m%4;if((l<=5)&&(l!==2)){if(A===2){f=Kekule.AromaticTypes.EXPLICIT_AROMATIC}else{if(!A){f=Kekule.AromaticTypes.ANTIAROMATIC}}}if(s!==null){if(s!==f){if((s===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(f===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){return Kekule.AromaticTypes.UNCERTAIN;break}}}else{s=f}}while(y(p));return s}},_calcPossibleRingNodesPElectronCounts:function(e,r,g){var f=[];var n=[];var q=[];if(!g){for(var o=0,m=r.length;o<m;++o){b.pushUnique(f,r[o].nodes);b.pushUnique(n,r[o].connectors)}q=f}else{for(var o=0,m=g.length;o<m;++o){b.pushUnique(f,g[o].nodes);b.pushUnique(n,g[o].connectors)}for(var o=0,m=r.length;o<m;++o){b.pushUnique(q,r[o].nodes)}}for(var o=0,m=q.length;o<m;++o){var h=q[o];var p=this._getPossibleRingNodePiElectronCounts(h,f,n);e.set(h,p)}},perceiveAromaticRings:function(m,p){var n=p||this.findSSSR();var q=[];var e=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(e,n,null);for(var h=0,f=n.length;h<f;++h){var g=n[h];var o=this._checkRingAromaticType(g,e);if((o===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(m&&(o===Kekule.AromaticTypes.UNCERTAIN))){q.push(g)}}return q}finally{e.finalize()}},getRingAromaticType:function(g,f){if(!f){f=this.findSSSR()}var e;var h=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(h,[g],f);e=this._checkRingAromaticType(g,h)}finally{h.finalize()}return e}});ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(f){var e=this.hasCtab()?this.getCtab().perceiveAromaticRings(f):[];this.setAromaticRings(e||[]);return e},getRingAromaticType:function(f,e){return this.hasCtab()?this.getCtab().getRingAromaticType(f,e):null}})})();(function(){Kekule.MolStandardizer={standardize:function(d,a){var c={unmarshalSubFragments:true,doCanonicalization:true,doAromaticPerception:true};var b=d;var e=Object.extend(c,a);if(e.unmarshalSubFragments){b.unmarshalAllSubFragments(true)}if(e.doCanonicalization){Kekule.canonicalizer.canonicalize(b,e.canonicalizerExecutorId||null)}if(e.doAromaticPerception){b.perceiveAromaticRings()}return b}};Object.extend(Kekule.ChemStructureUtils,{isSameStructure:function(a,d){var c=a.clone(false);var b=d.clone(false);c=Kekule.MolStandardizer.standardize(c);b=Kekule.MolStandardizer.standardize(b);return Kekule.UnivChemStructObjComparer.compare(c,b)===0}});ClassEx.extend(Kekule.ChemObject,{standardize:function(c){var a=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var d=0,b=a.length;d<b;++d){a[d].standardize(c)}return this}});ClassEx.extend(Kekule.StructureFragment,{standardize:function(a){return Kekule.MolStandardizer.standardize(this,a)},isSameStructureWith:function(a){return Kekule.ChemStructureUtils.isSameStructure(this,a)}})})();(function(){var b=Kekule.ArrayUtils;var c=Kekule.UnivChemStructObjComparer;Kekule.ChemStructureSearcher={findSubStructure:function(m,l,q){var g=Object.extend({doStandardize:true},q);if(g.doStandardize){var h={unmarshalSubFragments:true,doCanonicalization:false,doAromaticPerception:true};m.standardize(h);l.standardize(h)}var p=m.getNodeAt(0);var f=l.getNodes();var r=f.length;var i=0;var o=[];var n=[];var e={compareLinkedConnectorCount:false,compareCharge:!g.ignoreCharge,compareHydrogenCount:false,compareConnectedObjCount:false,compareBondOrder:!g.ignoreBondOrder};var d=false;while(!d&&(i<r)){d=a._compareNode(p,f[i],o,n,e);++i}if(!d){return false}else{return b.toUnique(d)}},_addToComparedObjs:function(e,f,d){f.push(e)},_removeFromComparedObjs:function(f,g,d){var e=g.indexOf(f);g.length=e},_isSameMappedObj:function(i,h,d,g){var f=g.indexOf(h);var e=d.indexOf(i);return(f>=0)&&(f===e)},_compareComparedNeighbors:function(e,d,n,o){if(e.length>d.length){return false}var h=[];for(var m=0,f=e.length;m<f;++m){h.push(n.indexOf(e[m]))}var g=[];for(var m=0,f=d.length;m<f;++m){g.push(o.indexOf(d[m]))}for(var m=0,f=h.length;m<f;++m){if(g.indexOf(h[m])<0){return false}}return true},_compareNode:function(g,q,t,m,x){if(c.compare(g,q,x)!==0){return false}else{var s=g.getLinkedConnectorCount();var l=q.getLinkedConnectorCount();if(s>l){return false}var f=b.clone(t);var h=b.clone(m);a._addToComparedObjs(g,f,"target");a._addToComparedObjs(q,h,"src");var o=b.clone(g.getLinkedConnectors());var e=b.clone(q.getLinkedConnectors());var u=b.intersect(o,f);var v=b.intersect(e,h);var p=true;if(!a._compareComparedNeighbors(u,v,f,h)){p=false}else{o=b.exclude(o,u);e=b.exclude(e,v);if(o.length>e.length){p=false}}var r=[];while(p&&o.length){var n=false;var w=o.shift();var i=0;var d;while(e.length&&!n&&(i<e.length)){d=e[i];n=a._compareConnector(w,d,f,h,x);if(n){r=r.concat(n)}++i}if(!n){p=false;break}else{b.remove(e,d)}}if(p){p=[q].concat(r)}return p}},_compareConnector:function(v,e,t,n,w){if(c.compare(v,e,w)!==0){return false}else{var l=v.getConnectedObjCount();var f=e.getConnectedObjCount();if(l>f){return false}var g=b.clone(t);var i=b.clone(n);a._addToComparedObjs(v,g,"target");a._addToComparedObjs(e,i,"src");var u=b.clone(v.getConnectedObjs());var x=b.clone(e.getConnectedObjs());var q=b.intersect(u,g);var h=b.intersect(x,i);var r=true;if(!a._compareComparedNeighbors(q,h,g,i)){r=false}else{u=b.exclude(u,q);x=b.exclude(x,h);if(u.length>x.length){r=false}}var s=[];while(r&&u.length){var o=false;var p=u.shift();var m=0;var d;while(x.length&&!o&&(m<x.length)){d=x[m];if(d.getClass()!==p.getClass()){o=false}else{if(d instanceof Kekule.ChemStructureNode){o=a._compareNode(p,d,g,i,w)}else{if(d instanceof Kekule.ChemStructureConnector){o=a._compareConnector(p,d,g,i,w)}else{o=false}}}if(o){s=s.concat(o)}++m}if(!o){r=false;break}else{b.remove(x,d)}}if(r){r=[e].concat(s)}return r}}};var a=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(e,d){return a.findSubStructure(e,this,d)}})})();Kekule.chemicalElementsData=[{symbol:"H",casId:"1333-74-0",group:1,period:1,name:"Hydrogen",atomicNumber:1,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.37,radiiVdw:1.2,paulingE:2.2,naturalMass:1.00794075382579},{symbol:"He",casId:"7440-59-7",group:18,period:1,name:"Helium",atomicNumber:2,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.32,radiiVdw:1.4,naturalMass:4.002601902393709},{symbol:"Li",casId:"7439-93-2",group:1,period:2,name:"Lithium",atomicNumber:3,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:0.32,radiiVdw:2.2,paulingE:0.98,naturalMass:6.9400376247955},{symbol:"Be",casId:"7440-41-7",group:2,period:2,name:"Beryllium",atomicNumber:4,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:0.9,radiiVdw:1.9,paulingE:1.57,naturalMass:9.0121822},{symbol:"B",casId:"7440-42-8",group:13,period:2,name:"Boron",atomicNumber:5,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:0.82,radiiVdw:1.8,paulingE:2.04,naturalMass:10.811028088400002},{symbol:"C",casId:"7440-44-0",group:14,period:2,name:"Carbon",atomicNumber:6,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:0.77,radiiVdw:1.7,paulingE:2.55,naturalMass:12.010735896788},{symbol:"N",casId:"7727-37-9",group:15,period:2,name:"Nitrogen",atomicNumber:7,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.77,radiiVdw:1.6,paulingE:3.04,naturalMass:14.006743088432001},{symbol:"O",casId:"7782-44-7",group:16,period:2,name:"Oxygen",atomicNumber:8,chemicalSerie:"Nonmetals",phase:"Gas",radiiCova:0.73,radiiVdw:1.55,paulingE:3.44,naturalMass:15.999404927569397},{symbol:"F",casId:"7782-41-4",group:17,period:2,name:"Fluorine",atomicNumber:9,chemicalSerie:"Halogens",phase:"Gas",radiiCova:0.73,radiiVdw:1.5,paulingE:3.98,naturalMass:18.99840322},{symbol:"Ne",casId:"7440-01-9",group:18,period:2,name:"Neon",atomicNumber:10,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.69,radiiVdw:1.54,naturalMass:20.180046383574997},{symbol:"Na",casId:"7440-23-5",group:1,period:3,name:"Sodium",atomicNumber:11,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.54,radiiVdw:2.4,paulingE:0.93,naturalMass:22.98976928},{symbol:"Mg",casId:"7439-95-4",group:2,period:3,name:"Magnesium",atomicNumber:12,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.3,radiiVdw:2.2,paulingE:1.31,naturalMass:24.305051612423004},{symbol:"Al",casId:"7429-90-5",group:13,period:3,name:"Aluminum",atomicNumber:13,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.18,radiiVdw:2.1,paulingE:1.61,naturalMass:26.98153863},{symbol:"Si",casId:"7440-21-3",group:14,period:3,name:"Silicon",atomicNumber:14,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.11,radiiVdw:2.1,paulingE:1.9,naturalMass:28.085384754933294},{symbol:"P",casId:"7723-14-0",group:15,period:3,name:"Phosphorus",atomicNumber:15,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.06,radiiVdw:1.95,paulingE:2.19,naturalMass:30.97376163},{symbol:"S",casId:"7704-34-9",group:16,period:3,name:"Sulfur",atomicNumber:16,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.02,radiiVdw:1.8,paulingE:2.58,naturalMass:32.066084993038},{symbol:"Cl",casId:"7782-50-5",group:17,period:3,name:"Chlorine",atomicNumber:17,chemicalSerie:"Halogens",phase:"Gas",radiiCova:0.99,radiiVdw:1.8,paulingE:3.16,naturalMass:35.452538168202},{symbol:"Ar",casId:"7440-37-1",group:18,period:3,name:"Argon",atomicNumber:18,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:0.97,radiiVdw:1.8,naturalMass:39.947676710841314},{symbol:"K",casId:"7440-09-7",group:1,period:4,name:"Potassium",atomicNumber:19,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:1.96,radiiVdw:2.8,paulingE:0.82,naturalMass:39.09830112446276},{symbol:"Ca",casId:"7440-70-2",group:2,period:4,name:"Calcium",atomicNumber:20,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.74,radiiVdw:2.4,paulingE:1,naturalMass:40.078022651988505},{symbol:"Sc",casId:"7440-20-2",group:3,period:4,name:"Scandium",atomicNumber:21,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.3,paulingE:1.36,naturalMass:44.9559119},{symbol:"Ti",casId:"7440-32-6",group:4,period:4,name:"Titanium",atomicNumber:22,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.15,paulingE:1.54,naturalMass:47.866749245159994},{symbol:"V",casId:"7440-62-2",group:5,period:4,name:"Vanadium",atomicNumber:23,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.63,naturalMass:50.94146749750001},{symbol:"Cr",casId:"7440-47-3",group:6,period:4,name:"Chromium",atomicNumber:24,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.27,radiiVdw:2.05,paulingE:1.66,naturalMass:51.996133070619},{symbol:"Mn",casId:"7439-96-5",group:7,period:4,name:"Manganese",atomicNumber:25,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.39,radiiVdw:2.05,paulingE:1.55,naturalMass:54.9380451},{symbol:"Fe",casId:"7439-89-6",group:8,period:4,name:"Iron",atomicNumber:26,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.25,radiiVdw:2.05,paulingE:1.83,naturalMass:55.845145623527},{symbol:"Co",casId:"7440-48-4",group:9,period:4,name:"Cobalt",atomicNumber:27,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2,paulingE:1.88,naturalMass:58.933195},{symbol:"Ni",casId:"7440-02-0",group:10,period:4,name:"Nickel",atomicNumber:28,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.21,radiiVdw:2,paulingE:1.91,naturalMass:58.693351562447994},{symbol:"Cu",casId:"7440-50-8",group:11,period:4,name:"Copper",atomicNumber:29,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2,paulingE:1.9,naturalMass:63.5456400936},{symbol:"Zn",casId:"7440-66-6",group:12,period:4,name:"Zinc",atomicNumber:30,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.1,paulingE:1.65,naturalMass:65.39556265691999},{symbol:"Ga",casId:"7440-55-3",group:13,period:4,name:"Gallium",atomicNumber:31,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.1,paulingE:1.81,naturalMass:69.723065622084},{symbol:"Ge",casId:"7440-56-4",group:14,period:4,name:"Germanium",atomicNumber:32,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.22,radiiVdw:2.1,paulingE:2.01,naturalMass:72.61275825015},{symbol:"As",casId:"7440-38-2",group:15,period:4,name:"Arsenic",atomicNumber:33,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.19,radiiVdw:2.05,paulingE:2.18,naturalMass:74.9215965},{symbol:"Se",casId:"7782-49-2",group:16,period:4,name:"Selenium",atomicNumber:34,chemicalSerie:"Nonmetals",phase:"Solid",radiiCova:1.16,radiiVdw:1.9,paulingE:2.55,naturalMass:78.9593882401},{symbol:"Br",casId:"7726-95-6",group:17,period:4,name:"Bromine",atomicNumber:35,chemicalSerie:"Halogens",phase:"Liquid",radiiCova:1.14,radiiVdw:1.9,paulingE:2.96,naturalMass:79.90352797085},{symbol:"Kr",casId:"7439-90-9",group:18,period:4,name:"Krypton",atomicNumber:36,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.1,radiiVdw:2.02,paulingE:3,naturalMass:83.79932499157},{symbol:"Rb",casId:"7440-17-7",group:1,period:5,name:"Rubidium",atomicNumber:37,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.11,radiiVdw:2.9,paulingE:0.82,naturalMass:85.46766359685701},{symbol:"Sr",casId:"7440-24-6",group:2,period:5,name:"Strontium",atomicNumber:38,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.92,radiiVdw:2.55,paulingE:0.95,naturalMass:87.61664410489999},{symbol:"Y",casId:"7440-65-5",group:3,period:5,name:"Yttrium",atomicNumber:39,chemicalSerie:"Transition metals",phase:"Solid",naturalMass:88.9058483},{symbol:"Zr",casId:"7440-67-7",group:4,period:5,name:"Zirconium",atomicNumber:40,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:91.22364760672002},{symbol:"Nb",casId:"7440-03-1",group:5,period:5,name:"Niobium",atomicNumber:41,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2.15,naturalMass:92.9063781},{symbol:"Mo",casId:"7439-98-7",group:6,period:5,name:"Molybdenum",atomicNumber:42,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.45,radiiVdw:2.1,naturalMass:95.93129211008},{symbol:"Tc",casId:"7440-26-8",group:7,period:5,name:"Technetium",atomicNumber:43,chemicalSerie:"Transition metals",phase:"Synthetic",radiiCova:1.56,radiiVdw:2.05},{symbol:"Ru",casId:"7440-18-8",group:8,period:5,name:"Ruthenium",atomicNumber:44,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.26,radiiVdw:2.05,naturalMass:101.06494544279},{symbol:"Rh",casId:"7440-16-6",group:9,period:5,name:"Rhodium",atomicNumber:45,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.35,radiiVdw:2,naturalMass:102.905504},{symbol:"Pd",casId:"7440-05-3",group:10,period:5,name:"Palladium",atomicNumber:46,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.31,radiiVdw:2.05,naturalMass:106.41532878129999},{symbol:"Ag",casId:"7440-22-4",group:11,period:5,name:"Silver",atomicNumber:47,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.53,radiiVdw:2.1,naturalMass:107.86815084455},{symbol:"Cd",casId:"7440-43-9",group:12,period:5,name:"Cadmium",atomicNumber:48,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.2,naturalMass:112.41155220052002},{symbol:"In",casId:"7440-74-6",group:13,period:5,name:"Indium",atomicNumber:49,chemicalSerie:"Metals",phase:"Solid",radiiVdw:2.25,naturalMass:114.818085722},{symbol:"Sn",casId:"7440-31-5",group:14,period:5,name:"Tin",atomicNumber:50,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.41,radiiVdw:2.25,naturalMass:118.71010831537001},{symbol:"Sb",casId:"7440-36-0",group:15,period:5,name:"Antimony",atomicNumber:51,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:121.75978613257},{symbol:"Te",casId:"13494-80-9",group:16,period:5,name:"Tellurium",atomicNumber:52,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.35,radiiVdw:2.1,naturalMass:127.60312784714},{symbol:"I",casId:"7553-56-2",group:17,period:5,name:"Iodine",atomicNumber:53,chemicalSerie:"Halogens",phase:"Solid",radiiCova:1.33,radiiVdw:2.1,naturalMass:126.904473},{symbol:"Xe",casId:"7440-63-3",group:18,period:5,name:"Xenon",atomicNumber:54,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.3,radiiVdw:2.16,naturalMass:131.29248059059},{symbol:"Cs",casId:"7440-46-2",group:1,period:6,name:"Cesium",atomicNumber:55,chemicalSerie:"Alkali Metals",phase:"Solid",radiiCova:2.25,radiiVdw:3,naturalMass:132.9054519},{symbol:"Ba",casId:"7440-39-3",group:2,period:6,name:"Barium",atomicNumber:56,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiCova:1.98,radiiVdw:2.7,naturalMass:137.32689183471098},{symbol:"La",casId:"7439-91-0",group:3,period:6,name:"Lanthanum",atomicNumber:57,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.69,radiiVdw:2.5,naturalMass:138.90545398283},{symbol:"Ce",casId:"7440-45-1",period:6,name:"Cerium",atomicNumber:58,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.48,naturalMass:140.11572621392},{symbol:"Pr",casId:"7440-10-0",period:6,name:"Praseodymium",atomicNumber:59,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:140.9076528},{symbol:"Nd",casId:"7440-00-8",period:6,name:"Neodymium",atomicNumber:60,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.47,naturalMass:144.23613137220002},{symbol:"Pm",casId:"7440-12-2",period:6,name:"Promethium",atomicNumber:61,chemicalSerie:"Lanthanides",phase:"Synthetic",radiiVdw:2.43},{symbol:"Sm",casId:"7440-19-9",period:6,name:"Samarium",atomicNumber:62,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.43,naturalMass:150.36634852618},{symbol:"Eu",casId:"7440-53-1",period:6,name:"Europium",atomicNumber:63,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:2.4,naturalMass:151.96437047419},{symbol:"Gd",casId:"7440-54-2",period:6,name:"Gadolinium",atomicNumber:64,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.38,naturalMass:157.25212221544},{symbol:"Tb",casId:"7440-27-9",period:6,name:"Terbium",atomicNumber:65,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.37,naturalMass:158.9253468},{symbol:"Dy",casId:"7429-91-6",period:6,name:"Dysprosium",atomicNumber:66,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.35,naturalMass:162.49703350552},{symbol:"Ho",casId:"7440-60-0",period:6,name:"Holmium",atomicNumber:67,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.33,naturalMass:164.9303221},{symbol:"Er",casId:"7440-52-0",period:6,name:"Erbium",atomicNumber:68,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.32,naturalMass:167.25630413192},{symbol:"Tm",casId:"7440-30-4",period:6,name:"Thulium",atomicNumber:69,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.3,naturalMass:168.9342133},{symbol:"Yb",casId:"7440-64-4",period:6,name:"Ytterbium",atomicNumber:70,chemicalSerie:"Lanthanides",phase:"Solid",radiiVdw:2.28,naturalMass:173.03769558789998},{symbol:"Lu",casId:"7439-94-3",period:6,name:"Lutetium",atomicNumber:71,chemicalSerie:"Lanthanides",phase:"Solid",radiiCova:1.6,radiiVdw:2.27,naturalMass:174.96672138555},{symbol:"Hf",casId:"7440-58-6",group:4,period:6,name:"Hafnium",atomicNumber:72,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.5,radiiVdw:2.25,naturalMass:178.48497214162},{symbol:"Ta",casId:"7440-25-7",group:5,period:6,name:"Tantalum",atomicNumber:73,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.38,radiiVdw:2.2,naturalMass:180.94787573628},{symbol:"W",casId:"7440-33-7",group:6,period:6,name:"Tungsten",atomicNumber:74,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.46,radiiVdw:2.1,naturalMass:183.84177810241},{symbol:"Re",casId:"7440-15-5",group:7,period:6,name:"Rhenium",atomicNumber:75,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.59,radiiVdw:2.05,naturalMass:186.2067066106},{symbol:"Os",casId:"7440-04-2",group:8,period:6,name:"Osmium",atomicNumber:76,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2,naturalMass:190.22486304558998},{symbol:"Ir",casId:"7439-88-5",group:9,period:6,name:"Iridium",atomicNumber:77,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.37,radiiVdw:2,naturalMass:192.2160564148},{symbol:"Pt",casId:"7440-06-4",group:10,period:6,name:"Platinum",atomicNumber:78,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.28,radiiVdw:2.05,naturalMass:195.07780788031297},{symbol:"Au",casId:"7440-57-5",group:11,period:6,name:"Gold",atomicNumber:79,chemicalSerie:"Transition metals",phase:"Solid",radiiCova:1.44,radiiVdw:2.1,naturalMass:196.9665687},{symbol:"Hg",casId:"7439-97-6",group:12,period:6,name:"Mercury",atomicNumber:80,chemicalSerie:"Transition metals",phase:"Liquid",radiiCova:1.49,radiiVdw:2.05,naturalMass:200.59916661780002},{symbol:"Tl",casId:"7440-28-0",group:13,period:6,name:"Thallium",atomicNumber:81,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.49,radiiVdw:2.2,naturalMass:204.38333242650796},{symbol:"Pb",casId:"7439-92-1",group:14,period:6,name:"Lead",atomicNumber:82,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.48,radiiVdw:2.3,naturalMass:207.21690766300003},{symbol:"Bi",casId:"7440-69-9",group:15,period:6,name:"Bismuth",atomicNumber:83,chemicalSerie:"Metals",phase:"Solid",radiiCova:1.47,radiiVdw:2.3,naturalMass:208.9803987},{symbol:"Po",casId:"7440-08-6",group:16,period:6,name:"Polonium",atomicNumber:84,chemicalSerie:"Metalloids",phase:"Solid",radiiCova:1.46,radiiVdw:2},{symbol:"At",casId:"7440-08-6",group:17,period:6,name:"Astatine",atomicNumber:85,chemicalSerie:"Halogens",phase:"Solid",radiiVdw:2},{symbol:"Rn",casId:"10043-92-2",group:18,period:6,name:"Radon",atomicNumber:86,chemicalSerie:"Noble Gasses",phase:"Gas",radiiCova:1.45,radiiVdw:2},{symbol:"Fr",casId:"7440-73-5",group:1,period:7,name:"Francium",atomicNumber:87,chemicalSerie:"Alkali Metals",phase:"Solid",radiiVdw:2},{symbol:"Ra",casId:"7440-14-4",group:2,period:7,name:"Radium",atomicNumber:88,chemicalSerie:"Alkali Earth Metals",phase:"Solid",radiiVdw:2},{symbol:"Ac",casId:"7440-34-8",group:3,period:7,name:"Actinium",atomicNumber:89,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Th",casId:"7440-29-1",period:7,name:"Thorium",atomicNumber:90,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:232.0380553},{symbol:"Pa",casId:"7440-13-3",period:7,name:"Protactinium",atomicNumber:91,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2,naturalMass:231.035884},{symbol:"U",casId:"7440-61-1",period:7,name:"Uranium",atomicNumber:92,chemicalSerie:"Actinides",phase:"Solid",radiiVdw:2.3,naturalMass:238.0289182792545},{symbol:"Np",casId:"7439-99-8",period:7,name:"Neptunium",atomicNumber:93,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Pu",casId:"7440-07-5",period:7,name:"Plutonium",atomicNumber:94,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Am",casId:"7440-35-9",period:7,name:"Americium",atomicNumber:95,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cm",casId:"7440-51-9",period:7,name:"Curium",atomicNumber:96,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Bk",casId:"7440-40-6",period:7,name:"Berkelium",atomicNumber:97,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Cf",casId:"7440-71-3",period:7,name:"Californium",atomicNumber:98,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Es",casId:"7429-92-7",period:7,name:"Einsteinium",atomicNumber:99,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Fm",casId:"7440-72-4",period:7,name:"Fermium",atomicNumber:100,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Md",casId:"7440-11-1",period:7,name:"Mendelevium",atomicNumber:101,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"No",casId:"10028-14-5",period:7,name:"Nobelium",atomicNumber:102,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Lr",casId:"22537-19-5",period:7,name:"Lawrencium",atomicNumber:103,chemicalSerie:"Actinides",phase:"Synthetic",radiiVdw:2},{symbol:"Rf",casId:"53850-36-5",group:4,period:7,name:"Rutherfordium",atomicNumber:104,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Db",casId:"53850-35-4",group:5,period:7,name:"Dubnium",atomicNumber:105,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Sg",casId:"54038-81-2",group:6,period:7,name:"Seaborgium",atomicNumber:106,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Bh",casId:"54037-14-8",group:7,period:7,name:"Bohrium",atomicNumber:107,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Hs",casId:"54037-57-9",group:8,period:7,name:"Hassium",atomicNumber:108,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Mt",casId:"54038-01-6",group:9,period:7,name:"Meitnerium",atomicNumber:109,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Ds",casId:"54083-77-1",group:10,period:7,name:"Darmstadtium",atomicNumber:110,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Rg",casId:"54386-24-2",group:11,period:7,name:"Roentgenium",atomicNumber:111,chemicalSerie:"Transition metals",phase:"Synthetic"},{symbol:"Uub",group:12,period:7,name:"Ununbium",atomicNumber:112,chemicalSerie:"Transition metals",phase:"Synthetic"}];Kekule.isotopesData=[{elementSymbol:"H",atomicNumber:1,isotopes:[{id:"H1",massNumber:1,relativeAbundance:0.999885,exactMass:1.007825032,spin:"1/2+",magneticMoment:"+2.792846",halfLife:-1},{id:"H2",massNumber:2,relativeAbundance:0.000115,exactMass:2.014101778,spin:"1+",magneticMoment:"+0.857438",halfLife:-1},{id:"H3",massNumber:3,exactMass:3.016049278,spin:"1/2+",magneticMoment:"+2.978960",halfLife:388839000,betaminusDecay:"0.01861",betaminusDecayLikeliness:"100.0"},{id:"H4",massNumber:4,exactMass:4.02781},{id:"H5",massNumber:5,exactMass:5.03531},{id:"H6",massNumber:6,exactMass:6.04494},{id:"H7",massNumber:7,exactMass:7.05275}]},{elementSymbol:"He",atomicNumber:2,isotopes:[{id:"He3",massNumber:3,relativeAbundance:0.00000137,exactMass:3.016029319,spin:"1/2+",magneticMoment:"-2.127624",halfLife:-1},{id:"He4",massNumber:4,relativeAbundance:0.99999863,exactMass:4.002603254,spin:"0+",halfLife:-1},{id:"He5",massNumber:5,exactMass:5.01222},{id:"He6",massNumber:6,exactMass:6.0188891,halfLife:0.8067},{id:"He7",massNumber:7,exactMass:7.028021},{id:"He8",massNumber:8,exactMass:8.033922,halfLife:0.119},{id:"He9",massNumber:9,exactMass:9.04395},{id:"He10",massNumber:10,exactMass:10.0524}]},null,null,null,{elementSymbol:"C",atomicNumber:6,isotopes:[{id:"C8",massNumber:8,exactMass:8.037675},{id:"C9",massNumber:9,exactMass:9.0310367,halfLife:0.126},{id:"C10",massNumber:10,exactMass:10.0168532,halfLife:19.255},{id:"C11",massNumber:11,exactMass:11.0114336,spin:"3/2-",halfLife:1223.4,betaplusDecay:"0.96",betaplusDecayLikeliness:"100.0"},{id:"C12",massNumber:12,relativeAbundance:0.9893000000000001,exactMass:12,spin:"0+",halfLife:-1},{id:"C13",massNumber:13,relativeAbundance:0.010700000000000001,exactMass:13.00335484,spin:"1/2-",magneticMoment:"+0.702411",halfLife:-1},{id:"C14",massNumber:14,exactMass:14.00324199,halfLife:180701000000,betaminusDecay:"0.15648",betaminusDecayLikeliness:"100.0"},{id:"C15",massNumber:15,exactMass:15.0105993,halfLife:2.449},{id:"C16",massNumber:16,exactMass:16.014701,halfLife:0.747},{id:"C17",massNumber:17,exactMass:17.022586,halfLife:0.193},{id:"C18",massNumber:18,exactMass:18.02676,halfLife:0.095},{id:"C19",massNumber:19,exactMass:19.03481,halfLife:0.046},{id:"C20",massNumber:20,exactMass:20.04032,halfLife:0.014},{id:"C21",massNumber:21,exactMass:21.04934},{id:"C22",massNumber:22,exactMass:22.0572}]},{elementSymbol:"N",atomicNumber:7,isotopes:[{id:"N10",massNumber:10,exactMass:10.04165},{id:"N11",massNumber:11,exactMass:11.02609},{id:"N12",massNumber:12,exactMass:12.0186132,halfLife:0.011},{id:"N13",massNumber:13,exactMass:13.00573861,halfLife:597.9},{id:"N14",massNumber:14,relativeAbundance:0.9963200000000001,exactMass:14.003074,spin:"1+",magneticMoment:"+0.403761",halfLife:-1},{id:"N15",massNumber:15,relativeAbundance:0.00368,exactMass:15.0001089,spin:"1/2-",magneticMoment:"-0.283189",halfLife:-1},{id:"N16",massNumber:16,exactMass:16.0061017,halfLife:7.13},{id:"N17",massNumber:17,exactMass:17.00845,halfLife:4.173},{id:"N18",massNumber:18,exactMass:18.014079,halfLife:0.624},{id:"N19",massNumber:19,exactMass:19.017029,halfLife:0.304},{id:"N20",massNumber:20,exactMass:20.02337,halfLife:0.1},{id:"N21",massNumber:21,exactMass:21.02711,halfLife:0.085},{id:"N22",massNumber:22,exactMass:22.03439,halfLife:0.024},{id:"N23",massNumber:23,exactMass:23.04122},{id:"N24",massNumber:24,exactMass:24.05104},{id:"N25",massNumber:25,exactMass:25.06066}]},{elementSymbol:"O",atomicNumber:8,isotopes:[{id:"O12",massNumber:12,exactMass:12.034405},{id:"O13",massNumber:13,exactMass:13.024812,halfLife:0.00858},{id:"O14",massNumber:14,exactMass:14.00859625,halfLife:70.606},{id:"O15",massNumber:15,exactMass:15.0030656,halfLife:122.24},{id:"O16",massNumber:16,relativeAbundance:0.9975700000000001,exactMass:15.99491462,spin:"0+",halfLife:-1},{id:"O17",massNumber:17,relativeAbundance:0.00037999999999999997,exactMass:16.9991317,spin:"5/2+",magneticMoment:"-1.89379",halfLife:-1},{id:"O18",massNumber:18,relativeAbundance:0.0020499999999999997,exactMass:17.999161,spin:"0+",halfLife:-1},{id:"O19",massNumber:19,exactMass:19.00358,halfLife:26.91},{id:"O20",massNumber:20,exactMass:20.0040767,halfLife:13.51},{id:"O21",massNumber:21,exactMass:21.008656,halfLife:3.42},{id:"O22",massNumber:22,exactMass:22.00997,halfLife:2.25},{id:"O23",massNumber:23,exactMass:23.01569,halfLife:0.082},{id:"O24",massNumber:24,exactMass:24.02047,halfLife:0.061},{id:"O25",massNumber:25,exactMass:25.02946},{id:"O26",massNumber:26,exactMass:26.03834},{id:"O27",massNumber:27,exactMass:27.04826},{id:"O28",massNumber:28,exactMass:28.05781}]},{elementSymbol:"F",atomicNumber:9,isotopes:[{id:"F14",massNumber:14,exactMass:14.03506},{id:"F15",massNumber:15,exactMass:15.01801,halfLife:-1},{id:"F16",massNumber:16,exactMass:16.011466},{id:"F17",massNumber:17,exactMass:17.00209524,halfLife:64.49},{id:"F18",massNumber:18,exactMass:18.000938,spin:"1+",halfLife:6586.2,betaplusDecay:"0.64",betaplusDecayLikeliness:"97.0",ecDecay:"",ecDecayLikeliness:"3.0"},{id:"F19",massNumber:19,relativeAbundance:1,exactMass:18.99840322,spin:"1/2+",magneticMoment:"+2.628866",halfLife:-1},{id:"F20",massNumber:20,exactMass:19.99998132,halfLife:11},{id:"F21",massNumber:21,exactMass:20.999949,halfLife:4.158},{id:"F22",massNumber:22,exactMass:22.002999,halfLife:4.23},{id:"F23",massNumber:23,exactMass:23.00357,halfLife:2.23},{id:"F24",massNumber:24,exactMass:24.00812,halfLife:0.34},{id:"F25",massNumber:25,exactMass:25.0121,halfLife:0.059},{id:"F26",massNumber:26,exactMass:26.01962},{id:"F27",massNumber:27,exactMass:27.02676},{id:"F28",massNumber:28,exactMass:28.03567},{id:"F29",massNumber:29,exactMass:29.04326},{id:"F30",massNumber:30,exactMass:30.0525},{id:"F31",massNumber:31,exactMass:31.06043}]},null,null,null,null,{elementSymbol:"Si",atomicNumber:14,isotopes:[{id:"Si22",massNumber:22,exactMass:22.03453,halfLife:0.006},{id:"Si23",massNumber:23,exactMass:23.02552},{id:"Si24",massNumber:24,exactMass:24.011546,halfLife:0.102},{id:"Si25",massNumber:25,exactMass:25.004106,halfLife:0.22},{id:"Si26",massNumber:26,exactMass:25.99233,halfLife:2.234},{id:"Si27",massNumber:27,exactMass:26.98670491,halfLife:4.16},{id:"Si28",massNumber:28,relativeAbundance:0.9222969999999999,exactMass:27.97692653,spin:"0+",halfLife:-1},{id:"Si29",massNumber:29,relativeAbundance:0.046832000000000006,exactMass:28.9764947,spin:"1/2+",magneticMoment:"-0.55529",halfLife:-1},{id:"Si30",massNumber:30,relativeAbundance:0.030872,exactMass:29.97377017,spin:"0+",halfLife:-1},{id:"Si31",massNumber:31,exactMass:30.97536323,halfLife:9438},{id:"Si32",massNumber:32,exactMass:31.97414808,halfLife:4730400000},{id:"Si33",massNumber:33,exactMass:32.978,halfLife:6.18},{id:"Si34",massNumber:34,exactMass:33.978576,halfLife:2.77},{id:"Si35",massNumber:35,exactMass:34.98458,halfLife:0.78},{id:"Si36",massNumber:36,exactMass:35.9866,halfLife:0.45},{id:"Si37",massNumber:37,exactMass:36.99294},{id:"Si38",massNumber:38,exactMass:37.99563},{id:"Si39",massNumber:39,exactMass:39.00207},{id:"Si40",massNumber:40,exactMass:40.00587},{id:"Si41",massNumber:41,exactMass:41.01456},{id:"Si42",massNumber:42,exactMass:42.01979},{id:"Si43",massNumber:43,exactMass:43.02866},{id:"Si44",massNumber:44,exactMass:44.03526}]},{elementSymbol:"P",atomicNumber:15,isotopes:[{id:"P24",massNumber:24,exactMass:24.03435},{id:"P25",massNumber:25,exactMass:25.02026},{id:"P26",massNumber:26,exactMass:26.01178,halfLife:0.02},{id:"P27",massNumber:27,exactMass:26.99923,halfLife:0.26},{id:"P28",massNumber:28,exactMass:27.992315,halfLife:0.2703},{id:"P29",massNumber:29,exactMass:28.9818006,halfLife:4.14},{id:"P30",massNumber:30,exactMass:29.9783138,halfLife:149.88},{id:"P31",massNumber:31,relativeAbundance:1,exactMass:30.97376163,spin:"1/2+",magneticMoment:"+1.13160",halfLife:-1},{id:"P32",massNumber:32,exactMass:31.97390727,spin:"1+",magneticMoment:"-0.2524",halfLife:1232240,betaminusDecay:"1.710",betaminusDecayLikeliness:"100.0"},{id:"P33",massNumber:33,exactMass:32.9717255,halfLife:2189380},{id:"P34",massNumber:34,exactMass:33.973636,halfLife:12.43},{id:"P35",massNumber:35,exactMass:34.9733141,halfLife:47.3},{id:"P36",massNumber:36,exactMass:35.97826,halfLife:5.6},{id:"P37",massNumber:37,exactMass:36.97961,halfLife:2.31},{id:"P38",massNumber:38,exactMass:37.98416,halfLife:0.64},{id:"P39",massNumber:39,exactMass:38.98618,halfLife:0.16},{id:"P40",massNumber:40,exactMass:39.9913,halfLife:0.26},{id:"P41",massNumber:41,exactMass:40.99434,halfLife:0.12},{id:"P42",massNumber:42,exactMass:42.00101,halfLife:0.11},{id:"P43",massNumber:43,exactMass:43.00619,halfLife:0.033},{id:"P44",massNumber:44,exactMass:44.01299},{id:"P45",massNumber:45,exactMass:45.01922},{id:"P46",massNumber:46,exactMass:46.02738}]},{elementSymbol:"S",atomicNumber:16,isotopes:[{id:"S26",massNumber:26,exactMass:26.02788},{id:"S27",massNumber:27,exactMass:27.01883,halfLife:0.021},{id:"S28",massNumber:28,exactMass:28.00437,halfLife:0.125},{id:"S29",massNumber:29,exactMass:28.99661,halfLife:0.187},{id:"S30",massNumber:30,exactMass:29.984903,halfLife:1.178},{id:"S31",massNumber:31,exactMass:30.9795547,halfLife:2.572},{id:"S32",massNumber:32,relativeAbundance:0.9493,exactMass:31.972071,spin:"0+",halfLife:-1},{id:"S33",massNumber:33,relativeAbundance:0.0076,exactMass:32.97145876,spin:"3/2+",magneticMoment:"+0.643821",halfLife:-1},{id:"S34",massNumber:34,relativeAbundance:0.0429,exactMass:33.9678669,spin:"0+",halfLife:-1},{id:"S35",massNumber:35,exactMass:34.96903216,spin:"3/2+",magneticMoment:"+1",halfLife:7544450,betaminusDecay:"0.1674",betaminusDecayLikeliness:"100.0"},{id:"S36",massNumber:36,relativeAbundance:0.0002,exactMass:35.96708076,spin:"0+",halfLife:-1},{id:"S37",massNumber:37,exactMass:36.97112557,halfLife:303},{id:"S38",massNumber:38,exactMass:37.971163,halfLife:10218},{id:"S39",massNumber:39,exactMass:38.97513,halfLife:11.5},{id:"S40",massNumber:40,exactMass:39.97545,halfLife:8.8},{id:"S41",massNumber:41,exactMass:40.97958},{id:"S42",massNumber:42,exactMass:41.98102,halfLife:0.56},{id:"S43",massNumber:43,exactMass:42.98715,halfLife:0.22},{id:"S44",massNumber:44,exactMass:43.99021,halfLife:0.123},{id:"S45",massNumber:45,exactMass:44.99651,halfLife:0.082},{id:"S46",massNumber:46,exactMass:46.00075},{id:"S47",massNumber:47,exactMass:47.00859},{id:"S48",massNumber:48,exactMass:48.01417},{id:"S49",massNumber:49,exactMass:49.02362}]},{elementSymbol:"Cl",atomicNumber:17,isotopes:[{id:"Cl28",massNumber:28,exactMass:28.02851},{id:"Cl29",massNumber:29,exactMass:29.01411},{id:"Cl30",massNumber:30,exactMass:30.00477},{id:"Cl31",massNumber:31,exactMass:30.99241,halfLife:0.15},{id:"Cl32",massNumber:32,exactMass:31.98569,halfLife:0.298},{id:"Cl33",massNumber:33,exactMass:32.9774519,halfLife:2.511},{id:"Cl34",massNumber:34,exactMass:33.97376282,halfLife:1.5264},{id:"Cl35",massNumber:35,relativeAbundance:0.7578,exactMass:34.96885268,spin:"3/2+",magneticMoment:"+0.82187",halfLife:-1},{id:"Cl36",massNumber:36,exactMass:35.96830698},{id:"Cl37",massNumber:37,relativeAbundance:0.2422,exactMass:36.96590259,spin:"3/2+",magneticMoment:"+0.68412",halfLife:-1},{id:"Cl38",massNumber:38,exactMass:37.96801043,halfLife:2234.4},{id:"Cl39",massNumber:39,exactMass:38.9680082,halfLife:3336},{id:"Cl40",massNumber:40,exactMass:39.97042,halfLife:81},{id:"Cl41",massNumber:41,exactMass:40.97068,halfLife:38.4},{id:"Cl42",massNumber:42,exactMass:41.97325,halfLife:6.8},{id:"Cl43",massNumber:43,exactMass:42.97405,halfLife:3.3},{id:"Cl44",massNumber:44,exactMass:43.97828,halfLife:0.434},{id:"Cl45",massNumber:45,exactMass:44.98029,halfLife:0.4},{id:"Cl46",massNumber:46,exactMass:45.98421,halfLife:0.223},{id:"Cl47",massNumber:47,exactMass:46.98871},{id:"Cl48",massNumber:48,exactMass:47.99495},{id:"Cl49",massNumber:49,exactMass:49.00032},{id:"Cl50",massNumber:50,exactMass:50.00784},{id:"Cl51",massNumber:51,exactMass:51.01449}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"Br",atomicNumber:35,isotopes:[{id:"Br67",massNumber:67,exactMass:66.96479},{id:"Br68",massNumber:68,exactMass:67.95852},{id:"Br69",massNumber:69,exactMass:68.95011},{id:"Br70",massNumber:70,exactMass:69.94479,halfLife:0.0791},{id:"Br71",massNumber:71,exactMass:70.93874,halfLife:21.4},{id:"Br72",massNumber:72,exactMass:71.93664,halfLife:78.6},{id:"Br73",massNumber:73,exactMass:72.93169,halfLife:204},{id:"Br74",massNumber:74,exactMass:73.929891,halfLife:1524},{id:"Br75",massNumber:75,exactMass:74.925776,halfLife:5802},{id:"Br76",massNumber:76,exactMass:75.924541,halfLife:58320},{id:"Br77",massNumber:77,exactMass:76.921379,halfLife:205330},{id:"Br78",massNumber:78,exactMass:77.921146,halfLife:387.6},{id:"Br79",massNumber:79,relativeAbundance:0.5069,exactMass:78.9183371,spin:"3/2-",magneticMoment:"+2.1064",halfLife:-1},{id:"Br80",massNumber:80,exactMass:79.9185293,halfLife:1060.8},{id:"Br81",massNumber:81,relativeAbundance:0.49310000000000004,exactMass:80.9162906,spin:"3/2-",magneticMoment:"+2.2706",halfLife:-1},{id:"Br82",massNumber:82,exactMass:81.9168041,halfLife:127080},{id:"Br83",massNumber:83,exactMass:82.91518,halfLife:8640},{id:"Br84",massNumber:84,exactMass:83.916479,halfLife:1908},{id:"Br85",massNumber:85,exactMass:84.915608,halfLife:174},{id:"Br86",massNumber:86,exactMass:85.918798,halfLife:55.1},{id:"Br87",massNumber:87,exactMass:86.920711,halfLife:55.6},{id:"Br88",massNumber:88,exactMass:87.92407,halfLife:16.34},{id:"Br89",massNumber:89,exactMass:88.92639,halfLife:4.348},{id:"Br90",massNumber:90,exactMass:89.93063,halfLife:1.91},{id:"Br91",massNumber:91,exactMass:90.93397,halfLife:0.541},{id:"Br92",massNumber:92,exactMass:91.93926,halfLife:0.343},{id:"Br93",massNumber:93,exactMass:92.94305,halfLife:0.102},{id:"Br94",massNumber:94,exactMass:93.94868,halfLife:0.07},{id:"Br95",massNumber:95,exactMass:94.95287},{id:"Br96",massNumber:96,exactMass:95.95853},{id:"Br97",massNumber:97,exactMass:96.9628}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,isotopes:[{id:"I108",massNumber:108,exactMass:107.94348,halfLife:0.036},{id:"I109",massNumber:109,exactMass:108.93815,halfLife:0.0001},{id:"I110",massNumber:110,exactMass:109.93524,halfLife:0.65},{id:"I111",massNumber:111,exactMass:110.93028,halfLife:2.5},{id:"I112",massNumber:112,exactMass:111.92797,halfLife:3.42},{id:"I113",massNumber:113,exactMass:112.92364,halfLife:6.6},{id:"I114",massNumber:114,exactMass:113.92185,halfLife:2.1},{id:"I115",massNumber:115,exactMass:114.91805,halfLife:78},{id:"I116",massNumber:116,exactMass:115.91681,halfLife:2.91},{id:"I117",massNumber:117,exactMass:116.91365,halfLife:133.2},{id:"I118",massNumber:118,exactMass:117.913074,halfLife:822},{id:"I119",massNumber:119,exactMass:118.91007,halfLife:1146},{id:"I120",massNumber:120,exactMass:119.910048,halfLife:4860},{id:"I121",massNumber:121,exactMass:120.907367,halfLife:7632},{id:"I122",massNumber:122,exactMass:121.907589,halfLife:217.8},{id:"I123",massNumber:123,exactMass:122.905589,halfLife:47772},{id:"I124",massNumber:124,exactMass:123.9062099,halfLife:360806},{id:"I125",massNumber:125,exactMass:124.9046302,spin:"5/2+",halfLife:5132850},{id:"I126",massNumber:126,exactMass:125.905624,spin:"2-",halfLife:1132700},{id:"I127",massNumber:127,relativeAbundance:1,exactMass:126.904473,spin:"5/2+",magneticMoment:"+2.808",halfLife:-1},{id:"I128",massNumber:128,exactMass:127.905809,spin:"1+",halfLife:1499.4},{id:"I129",massNumber:129,exactMass:128.904988,magneticMoment:"+2.617",halfLife:15700000,betaminusDecay:"0.193",betaminusDecayLikeliness:"100.0"},{id:"I130",massNumber:130,exactMass:129.906674,halfLife:44496},{id:"I131",massNumber:131,exactMass:130.9061246,halfLife:692988},{id:"I132",massNumber:132,exactMass:131.907997,halfLife:8262},{id:"I133",massNumber:133,exactMass:132.907797,halfLife:74880},{id:"I134",massNumber:134,exactMass:133.909744,halfLife:3150},{id:"I135",massNumber:135,exactMass:134.910048,halfLife:23652},{id:"I136",massNumber:136,exactMass:135.91465,halfLife:83.4},{id:"I137",massNumber:137,exactMass:136.917871,halfLife:24.5},{id:"I138",massNumber:138,exactMass:137.92235,halfLife:6.49},{id:"I139",massNumber:139,exactMass:138.9261,halfLife:2.29},{id:"I140",massNumber:140,exactMass:139.931,halfLife:0.86},{id:"I141",massNumber:141,exactMass:140.93503,halfLife:0.43},{id:"I142",massNumber:142,exactMass:141.94018},{id:"I143",massNumber:143,exactMass:142.94456},{id:"I144",massNumber:144,exactMass:143.94999}]}];Kekule.structGenAtomTypesData=[{elementSymbol:"H",atomicNumber:1,atomTypes:[{id:"H1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Li",atomicNumber:3,atomTypes:[{id:"Li1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"B",atomicNumber:5,atomTypes:[{id:"B3",maxBondOrder:2,bondOrderSum:3}]},{elementSymbol:"C",atomicNumber:6,atomTypes:[{id:"C4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"N",atomicNumber:7,atomTypes:[{id:"N3",maxBondOrder:3,bondOrderSum:3},{id:"N5",maxBondOrder:2,bondOrderSum:5}]},{elementSymbol:"O",atomicNumber:8,atomTypes:[{id:"O2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"F",atomicNumber:9,atomTypes:[{id:"F1",maxBondOrder:1,bondOrderSum:1}]},null,{elementSymbol:"Na",atomicNumber:11,atomTypes:[{id:"Na1",maxBondOrder:1,bondOrderSum:1}]},null,null,{elementSymbol:"Si",atomicNumber:14,atomTypes:[{id:"Si4",maxBondOrder:3,bondOrderSum:4}]},{elementSymbol:"P",atomicNumber:15,atomTypes:[{id:"P3",maxBondOrder:3,bondOrderSum:3},{id:"P4",maxBondOrder:3,bondOrderSum:5}]},{elementSymbol:"S",atomicNumber:16,atomTypes:[{id:"S2",maxBondOrder:2,bondOrderSum:2},{id:"S3",maxBondOrder:2,bondOrderSum:4},{id:"S4",maxBondOrder:2,bondOrderSum:6}]},{elementSymbol:"Cl",atomicNumber:17,atomTypes:[{id:"Cl1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"As",atomicNumber:33,atomTypes:[{id:"As3",maxBondOrder:1,bondOrderSum:3}]},{elementSymbol:"Se",atomicNumber:34,atomTypes:[{id:"Se2",maxBondOrder:2,bondOrderSum:2}]},{elementSymbol:"Br",atomicNumber:35,atomTypes:[{id:"Br1",maxBondOrder:1,bondOrderSum:1}]},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,{elementSymbol:"I",atomicNumber:53,atomTypes:[{id:"I1",maxBondOrder:1,bondOrderSum:1}]}];Kekule.ChemicalElementsDataUtil={_getElementInfoBySymbol:function(d){var a;for(var c=0,b=Kekule.chemicalElementsData.length;c<b;++c){a=Kekule.chemicalElementsData[c];if(a&&(a.symbol==d)){return a}}return null},_getElementInfoByAtomicNumber:function(c){var a=Kekule.chemicalElementsData[c-1];if(a&&(a.atomicNumber==c)){return a}else{if((!a)||(a.atomicNumber<c)){for(var d=c,b=Kekule.chemicalElementsData.length;d<b;++d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}for(var d=c-2;d>=0;--d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}}else{for(var d=c-2;d>=0;--d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}for(var d=c,b=Kekule.chemicalElementsData.length;d<b;++d){a=Kekule.chemicalElementsData[d];if(a&&(a.atomicNumber==c)){return a}}}}return null},getElementInfo:function(a){if(typeof(a)=="number"){return Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a)}else{return Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(a)}},getElementProp:function(a,b){var c=Kekule.ChemicalElementsDataUtil.getElementInfo(a);return c?c[b]:null},getAtomicNumber:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoBySymbol(a);if(b){return b.atomicNumber}else{return 0}},getElementSymbol:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a);if(b){return b.symbol}else{return null}},isAtomicNumberAvailable:function(a){var b=Kekule.ChemicalElementsDataUtil._getElementInfoByAtomicNumber(a);return(!!b)},isElementSymbolAvailable:function(a){return Kekule.ChemicalElementsDataUtil.getAtomicNumber(a)>0}};Kekule.IsotopesDataUtil={getAllIsotopeInfos:function(a){if(typeof(a)=="number"){atomicNumber=a}else{atomicNumber=Kekule.ChemicalElementsDataUtil.getAtomicNumber(a)}var d=Kekule.isotopesData[atomicNumber-1];if((!d)||(d.atomicNumber!=atomicNumber)){for(var c=0,b=Kekule.isotopesData.length;c<b;++c){var d=Kekule.isotopesData[c];if(d&&(d.atomicNumber==atomicNumber)){break}}}if(d){return d.isotopes}else{return null}},getIsotopeInfo:function(b,c){var a=null;var f;var e=Kekule.IsotopesDataUtil.getAllIsotopeInfos(b);if(e){for(var g=0,d=e.length;g<d;++g){a=e[g];if(a&&(a.massNumber==c)){return a}}}return null},isMassNumberAvailable:function(a,b){var c=Kekule.IsotopesDataUtil.getIsotopeInfo(a,b);return(!!c)},getIsotopeId:function(a,c){var b=Kekule.ChemicalElementsDataUtil.getElementInfo(a);var d=b.symbol;if(c){return d+c.toString()}else{return d}},getIsotopeIdDetail:function(m){if(!m){return null}var g="";var b="";for(var d=0,a=m.length;d<a;++d){var h=m.charAt(d);if((h>="0")&&(h<="9")){b+=h}else{g+=h}}var f=b?parseInt(b,10):null;var e={symbol:g};if(f){e.massNumber=f}return e}};Kekule.AtomTypeDataUtil={getAtomTypeInfoObj:function(b){if(typeof(b)=="number"){atomicNumber=b}else{atomicNumber=Kekule.ChemicalElementsDataUtil.getAtomicNumber(b)}var a=Kekule.structGenAtomTypesData[atomicNumber-1];if(a&&(a.atomicNumber==atomicNumber)){return a}else{for(var d=0,c=Kekule.structGenAtomTypesData.length;d<c;++d){a=Kekule.structGenAtomTypesData[d];if(a&&(a.atomicNumber==atomicNumber)){return a}}return null}},getAllAtomTypes:function(a){var b=Kekule.AtomTypeDataUtil.getAtomTypeInfoObj(a);if(b){return b.atomTypes}else{return null}},getAtomTypeFromId:function(a,h){if(!a){var f="";for(var e=0,b=h.length;e<b;++e){var g=h.chatAt(e);if((g<"0")||(g>"9")){f+=g}}a=f}if(a){var d=Kekule.AtomTypeDataUtil.getAllAtomTypes(a);for(var e=0,b=d.length;e<b;++e){if(d[e].id==h){return d[e]}}}return null}};(function(){var c=Kekule.Render;c.atomColorSets={jmol:["#000099","#FFFFFF","#D9FFFF","#CC80FF","#C2FF00","#FFB5B5","#909090","#3050F8","#FF0D0D","#90E050","#B3E3F5","#AB5CF2","#8AFF00","#BFA6A6","#F0C8A0","#FF8000","#FFFF30","#1FF01F","#80D1E3","#8F40D4","#3DFF00","#E6E6E6","#BFC2C7","#A6A6AB","#8A99C7","#9C7AC7","#E06633","#F090A0","#50D050","#C88033","#7D80B0","#C28F8F","#668F8F","#BD80E3","#FFA100","#A62929","#5CB8D1","#702EB0","#00FF00","#94FFFF","#94E0E0","#73C2C9","#54B5B5","#3B9E9E","#248F8F","#0A7D8C","#006985","#C0C0C0","#FFD98F","#A67573","#668080","#9E63B5","#D47A00","#940094","#429EB0","#57178F","#00C900","#70D4FF","#FFFFC7","#D9FFC7","#C7FFC7","#A3FFC7","#8FFFC7","#61FFC7","#45FFC7","#30FFC7","#1FFFC7","#00FF9C","#00E675","#00D452","#00BF38","#00AB24","#4DC2FF","#4DA6FF","#2194D6","#267DAB","#266696","#175487","#D0D0E0","#FFD123","#B8B8D0","#A6544D","#575961","#9E4FB5","#AB5C00","#754F45","#428296","#420066","#007D00","#70ABFA","#00BAFF","#00A1FF","#008FFF","#0080FF","#006BFF","#545CF2","#785CE3","#8A4FE3","#A136D4","#B31FD4","#B31FBA","#B30DA6","#BD0D87","#C70066","#CC0059","#D1004F","#D90045","#E00038","#E6002E","#EB0026","#000000","#000000"],cpk2D:["#000000","#000000","#FFC0CB","#B22222",null,"#00FF00","#000000","#8F8FFF","#F00000","#DAA520",null,"#0000FF","#228B22","#808090","#DAA520","#FFA500","#FFC832","#00FF00",null,"#0000FF","#808090","#808090","#808090","#808090","#808090","#808090","#FFA500","#A52A2A","#A52A2A","#A52A2A","#A52A2A",]};var b=c.atomColorSets.cpk2D;b[35]="#A52A2A";b[47]="#808090";b[53]="#A020F0";b[56]="#FFA500";b[79]="#DAA520";c.atom3DColors=Kekule.Render.atomColorSets.jmol;c.atom2DColors=Kekule.Render.atomColorSets.cpk2D;c.atomColors=[];c.atomColors[c.RendererType.R2D]=c.atom2DColors;c.atomColors[c.RendererType.R3D]=c.atom3DColors})();(function(){Kekule.EmscriptenUtils={isSupported:function(){return(typeof(Module)!=="undefined")},getRootModule:function(){return Module},getClassCtor:function(b){if(Kekule.EmscriptenUtils.isSupported()){return a.getRootModule()[b]}else{return undefined}}};var a=Kekule.EmscriptenUtils})();(function(){var a=Kekule.EmscriptenUtils;Kekule.OpenBabel={BondOrder:{SINGLE:1,DOUBLE:2,TRIPLE:3,EXPLICIT_AROMATIC:5}};Kekule.OpenBabel.AdaptUtils={DEF_ATOM_ID_PREFIX:"A",DEF_BOND_ID_PREFIX:"B",DEF_MOL_ID_PREFIX:"M",isAvailable:function(){return typeof(a.getClassCtor("ObBaseHelper"))!=="undefined"},obObjToKekule:function(c){var b=Kekule.OpenBabel.AdaptUtils;var d=Kekule.ObjUtils.getPrototypeOf(c).constructor.name;var e=(d==="OBReaction")?b.obReactionToKekule:(d==="OBMol")?b.obMolToKekule:(d==="OBAtom")?b.obAtomToKekule:(d==="OBBond")?b.obBondToKekule:b.obBaseToKekule;return e(c)},kObjToOB:function(d){var b=Kekule.OpenBabel.AdaptUtils;var c=(d instanceof Kekule.Reaction)?b.kReactionToOB:(d instanceof Kekule.StructureFragment)?b.kMolToOB:(d instanceof Kekule.ChemStructureNode)?b.kChemNodeToOB:(d instanceof Kekule.ChemStructureConnector)?b.kBondToOB:b.kChemNodeToOB;return c(d)},kIdToOB:function(c){var b=parseInt(c,10);if(b){return b}else{return null}},obBondOrderToKekule:function(b){if(b<=3){return b}else{if(b===Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC){return Kekule.BondOrder.EXPLICIT_AROMATIC}else{return Kekule.BondOrder.OTHER}}},kBondOrderToOB:function(b){if(b<=3){return b}else{if(b===Kekule.BondOrder.EXPLICIT_AROMATIC){return Kekule.OpenBabel.BondOrder.EXPLICIT_AROMATIC}else{return 0}}},obBaseToKekule:function(n,c){var o=c||new Kekule.ChemObject();var e=new (a.getClassCtor("ObBaseHelper"))(n);var h=e.getTitle();if(h&&o.setName){o.setName(h)}var b=e.getDataSize();if(b){var d=o.getInfo(true);for(var g=0;g<b;++g){var f=e.getDataAt(g);if(f){var m=f.GetAttribute();var l=f.GetValue();if(m&&l){d[m]=l}}}}return o},kChemObjToOB:function(b,n){var o=n||new (a.getClassCtor("OBBase"))();if(b.getName&&o.SetTitle){o.SetTitle(b.getName())}var c=b.getInfo();if(c){var m=Kekule.ObjUtils.getOwnedFieldNames(c);for(var f=0,d=m.length;f<d;++f){var h=m[f];var g=c[h];if(h&&g){var e=new (a.getClassCtor("OBPairData"))();e.SetAttribute(""+h);e.SetValue(""+g);o.SetData(e)}}}},obAtomToKekule:function(g,f,e){var h=g.GetAtomicNum();var d=h?Kekule.Atom:Kekule.SubGroup;if(f&&(!(f instanceof d))){Kekule.Error(Kekule.ErrorMsg.OpenBabel.CHEM_NODE_TYPE_NOT_SUITABLE)}var b=f||new d();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(g,b);var c;c=g.GetId();if(Kekule.ObjUtils.notUnset(c)){b.setId(Kekule.OpenBabel.AdaptUtils.DEF_ATOM_ID_PREFIX+c)}c=g.GetFormalCharge();if(c){b.setCharge(c)}c=g.GetSpinMultiplicity();if(c){b.setRadical(c)}c={x:g.GetX(),y:g.GetY()};if(e===Kekule.CoordMode.COORD3D){c.z=g.GetZ()}if(b.setAbsCoordOfMode){b.setAbsCoordOfMode(c,e)}else{b.setCoordOfMode(c,e)}if(b instanceof Kekule.Atom){if(h){b.setAtomicNumber(h)}c=g.GetIsotope();if(c){b.setMassNumber(c)}c=g.GetHyb();if(c){b.setHybridizationType(c)}}return b},kChemNodeToOB:function(h,l,e){var b=l||new (a.getClassCtor("OBAtom"))();var c;c=h.getId();c=Kekule.OpenBabel.AdaptUtils.kIdToOB(c);if(Kekule.ObjUtils.notUnset(c)){b.SetId(c)}c=h.getCharge();if(c){if(parseInt(c,10)===parseFloat(c)){b.SetFormalCharge(c)}else{var d=parseInt(c,10);var g=c-d;b.SetFormalCharge(d);b.SetPartialCharge(g)}}c=h.getRadical();if(c){b.SetSpinMultiplicity(c)}c=h.getAbsCoordOfMode?h.getAbsCoordOfMode(e):h.getCoordOfMode(e);b.SetVector(c.x||0,c.y||0,c.z||0);if(h instanceof Kekule.Atom){b.SetAtomicNum(h.getAtomicNumber());c=h.getMassNumber();if(c){b.SetIsotope(c)}c=h.getHybridizationType();if(c){b.SetHyb(c)}}else{b.SetAtomicNum(0)}return b},obBondToKekule:function(h,n,c){var o=n||new Kekule.Bond();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(h,o);var m;m=h.GetId();if(Kekule.ObjUtils.notUnset(m)){o.setId(Kekule.OpenBabel.AdaptUtils.DEF_BOND_ID_PREFIX+m)}m=h.GetBondOrder();o.setBondOrder(Kekule.OpenBabel.AdaptUtils.obBondOrderToKekule(m));var d=Kekule.BondStereo;m=h.IsWedge()?d.UP:h.IsHash()?d.DOWN:h.IsWedgeOrHash()?d.UP_OR_DOWN:h.IsCisOrTrans()?d.CIS_OR_TRANS:h.IsDoubleBondGeometry()?d.E_Z_BY_COORDINATES:d.NONE;o.setStereo(m);if(c){m=null;var f=[h.GetBeginAtom(),h.GetEndAtom()];for(var e=0,b=f.length;e<b;++e){var g=f[e];if(g){m=c.get(g.GetIdx());if(m){o.appendConnectedObj(m)}}}}return o},kBondToOB:function(n,h,d,b){var p=h||new (a.getClassCtor("OBBond"))();Kekule.OpenBabel.AdaptUtils.kChemObjToOB(n,p);var m;m=Kekule.OpenBabel.AdaptUtils.kIdToOB(n.getId());if(Kekule.ObjUtils.notUnset(m)){p.SetId(m)}m=n.getBondOrder();if(m){p.SetBondOrder(Kekule.OpenBabel.AdaptUtils.kBondOrderToOB(m));if(m===Kekule.BondOrder.EXPLICIT_AROMATIC){p.SetAromatic()}}p.UnsetHash();p.UnsetWedge();p.UnsetUp();p.UnsetDown();p.UnsetAromatic();var g=Kekule.BondStereo;m=n.getStereo();if(m===g.UP){p.SetWedge()}else{if(m===g.DOWN){p.SetHash()}else{if(m===g.UP_OR_DOWN){p.SetWedgeOrHash()}}}if(d){var o=0;for(var f=0,c=n.getConnectedObjCount();f<c;++f){var e=n.getConnectedObjAt(f);if(e&&(e instanceof Kekule.ChemStructureNode)){var m=d.get(e);if(m){if(o===0){p.SetBegin(m)}else{if(o===1){p.SetEnd(m)}}++o}if(o>1){break}}}}return p},obMolToKekule:function(b,h){var o=h||new Kekule.Molecule();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(b,o);var d=b.Has3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;o.clearNodes();o.clearConnectors();var e=new Kekule.MapEx(true);var l=b.NumAtoms();for(var g=0;g<l;++g){var f=b.GetAtom(g+1);if(f){var c=Kekule.OpenBabel.AdaptUtils.obAtomToKekule(f,null,d);if(c){o.appendNode(c);e.set(f.GetIdx(),c)}}}var l=b.NumBonds();for(var g=0;g<l;++g){var m=b.GetBond(g);if(m){var n=Kekule.OpenBabel.AdaptUtils.obBondToKekule(m,null,e);if(n){o.appendConnector(n)}}}e.finalize();e=null;return o},kMolToOB:function(m,b){var e=m.nodesHasCoord3D()?Kekule.CoordMode.COORD3D:Kekule.CoordMode.COORD2D;var p=b||new (a.getClassCtor("OBMol"))();if(b){p.Clear()}var f=new Kekule.MapEx(false);for(var h=0,d=m.getNodeCount();h<d;++h){var c=m.getNodeAt(h);if(c){var g=Kekule.OpenBabel.AdaptUtils.kChemNodeToOB(c,p.NewAtom(),e);if(g){f.set(c,g)}}}for(var h=0,d=m.getConnectorCount();h<d;++h){var o=m.getConnectorAt(h);if(o&&(o instanceof Kekule.Bond)){var n=Kekule.OpenBabel.AdaptUtils.kBondToOB(o,p.NewBond(),f,p)}}f.finalize();f=null;return p},obReactionToKekule:function(h,f){var b=f||new Kekule.Reaction();b.clearAll();Kekule.OpenBabel.AdaptUtils.obBaseToKekule(h,b);b.setDirection(h.IsReversible()?Kekule.ReactionDirection.BIDIRECTION:Kekule.ReactionDirection.FORWARD);for(var g=0,e=h.NumReactants();g<e;++g){var d=h.GetReactant(g);var c=Kekule.OpenBabel.AdaptUtils.obMolToKekule(d);b.appendReactant(c)}for(var g=0,e=h.NumProducts();g<e;++g){var d=h.GetProduct(g);var c=Kekule.OpenBabel.AdaptUtils.obMolToKekule(d);b.appendProduct(c)}return b},kReactionToOB:function(h,d){var n=d||new (a.getClassCtor("OBReaction"))();n.Clear();Kekule.OpenBabel.AdaptUtils.kChemObjToOB(h,n);var b=false;var m=h.getDirection();if(m===Kekule.ReactionDirection.BIDIRECTION){n.SetReversible(true)}else{if(m===Kekule.ReactionDirection.BACKWARD){b=true}}for(var f=0,e=h.getReactantCount();f<e;++f){var g=h.getReactantAt(f);if(g){var c=Kekule.OpenBabel.AdaptUtils.kMolToOB(g);if(b){n.AddProduct(c)}else{n.AddReactant(c)}}}for(var f=0,e=h.getProductCount();f<e;++f){var g=h.getProductAt(f);if(g){var c=Kekule.OpenBabel.AdaptUtils.kMolToOB(g);if(b){n.AddReactant(c)}else{n.AddProduct(c)}}}}}})();(function(){var b=Kekule.EmscriptenUtils;var a=Kekule.OpenBabel.AdaptUtils;Kekule.IO.OpenBabelReader=Class.create(Kekule.IO.ChemDataReader,{CLASS_NAME:"Kekule.IO.OpenBabelReader",initialize:function($super,c){$super()},finalize:function($super){$super()},getFormatTargetObClassName:function(c){var e=c.getTypeName();var d=(e.toLowerCase().indexOf("reaction")>=0);return d?"OBReaction":"OBMol"},doReadData:function(l,o,p){this._obConv=new (b.getClassCtor("ObConversionWrapper"))();try{var n=Kekule.IO.DataFormatsManager.getFormatInfo(p);var c=n.mimeType;var s=n.fileExts[0];var e=this._obConv.setInFormat(c,s);var g=this.getFormatTargetObClassName(e);try{var m=[];this._obConv.setInStr(l);var f=new (b.getClassCtor(g))();var q=this._obConv.readFromInput(f);while(q){if(f.NumAtoms&&(f.NumAtoms()>0)){kObj=a.obObjToKekule(f);m.push(kObj)}q=this._obConv.readFromInput(f)}var d=m.length;if(d<=0){return null}else{if(d===1){return m[0]}else{var r=new Kekule.ChemObjList();for(var h=0;h<d;++h){r.append(m[h])}return r}}}finally{if(f){f["delete"]();f=null}}}finally{if(this._obConv){this._obConv["delete"]();this._obConv=null}}}});Kekule.IO.OpenBabelWriter=Class.create(Kekule.IO.ChemDataWriter,{CLASS_NAME:"Kekule.IO.OpenBabelWriter",initialize:function($super,c){$super(c)},finalize:function($super){$super()},doWriteData:function(f,o,p){this._obConv=new (b.getClassCtor("ObConversionWrapper"))();try{var n=Kekule.IO.DataFormatsManager.getFormatInfo(p);var c=n.mimeType;var s=n.fileExts[0];this._obConv.setOutFormat(c,s);var h=Kekule.ChemStructureUtils.getChildStructureObjs(f,true);for(var g=0,e=h.length;g<e;++g){var m=h[g];if(m){var d=a.kObjToOB(m);if(d){try{var q=this._obConv.writeToOutput(d);if(!q){break}}finally{d["delete"]();d=null}}}}var r=this._obConv.getOutStr();return r}finally{if(this._obConv){this._obConv["delete"]()}}},isAllowedObj:function(c){var d=Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES;return Kekule.ObjUtils.isInstanceOf(c,d)}});Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES=[Kekule.StructureFragment,Kekule.Reaction,Kekule.ChemObjList,Kekule.ChemStructureObjectGroup,Kekule.ChemSpaceElement,Kekule.ChemSpace];Kekule.OpenBabel.IORegHelper=Class.create({listFormatInfo:function(o,h){var t=[];var c="\n";var f="--";var m;if(o==="in"){m=h.getSupportedInputFormatsStr(c)}else{m=h.getSupportedOutputFormatsStr(c)}var p=m.split(c);for(var n=0,g=p.length;n<g;++n){var r=p[n];var q=r.indexOf(f);if(q>0){var d=r.substring(0,q).trim();var e=h.getFormatInfoById(d);t.push(e)}}return t},registerByInfos:function(r,q){var p=Kekule.IO.DataFormatsManager;var n=[];for(var o=0,h=r.length;o<h;++o){var g=r[o];var d=g.id;var c=g.mimeType;var f=p.register(d,c,d,Kekule.IO.ChemDataType.UNKNOWN,g.description,g.description,{specificationUrl:g.specificationURL});var e=f.id;var m=(q==="in")?Kekule.IO.ChemDataReaderManager.getReaderInfoByFormat(e):Kekule.IO.ChemDataWriterManager.getWriterInfoByFormat(e);if(!m){Kekule.ArrayUtils.pushUnique(n,e)}}if(q==="in"){Kekule.IO.ChemDataReaderManager.register("openbabel",Kekule.IO.OpenBabelReader,n)}else{Kekule.IO.ChemDataWriterManager.register("openbabel",Kekule.IO.OpenBabelWriter,Kekule.IO.OpenBabelWriter.ALLOWED_CLASSES,n)}},registerAll:function(){var c=new (b.getClassCtor("ObConversionWrapper"))();try{var d=this.listFormatInfo("in",c);this.registerByInfos(d,"in");var d=this.listFormatInfo("out",c);this.registerByInfos(d,"out")}finally{c["delete"]()}}});(function(){Kekule.X.domReady(function(){if(Kekule.OpenBabel.AdaptUtils.isAvailable()){var c=new Kekule.OpenBabel.IORegHelper();c.registerAll();c=null}})})()})();