(function(){var a=Kekule.ArrayUtils;Kekule.GraphElement=Class.create(ObjectEx,{CLASS_NAME:"Kekule.GraphElement",initialize:function($super){$super();this._data={}},initProperties:function(){this.defineProp("storedData",{dataType:DataType.HASH,getter:function(){return this._data},setter:function(b){this._data=b||{}}})},getData:function(b){return b?this._data[b]:this._data},setData:function(b,c){if(b){this._data[b]=c}return this},removeData:function(b){if(this._data[b]){delete this._data[b]}return this}});Kekule.GraphVertex=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphVertex",initialize:function($super){$super();this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},getEdgeCount:function(){return this.getEdges().length},getNeighbors:function(){var b=[];var d=this.getEdges();for(var e=0,c=d.length;e<c;++e){var f=d[e].getVertexes();a.pushUnique(b,a.exclude(f,this))}return b},getNeighborOnEdge:function(d){var e=d.getVertexes();for(var c=0,b=e.length;c<b;++c){if(e[c]!==this){return e[c]}}},getEdgeTo:function(c){var d=this.getEdges();for(var e=0,b=d.length;e<b;++e){var f=d[e].getVertexes();if(f.indexOf(c)>=0){return d[e]}}return null},doAppendEdge:function(b){Kekule.ArrayUtils.pushUnique(this.getEdges(),b);return this},doRemoveEdge:function(b){Kekule.ArrayUtils.remove(this.getEdges(),b);return this},doClearEdges:function(){var b=this.getEdges();for(var c=b.length-1;c>=0;--c){this.removeEdge(b[c])}return this}});Kekule.GraphEdge=Class.create(Kekule.GraphElement,{CLASS_NAME:"Kekule.GraphEdge",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null})}});Kekule.GraphTraverseMode={DEPTH_FIRST:0,BREADTH_FIRST:1};Kekule.Graph=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Graph",VISITED_KEY:"__$visited__",initialize:function($super){$super();this.setPropStoreFieldValue("vertexes",[]);this.setPropStoreFieldValue("edges",[])},initProperties:function(){this.defineProp("vertexes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("edges",{dataType:DataType.ARRAY,serializable:false,setter:null})},addVertex:function(b){Kekule.ArrayUtils.pushUnique(this.getVertexes(),b);return this},newVertex:function(){var b=new Kekule.GraphVertex();this.addVertex(b);return b},removeVertex:function(e){if(Kekule.ArrayUtils.remove(this.getVertexes(),e)){var c=e.getEdges();for(var d=0,b=c.length;d<b;++d){this.removeEdge(c[d])}}},addEdge:function(d,c,b){if(Kekule.ArrayUtils.pushUnique(this.getEdges(),d)){d.setPropStoreFieldValue("vertexes",[c,b]);c.doAppendEdge(d);b.doAppendEdge(d)}return this},newEdge:function(d,c){var b=new Kekule.GraphEdge();this.addEdge(b,d,c);return b},removeEdge:function(e){var f=e.getVertexes();for(var d=0,b=f.length;d<b;++d){var c=f[d];c.doRemoveEdge(e)}Kekule.ArrayUtils.remove(this.getEdges(),e);return this},traverse:function(h,f,b){var m=[];var g=a.clone(this.getVertexes());for(var e=0,c=g.length;e<c;++e){g[e].setData(this.VISITED_KEY,false)}while(g.length){var j={vertexes:[],edges:[]};var d;if(b&&(g.indexOf(b)>=0)){d=b}else{d=g[0]}var k=this._doTravers(h,f,d);j.vertexes=j.vertexes.concat(k.vertexes);j.edges=j.edges.concat(k.edges);g=a.exclude(g,k.vertexes);m.push(j)}return m},_doTravers:function(p,h,c){var q={vertexes:[],edges:[]};var j=c;if(!j.getData(this.VISITED_KEY)){q.vertexes.push(j);j.setData(this.VISITED_KEY,true);if(p){p(j,false)}}var e=j.getEdges();var k=[];var m=h===Kekule.GraphTraverseMode.BREADTH_FIRST;for(var f=0,d=e.length;f<d;++f){var b=e[f];var o=j.getNeighborOnEdge(b);if(!o.getData(this.VISITED_KEY)){q.vertexes.push(o);q.edges.push(b);o.setData(this.VISITED_KEY,true);if(p){p(b,true);p(o,false)}if(m){k.push(o)}else{var g=this._doTravers(p,h,o);q.vertexes=q.vertexes.concat(g.vertexes);q.edges=q.edges.concat(g.edges)}}}if(m){for(var f=0,d=k.length;f<d;++f){var n=k[f];var g=this._doTravers(p,h,n);q.vertexes=q.vertexes.concat(g.vertexes);q.edges=q.edges.concat(g.edges)}}return q}});Kekule.GraphAdaptUtils={ctabToGraph:function(m,c,d){var n=Object.extend({expandSubStructures:true},d||{});var F=m;var f=Kekule.ArrayUtils;var r=null;var u=n.expandSubStructures;if(F){var r=c||new Kekule.Graph();var z=u?F.getAllContainingConnectors():F.getConnectors();var x=u?F.getLeafNodes():F.getNodes();var g=[];var G=new Kekule.MapEx();for(var C=0,y=z.length;C<y;++C){var b=z[C];if(n.connectorClasses){var w=b.getClass();if(!ClassEx.isOrIsDescendantOfClasses(w,n.connectorClasses)){continue}}if(b.getBondType&&n.bondTypes){if(n.bondTypes.indexOf(b.getBondType())<0){continue}}var h=[];var o=u?b.getConnectedObjs():b.getConnectedSiblings();for(var B=0,A=o.length;B<A;++B){var D=o[B];if(x.indexOf(D)>=0){h.push(D);if(h.length>=2){var q=f.exclude(h,g);for(var t=0,p=q.length;t<p;++t){var s=r.newVertex();s.setData("object",q[t]);G.set(q[t],s)}var E=r.newEdge(G.get(h[0]),G.get(h[1]));E.setData("object",b);f.pushUnique(g,h);break}}}}G.finalize()}return r},molToGraph:function(g,f,d){var c=Kekule.ArrayUtils;var b=null;if(!g||!g.hasCtab()){return null}var e=g.getCtab();if(e){return Kekule.GraphAdaptUtils.ctabToGraph(e,f,d)}return b},chemObjToGraph:function(h,g,e){var c=Kekule.ChemStructureUtils.getAllStructFragments(h,true);var b=g||new Kekule.Graph();for(var f=0,d=c.length;f<d;++f){Kekule.GraphAdaptUtils.molToGraph(c[f],b,e)}return b}};Kekule.GraphAlgorithmUtils={SEQ_KEY:"__$seq__",RESD_DEGREE_KEY:"__$resdDegree__",VISIT_EDGE_DEGREE_KEY:"__$visitedEdgeDegree__",TYPE_KEY:"__$type__",TYPE_CYCLE:"cycle",TYPE_BRIDGE:"bridge",VISITED_KEY:"__$visited",createSpanningTrees:function(c,b){return c.traverse(null,b)},findCycleBlocks:function(b){var v=[];var m=Kekule.GraphAlgorithmUtils;var c=m.SEQ_KEY;var e=m.RESD_DEGREE_KEY;var u=m.VISIT_EDGE_DEGREE_KEY;var h=m.TYPE_KEY;var p=m.TYPE_CYCLE;var n=m.TYPE_BRIDGE;var d=b.getEdges();for(var D=0,A=d.length;D<A;++D){d[D].removeData(c)}var r=b.getVertexes();for(var D=0,A=r.length;D<A;++D){r[D].removeData(h)}var E=1;var w=1;var K=[];var g=[];var z=[];var f=b.traverse(function(j,i){if(i){j.setData(c,E);g.push(j);++E}else{j.setData(c,w);++w;K.push(j)}});for(var D=0,A=K.length;D<A;++D){var x=K[D];var G=x.getEdges();x.setData(e,G.length);var I=0;for(var C=0,B=G.length;C<B;++C){var o=G[C];if(o.getData(c)){++I}}x.setData(u,I);if(I<G.length){z.push(x)}}var s=function(R,P){if(P&&R.getData(c)<=1){return null}var N=R.getEdges();var S=null;var Q=null;for(var O=0,j=N.length;O<j;++O){var k=N[O].getData(c);if(k){if(!Q){S=N[O];Q=k}else{if(k<Q){S=N[O];Q=k}}}}if(S){return S}else{return null}};var t=function(O){var k=O.getEdges();for(var N=0,j=k.length;N<j;++N){if(!k[N].getData(c)&&!k[N].getData(h)){return k[N]}}return null};var H=function(N){var j=[],W=[];var k=N.getData(u);var S=N.getData(e);var R=S-k;if(R>0){N.setData(h,p);a.pushUnique(j,N);for(var P=0;P<R;++P){N.setData(e,S+1);var l=t(N);if(l){l.setData(h,p);a.pushUnique(W,l);var V=N.getNeighborOnEdge(l);V.setData(e,V.getData(e)+1);V.setData(h,p);a.pushUnique(j,V);do{var k=V.getData(u);var S=V.getData(e);if(k<S){var O=H(V);a.pushUnique(j,O.vertexes);a.pushUnique(W,O.edges)}var T=s(V,false);if(!T){break}T.setData(h,p);a.pushUnique(W,T);var Q=V.getNeighborOnEdge(T);if(!Q.getData(h)){Q.setData(h,p);a.pushUnique(j,Q);V=Q}else{break}}while(true)}}}return{vertexes:j,edges:W}};var y=K.shift();while(y){if(y.getData(h)){}else{var M=y.getData(u);var L=y.getData(e);var J=L-M;if(J>0){var F=H(y);v.push(F)}else{y.setData(h,n);var q=s(y,true);if(q){q.setData(h,n)}}}y=K.shift()}return v},findEndChains:function(o){var m=Kekule.ArrayUtils;var h="__$currConnectivity__";var q={vertexes:[],edges:[]};var j=m.clone(o.getVertexes());var b=[];for(var g=0,d=j.length;g<d;++g){var n=j[g];var c=n.getEdgeCount();n.setData(h,c);if(c<=1){b.push(n)}}if(b.length){var f=b.pop();m.remove(j,f);q.vertexes.push(f);while(j.length){var k=false;var e=m.exclude(f.getEdges(),q.edges);if(e.length){q.edges=q.edges.concat(e);var p=f.getNeighborOnEdge(e[0]);var c=p.getData(h)-1;p.setData(h,c);if(c<=1){f=p;m.remove(j,f);q.vertexes.push(f);k=true}}if(!k){if(b.length){var f=b.pop();m.remove(j,f);q.vertexes.push(f)}else{break}}}}return q},removeEndChains:function(e){var d=Kekule.GraphAlgorithmUtils.findEndChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(d.vertexes[c])}return d},findBridgeChains:function(f){var h=f.getVertexes();var g=f.getEdges();var e=Kekule.GraphAlgorithmUtils.findCycleBlocks(f);for(var d=0,c=e.length;d<c;++d){h=a.exclude(h,e[d].vertexes);g=a.exclude(g,e[d].edges)}var b={vertexes:h,edges:g};return b},removeBridgeChains:function(e){var d=Kekule.GraphAlgorithmUtils.findBridgeChains(e);for(var c=0,b=d.vertexes.length;c<b;++c){e.removeVertex(chainElems.vertexes[c])}return d},findAllRings:function(w){var f=Kekule.GraphAlgorithmUtils;var g="__$path_detail__";var r="__$vertextPartDegree__";var n=[];var h;if(w instanceof Kekule.Graph){h=f.findCycleBlocks(w)}else{h=[w]}var s=function(i){return i.vertexes.length===i.edges.length};var o=function(i,k){var x=i.vertexes;var j=x.length;return j&&((x[0]===k)||(x[j-1]===k))};var b=function(k,j,i){var y=a.clone(k.vertexes);var x=a.clone(j.vertexes);y.shift();y.pop();x.shift();x.pop();var l=a.intersect(y,x);return(l.length>=1)};var c=function(k,j,i){var x=a.clone(k.vertexes);var l=a.clone(j.vertexes);var A=a.clone(k.edges);var z=a.clone(j.edges);if(x[0]===i){x.reverse();A.reverse()}if(l[l.length-1]===i){l.reverse();z.reverse()}x.pop();var B=x.concat(l);var y=A.concat(z);return{vertexCount:k.vertexCount+j.vertexCount-1,vertexes:B,edges:y}};var d=function(y){var C=[];var H=a.clone(y.vertexes);var x=y.edges;for(var L=0,I=H.length;L<I;++L){var D=H[L];var N=a.intersect(D.getEdges(),x);D.setData(r,N.length)}H.sort(function(j,i){return(j.getData(r)-i.getData(r))});var M=[];for(var L=0,I=y.edges.length;L<I;++L){var z=y.edges[L];var J=z.getVertexes();M.push({vertexCount:J.length,vertexes:[J[0],J[1]],edges:[z]})}while(H.length){var F=H.shift();var E=null;var k=-1;for(var L=M.length-1;L>=0;--L){var G=M[L];if(o(G,F)){E=G;for(var K=L-1;K>=0;--K){var G=M[K];if(o(G,F)){if(!b(E,G,F)){var B=c(E,G,F);var A=B.vertexes;if(A[0]===A[A.length-1]){A.pop();C.push(B)}else{M.push(B)}}}}M.splice(L,1)}}}return C};for(var v=0,q=h.length;v<q;++v){var p=h[v];if(s(p)){n.push({vertexes:a.clone(p.vertexes),edges:a.clone(p.edges)})}else{var e=d(p);for(var u=0,t=e.length;u<t;++u){var m=e[u];n.push({vertexes:a.clone(m.vertexes),edges:a.clone(m.edges)})}}}return n},findSSSR:function(g,k){var e=Kekule.GraphAlgorithmUtils;var n=[];var m;if(g instanceof Kekule.Graph){m=e.findCycleBlocks(g);k=null}else{m=[g]}var b=1||function(w){var v=[];var p=cycleBlock.edges.length-cycleBlock.vertexes.length+1;if(p<=0){return[]}var u=e.findAllRings(cycleBlock);var x=new Kekule.MapEx(true);for(var D=0,A=u.length;D<A;++D){var o=u[D].edges.length;var t=x.get(o);if(!t){t=[];x.set(o,t)}t.push(u[D])}var z=x.getKeys();z.sort(function(l,i){return l-i});var s;var q=a.clone(cycleBlock.edges);var y=function(l,i){return a.intersect(l,i.edges).length};var r=function(i){v.push(i);q=a.exclude(q,i.edges)};for(var C=0,B=z.length;C<B;++C){var G=z[C];var F=x.get(G);if(F.length<=1){if(v.length===0){s=F.shift();r(s)}else{s=F.shift();if(!!y(q,s)){r(s)}}}else{while(F.length&&(v.length<p)&&q.length){if(v.length===0){s=F.shift();r(s)}else{for(var D=F.length-1;D>=0;--D){s=F[D];var E=y(q,s);if(E<=0){F.splice(D,1)}else{s.__uncheckedEdgeCount__=E}}F.sort(function(l,i){return l.__uncheckedEdgeCount__-i.__uncheckedEdgeCount__});s=F.shift();r(s)}}}if((v.length>=p)||(q.length<=0)){break}}return v};var h=function(u,s){var v=[];var p=u.edges.length-u.vertexes.length+1;if(p<=0){return[]}var r=s?a.clone(s):e.findAllRings(u);r.sort(function(x,w){return x.vertexes.length-w.vertexes.length});var i=function(w){v.push(w)};var t;var l=[];var q=Kekule.RingVectorUtils;q.prepareConvertRingToVector(u);var o=r.shift();i(o);t=q.convertRingToVector(o,u);l.push(t);while((v.length<p)&&r.length){o=r.shift();t=q.convertRingToVector(o,u);if(!q.isLinearDependant(t,l)){l.push(t);i(o)}}return v};for(var f=0,d=m.length;f<d;++f){var c=m[f];var j=h(c,k);n=n.concat(j)}return n},analysisRings:function(f){var c=Kekule.GraphAlgorithmUtils;var k=[];var j;if(f instanceof Kekule.Graph){j=c.findCycleBlocks(f)}else{j=[f]}for(var e=0,d=j.length;e<d;++e){var b=j[e];var g=c.findAllRings(b);var h=c.findSSSR(b,g);k.push({vertexes:b.vertexes,edges:b.edges,allRings:g,sssrRings:h})}return k}};Kekule.RingVectorUtils={MAX_INT_BITNUM:23,EDGE_INDEX_FIELD:"__$index__",prepareConvertRingToVector:function(e){var c=e.edges;for(var d=0,b=c.length;d<b;++d){c[d][Kekule.RingVectorUtils.EDGE_INDEX_FIELD]=d}},convertRingToVector:function(e,h){var k;var b=h.edges.length;var j=e.edges;if(b<Kekule.RingVectorUtils.MAX_INT_BITNUM){k=0;for(var f=0,d=j.length;f<d;++f){var c=j[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];k+=1<<g}}else{k=[];for(var f=0,d=j.length;f<d;++f){var c=j[f];var g=c[Kekule.RingVectorUtils.EDGE_INDEX_FIELD];k[g]=true}}return k},vectorNotNull:function(b){if(DataType.isSimpleValue(b)){return !!b}else{for(var c=0;c<b.length;++c){if(b[c]){return true}}return false}},getVectorLength:function(b){if(DataType.isSimpleValue(b)){return b.toString(2).length}else{return b.length}},ringVectorAnd:function(f,e){if(DataType.isSimpleValue(f)){return f&e}else{var b=[];var c=Math.min(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]&&e[d]}return b}},ringVectorAndAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorAnd(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorAnd(b,f[e])}return b},ringVectorOr:function(f,e){if(DataType.isSimpleValue(f)){return f|e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=f[d]||e[d]}return b}},ringVectorOrAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorOr(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorOr(b,f[e])}return b},ringVectorXor:function(f,e){if(DataType.isSimpleValue(f)){return f^e}else{var b=[];var c=Math.max(f.length,e.length);for(var d=0;d<c;++d){b[d]=!!(f[d]^e[d])}return b}},ringVectorXorAll:function(f){if(f.length<2){return f[0]}var d=Kekule.RingVectorUtils;var b=d.ringVectorXor(f[0],f[1]);for(var e=2,c=f.length;e<c;++e){b=d.ringVectorXor(b,f[e])}return b},ringVectorNot:function(d){if(DataType.isSimpleValue(d)){return ~d}else{var b=[];for(var e=0,c=d.length;e<c;++e){b[e]=!d[e]}return b}},isLinearDependant:function(c,b){var q=Kekule.RingVectorUtils;var g=q.ringVectorOrAll(b);var p=q.ringVectorAnd(c,q.ringVectorNot(g));if(q.vectorNotNull(p)){return false}else{var r=b.length;var j=function(v){var l=[];for(var u=0;u<v;++u){l[u]=v-u-1}return l};var n=function(v,z,x){var u=v[z];var y=++u;if(y>=x-z){if(z>=v.length-1){return false}else{return n(v,z+1,x)}}else{v[z]=y;var l=y;for(var w=z-1;w>=0;--w){++l;v[w]=l}return true}};var o=function(i,l){return n(i,0,l)};var k=0;var t=false;for(var h=2;h<=r;++h){var d=j(h);while(true){++k;var s=[];for(var f=0,e=d.length;f<e;++f){s.push(b[d[f]])}var m=q.ringVectorXorAll(s);if(!q.vectorNotNull(q.ringVectorXor(m,c))){t=true;break}if(!o(d,r)){t=false;break}}if(t){break}}return t}},isLinearDependant_wrong:null&&function(d,g){var c=Kekule.RingVectorUtils;var k=c.ringVectorOrAll(g);var x=c.ringVectorAnd(d,c.ringVectorNot(k));if(c.vectorNotNull(x)){return false}else{var o=c.getVectorLength(d);var e=g.length;var f=[];try{var n=DataType.isSimpleValue(d);if(n){for(var v=0;v<o;++v){var r=1<<v;if(r&d){var p=[];f.push(p);for(var u=0;u<e;++u){if(g[u]&r){p.push(g[u])}}}}}else{for(var v=0;v<o;++v){if(d[v]){var p=[];f.push(p);for(var u=0;u<e;++u){if(g[u][v]){p.push(g[u])}}}}}var w=[];var h=[];for(var v=0,t=f.length;v<t;++v){w[v]=f[v].length;h[v]=0}var z=function(i,j,l){if(i[l]<j[l]-1){++i[l];return true}else{if(l>=j.length-1){return false}i[l]=0;return z(i,j,l+1)}};var b=function(i,j){return z(i,j,0)};var m=0;var q;while(true){++m;var y=[];for(var v=0,t=h.length;v<t;++v){a.pushUnique(y,f[v][h[v]])}if((f.length===4)){console.log("new vector edge count",f.length,"selVector count",y.length);console.log(y)}var s=c.ringVectorXorAll(y);if(!c.vectorNotNull(c.ringVectorXor(s,d))){q=true;break}if(!b(h,w)){q=false;break}}console.log("tried ",m,q);return q}finally{}}}}})();(function(){Kekule.ChemStructObjContainer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemStructObjContainer",initialize:function($super){$super();this.setPropStoreFieldValue("nodes",[]);this.setPropStoreFieldValue("connectors",[])},initProperties:function(){this.defineProp("nodes",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("connectors",{dataType:DataType.ARRAY,serializable:false,setter:null})},clear:function(){this.getNodes().length=0;this.getConnectors().length=0;return this},add:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{if(c instanceof Kekule.ChemStructureNode){b=this.getNodes()}}if(!b){Kekule.error(Kekule.ErrorMsg.CANNOT_ADD_NON_NODE_NOR_CONNECTOR_TO_STRUCT_CONTAINER)}else{Kekule.ArrayUtils.pushUnique(b,c)}return this},remove:function(c){var b=null;if(c instanceof Kekule.ChemStructureConnector){b=this.getConnectors()}else{b=this.getNodes()}Kekule.ArrayUtils.remove(b,c);return this}})})();(function(){var b=Kekule;var a=Kekule.ArrayUtils;var c=Kekule.BondType;Kekule.UnivChemStructObjComparer={NODE_CLASS_MAP:(new b.MapEx()).set(b.Atom,17).set(b.Pseudoatom,18).set(b.VariableAtom,19).set(b.AbstractAtom,16).set(b.ChemStructureNode,0),CHARGE_BASE:64,BOND_TYPE_MAP:(new b.MapEx(true)).set(c.COVALENT,1).set(c.IONIC,2).set(c.COORDINATE,3).set(c.METALLIC,4).set(c.HYDROGEN,9),_P36:Math.pow(2,36),_P48:Math.pow(2,48),_P24:Math.pow(2,24),getCompareValue:function(f,d){var e=Object.extend({compareLinkedConnectorCount:true,compareCharge:true,compareHydrogenCount:true,compareConnectedObjCount:true,compareBondType:true,compareBondOrder:true},d);if(!f){return 0}else{if(f instanceof b.ChemStructureNode){return b.UnivChemStructObjComparer.getNodeCompareValue(f,e)}else{if(f instanceof b.ChemStructureConnector){return b.UnivChemStructObjComparer.getConnectorCompareValue(f,e)}else{return 0}}}},compare:function(k,g,j){var h=b.UnivChemStructObjComparer;var p=h.getCompareValue(k,j);var o=h.getCompareValue(g,j);var r=p-o;if((r===0)&&(k.getNodes&&g.getNodes)){var q=k.getNodes();var n=g.getNodes();for(var m=0,f=q.length;m<f;++m){var r=h.compare(q[m],n[m]);if(r!==0){break}}}if((r===0)&&(k.getConnectors&&g.getConnectors)){var e=k.getConnectors();var d=g.getConnectors();for(var m=0,f=e.length;m<f;++m){var r=h.compare(e[m],d[m]);if(r!==0){break}}}return r},max:function(){var e=-1;var k=arguments;if((k.length===1)&&(DataType.isArrayValue(k))){k=k[0]}var d=null;for(var h=0,f=k.length;h<f;++h){var j=k[h];var g=Kekule.UnivChemStructObjComparer.getCompareValue(j);if(g>e){d=j}}return d},sort:function(e,d){e.sort(function(h,g){var f=Kekule.UnivChemStructObjComparer.compare(h,g);if(d){f=-f}return f});return e},getNodeCompareValue:function(e,l){var g=b.UnivChemStructObjComparer;var m=1152921504606847000;var d=e.getClass();var h=b.UnivChemStructObjComparer.NODE_CLASS_MAP.get(d);var j=0;if(b.ObjUtils.isUnset(h)){if(e instanceof b.AbstractAtom){h=(e instanceof b.Atom)?17:(e instanceof b.Pseudoatom)?18:(e instanceof b.VariableAtom)?19:16}if(e instanceof b.StructureFragment){h=(e instanceof b.SubGroup)?49:(e instanceof b.Molecule)?53:48}else{h=0}}j=b.UnivChemStructObjComparer.getAtomDetailCompareValue(e);m+=h*g._P48;m+=j;if(l.compareLinkedConnectorCount){var k=e.getLinkedConnectorCount();m+=(k<<(4*4))}if(l.compareCharge){var i=Math.round(e.getCharge()||0)+b.UnivChemStructObjComparer.CHARGE_BASE;m+=(i<<(2*4))}if(l.compareHydrogenCount){var f=e.getHydrogenCount?e.getHydrogenCount()||0:0;m+=f}return m},getAtomDetailCompareValue:function(g){var e=b.UnivChemStructObjComparer;var d=0;var i,h=0;var f=g.getClass();if(f===b.Atom){i=g.getAtomicNumber()||0;h=g.getMassNumber()||0}else{if(f===b.Pseudoatom){i=4094}else{if(f===b.VariableAtom){i=4095}else{i=0}}}d+=i*e._P36+h*e._P24;return d},getFragmentDetailCompareValue:function(e){var d=0;d+=(e.getNodeCount()||0)*U._P36+(e.getConnectorCount()||0)*U._P24;return d},getConnectorCompareValue:function(e,g){var f=b.UnivChemStructObjComparer;var d=0;var j=e instanceof Kekule.Bond;d|=j?(1<<(5*4)):0;if(g.compareBondType){var i;if(j){i=f.BOND_TYPE_MAP.get(e.getBondType());if(b.ObjUtils.isUnset(i)){i=0}}else{i=0}d|=(i<<(4*4))}if(g.compareBondOrder){var h=j?Math.round(e.getElectronCount()):0;d|=h<<(4*2)}if(g.compareConnectedObjCount){d|=(e.getConnectedObjCount()||0)}return d}};Kekule.Canonicalizer=Class.create({CLASS_NAME:"Kekule.Canonicalizer",initialize:function(){this._executorClasses={};this._executorInstances={};this._defExecutorId=null},registerExecutor:function(f,e,d){this._executorClasses[f]=e;if(d){this._defExecutorId=f}},getExecutor:function(f){if(!f){return null}var d=this._executorInstances[f];if(!d){var e=this._executorClasses[f];if(e){d=new e();this._executorInstances[f]=d}}return d},canonicalize:function(e,d){var g=this.getExecutor(d||this._defExecutorId);if(!g){Kekule.error(Kekule.ErrorMsg.REGISTERED_CANONICALIZATION_EXECUTOR_NOT_FOUND)}else{var f=e.getCtab?e.getCtab():e;return g.execute(f)}}});Kekule.ClassUtils.makeSingleton(Kekule.Canonicalizer);Kekule.canonicalizer=Kekule.Canonicalizer.getInstance();ClassEx.extend(Kekule.ChemObject,{canonicalize:function(e){var d=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var g=0,f=d.length;g<f;++g){d[g].canonicalize(e)}return this}});ClassEx.extend(Kekule.StructureConnectionTable,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});ClassEx.extend(Kekule.StructureFragment,{canonicalize:function(d){Kekule.canonicalizer.canonicalize(this);return this}});Kekule.CanonicalizationExecutor=Class.create({CLASS_NAME:"Kekule.CanonicalizationExecutor",execute:function(e){var d=this.doExecute(e);this.doCanonicalizeConnectedObjs(d);return d},doExecute:function(d){return d},doCanonicalizeConnectedObjs:function(f){var j=function(k,i){var m=f.indexOfChild(k);var l=f.indexOfChild(i);return m-l};for(var e=0,d=f.getConnectorCount();e<d;++e){var g=f.getConnectorAt(e);var h=g.getConnectedObjs();h.sort(j)}}});Kekule.MorganCanonicalizationExecutor=Class.create(Kekule.CanonicalizationExecutor,{CLASS_NAME:"Kekule.MorganCanonicalizationExecutor",doExecute:function(f){var g=Kekule.GraphAdaptUtils.ctabToGraph(f,null,{expandSubStructures:true});var e=this._calcGraphFinalECs(g);var d=this._sortVertexesAndEdges(g,e);this._sortNodesAndConnectors(f,d.sortedVertexes,d.sortedEdges);return f},_processECs:function(s,e,p,n){var r=[];var d=s.getVertexes();for(var m=0,f=d.length;m<f;++m){var o=d[m];var q=0;if(!n){var t=o.getNeighbors();for(var h=0,g=t.length;h<g;++h){q+=p.get(t[h])||0}}else{q=o.getEdgeCount()}e.set(o,q);a.pushUnique(r,q)}return r.length},_calcGraphFinalECs:function(i){var g=[new Kekule.MapEx(),new Kekule.MapEx()];try{var f=0;var j=g[0];var d=g[0];var h=this._processECs(i,j,d,true);var e=0;while(h>e){e=h;++f;d=j;j=g[f%2];h=this._processECs(i,j,d)}}finally{j.finalize()}return d},_sortVertexesAndEdges:function(e,r){var m=e.getVertexes();var f=e.getEdges();if(!m.length){return{sortedVertexes:m,sortedEdges:f}}var t=a.clone(m);t.sort(function(C,B){var A=r.get(C);var z=r.get(B);var i=(A-z);if(i===0){var l=C.getData("object");var j=B.getData("object");i=Kekule.UnivChemStructObjComparer.compare(l,j)}return i});var p=new Kekule.MapEx();var n=function(j,i){return t.indexOf(j)-t.indexOf(i)};try{var y=a.clone(t);var q=[];var s=t[t.length-1];q.push(s);p.set(s,0);y.splice(t.length-1,1);for(var x=0;x<q.length;++x){var s=q[x];if(x!==0){var d=y.indexOf(s);if(d>=0){q.push(s);p.set(s,q.length-1);y.splice(d,1)}}var u=s.getNeighbors();u=a.intersect(u,y);if(u.length){u.sort(n);for(var w=u.length-1;w>=0;--w){var o=u[w];d=y.indexOf(o);if(d>=0){q.push(o);p.set(u[w],q.length-1);y.splice(d,1)}}}}var k=a.clone(f);var g=function(j,i){return(p.get(j)-p.get(i))};if(k.length>1){for(var x=0,v=k.length;x<v;++x){var h=k[x];h.getVertexes().sort(g)}k.sort(function(z,l){var C=z.getVertexes();var B=l.getVertexes();var j=0;for(var A=0;A<2;++A){j=g(C[A],B[A]);if(j!==0){return j}}return j})}}finally{p.finalize()}return{sortedVertexes:q,sortedEdges:k}},_sortNodesAndConnectors:function(g,m,j){var e=[];for(var f=0,d=m.length;f<d;++f){e.push(m[f].getData("object"))}var k=[];for(var f=0,d=j.length;f<d;++f){k.push(j[f].getData("object"))}var h=new Kekule.MapEx();try{this._calcChildNodeLabels(g,h,e);this._reindexCtabNodesAndConnectors(g,h,e,k)}finally{h.finalize()}},_calcChildNodeLabels:function(g,m,n){var j=null;var d=g.getNodes();for(var h=0,f=d.length;h<f;++h){var e=d[h];var k=n.indexOf(e)+1;if(k<1){if(e.hasCtab&&e.hasCtab()){k=-this._calcChildNodeLabels(e.getCtab(),m,n)}else{}}m.set(e,k);if(k>=0){if((j===null)||(j>k)){j=k}}}return j},_reindexCtabNodesAndConnectors:function(j,h,e,m){j.sortNodes(function(l,i){var o=h.get(l);var n=h.get(i);if(o>0&&n>0){return o-n}else{if(o<0&&n<0){return -(o-n)}else{return(o>0)?-1:1}}});j.sortConnectors(function(l,i){var o=m.indexOf(l);var n=m.indexOf(i);return o-n});var f=j.getNodes();for(var g=0,d=f.length;g<d;++g){var k=f[g];if(k.hasCtab&&k.hasCtab()&&e.indexOf(k)<0){this._reindexCtabNodesAndConnectors(k.getCtab(),h,e,m)}}}});Kekule.canonicalizer.registerExecutor("morgan",Kekule.MorganCanonicalizationExecutor,true)})();(function(){var a=Kekule.ArrayUtils;var b=Kekule.GraphAlgorithmUtils;var d=Kekule.ChemStructureUtils;var c=Kekule.BondType;Kekule.StructureRingSearchDefOptions={bondTypes:[c.COVALENT]};ClassEx.extend(Kekule.StructureConnectionTable,{getGraph:function(e){var f=Class.create(e);f.connectorClasses=[Kekule.Bond];return Kekule.GraphAdaptUtils.ctabToGraph(this,null,f)},extractStructObjs:function(j){var h=j.edges;var n=j.vertexes;var g=[],f=[];for(var k=0,e=n.length;k<e;++k){var m=n[k].getData("object");if(m instanceof Kekule.BaseStructureNode){g.push(m)}}for(var k=0,e=h.length;k<e;++k){var m=h[k].getData("object");if(m instanceof Kekule.BaseStructureConnector){f.push(m)}}return{nodes:g,connectors:f}},findCycleBlocks:function(){var e=this.getRingInfo();return e?e.cycleBlocks:[]},findAllRings:function(){var k=this.getRingInfo();var f=[];if(k){for(var h=0,g=k.cycleBlocks.length;h<g;++h){var e=k.cycleBlocks[h];var j=e.allRings;f=f.concat(j)}}return f},findSSSR:function(){var k=this.getRingInfo();var f=[];if(k){for(var h=0,g=k.cycleBlocks.length;h<g;++h){var e=k.cycleBlocks[h];var j=e.sssrRings;f=f.concat(j)}}return f},analysisRings:function(x){var q=this.getGraph(x||Kekule.StructureRingSearchDefOptions);if(q){var v=[];var e=b.analysisRings(q);for(var p=0,m=e.length;p<m;++p){var u=e[p];var r=this.extractStructObjs(u);v.push(r);r.allRings=[];var h=u.allRings;for(var o=0,n=h.length;o<n;++o){var t=h[o];var f=this.extractStructObjs(t);r.allRings.push(f)}r.sssrRings=[];var w=u.sssrRings;for(var o=0,n=w.length;o<n;++o){var t=w[o];var s=h.indexOf(t);if(s>=0){r.sssrRings.push(r.allRings[s])}else{var f=this.extractStructObjs(t);r.sssrRings.push(f)}}}return{cycleBlocks:v}}else{return null}}});ClassEx.defineProps(Kekule.StructureConnectionTable,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(f){var e=this.getPropStoreFieldValue("ringInfo");if(!e&&!f){e=this.analysisRings();this.setPropStoreFieldValue("ringInfo",e)}return e},setter:null}]);ClassEx.extendMethod(Kekule.StructureConnectionTable,"objectChange",function(f,e){this.setPropStoreFieldValue("ringInfo",null);return f(e)});ClassEx.extend(Kekule.StructureFragment,{findCycleBlocks:function(){return this.hasCtab()?this.getCtab().findCycleBlocks():null},findAllRings:function(){return this.hasCtab()?this.getCtab().findAllRings():null},findSSSR:function(){return this.hasCtab()?this.getCtab().findSSSR():null},analysisRings:function(){return this.hasCtab()?this.getCtab().analysisRings():null}});ClassEx.defineProps(Kekule.StructureFragment,[{name:"ringInfo",dataType:DataType.HASH,serializable:false,getter:function(e){return this.hasCtab()?this.getCtab().getRingInfo(e):null},setter:null}]);ClassEx.extend(Kekule.ChemObject,{findCycleBlocks:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findCycleBlocks();if(j){e=e.concat(j)}}return e.length?e:null},findAllRings:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findAllRings();if(j){e=e.concat(j)}}return e.length?e:null},findSSSR:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].findSSSR();if(j){e=e.concat(j)}}return e.length?e:null},analysisRings:function(){var h=d.getAllStructFragments(this);var e=[];for(var g=0,f=h.length;g<f;++g){var j=h[g].analysisRings();if(j){e=e.concat(j)}}return e.length?e:null}})})();(function(){var b=Kekule.ArrayUtils;var c=Kekule.BondType;var e=Kekule.BondOrder;var d=Kekule.ChemStructureUtils;var a={SATURATED_CARBON:-1,ESTER_CARBON:-16,SULFONE_OR_SULFOXIDE_SULPHUR:-32};Kekule.AromaticTypes={NONAROMATIC:0,EXPLICIT_AROMATIC:1,ANTIAROMATIC:-1,UNCERTAIN:64};ClassEx.extend(Kekule.Atom,{isSulfoneOrSulfoxideSulphur:function(){if(this.getSymbol()==="S"){var g=this.getLinkedMultipleBonds();if(g.length>=1){for(var n=0,f=g;n<f;++n){var p=this.getLinkedObjsOnConnector(g[n]);for(var m=0,h=p.length;m<h;++m){var o=p[m];if((o instanceof Kekule.Atom)&&(o.getSymbol()==="O")){return true}}}}}return false},isEsterCarbon:function(){if(this.getSymbol()==="C"){var m=this.getLinkedBonds(c.COVALENT);var j,k;for(var h=0,g=m.length;h<g;++h){var f=m[h];if(f.isBondBetween("C","O")){if(!k&&(f.getBondOrder()===e.SINGLE)){k=true}else{if(!j&&(f.getBondOrder()===e.DOUBLE)){j=true}}if(k&&j){return true}}}}return false}});ClassEx.extend(Kekule.StructureConnectionTable,{_getPossibleRingNodePiElectronCounts:function(j,g,p){var m=function(x,G,B,z){var I=x;var s=Kekule.IsotopeFactory.getIsotope(I);var F=G.getCharge();var E=G.isSaturated&&G.isSaturated();if(!E){var t=G.getLinkedMultipleBonds();if(G.isSulfoneOrSulfoxideSulphur&&G.isSulfoneOrSulfoxideSulphur()){return a.SULFONE_OR_SULFOXIDE_SULPHUR}else{if(G.isEsterCarbon&&G.isEsterCarbon()){return a.ESTER_CARBON}}var C=b.intersect(t,z);var A=C.length;if(A){if((A===2)&&(C[0].getBondOrder()===Kekule.BondOrder.EXPLICIT_AROMATIC)){if(s.isHetero&&s.isHetero()){return[1,2]}else{return 1}}else{if((A===1)&&(C[0].getBondOrder()===Kekule.BondOrder.DOUBLE)){return 1}else{return 0}}}else{if(I==="C"){var u=false;for(var J=0,H=t.length;J<H;++J){var y=t[J];var v=G.getLinkedObjsOnConnector(y);if(v.length===1){var D=v[0];var w=D.getPrimaryIsotope();if(w.isHetero()){u=true;break}}}if(u){return 0}else{return 1}}else{return 1}}}else{if(G.getRadical&&(G.getRadical()===Kekule.RadicalOrder.DOUBLET)){return 1}else{if(s.isHetero()){return 2}else{if(I==="C"){if(F>0){return 0}else{if(F<0){return 2}else{return a.SATURATED_CARBON}}}}}}return 0};if(j instanceof Kekule.VariableAtom){var f=j.getAllowedIsotopeIds();if(f&&f.length){var r=[];for(var o=0,n=f.length;o<n;++o){var h=f[o];var k=Kekule.IsotopeFactory.getIsotopeById(h).getSymbol();b.pushUnique(r,m(k,j,g,p))}return r}else{return[0,1,2]}}var q=j.getPrimaryIsotope();if(!q){return[0,1,2]}else{var k=q.getSymbol();return m(k,j,g,p)}},_checkRingAromaticType:function(h,f){if(f){var q=h.nodes;var v=[];var o=[];var t=q.length;for(var s=0;s<t;++s){var p=q[s];var u=f.get(p);if(b.isArray(u)){v.push(u)}else{v.push([u])}o[s]=0}var y=function(B,n){var i=n[B];var A=++i;if(A>=v[B].length){if(B>=n.length-1){return false}else{n[B]=0;return y(B+1,n)}}else{n[B]=A;return true}};var x=function(i){return y(0,i)};var j;var r=null;var m=0;do{++m;var l=0;var g=null;for(var s=0;s<t;++s){var w=v[s][o[s]];if(w>=0){l+=w}else{g=Kekule.AromaticTypes.NONAROMATIC;break}}if(g===null){var k=parseInt(l/4);var z=l%4;if((k<=5)&&(k!==2)){if(z===2){g=Kekule.AromaticTypes.EXPLICIT_AROMATIC}else{if(!z){g=Kekule.AromaticTypes.ANTIAROMATIC}}}}if(r!==null){if(r!==g){if((r===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(g===Kekule.AromaticTypes.EXPLICIT_AROMATIC)){return Kekule.AromaticTypes.UNCERTAIN;break}}}else{r=g}}while(x(o));return r}},_calcPossibleRingNodesPElectronCounts:function(f,q,h){var g=[];var m=[];var p=[];if(!h){for(var n=0,k=q.length;n<k;++n){b.pushUnique(g,q[n].nodes);b.pushUnique(m,q[n].connectors)}p=g}else{for(var n=0,k=h.length;n<k;++n){b.pushUnique(g,h[n].nodes);b.pushUnique(m,h[n].connectors)}for(var n=0,k=q.length;n<k;++n){b.pushUnique(p,q[n].nodes)}}for(var n=0,k=p.length;n<k;++n){var j=p[n];var o=this._getPossibleRingNodePiElectronCounts(j,g,m);f.set(j,o)}},perceiveAromaticRings:function(k,o){var m=o||this.findSSSR();var p=[];var f=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(f,m,null);for(var j=0,g=m.length;j<g;++j){var h=m[j];var n=this._checkRingAromaticType(h,f);if((n===Kekule.AromaticTypes.EXPLICIT_AROMATIC)||(k&&(n===Kekule.AromaticTypes.UNCERTAIN))){p.push(h)}}return p}finally{f.finalize()}},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)},getRingAromaticType:function(h,g){if(!g){g=this.findSSSR()}var f;var i=new Kekule.MapEx();try{this._calcPossibleRingNodesPElectronCounts(i,[h],g);f=this._checkRingAromaticType(h,i)}finally{i.finalize()}return f}});ClassEx.extend(Kekule.StructureFragment,{perceiveAromaticRings:function(g,h){var f=this.hasCtab()?this.getCtab().perceiveAromaticRings(g,h):[];this.setAromaticRings(f||[]);return f},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)},getRingAromaticType:function(g,f){return this.hasCtab()?this.getCtab().getRingAromaticType(g,f):null}});ClassEx.extend(Kekule.ChemObject,{perceiveAromaticRings:function(h,n){var k=d.getAllStructFragments(this);var f=[];for(var j=0,g=k.length;j<g;++j){var m=k[j].perceiveAromaticRings(h,n);if(m){f=f.concat(m)}}return f.length?f:null},findAromaticRings:function(f,g){return this.perceiveAromaticRings(f,g)}})})();(function(){Kekule.MolStandardizer={standardize:function(d,a){var c={unmarshalSubFragments:true,doCanonicalization:true,doAromaticPerception:true};var b=d;var e=Object.extend(c,a);if(e.unmarshalSubFragments){b.unmarshalAllSubFragments(true)}if(e.doCanonicalization){Kekule.canonicalizer.canonicalize(b,e.canonicalizerExecutorId||null)}if(e.doAromaticPerception){b.perceiveAromaticRings()}return b}};Object.extend(Kekule.ChemStructureUtils,{isSameStructure:function(a,d){var c=a.clone(false);var b=d.clone(false);c=Kekule.MolStandardizer.standardize(c);b=Kekule.MolStandardizer.standardize(b);return Kekule.UnivChemStructObjComparer.compare(c,b)===0}});ClassEx.extend(Kekule.ChemObject,{standardize:function(c){var a=Kekule.ChemStructureUtils.getAllStructFragments(this,true);for(var d=0,b=a.length;d<b;++d){a[d].standardize(c)}return this}});ClassEx.extend(Kekule.StructureFragment,{standardize:function(a){return Kekule.MolStandardizer.standardize(this,a)},isSameStructureWith:function(a){return Kekule.ChemStructureUtils.isSameStructure(this,a)}})})();(function(){var b=Kekule.ArrayUtils;var c=Kekule.UnivChemStructObjComparer;Kekule.ChemStructureSearcher={findSubStructure:function(l,k,q){var h=Object.extend({doStandardize:true},q);if(h.exactMatch){var e=k.isSameStructureWith(l);if(e){return[].concat(k.getNodes()).concat(k.getConnectors())}else{return false}}if(h.doStandardize){var i={unmarshalSubFragments:true,doCanonicalization:false,doAromaticPerception:true};l.standardize(i);k.standardize(i)}var p=l.getNodeAt(0);var g=k.getNodes();var o=g.length;var j=0;var n=[];var m=[];var f={compareLinkedConnectorCount:false,compareCharge:!h.ignoreCharge,compareHydrogenCount:false,compareConnectedObjCount:false,compareBondOrder:!h.ignoreBondOrder};var d=false;while(!d&&(j<o)){d=a._compareNode(p,g[j],n,m,f);++j}if(!d){return false}else{return b.toUnique(d)}},_addToComparedObjs:function(e,f,d){f.push(e)},_removeFromComparedObjs:function(f,g,d){var e=g.indexOf(f);g.length=e},_isSameMappedObj:function(i,h,d,g){var f=g.indexOf(h);var e=d.indexOf(i);return(f>=0)&&(f===e)},_compareComparedNeighbors:function(e,d,k,m){if(e.length>d.length){return false}var h=[];for(var j=0,f=e.length;j<f;++j){h.push(k.indexOf(e[j]))}var g=[];for(var j=0,f=d.length;j<f;++j){g.push(m.indexOf(d[j]))}for(var j=0,f=h.length;j<f;++j){if(g.indexOf(h[j])<0){return false}}return true},_compareNode:function(g,o,r,k,v){if(c.compare(g,o,v)!==0){return false}else{var q=g.getLinkedConnectorCount();var j=o.getLinkedConnectorCount();if(q>j){return false}var f=b.clone(r);var h=b.clone(k);a._addToComparedObjs(g,f,"target");a._addToComparedObjs(o,h,"src");var m=b.clone(g.getLinkedConnectors());var e=b.clone(o.getLinkedConnectors());var s=b.intersect(m,f);var t=b.intersect(e,h);var n=true;if(!a._compareComparedNeighbors(s,t,f,h)){n=false}else{m=b.exclude(m,s);e=b.exclude(e,t);if(m.length>e.length){n=false}}var p=[];while(n&&m.length){var l=false;var u=m.shift();var i=0;var d;while(e.length&&!l&&(i<e.length)){d=e[i];l=a._compareConnector(u,d,f,h,v);if(l){p=p.concat(l)}++i}if(!l){n=false;break}else{b.remove(e,d)}}if(n){n=[o].concat(p)}return n}},_compareConnector:function(t,e,r,l,u){if(c.compare(t,e,u)!==0){return false}else{var j=t.getConnectedObjCount();var f=e.getConnectedObjCount();if(j>f){return false}var g=b.clone(r);var i=b.clone(l);a._addToComparedObjs(t,g,"target");a._addToComparedObjs(e,i,"src");var s=b.clone(t.getConnectedObjs());var v=b.clone(e.getConnectedObjs());var o=b.intersect(s,g);var h=b.intersect(v,i);var p=true;if(!a._compareComparedNeighbors(o,h,g,i)){p=false}else{s=b.exclude(s,o);v=b.exclude(v,h);if(s.length>v.length){p=false}}var q=[];while(p&&s.length){var m=false;var n=s.shift();var k=0;var d;while(v.length&&!m&&(k<v.length)){d=v[k];if(d.getClass()!==n.getClass()){m=false}else{if(d instanceof Kekule.ChemStructureNode){m=a._compareNode(n,d,g,i,u)}else{if(d instanceof Kekule.ChemStructureConnector){m=a._compareConnector(n,d,g,i,u)}else{m=false}}}if(m){q=q.concat(m)}++k}if(!m){p=false;break}else{b.remove(v,d)}}if(p){p=[e].concat(q)}return p}}};var a=Kekule.ChemStructureSearcher;ClassEx.extend(Kekule.StructureFragment,{search:function(e,d){return a.findSubStructure(e,this,d)}})})();