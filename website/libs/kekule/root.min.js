var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());"use strict";var $jsRoot=this;function emptyFunction(){}function $A(c){if(!c){return[]}if(c.toArray){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}var Class={createCore:function(){var e=null,d=$A(arguments);if(Object.isFunction(d[0])){e=d.shift()}function a(){this.initialize.apply(this,arguments)}Object.extend(a,Class.Methods);a.superclass=e;a.subclasses=[];if(e){var b=function(){};b.prototype=e.prototype;a.prototype=new b;e.subclasses.push(a)}for(var c=0;c<d.length;c++){a.addMethods(d[c])}if(!a.prototype.initialize){a.prototype.initialize=emptyFunction}a.prototype.constructor=a;return a},create:function(){var a=Class.createCore.apply(this,arguments);return a},free:function(a){if(a.finalize){a.finalize()}a=null}};Class.Methods={addMethods:function(b){if(!b){return this}var f=this.superclass&&this.superclass.prototype;var h=Object.keys(b);if(!Object.keys({toString:true}).length){h.push("toString","valueOf")}var g=function(){};for(var e=0,d=h.length;e<d;e++){var k=h[e];var j=b[k];var c=Object.isFunction(j);if(f&&c&&j.argumentNames().first()=="$super"){var a=j;j=(function(i){return function(){return(f[i]||g).apply(this,arguments)}})(k).wrap(a);j.valueOf=a.valueOf.bind(a);j.toString=a.toString.bind(a)}this.prototype[k]=j}return this}};Object.extend=function(a,e,f,d){for(var c in e){var b=e[c];if(f&&((b===undefined)||(b===null))){continue}if(d&&(b==="")){continue}a[c]=b}return a};Object.getCascadeFieldValue=function(f,c){var a;var e=f.split(".");if(!c){var c=this}for(var d=0,b=e.length;d<b;++d){a=c[e[d]];if(!a){break}else{c=a}}return a};Object._inherit=function(b){if(b===null){b={}}var a=typeof(b);if(!(DataType.isFunctionType(a)||DataType.isObjectType(a))){throw TypeError()}function c(){}c.prototype=b;return new c()};if(!Object.create){Object.create=Object._inherit}Object.copyValues=function(b,e,g){if(!g){return Object.extend(b,source)}else{for(var c=0,a=g.length;c<a;++c){var f=g[c];var d=e[f];if(d!==undefined){b[f]=d}}return b}};Object.extend(Object,{keys:function(a){var b=[];for(var c in a){b.push(c)}return b},isFunction:function(a){return typeof a=="function"},isUndefined:function(a){return typeof a=="undefined"}});Object.extend(Function.prototype,{argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return a.length==1&&!a[0]?[]:a},wrap:function(b){var a=this;return function(){return b.apply(this,[a.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var a=this;return this._methodized=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this);return a.apply(null,b)}}});if(!Function.prototype.bind){Object.extend(Function.prototype,{bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var a=this,c=$A(arguments),b=c.shift();return function(){return a.apply(b,c.concat($A(arguments)))}}})}Object.extend(Array.prototype,{first:function(){return this[0]},last:function(){return this[this.length-1]},clear:function(){this.length=0;return this},without:function(){var a=$A(arguments);return this.select(function(b){return !a.include(b)})},removeAt:function(a){this.splice(a,1)},remove:function(b){var a=this.indexOf(b);if(a>=0){return this.removeAt(a)}}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,a){a||(a=0);var b=this.length;if(a<0){a=b+a}for(;a<b;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b,a){a=isNaN(a)?this.length:(a<0?this.length+a:a)+1;var c=this.slice(0,a).reverse().indexOf(b);return(c<0)?c:a-c-1}}Object.extend(String.prototype,{truncate:function(b,a){b=b||30;a=Object.isUndefined(a)?"...":a;return this.length>b?this.slice(0,b-a.length)+a:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var b=new RegExp(Prototype.ScriptFragment,"img");var a=new RegExp(Prototype.ScriptFragment,"im");return(this.match(b)||[]).map(function(c){return(c.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var a=arguments.callee;a.text.data=this;return a.div.innerHTML},unescapeHTML:function(){var a=new Element("div");a.innerHTML=this.stripTags();return a.childNodes[0]?(a.childNodes.length>1?$A(a.childNodes).inject("",function(b,c){return b+c.nodeValue}):a.childNodes[0].nodeValue):""},toQueryParams:function(b){var a=this.strip().match(/([^?#]*)(#.*)?$/);if(!a){return{}}return a[1].split(b||"&").inject({},function(e,f){if((f=f.split("="))[0]){var c=decodeURIComponent(f.shift());var d=f.length>1?f.join("="):f[0];if(d!=undefined){d=decodeURIComponent(d)}if(c in e){if(!Object.isArray(e[c])){e[c]=[e[c]]}e[c].push(d)}else{e[c]=d}}return e})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return a<1?"":new Array(a+1).join(this)},camelize:function(){var d=this.split("-"),a=d.length;if(a==1){return d[0]}var c=this.charAt(0)=="-"?d[0].charAt(0).toUpperCase()+d[0].substring(1):d[0];for(var b=1;b<a;b++){c+=d[b].charAt(0).toUpperCase()+d[b].substring(1)}return c},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(b){var a=this.gsub(/[\x00-\x1f\\]/,function(c){var d=String.specialChar[c[0]];return d?d:"\\u00"+c[0].charCodeAt().toPaddedString(2,16)});if(b){return'"'+a.replace(/"/g,'\\"')+'"'}return"'"+a.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(a){return this.sub(a||Prototype.JSONFilter,"#{1}")},isJSON:function(){var a=this;if(a.blank()){return false}a=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(a)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(a){return this.indexOf(a)>-1},startsWith:function(a){return this.indexOf(a)===0},endsWith:function(a){var b=this.length-a.length;return b>=0&&this.lastIndexOf(a)===b},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,b){return new Template(this,b).evaluate(a)}});Object.extend(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){var c=this;for(var a=0;a<arguments.length;a++){var b=new RegExp("\\{"+a+"\\}","gi");c=c.replace(b,arguments[a])}return c},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},pad:function(g,f,e){var h=f||" ";var c=[];for(var d=0,b=g-this.length;d<b;++d){c.push(h)}var j=this;if(e){return j+c.join("")}else{return c.join("")+j}},lpad:function(b,a){return this.pad(b,a,false)},rpad:function(b,a){return this.pad(b,a,true)},reverse:function(){var d=this.length;var b=[];for(var c=d-1;c>=0;--c){b.push(this.charAt(c))}return b.join("")},toCharArray:function(){var c=[];for(var d=0,b=this.length;d<b;++d){c.push(this.charAt(d))}return c},hyphenize:function(f){if(!f){f="-"}var b=this.length;var d=[];for(var e=0;e<b;++e){var g=this.charAt(e);if((e!==0)&&(g>="A")&&(g<="Z")){d.push(f+g.toLowerCase())}else{d.push(g)}}return d.join("")}});if(!String.prototype.trim){Object.extend(String.prototype,{trim:function(){return this.replace(/^\s*|\s*$/g,"")}})}if(!String.prototype.trimLeft){String.prototype.trimLeft=String.prototype.ltrim}if(!String.prototype.trimRight){String.prototype.trimLeft=String.prototype.rtrim}var StringUtils={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(e){for(var b=0,a=e.length;b<a;++b){var f=e.charAt(b);var d=(f>="0")&&(f<="9");if((!d)&&(f!=".")){return false}}return true},serializeValue:function(b,e){var d=e||[];var c=DataType.getType(b);if(d.indexOf(c)>=0){return b.toString()}if(b===null){return StringUtils.SNULL}else{if(typeof(b)=="undefined"){return StringUtils.SUNDEFINED}else{if(b!=b){return StringUtils.SNAN}else{switch(c){case"boolean":return b?StringUtils.STRUE:StringUtils.SFALSE;break;case"number":var a=(b>=0)?StringUtils.SPOSITIVE:"";return a+b;break;case DataType.DATE:return StringUtils.SDATEPREFIX+b.toString();default:return b.toString()}}}}},deserializeValue:function(d,a){if(typeof(d)!=="string"){return d}switch(d){case StringUtils.STRUE:return true;break;case StringUtils.SFALSE:return false;break;case StringUtils.SNULL:return null;break;case StringUtils.SUNDEFINED:return undefined;break;case StringUtils.SNAN:return NaN;break;default:if(a){switch(a){case DataType.FLOAT:return parseFloat(d);break;case DataType.INT:return parseInt(d);break;case"number":return parseFloat(d);break;case"boolean":return !!d;break;default:return d}}else{var c=d.charAt(0);switch(c){case StringUtils.SPOSITIVE:case StringUtils.SNEGATIVE:var b=d.substring(1);if(StringUtils.isAllDigitalChar(b)){return parseFloat(d)}else{return d}break;case StringUtils.SDATEPREFIX:var b=d.substr(1);return new Date(b);default:return d}}}}};Object.extend(Date.prototype,{copyFrom:function(a){this.setFullYear(a.getFullYear(),a.getMonth(),a.getDate());this.setTime(a.getTime())}});Math.sqr=function(a){return a*a};Math.sign=function(a){return(a>=0)?1:-1};if(!this.Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}Class.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1};Class.PropList=function(){this.props=[]};Class.PropList.prototype={addProperty:function(c,b){if(!b){b={}}var a;a=this.getPropInfo(c);if(!a){a={};this.props.push(a)}a=Object.extend(a,b);if(a.serializable===undefined){a.serializable=true}a.name=c;return a},removeProperty:function(b){var a=this.indexOf(b);if(a>=0){this.props.splice(a,1)}},removePropAt:function(a){if(a>=0){var b=this.props[a];if(b){this.props.splice(a,1)}}},getLength:function(){return this.props.length},indexOf:function(c){for(var b=0,a=this.props.length;b<a;++b){if(this.props[b].name===c){return b}}return -1},getPropInfoAt:function(a){if(a>=0){return this.props[a]}else{return null}},getPropInfo:function(c){var a;var b=this.indexOf(c);var a=this.getPropInfoAt(b);return a},hasProperty:function(a){return(this.indexOf(a)>=0)},clear:function(){this.props.clear()},clone:function(){var a=new Class.PropList();a.props=this.props.slice();return a},appendList:function(a){for(var c=0,b=a.props.length;c<b;++c){this.props.push(a.props[c])}}};Class.PropList.prototype.constructor=Class.PropList;Class.EventHandlerList=function(){this.handlers=[]};Class.EventHandlerList.prototype={add:function(b,a){if(!a){a=null}this.handlers.push({thisArg:a,handler:b})},remove:function(d,a){var b=this.indexesOf(d,a);if(b.length>0){for(var c=b.length-1;c>=0;--c){this.removeAt(b[c])}}},removeAt:function(b){for(var c=b,a=this.handlers.length;c<a;++c){this.handlers[c]=this.handlers[c+1]}this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(a){return this.handlers[a]},indexOf:function(d,b){for(var c=0,a=this.handlers.length;c<a;++c){if(this.handlers[c].handler==d){if((b!==undefined)&&(this.handlers[c].thisArg===b)){return c}else{if(b===undefined){return c}}}}return -1},indexesOf:function(e,c){var a=[];for(var d=0,b=this.handlers.length;d<b;++d){if(this.handlers[d].handler==e){if((c!==undefined)&&(this.handlers[d].thisArg===c)){a.push(d)}else{if(c===undefined){a.push(d)}}}}return a},getLength:function(){return this.handlers.length}};Class.EventHandlerList.constructor=Class.EventHandlerList;var DataType={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(a){return(a==DataType.STRING)||(a==DataType.NUMBER)||(a==DataType.INT)||(a==DataType.FLOAT)||(a==DataType.BOOL)||(a==DataType.UNDEFINED)||(a==DataType.PRIMARY)},isComplexType:function(a){return !(DataType.isSimpleType(a)||DataType.isFunctionType(a))},isFunctionType:function(a){return a==DataType.FUNCTION},isObjectType:function(a){return a==DataType.OBJECT},isDateType:function(a){return a==DataType.DATE},isObjectExType:function(b){var a=DataType.isComplexType(b)&&(!DataType.isObjectType(b))&&(!DataType.isDateType(b));if(a){var c=ClassEx.findClass(b);a=c&&ClassEx.isOrIsDescendantOf(c,ObjectEx)}return a},getType:function(b){var a=typeof(b);switch(a){case"undefined":return DataType.UNDEFINED;case"function":return DataType.FUNCTION;case"boolean":return DataType.BOOL;case"string":return DataType.STRING;case"number":if(Math.floor(b)==b){return DataType.INT}else{return DataType.FLOAT}case"object":if(this.isDateValue(b)){return DataType.DATE}else{if(DataType.isArrayValue(b)){return DataType.ARRAY}else{if(ClassEx.isClass(b)){return DataType.CLASS}else{if(DataType.isObjectExValue(b)&&b.getClassName){return b.getClassName()}else{return DataType.OBJECT}}}}default:return a}},isSimpleValue:function(a){return DataType.isSimpleType(typeof(a))},isUndefinedValue:function(a){return typeof(a)=="undefined"},isNullValue:function(a){return(a===null)},isFunctionValue:function(a){return typeof(a)=="function"},isObjectValue:function(a){if(a){return(typeof(a)=="object")&&(!DataType.isArrayValue(a))&&(!DataType.isDateValue(a))}else{return false}},isDateValue:function(a){if(a){return((typeof(a)=="object")&&(a.getFullYear!==undefined))}return false},isArrayValue:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},isObjectExValue:function(a){return(a instanceof ObjectEx)},createInstance:function(a){switch(a){case DataType.UNDEFINED:return undefined;case DataType.DATE:return new Date();case DataType.ARRAY:return new Array();case DataType.OBJECT:return new Object();case DataType.FUNCTION:return new Function();default:var b=ClassEx.findClass(a.capitalizeFirst());return new b()}}};var ClassEx={isClass:function(a){if(!a){return false}return(a.superclass&&a.subclasses)},findClass:function(b,a){return Object.getCascadeFieldValue(b,a||$jsRoot)},getClassName:function(a){return a.prototype.CLASS_NAME},getPrototype:function(a){return a.prototype},getSuperClass:function(a){return a.superclass||a.constructor.superclass},getSuperClassPrototype:function(a){if(a.superclass){return a.superclass.prototype}else{return null}},_getCommonSuperClass2:function(c,b){var a=c;while(a&&(!ClassEx.isOrIsDescendantOf(b,a))){a=ClassEx.getSuperClass(a)}return a},getCommonSuperClass:function(e){if(!e||!e.length){return null}var a=e[0].getClass?e[0].getClass():null;if(!a){return null}for(var c=1,b=e.length;c<b;++c){var d=e[c].getClass?e[c].getClass():null;if(!d){return null}a=ClassEx._getCommonSuperClass2(a,d)}return a},isDescendantOf:function(c,b){var a=ClassEx.getSuperClass(c);while(a&&(a!==b)){a=ClassEx.getSuperClass(a)}return !!a},isOrIsDescendantOf:function(b,a){return(b===a)||ClassEx.isDescendantOf(b,a)},isOrIsDescendantOfClasses:function(c,d){for(var b=0,a=d.length;b<a;++b){if(ClassEx.isOrIsDescendantOf(c,d[b])){return true}}return false},_ensurePropertySystem:function(c){var b=ClassEx.getPrototype(c);if(!b){return}if(!b.hasOwnProperty("properties")){var a=ClassEx.getSuperClass(c);if(a){ClassEx._ensurePropertySystem(a)}ClassEx._createPropertyList(c);if(b.hasOwnProperty("initProperties")){b.initProperties.apply(b)}}},_createPropertyList:function(a){if(!ClassEx.getPrototype(a).hasOwnProperty("properties")){ClassEx.getPrototype(a).properties=new Class.PropList()}},getOwnPropList:function(b){var a=ClassEx.getPrototype(b);if(a){a._initPropertySystem();return a.properties}else{return null}},getAllPropList:function(c){var a;var b=ClassEx.getSuperClassPrototype(c);if(b){a=b.getAllPropList().clone();a.appendList(ClassEx.getOwnPropList(c))}else{a=ClassEx.getOwnPropList(c)}return a},getPropListOfScopes:function(e,d){var b=function(j,h){var l=ClassEx.getOwnPropList(j).clone();if(l){for(var g=l.getLength()-1;g>=0;--g){var f=l.getPropInfoAt(g);var k=f.scope||Class.PropertyScope.DEFAULT;if(h.indexOf(k)<0){l.removePropAt(g)}}}return l};var a;var c=ClassEx.getSuperClass(e);if(c){a=ClassEx.getPropListOfScopes(c,d).clone();a.appendList(b(e,d))}else{a=b(e,d)}return a},defineProp:function(b,c,a){ClassEx._ensurePropertySystem(b);return ClassEx.getPrototype(b).defineProp(c,a)},defineProps:function(g,a){ClassEx._ensurePropertySystem(g);var f=ClassEx.getPrototype(g);for(var d=0,b=a.length;d<b;++d){var e=a[d];var h=e.name;var c=e;f.defineProp(h,c)}},getPropInfo:function(a,b){return ClassEx.getPrototype(a).getPropInfo(b)},defineEvent:function(b,a){return ClassEx.getPrototype(b).defineEvent(a)},getUnusedMethodName:function(e,d,c){var g=c||0;var b=g;var f=ClassEx.getPrototype(e);var a=d+Number(b).toString();while(f[a]){++b;a=d+Number(b).toString()}return a},extendMethod:function(d,b,g){var c=ClassEx.getPrototype(d);var f=c[b];var a=ClassEx.getUnusedMethodName(d,"__$changed$_"+b+"__");c[a]=f;var e=(function(h){return function(){return c[h].apply(this,arguments)}})(a).wrap(g);c[b]=e;e.valueOf=g.valueOf.bind(g);e.toString=g.toString.bind(g)},extend:function(o,m){var f=ClassEx.getPrototype(o);var g=ClassEx.getSuperClassPrototype(o);var k=Object.keys(m);if(!Object.keys({toString:true}).length){k.push("toString","valueOf")}for(var d=0,c=k.length;d<c;d++){var n=k[d],l=m[n];if(typeof(l)=="function"){var j=l.argumentNames();var e=j.first();if(e=="$origin"){var a=l;var b=f[n];var h=ClassEx.getUnusedMethodName(o,"__$changed$_"+n+"__");f[h]=b;l=(function(i){return function(){return f[i].apply(this,arguments)}})(h).wrap(a);l.valueOf=a.valueOf.bind(a);l.toString=a.toString.bind(a);j.shift();e=j.first()}if(e=="$super"){var a=l;l=(function(i){return function(){return g[i].apply(this,arguments)}})(n).wrap(a);l.valueOf=a.valueOf.bind(a);l.toString=a.toString.bind(a)}}f[n]=l}return o}};var ObjectEx=Class.create({CLASS_NAME:"ObjectEx",initialize:function(){this._initPropertySystem();this.initPropValues();this._updateStatus=0;this._modifiedProps=[];this._finalized=false;this.afterInitialization()},afterInitialization:function(){},finalize:function(){if(!this._finalized){this.doFinalize();this.invokeEvent("finalize",{obj:this});this._finalized=true}},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePropValueSetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bubbleEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("eventHandlers",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE,getter:function(){var a=this.getPropStoreFieldValue("eventHandlers");if(!a){a={};this.setPropStoreFieldValue("eventHandlers",a)}return a}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){if(!this.getPrototype().hasOwnProperty("properties")){var a=this.getSuperClassPrototype();if(a){a._initPropertySystem.apply(a)}this._createPropertyList();if(this.getPrototype().hasOwnProperty("initProperties")){this.getPrototype().initProperties.apply(this.getPrototype())}}},_createPropertyList:function(){if(!this.getPrototype().hasOwnProperty("properties")){this.getPrototype().properties=new Class.PropList()}},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getSerializationName:function(){return this.getClassName()},getPrototype:function(){if(this.prototype){return this.prototype}else{return this.constructor.prototype}},getSuperClassPrototype:function(){if(this.constructor&&this.constructor.superclass){return this.constructor.superclass.prototype}else{return null}},getOwnPropList:function(){this._initPropertySystem();return this.getPrototype().properties},getAllPropList:function(){var a;var b=this.getSuperClassPrototype();if(b){a=b.getAllPropList().clone();a.appendList(this.getOwnPropList())}else{a=this.getOwnPropList().clone()}return a},getPropListOfScopes:function(a){return ClassEx.getPropListOfScopes(this.getClass(),a)},getPropInfoHashKey:function(a){return ObjectEx._PROPINFO_HASHKEY_PREFIX+a},getDefPropStoreFieldName:function(a){return ObjectEx._PROP_STOREFIELD_PREFIX+a},defineProp:function(c,a){if(!a){a={}}if(a.serializable===undefined){a.serializable=true}if(!a.storeField){a.storeField=this.getDefPropStoreFieldName(c)}var b=this.getOwnPropList();var d=b.addProperty(c,a);if(a.getter!==null){d.getter=this.createPropGetter(d,a.getter)}if(a.setter!==null){d.setter=this.createPropSetter(d,a.setter)}this[this.getPropInfoHashKey(c)]=d;return d},createPropGetter:function(f,a){var d=f.name.toString().upperFirst();var c="get"+d;var b="doGet"+d;var e=this[b];if(!e){e=a||new Function('return this["'+f.storeField+'"];');this.getPrototype()[b]=e}this.getPrototype()[c]=function(){var g=Array.prototype.slice.call(arguments);return this[b].apply(this,g)};return b},createPropSetter:function(g,f){var d=g.name.toString();var c=d.upperFirst();var b="set"+c;var a="doSet"+c;var e=this[a];if(!this[a]){e=f||new Function("value",'this["'+g.storeField+'"] = value;');this.getPrototype()[a]=e}this.getPrototype()[b]=function(){var h=Array.prototype.slice.call(arguments);var i=h[0];this[a].apply(this,h);this.notifyPropSet(d,i);return this};return a},hasProperty:function(a){return(this.getPropInfo(a)!=null)},getPropInfo:function(e){var b=e||"";var d=this.getPropInfoHashKey(b)||"";var a=this[d];if(!a){a=this.getOwnPropList().getPropInfo(b);if(!a){var c=this.getSuperClassPrototype();if(c&&c.getPropInfo){a=c.getPropInfo(b)}else{a=null}}}return a},getPropertyDataType:function(a){var b=this.getPropInfo(a);return b?b.dataType:null},isPropertySerializable:function(b){var c=this.getPropInfo(b);var a=c.serializable;return(a===undefined)||(!!a)},getPropStoreFieldValue:function(a){var b=this.getPropInfo(a);if(b.storeField){return this[b.storeField]}else{return undefined}},getPropValue:function(c){var a;var d=this.getPropInfo(c);if(d){if(d.getter){var b=Array.prototype.slice.call(arguments);b.shift();a=this[d.getter].apply(this,b)}else{a=this[d.storeField]}return a}else{return null}},setPropStoreFieldValue:function(c,b){var a;var d=this.getPropInfo(c);if(d.storeField){this[d.storeField]=b}},setPropValue:function(c,b,a){var d=this.getPropInfo(c);if(d){if(d.setter){this[d.setter].apply(this,[b])}else{if(a){this[d.storeField]=b}}this.notifyPropSet(c,b)}return this},setPropValueX:function(){var a=Array.prototype.slice.call(arguments);var b=a.shift();var c=this.getPropInfo(b);if(c){if(c.setter){this[c.setter].apply(this,a)}this.notifyPropSet(b,this.getPropValue(b))}return this},setPropValues:function(c,a){for(var b in c){if(c.hasOwnProperty(b)){if(this.hasProperty(b)){var d=c[b];this.setPropValue(b,d,a)}}}return this},_isPropGetOrSetEvent:function(a){return(a=="propValueGet")||(a=="propValueSet")},notifyPropSet:function(a,b,c){if(this.isUpdating()){if(this._modifiedProps.indexOf(a)<0){this._modifiedProps.push(a)}return}if(this._isPropGetOrSetEvent(a)||this.isEventPropName(a)){return}this.doPropChanged(a,b);if(this.getPropStoreFieldValue("enablePropValueSetEvent")){this.invokeEvent("propValueSet",{propName:a,propValue:b})}if(!c){this.objectChange([a])}},objectChange:function(a){this.doObjectChange(a);this.invokeEvent("change",{changedPropNames:a})},doObjectChange:function(a){},doPropChanged:function(a,b){},defineEvent:function(b){return;var c=this.eventNameToPropName(b);var a=this.defineProp(c,{serializable:false,setter:null});return a},eventNameToPropName:function(a){return"__event_"+a},isEventPropName:function(a){return((typeof(a)=="string")&&(a.indexOf("__event_")>=0))},isEventHandlerList:function(a){return(a&&(typeof(a)=="object")&&(a instanceof Class.EventHandlerList))},getEventHandlerList:function(b){var c=this.getEventHandlers();var a=c[b];if(!a){a=new Class.EventHandlerList();c[b]=a}return a},addEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.add(d,a)}else{return null}},addOnceEventListener:function(c,d,a){var b=this;var e=function(f){b.removeEventListener(c,e,a);d(f)};return this.addEventListener(c,e,a)},removeEventListener:function(b,d,a){var c=this.getEventHandlerList(b);if(this.isEventHandlerList(c)){return c.remove(d,a)}},invokeEvent:function(a,b){if(!b){b={}}b.name=a;b.target=this;b.stopPropagation=this._eventStopPropagation;this.dispatchEvent(a,b)},relayEvent:function(a,b){b.currentTarget=this;this.dispatchEvent(a,b)},dispatchEvent:function(b,e){var f=this.getEventHandlerList(b);if(this.isEventHandlerList(f)){for(var c=0,a=f.getLength();c<a;++c){var g=f.getHandlerInfo(c);if(g.handler){g.handler.apply(g.thisArg,[e])}}}var d=this.getHigherLevelObj();if(!e.cancelBubble&&this.getBubbleEvent()&&d){if(d.relayEvent){d.relayEvent(b,e)}}},stopEventPropagation:function(a){a.cancelBubble=true},assign:function(a){return a.assignTo(this)},assignTo:function(a){var b={};this.saveObj(b,"json");a.loadObj(b,"json")},clone:function(){var b=this.getClass();var a=new b();this.assignTo(a);return a},beginUpdate:function(){++this._updateStatus},endUpdate:function(){--this._updateStatus;this.checkUpdateStatus();if(!this.isUpdating()){var a=this._modifiedProps;this._modifiedProps=[];this.doEndUpdate(a)}},doEndUpdate:function(c){if(c.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent")){for(var b=0,a=c.length;b<a;++b){var d=c[b];var e=this.getPropValue(d);this.notifyPropSet(d,e,true)}}this.objectChange(c)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(a){return(this._modifiedProps.indexOf(a)>=0)},checkUpdateStatus:function(){if(this._updateStatus<=0){this._updateStatus=0}},copyPropsTo:function(b){var d=this.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var e=d.getPropInfoAt(c).name;if(b.hasProperty(e)){var f=this.getPropValue(e);b.setPropValue(e,f,true)}}}});ObjectEx._PROPINFO_HASHKEY_PREFIX="__$propInfo__";ObjectEx._PROP_STOREFIELD_PREFIX="__$";var JsonUtility={DEF_LOAD_TIMEOUT:20000,FILE_EXT_JSON:".json",FILE_EXT_JSON_JS_WRAPPER:".jsonjs",DEF_SERIALIZE_TO_JSCODE_VARNAME:"__jsonvar__",parse:function(a){return JSON.parse(a)},parseFromJsWrappedCode:function(code,jsVarName){if(!jsVarName){jsVarName=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}eval(code);return JsonUtility.parse(eval(jsVarName))},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==JsonUtility.FILE_EXT_JSON_JS_WRAPPER){return JsonUtility.loadJsWrapper(b,d,a)}else{return JsonUtility.loadJson(b,d,a)}},loadJsWrapper:function(url,callback,options){var loptions=options||{};var wrapperVarName=loptions.wrapperVarName||JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(jsonObj,isSuccess){if(callback){callback(jsonObj,isSuccess)}};var wrapperCallback=function(src,isSuccess){var jsonObj=null;if(isSuccess){var wrapperVar=eval(wrapperVarName);if(wrapperVar){if(typeof(wrapperVar)=="string"){jsonObj=JsonUtility.parse(wrapperVar)}else{jsonObj=wrapperVar}}runCallBack(jsonObj,true)}else{runCallBack(null,false)}};WebShow.ScriptLoader.load(url,wrapperCallback,loptions)},loadJson:function(c,e,b){loptions=b||{};if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}loptions.resultType=WebShow.FileLoader.ResultType.TEXT;loptions.extractBody=false;var d=function(h,f,g){if(f){var i=JsonUtility.parse(h);e(i,true)}else{e(null,false)}};var a=new WebShow.XHRLoader();a.load(c,d,loptions)},serializeToStr:function(b,a){if(a&&a.prettyPrint){return JSON.stringify(b,null,a.indentSpaces||2)}else{return JSON.stringify(b)}},serializeToJsCode:function(d,b,e){if(!e){e="'"}if(!b){b=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var a=JsonUtility.serializeToStr(d);var c=new RegExp(e,"g");a=a.replace(c,"\\"+e);return"var "+b+" = "+e+a+e}};var XmlUtility={DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:20000,DEF_BYPASS_ROOT_ELEM:true,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(b,a){if(!b){b=""}if(!a){a=""}if(document.implementation&&document.implementation.createDocument){var f=document.implementation.createDocument(a,b,null);return f}else{var f=new ActiveXObject("MSXML2.DOMDocument");if(b){var d="";var c=b;var e=b.indexOf(":");if(e!=-1){d=b.substring(0,e);c=b.substring(e+1)}var g="<"+(d?(d+":"):"")+c+(a?((d?" xmlns:":" xmlns")+d+'="'+a+'"'):"")+"/>";f.loadXML(g)}return f}},parse:function(d){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"application/xml")}else{if(typeof ActiveXObject!="undefined"){var c=XmlUtility.newDocument();c.loadXML(d);return c}else{var a="data:text/xml;charset=utf-8,"+encodeURIComponent(d);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==XmlUtility.FILE_EXT_XML_JS_WRAPPER){return XmlUtility.loadHelper.loadJsWrapper(b,d,a)}if(!a){a={disableInclude:false}}if(!a.disableInclude){return XmlUtility.loadHelper.loadAndHandleIncludeElement(b,d,a)}else{return XmlUtility.loadHelper.loadSimple(b,d,a.timeout)}},loadHelper:{loadSimple:function(a,h,f){var b=(h!=null);if((f===null)||(f===undefined)){f=XmlUtility.DEF_LOAD_TIMEOUT}if(!(document.implementation&&document.implementation.createDocument)){return XmlUtility.loadHelper.loadSimpleViaDoc(a,h)}else{var d=new XMLHttpRequest();var i=null;if(f){i=setTimeout(function(){j(null,false)},f)}var j=function(k,e){if(i){clearTimeout(i)}if(h){h(k,e)}};if(b){d.onreadystatechange=function(){if(d.readyState==4){var e=d.responseXML;if(e&&e.documentElement){j(e,true)}else{j(null,false)}}}}try{d.open("get",a,b);d.send(null)}catch(c){WebShow.reportError(c);j(null,false)}var g=d.responseXML;if(g&&g.documentElement){return g}else{return null}}},loadSimpleViaDoc:function(c,e){var b="dummy_dummy_dummy_dummy";var d=(e!=null);var a=XmlUtility.newDocument(b);a.async=d;if(d){a.onreadystatechange=function(){if(a.readyState==4){if((!a.documentElement)||(a.documentElement.tag==b)){e(a,false)}else{e(a,true)}}}}a.load(c);return a},loadAndHandleIncludeElement:function(c,f,b){var e;if(b){e=b.timeout}else{e=null}var d=(f==null);if(d){var a=XmlUtility.loadHelper.loadSimple(c,null,e);if(a&&a.documentElement){XmlUtility.loadHelper.handleIncludedXmlInElement(a.documentElement,null,b);return a}else{return null}}else{return XmlUtility.loadHelper.loadSimple(c,function(h,g){if(!g){f(h,false)}else{XmlUtility.loadHelper.handleIncludedXmlInElement(h.documentElement,function(i){f(h,true)},b)}},e)}},loadJsWrapper:function(url,callback,options){options=options||{};var wrapperVarName=options.wrapperVarName||XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;var loadTimeout=options.timeout;if((loadTimeout===null)||(loadTimeout===undefined)){loadTimeout=XmlUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(xmldoc,isSuccess){if(callback){callback(xmldoc,isSuccess)}};var wrapperCallback=function(src,isSuccess){if(isSuccess){var xmlContent=eval(wrapperVarName);var doc=XmlUtility.parse(xmlContent);runCallBack(doc,true)}else{runCallBack(null,false)}};options.timeout=loadTimeout;WebShow.ScriptLoader.load(url,wrapperCallback,options)},getIncludeElements:function(b,c){var a=[];if(!c){c=XmlUtility.DEF_INCLUDE_TAG_NAME}return b.getElementsByTagName(c)},handleIncludedXmlInElement:function(b,n,p){if(!p){p={}}var j=p.includeTagName||XmlUtility.DEF_INCLUDE_TAG_NAME;var o=p.srcAttribName||XmlUtility.DEF_INCLUDE_SRC_ATTRIB;var a=(p.bypassRootElem!=null)?p.bypassRootElem:XmlUtility.DEF_BYPASS_ROOT_ELEM;var k=(n==null);var m=XmlUtility.getXmlDocUrl(b.ownerDocument);var h=XmlUtility.loadHelper.getIncludeElements(b,j);if(!o){var d=null}var e=null;var l=0;var c=h.length;if(c<=0){if(n){n(0)}return null}var f;for(var g=h.length-1;g>=0;--g){e=h[g];d=e.getAttribute(o);if(d){d=WebShow.URL.mergePath(d,m);if(k){f=XmlUtility.loadHelper.loadSimple(d);if(f){XmlUtility.loadHelper.insertIncludedSection(f,e,a)}}else{XmlUtility.loadHelper.loadSimple(d,(function(r,q,i){if(i&&q){f=q;XmlUtility.loadHelper.insertIncludedSection(f,r,a)}l++;if(l==c){n(l)}}).bind(this,e))}}}return b},insertIncludedSection:function(j,h,a){var c=[];if(a){var d=j.documentElement.firstChild;while(d){if(d.nodeType==Node.ELEMENT_NODE){c.push(d)}d=d.nextSibling}}else{c.push(j.documentElement)}var f;var b=h.ownerDocument;var e=b.documentElement;for(var k=0,g=c.length;k<g;++k){var f=c[k];if(b.importNode){f=b.importNode(f,true)}h.parentNode.insertBefore(f,h)}h.parentNode.removeChild(h);return b}},serializeNode:function(b,a){if(a&&a.prettyPrint){return XmlUtility.serializeNodePretty(b)}if(typeof XMLSerializer!="undefined"){return(new XMLSerializer()).serializeToString(b)}else{if(b.xml){return b.xml}else{throw"XML.serialize is not supported or can't serialize "+b}}},serializeNodePretty:function(a){try{return XML((new XMLSerializer()).serializeToString(a)).toXMLString()}catch(b){return XmlUtility.serializeNode(a)}},serializeNodeToJsCode:function(d,a,c){if(!c){c="'"}if(!a){a=XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var e=XmlUtility.serializeNode(d);var b=new RegExp(c,"g");e=e.replace(b,"\\"+c);return"var "+a+" = "+c+e+c+";"},parseFromJsWrappedCode:function(code,jsVarName){eval(code);var xmlText=eval(jsVarName);return XmlUtility.parse(xmlText)},getXmlDocUrl:function(a){return a.url||a.documentURI||a.URL||a.location}};var ObjSerializer=Class.create({CLASS_NAME:"ObjSerializer",serializeValue:function(a){return a},deserializeValue:function(b,a){return b},propNameToStorageName:function(a){return a},storageNameToPropName:function(a){return a},getObjCustomSaveMethod:function(a){return(a.doSaveObj)},getObjCustomLoadMethod:function(a){return(a.doLoadObj)},getObjCustomPropSaveMethod:function(a){return(a.doSaveProp)},getObjCustomPropLoadMethod:function(a){return(a.doLoadProp)},isUndefined:function(a){return DataType.isUndefinedValue(a)},isNull:function(a){return(a===null)},isNaN:function(a){return a!=a},isFunction:function(a){return DataType.isFunctionValue(a)},isArray:function(a){return DataType.isArrayValue(a)},isDate:function(a){return DataType.isDateValue(a)},isObject:function(a){return DataType.isObjectValue(a)},isObjectEx:function(a){return DataType.isObjectExValue(a)},isSimpleType:function(b){var a=typeof(b);return(a=="string")||(a=="number")||(a=="boolean")||(a=="undefined")||(this.isNull(b))},isComplexType:function(a){return(!this.isSimpleType(a))},createChildStorageNode:function(c,b,a){},appendArrayItemStorageNode:function(b,c,a){},getNameForArrayItemStorageNode:function(a){var b=this.getDefaultArrayItemStorageName();return b},getChildStorageNode:function(a,b){},getAllArrayItemStorageNodes:function(a){},getAllStoredStorageNames:function(a){},setStorageNodeExplicitType:function(a,b){},getStorageNodeExplicitType:function(a){},getStorageNodeName:function(a){},isComplexStorageNode:function(a){},isComplexArrayItemStorageNode:function(a){},isSimpleStorageNode:function(a){},getValueExplicitType:function(a){if(a instanceof ObjectEx){return a.getClassName()}else{if(this.isObject(a)){return DataType.OBJECT}else{if(this.isArray(a)){return DataType.ARRAY}else{if(this.isDate(a)){return DataType.DATE}else{return(typeof a)}}}}},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function save(d,c,b){if(typeof(d)=="object"){var e=this.getObjCustomSaveMethod(d);if(e){return e(d,c,this)}}var a=this.doSave(d,c,b||{});if(a&&this.isFunction(d.saved)){d.saved()}return a},doSave:function(c,b,a){if(typeof(c)=="object"){if(c instanceof ObjectEx){this.doSaveObjectEx(c,b,a)}else{if(this.isArray(c)){this.doSaveArray(c,b)}else{if(this.isDate(c)){this.doSaveDate(c,b)}else{this.doSaveSimpleObject(c,b)}}}}this.setStorageNodeExplicitType(b,this.getValueExplicitType(c));return c},doSaveSimpleObject:function(d,b){for(var e in d){if(!d.hasOwnProperty(e)){continue}var a=d[e];var c;if(this.isComplexType(a)){c=this.getValueExplicitType(a)}this.doSaveFieldValue(d,e,a,b,c)}},doSaveArray:function(b,e){for(var c=0,a=b.length;c<a;++c){var d=b[c];var g=this.getNameForArrayItemStorageNode(d);if(this.isComplexType(d)){var f=this.appendArrayItemStorageNode(e,this.propNameToStorageName(g),this.isArray(d));this.setStorageNodeExplicitType(f,this.getValueExplicitType(d));this.save(d,f)}else{this.doAppendArrayItemSimpleValue(this.serializeValue(d),typeof(d),e)}}},doSaveDate:function(c,b){var a=c.toUTCString();this.doSaveSimpleValue(c,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,b)},doSaveObjectEx:function(f,b,m){var j=f.getAllPropList();var h=m.propFilter;for(var g=0,c=j.getLength();g<c;++g){var a=j.getPropInfoAt(g);var d=h?h(a,f):true;if(!d){continue}var e=this.getObjCustomPropSaveMethod(f);var k=false;if(e){k=e(f,a,b,this)}if(!!k){continue}if(a.serializable){this.doSaveObjectExProp(f,a,b,m)}}},doSaveObjectExProp:function(e,h,c,a){var b=h.name;var g=h.dataType;var f=e.getPropValue(b);if(a.saveDefaultValues||(f!==h.defaultValue)){var d;if(f instanceof ObjectEx){if(f.getClassName()!=g){d=f.getClassName()}}else{if(this.isComplexType(f)){d=this.getValueExplicitType(f);if(d==g){d=undefined}}}this.doSaveFieldValue(e,b,f,c,d)}},doSaveFieldValue:function(d,e,b,a,c){if(typeof(b)!="function"){if(this.isComplexType(b)){subNode=this.createChildStorageNode(a,this.propNameToStorageName(e),this.isArray(b));if(c){this.setStorageNodeExplicitType(subNode,c)}this.save(b,subNode)}else{this.doSaveSimpleValue(d,this.propNameToStorageName(e),this.serializeValue(b),this.getValueExplicitType(b),a)}}},doSaveSimpleValue:function(d,a,c,e,b){},doAppendArrayItemSimpleValue:function(b,c,a){},load:function(c,b){if(!c){var e=this.getStorageNodeExplicitType(b);if(e){c=DataType.createInstance(e)}else{if(this.doLoadUntypedNode){return this.doLoadUntypedNode(b)}else{return null}}}if(typeof(c)==="object"){var d=this.getObjCustomLoadMethod(c);if(d){return d(c,b,this)}}var a=this.doLoad(c,b);if(a&&this.isFunction(c.loaded)){c.loaded()}return a},doLoad:function(c,a){var b=this.getStorageNodeExplicitType(a);if(typeof(c)=="object"){if(c instanceof ObjectEx){c=this.doLoadObjectEx(c,a)}else{if(this.isArray(c)){c=this.doLoadArray(c,a)}else{if(this.isDate(c)){c=this.doLoadDate(c,a)}else{c=this.doLoadSimpleObject(c,a)}}}}return c},doLoadArray:function(j,a){var g=this.getAllArrayItemStorageNodes(a);for(var f=0,c=g.length;f<c;++f){var b=g[f];if(this.isComplexArrayItemStorageNode(b)){var e;var d=this.getStorageNodeExplicitType(b)||this.getStorageNodeName(b);if(d){e=DataType.createInstance(d);this.load(e,b)}else{e={};this.load(e,b)}j.push(e)}else{var h=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(b));j.push(h)}}return j},doLoadDate:function(e,d){var a=this.propNameToStorageName(this.getDefaultDateStorageName());var b=this.doLoadSimpleValue(e,a,DataType.DATE,d);if(b){var c=new Date(b);e.copyFrom(c);return e}else{return undefined}},doLoadSimpleObject:function(d,a){var b=this.getAllStoredStorageNames(a);for(var e=0,c=b.length;e<c;++e){var k=b[e];var j=this.storageNameToPropName(k);var f=this.getChildStorageNode(a,k);if(f){var m;var h=this.getStorageNodeExplicitType(f);if(h){m=DataType.createInstance(h)}else{m={}}this.load(m,f);d[j]=m}else{var g=this.doLoadSimpleValue(d,k,null,a);d[j]=g}}return d},doLoadObjectEx:function(f,e){var d=f.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var h=d.getPropInfoAt(c);if(!h.serializable){continue}var g=this.getObjCustomPropLoadMethod(f);var b=false;if(g){b=g(f,h,e,this)}if(!!b){continue}this.doLoadObjectExProp(f,h,e)}return f},doLoadObjectExProp:function(c,f,b){var a=f.name;var e=f.dataType;var d=this.doLoadFieldValue(c,a,b,e);if((d!==null)&&(d!==undefined)){c.setPropValue(a,d,true)}},doLoadFieldValue:function(f,h,c,b){var a;var e=false;if(DataType.isComplexType(b)){var g=this.getChildStorageNode(c,this.propNameToStorageName(h));if(g){var d=this.getStorageNodeExplicitType(g);if(d&&(d!=b)){a=DataType.createInstance(d)}else{a=DataType.createInstance(b)}this.load(a,g);e=true}}if(DataType.isSimpleType(b)||(!e)){a=this.doLoadSimpleValue(f,this.propNameToStorageName(h),b,c)}return a},doLoadSimpleValue:function(d,a,e,c){var b=this.doLoadSimpleStorageValue(a,c);return this.deserializeValue(b,e)},doLoadSimpleStorageValue:function(a,b){},doGetArrayItemSimpleStorageValue:function(a){}});var JsonObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(d,c,b){var a=b?[]:{};d[c]=a;return a},appendArrayItemStorageNode:function(c,d,b){var a=b?[]:{};c.push(a);return a},getChildStorageNode:function(b,c){var a=b[c];if(this.isSimpleType(a)){a=null}return a},getAllArrayItemStorageNodes:function(b){var a=Array.prototype.slice.call(b);return a},getAllStoredStorageNames:function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){if(b!=this.TYPE_TAG_NAME){a.push(b)}}}return a},isComplexStorageNode:function(a){return this.isComplexType(a)},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)},isSimpleStorageNode:function(a){return this.isSimpleType(a)},setStorageNodeExplicitType:function(a,b){if(!this.isArray(a)){a[this.TYPE_TAG_NAME]=b}},getStorageNodeExplicitType:function(b){var a=b[this.TYPE_TAG_NAME]||null;if((!a)&&this.isArray(b)){return DataType.ARRAY}else{return a}},doSaveSimpleValue:function(d,a,c,e,b){b[a]=c},doAppendArrayItemSimpleValue:function(b,c,a){return a.push(b)},doLoadSimpleStorageValue:function(a,b){return b[a]},doLoadUntypedNode:function(a){return a},doGetArrayItemSimpleStorageValue:function(a){return a}});var XmlObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getElemTextValue:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==Node.TEXT_NODE){a+=d.childNodes[c].nodeValue}}return a},serializeValue:function(a){return StringUtils.serializeValue(a)},deserializeValue:function(b,a){return StringUtils.deserializeValue(b,a)},createChildStorageNode:function(d,c,b){var a=d.ownerDocument.createElement(c);d.appendChild(a);return a},appendArrayItemStorageNode:function(b,c,a){return this.createChildStorageNode(b,c,a)},getAllArrayItemStorageNodes:function(b){var a=[];for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){a.push(e)}}return a},getAllStoredStorageNames:function(f){var a=[];for(var c=0,b=f.childNodes.length;c<b;++c){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(d)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(d))}}}for(var c=0,b=f.attributes.length;c<b;++c){var e=f.attributes[c];if(this.getLocalName(e)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(e))}}return a},getChildStorageNode:function(b,f){var a=null;for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(e)==f){a=e}}}return a},isComplexStorageNode:function(a){return a.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)&&(a.attributes.length)&&(!this.getElemTextValue(a).trim())},isSimpleStorageNode:function(a){return a.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(a,b){a.setAttribute(this.TYPE_TAG_NAME,b)},getStorageNodeExplicitType:function(a){return a.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(b){var a=b.tagName;if(a==this.getDefaultArrayItemStorageName()){return null}else{return a}},doSaveSimpleObject:function($super,b,a){$super(b,a)},doSaveArray:function($super,a,b){$super(a,b)},doSaveSimpleValue:function(d,a,c,e,b){b.setAttribute(a,c)},doAppendArrayItemSimpleValue:function(c,e,a){var b=this.appendArrayItemStorageNode(a,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),false);var d=b.ownerDocument.createTextNode(c);b.appendChild(d)},doLoadSimpleStorageValue:function(a,b){return b.getAttribute(a)},doGetArrayItemSimpleStorageValue:function(a){return this.getElemTextValue(a)}});var ObjSerializerFactory={_serializerClasses:{},_defaultName:null,registerSerializer:function(a,c,b){var d=(typeof(c)=="string")?ClassEx.findClass(c):c;ObjSerializerFactory._serializerClasses[a]=d;if(b){ObjSerializerFactory._defaultName=a}},getSerializer:function(a){var b=a||ObjSerializerFactory._defaultName;if(b){var c=ObjSerializerFactory._serializerClasses[b];return c?new c():null}else{return null}}};(function(){ObjSerializerFactory.registerSerializer("json",JsonObjSerializer,true);ObjSerializerFactory.registerSerializer("xml",XmlObjSerializer)})();ClassEx.extend(ObjectEx,{saveObj:function(c,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(this,c,b)},loadObj:function(b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(this,b)}});var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.5.0",PROP_AUTO_TITLE:true};var $jsRoot=this;Kekule.scriptSrcInfo=$jsRoot["__$kekule_load_info__"];if(!this.Kekule){Kekule={}}Kekule.oneOf=function(){var b=arguments;var d=Kekule.ObjUtils.notUnset;for(var c=0,a=b.length;c<a;++c){if(d(b[c])){return b[c]}}return null};Kekule.ClassUtils={getShortClassName:function(a){var b=a.indexOf(".");if(b>=0){return a.substring(b+1)}else{return a}},getLastClassName:function(a){var b=a.lastIndexOf(".");return(b>=0)?a.substring(b+1):a},makeSingleton:function(a){return Object.extend(a,{_instance:null,getInstance:function(k,j,i,h,g,f,e,d,c,b){if(!a._instance){a._instance=new a(k,j,i,h,g,f,e,d,c,b)}return a._instance}})}};Kekule.NumUtils={isInteger:function(a){return(typeof(a)==="number")&&(parseInt(a,10)===parseFloat(a))},toDecimals:function(a,e){if(Kekule.NumUtils.isInteger(a)){return a.toString()}var g=Math.pow(10,e);var h=Math.round(a*g);h=h/g;var b=parseInt(h);var d=h-b;var c=d.toString();if(c.length>e+2){c=c.substr(2,e);return b.toString()+"."+c}else{return h.toString()}},isFloatEqual:function(b,c,a){if(Kekule.ObjUtils.isUnset(a)){a=1e-100}return Math.abs(b-c)<=a}};Kekule.ObjUtils={getPrototypeOf:function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):(a.prototype||a.__proto__)},getOwnedFieldNames:function(b){var a=[];for(var c in b){if(b.hasOwnProperty(c)&&(typeof(b[c])!="function")){a.push(c)}}return a},replacePropName:function(c,b,a){if(c[b]!==undefined){if(c.hasOwnProperty(b)){c[a]=c[b];delete c[b]}else{Kekule.raise(Kekule.ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED)}}return c},isUnset:function(a){return(a===null)||(typeof(a)=="undefined")},notUnset:function(a){return(a!==null)&&(typeof(a)!=="undefined")},equal:function(c,a,b){for(var d in c){if(b&&(b.indexOf(d)>=0)){continue}if(c[d]!==a[d]){return false}}return true},match:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!==c[b]){return false}}}return true},isInstanceOf:function(d,c){if(!DataType.isArrayValue(c)){return(d instanceof c)}else{for(var b=0,a=c.length;b<a;++b){if(d instanceof c[b]){return true}}return false}}};Kekule.ArrayUtils={isArray:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},toArray:function(a){if(Kekule.ArrayUtils.isArray(a)){return a}else{return[a]}},clone:function(a){return a.slice(0)},pushUnique:function(c,b){var a=Kekule.ArrayUtils.pushUniqueEx(c,b);return a?a.index:null},pushUniqueEx:function(f,e){if(DataType.isArrayValue(e)){var d;for(var c=0,a=e.length;c<a;++c){if(Kekule.ObjUtils.isUnset(d)){d=Kekule.ArrayUtils.pushUniqueEx(f,e[c])}else{Kekule.ArrayUtils.pushUniqueEx(f,e[c])}}return d}else{if(!e){return{index:-1,isPushed:false}}var b=f.indexOf(e);if(b<0){return{index:f.push(e),isPushed:true}}else{return{index:b,isPushed:false}}}},insertUnique:function(c,b,a){return Kekule.ArrayUtils.insertUniqueEx(c,b,a).index},insertUniqueEx:function(d,c,a){if(!c){return{index:-1,isInserted:false}}if(Kekule.ObjUtils.isUnset(a)||(a<0)){a=d.length}var b=d.indexOf(c);if(b<0){d.splice(a,0,c);return{index:a,isInserted:true}}else{if(b!=a){d.splice(b,1);d.splice(a,0,c);return{index:a,isInserted:false}}}},removeAt:function(c,a){var b=c[a];if(typeof(b)!="undefined"){c.splice(a,1);return b}else{return null}},remove:function(c,b){var a=c.indexOf(b);if(a>=0){return Kekule.ArrayUtils.removeAt(c,a)}else{return null}},changeIndex:function(c,d,a){if((d>=0)&&(d<=c.length)){var b=c[d];c.splice(d,1);c.splice(a,0,b);return b}else{return null}},changeItemIndex:function(d,c,b){var a=d.indexOf(c);return Kekule.ArrayUtils.changeIndex(d,a,b)},toUnique:function(f){var c=[];for(var g=0,d=f.length;g<d;++g){var h=f[g];if(c.indexOf(h)<0){c.push(h)}}return c},getUniqueElemCount:function(d){var c=Kekule.ArrayUtils.toUnique(d);return c.length},reverse:function(d){var b=[];for(var e=0,c=d.length;e<c;++e){if(Kekule.ObjUtils.notUnset(d[e])){b[c-e-1]=d[e]}}return b},exclude:function(f,g){var a=[];var e=Kekule.ArrayUtils.toArray(g);for(var c=0,b=f.length;c<b;++c){var d=f[c];if(e.indexOf(d)<0){a.push(d)}}return a},intersect:function(d,b){var a=[];for(var e=0,c=d.length;e<c;++e){if(b.indexOf(d[e])>=0){a.push(d[e])}}return a},compareNestedArray:function(c,b,a){var d=Math.min(c.length,b.length);if(!a){a=function(m,l){return m-l}}for(var e=0;e<d;++e){var k=0;var g=c[e];var f=b[e];var j=DataType.isArrayValue(g);var h=DataType.isArrayValue(f);if(j&&h){k=Kekule.ArrayUtils.compareNestedArray(g,f,a)}else{if(j){k=1}else{if(h){k=-1}else{k=a(g,f)}}}if(k!=0){return k}}if(c.length>d){return 1}else{if(b.length>d){return -1}else{return 0}}},getMedian:function(b){var d=[].concat(b);var c=d.length;if(c===0){return null}if(c<=1){return d[0]}else{d.sort();return(c%2)?d[(c+1)>>1]:(d[c>>1]+d[(c>>1)+1])/2}}};Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(a){return a.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(a){return a.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(a){return""+a},convertToType:function(a,b){if(typeof(a)!="string"){return a}switch(b){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(a);break;case DataType.INT:return parseInt(a);break;case DataType.BOOL:return Kekule.StrUtils.strToBool(a);break;default:return a}},boolToStr:function(a){if(a){return Kekule.StrUtils.STR_TRUES[0]}else{return Kekule.StrUtils.STR_FALSES[0]}},strToBool:function(d){var b=d.toLowerCase();for(var c=0,a=Kekule.StrUtils.STR_FALSES.length;c<a;++c){if(b==Kekule.StrUtils.STR_FALSES[c]){return false}}return !!d},removeAroundPair:function(c,b,a){if(c.startsWith(b)&&c.endsWith(a)){return c.substring(b.length,c.length-b.length-a.length+1)}else{return c}},unquote:function(c){var b=Kekule.StrUtils.removeAroundPair;var a=c;a=b(a,"'","'");a=b(a,'"','"');return a},splitTokens:function(c,b){if(!c){return[]}if(DataType.isArrayValue(c)){return c}else{var a=b?new RegExp(b,"g"):/\s+/g;return c.replace(a," ").split(" ")}},hasToken:function(d,a,c){var b=Kekule.StrUtils.splitTokens(d,c);return(b.indexOf(a)>=0)},addTokens:function(g,e,d){var c=Kekule.StrUtils.splitTokens(g,d);var f=Kekule.StrUtils.splitTokens(e,d);for(var b=0,a=f.length;b<a;++b){if(c.indexOf(f[b])<0){c.push(f[b])}}return c.join(d||" ")},removeTokens:function(h,g,f){var e=Kekule.StrUtils.splitTokens(h,f);var d=Kekule.StrUtils.splitTokens(g,f);for(var c=0,a=d.length;c<a;++c){var b=e.indexOf(d[c]);if(b>=0){e.splice(b,1)}}return e.join(f||" ")},toggleTokens:function(g,h,d){var f=Kekule.StrUtils.splitTokens(g,d);var a=Kekule.StrUtils.splitTokens(h,d);var j=[];for(var c=0,b=a.length;c<b;++c){var e=f.indexOf(a[c]);if(e>=0){f.splice(e,1)}else{j.push(a[c])}}f=f.concat(j);return f.join(d||" ")},getLineCount:function(c,b){if(!b){b="\n"}var a=c.split(b);return a.length},getMaxLineCharCount:function(g,f){if(!f){f="\n"}var d=g.split(f);var a=0;for(var e=0,c=d.length;e<c;++e){var b=d[e];a=Math.max(b.length,a)}return a}};Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(b,c){var a={};c=c||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE;a[Kekule.RoleMapUtils.KEY_ITEM]=b;a[Kekule.RoleMapUtils.KEY_ROLE]=c;return a},getItem:function(a){return a[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(b,a){b[Kekule.RoleMapUtils.KEY_ITEM]=a},getRole:function(a){return a[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(a,b){a[Kekule.RoleMapUtils.KEY_ROLE]=b}};Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(b){var c=Kekule.FactoryUtils;var a={_items:new Kekule.MapEx(true),_matchMethod:b||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(d,e){a._items.set(d,e)},unregister:function(d){a._items.remove(d)},getClass:function(d){if(a._matchMethod===c.MATCH_EXACTLY){return a._items.get(d)}else{if(a._matchMethod===c.MATCH_BY_CLASS){var f=a._items.get(d);if(!f){var e=ClassEx.getSuperClass(d);if(e){f=a.getClass(e)}}return f}}},getInstance:function(m,n,l,j,i,h,g,f,e,d){var k=a.getClass(m);if(k){return new k(n,l,j,i,h,g,f,e,d)}}};return a}};Kekule.UrlUtils={EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",extractFileName:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);if(b>=0){return a.substr(b+1)}else{return a}},extractFileExt:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(b+1)}else{return""}}else{return null}},extractSearch:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);if(b>=0){return a.substr(b)}else{return null}},analysisSearch:function(b,e){var j=Kekule.UrlUtils.extractSearch(b);j=j.substr(1);var c=j.split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER);var k=e?{}:[];for(var g=0,d=c.length;g<d;++g){var f=c[g];var h=f.split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);if(h[0]){if(e){k[h[0]]=h[1]}else{k.push({key:h[0],value:h[1]})}}}return k}};Kekule.MatrixUtils={create:function(n,q,h){var s=false;var p=false;var o=Kekule.ObjUtils;if(o.notUnset(h)){s=true;if(Kekule.ArrayUtils.isArray(h)){p=true}}var g=0;var b=new Array(n);for(var f=0,c=b.length;f<c;++f){var a=new Array(q);if(s){for(var e=0,d=a.length;e<d;++e){if(p&&o.notUnset(h[g])){a[e]=h[g];++g}else{a[e]=h}}}b[f]=a}return b},createIdentity:function(b){var a=Kekule.MatrixUtils.create(b,b,0);for(var c=0;c<b-1;++c){a[c][c]=1}return a},getRowCount:function(a){return a.length},getColCount:function(a){return(Kekule.MatrixUtils.getRowCount(a)>0)?a[0].length:0},getValue:function(a,c,b){return a[c-1][b-1]||0},setValue:function(a,d,b,c){a[d-1][b-1]=c},transpose:function(b){var h=Kekule.MatrixUtils;var c=h.getColCount(b);var g=h.getRowCount(b);var a=h.create(c,g);for(var e=1;e<=c;++e){var f=a[e-1];for(var d=1;d<=g;++d){f[d-1]=h.getValue(b,d,e)}}return a},minus:function(g){var e=Kekule.MatrixUtils;var f=e.getRowCount(g);var h=e.getColCount(g);var k=this.create(f,h);for(var d=0;d<f;++d){var a=k[d];var b=g[d];for(var c=0;c<h;++c){a[c]=-(b[c]||0)}}},add:function(e,c){var h=Kekule.MatrixUtils;var b=h.getRowCount(e);var g=h.getColCount(e);var a=this.create(b,g);for(var f=1;f<=b;++f){for(var d=1;d<=g;++d){h.setValue(a,f,d,h.getValue(e,f,d)+h.getValue(c,f,d))}}return a},substract:function(b,a){var c=Kekule.MatrixUtils;return c.add(b,c.minus(a))},multiply:function(l,h){var e=Kekule.MatrixUtils;var f=e.getRowCount(l);var g=e.getColCount(h);var m=e.create(f,g);for(var c=1;c<=f;++c){for(var b=1;b<=g;++b){var d=0;for(var a=1;a<=f;++a){d+=e.getValue(l,c,a)*e.getValue(h,a,b)}e.setValue(m,c,b,d)}}return m}};Kekule.CoordUtils={create:function(b,d,c){var a={x:b,y:d};if(c||(c===0)){a.z=c}return a},is3D:function(a){return(a.z||(a.z===0))},isEqual:function(c,b){var a=(c.x===b.x)&&(c.y===b.y);var d=Kekule.ObjUtils;if(a&&(d.notUnset(c.z)||d.notUnset(b.z))){a=(c.z===b.z)}return a},add:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)+(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)+(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)+(b.z||0)}return a},substract:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)-(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)-(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)-(b.z||0)}return a},multiply:function(c,b){var a={};if(!Kekule.ObjUtils.isUnset(c.x)){a.x=c.x*b}if(!Kekule.ObjUtils.isUnset(c.y)){a.y=c.y*b}if(!Kekule.ObjUtils.isUnset(c.z)){a.z=c.z*b}return a},divide:function(b,a){return Kekule.CoordUtils.multiply(b,1/a)},standardize:function(b){var a=Math.sqrt(Math.sqr(b.x||0)+Math.sqr(b.y||0)+Math.sqr(b.z||0));return Kekule.CoordUtils.divide(b,a)},toArray:function(b){var a=[];a.push(b.x,b.y);if(Kekule.CoordUtils.is3D(b)){a.push(b.z)}},transform2D:function(d,c){var b=Kekule.CoordUtils.calcTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},inverseTransform2D:function(d,c){var b=Kekule.CoordUtils.calcInverseTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},transform2DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(3,1,[d.x||0,d.y||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0]}},calcTransform2DMatrix:function(c,d){var i=Kekule.MatrixUtils;var j=c||{};var p=j.center;if(p){var q=i.create(3,3,[1,0,-(p.x||0),0,1,-(p.y||0),0,0,1]);var h=i.create(3,3,[1,0,(p.x||0),0,1,(p.y||0),0,0,1])}if(j.rotateAngle){var r=j.rotateAngle;var o=Math.cos(r);var f=Math.sin(r);var b=i.create(3,3,[o,-f,0,f,o,0,0,0,1])}var t=j.scale;var n=j.scaleX;var m=j.scaleY;var l=t||1;if(t||n||m){var e=i.create(3,3);i.setValue(e,1,1,n||l);i.setValue(e,2,2,m||l);i.setValue(e,3,3,1)}var u=j.translateX;var s=j.translateY;if(u||s){var k=i.create(3,3);i.setValue(k,1,1,1);i.setValue(k,2,2,1);i.setValue(k,3,3,1);i.setValue(k,1,3,(u||0));i.setValue(k,2,3,(s||0))}var g=i.create(3,3,[1,0,0,0,1,0,0,0,1]);if(!d){if(q){g=i.multiply(q,g)}if(b){g=i.multiply(b,g)}if(e){g=i.multiply(e,g)}if(k){g=i.multiply(k,g)}if(h){g=i.multiply(h,g)}}else{if(q){g=i.multiply(q,g)}if(k){g=i.multiply(k,g)}if(e){g=i.multiply(e,g)}if(b){g=i.multiply(b,g)}if(h){g=i.multiply(h,g)}}return g},calcInverseTransform2DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}return Kekule.CoordUtils.calcTransform2DMatrix(b,true)},transform3D:function(c,b){var a=Kekule.CoordUtils.calcTransform3DMatrix(b);return Kekule.CoordUtils.transform3DByMatrix(c,a)},transform3DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(4,1,[d.x||0,d.y||0,d.z||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0],z:a[2][0]}},_calcRotateXYZ3DMatrixCore:function(b){var m=Kekule.MatrixUtils;var o=m.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var q=[];if(b.rotateAngle&&b.rotateAxisVector){var n=Kekule.CoordUtils.standardize(b.rotateAxisVector);q.push({vector:[n.x,n.y,n.z],angle:-b.rotateAngle})}else{var f=b.rotateX;var e=b.rotateY;var d=b.rotateZ;if(f){q.push({vector:[1,0,0],angle:-f})}if(e){q.push({vector:[0,1,0],angle:-e})}if(d){q.push({vector:[0,0,1],angle:-d})}}for(var u=0,r=q.length;u<r;++u){var a=m.create(4,4);var w=q[u].angle;var g=q[u].vector;var x=Math.cos(w);var c=Math.sin(w);var p;for(var u=1;u<=4;++u){for(var t=1;t<=4;++t){if((u<4)&&(t<4)){for(var s=1;s<=3;++s){if((s!==u)&&(s!==t)){break}}var h=g[u-1]*g[t-1];p=(u<t)?h*(1-x)-Math.pow(-1,u+t)*g[s-1]*c:(u>t)?h*(1-x)+Math.pow(-1,u+t)*g[s-1]*c:h+(1-h)*x}else{if(u===t){p=1}else{p=0}}m.setValue(a,u,t,p)}}o=m.multiply(a,o)}return o},calcRotate3DMatrix:function(d){var g=Kekule.MatrixUtils;var f=Object.extend({},d||{});var e;if(f.rotateMatrix){e=f.rotateMatrix}else{var a=f.center;if(a){var b=g.create(4,4,[1,0,0,-(a.x||0),0,1,0,-(a.y||0),0,0,1,-(a.z||0),0,0,0,1]);var c=g.create(4,4,[1,0,0,(a.x||0),0,1,0,(a.y||0),0,0,1,(a.z||0),0,0,0,1])}var e=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(d);if(b){e=g.multiply(b,e)}if(c){e=g.multiply(c,e)}}return e},calcTransform3DMatrix:function(b){var g=Kekule.MatrixUtils;var h=b||{};var o=h.center;if(o){var p=g.create(4,4,[1,0,0,-(o.x||0),0,1,0,-(o.y||0),0,0,1,-(o.z||0),0,0,0,1]);var e=g.create(4,4,[1,0,0,(o.x||0),0,1,0,(o.y||0),0,0,1,(o.z||0),0,0,0,1])}var f=["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"];var k=Object.copyValues({},h,f);var a=Kekule.CoordUtils.calcRotate3DMatrix(k);var r=h.scale;var n=h.scaleX;var m=h.scaleY;var l=h.scaleZ;if(r||n||m||l){var j=r||1;var c=g.create(4,4);g.setValue(c,1,1,n||j);g.setValue(c,2,2,m||j);g.setValue(c,3,3,l||j);g.setValue(c,4,4,1)}var t=h.translateX;var s=h.translateY;var q=h.translateZ;if(t||s||q){var i=g.create(4,4);g.setValue(i,1,1,1);g.setValue(i,2,2,1);g.setValue(i,3,3,1);g.setValue(i,4,4,1);g.setValue(i,1,4,t||0);g.setValue(i,2,4,s||0);g.setValue(i,3,4,q||0)}var d=g.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(p){d=g.multiply(p,d)}if(a){d=g.multiply(a,d)}if(c){d=g.multiply(c,d)}if(i){d=g.multiply(i,d)}if(e){d=g.multiply(e,d)}return d},calcInverseTransform3DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y,z:a.center.z}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.scaleZ){b.scaleZ=1/b.scaleZ}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.translateZ){b.translateZ=-b.translateZ}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}if(b.rotateX){b.rotateX=-b.rotateX}if(b.rotateX){b.rotateY=-b.rotateY}if(b.rotateZ){b.rotateZ=-b.rotateZ}return Kekule.CoordUtils.calcTransform3DMatrix(b,true)},calcCoordGroup2DTransformParams:function(e,c,l,k){var m=Kekule.CoordUtils;var d=m.getDistance(e,c);var i=m.substract(c,e);var g=Math.atan2(i.y,i.x);var f=m.getDistance(l,k);var b=m.substract(k,l);var h=Math.atan2(b.y,b.x);var a=m.substract(l,e);var j={translateX:a.x,translateY:a.y,scale:f/d,rotateAngle:h-g,center:e};return j},getDistance:function(c,b){if(!b){b={x:0,y:0,z:0}}var a=Math.sqr(b.x-c.x)+Math.sqr(b.y-c.y);if(Kekule.ObjUtils.notUnset(c.z)&&Kekule.ObjUtils.notUnset(b.z)){a+=Math.sqr(b.z-c.z)}return Math.sqrt(a)},getCenter:function(d){var c=d.length;if(c<=0){return null}var b=Object.extend(d[0]);for(var a=1;a<c;++a){b=Kekule.CoordUtils.add(b,d[a])}return Kekule.CoordUtils.divide(b,c)},insideRect:function(c,a,b){return((c.x-a.x)*(c.x-b.x)<=0)&&((c.y-a.y)*(c.y-b.y)<=0)},isInsideBox:function(e,d){var c=d;var a=(Math.sign(e.x-c.x1)*Math.sign(e.x-c.x2)<=0)&&(Math.sign(e.y-c.y1)*Math.sign(e.y-c.y2)<=0);if(Kekule.ObjUtils.notUnset(e.z)){a&=(Math.sign(e.z-c.z1)*Math.sign(e.z-c.z2)<=0)}return a},getContainerBox:function(d){var f={};var a={};var b=d.length;if(b>0){f=Object.extend({},d[0]);a=Object.extend({},d[0])}else{return null}for(var c=1;c<b;++c){var e=d[c];f.x=Math.min(f.x,e.x);f.y=Math.min(f.y,e.y);a.x=Math.max(a.x,e.x);a.y=Math.max(a.y,e.y);if(Kekule.ObjUtils.notUnset(f.z)){f.z=Math.min(f.z,e.z);a.z=Math.max(a.z,e.z)}}return Kekule.BoxUtils.createBox(f,a)}};Kekule.BoxUtils={createBox:function(g,f){var a={};var c=g.x||0;var e=g.y||0;var b=f.x||0;var d=f.y||0;(c<=b)?(a.x1=c,a.x2=b):(a.x1=b,a.x2=c);(e<=d)?(a.y1=e,a.y2=d):(a.y1=d,a.y2=e);if(Kekule.ObjUtils.notUnset(g.z)&&Kekule.ObjUtils.notUnset(f.z)){(g.z<=f.z)?(a.z1=g.z,a.z2=f.z):(a.z1=f.z,a.z2=g.z)}return a},convertToRect:function(c){var a=Kekule.BoxUtils.normalize(c);return Kekule.RectUtils.createRect(a.x1,a.y1,a.x2-a.x1,a.y2-a.y1)},normalize:function(b){var a={x1:Math.min(b.x1,b.x2),y1:Math.min(b.y1,b.y2),x2:Math.max(b.x1,b.x2),y2:Math.max(b.y1,b.y2)};if(Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){a.z1=Math.min(b.z1,b.z2);a.z2=Math.max(b.z1,b.z2)}return a},shiftBox:function(d,c,b,a){var j=c||0;var h=b||0;var g=a||0;var f={x:d.x1+j,y:d.y1+h};var e={x:d.x2+j,y:d.y2+h};if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)){f.z=d.z1+g;e.z=d.z2+g}var i=Kekule.BoxUtils.createBox(f,e);return i},inflateBox:function(c,e,d,b){if(Kekule.ObjUtils.isUnset(d)){d=e}if(Kekule.ObjUtils.isUnset(b)){b=e}var a=Kekule.BoxUtils.normalize(c);var a={x1:a.x1-e,y1:a.y1-d,x2:a.x2+e,y2:a.y2+d};if(Kekule.ObjUtils.notUnset(a.z1)&&Kekule.ObjUtils.notUnset(a.z2)){a.z1=a.z1-b;a.z2=a.z2+b}return a},getContainerBox:function(d,b){if(!d){return Object.extend({},b)}else{if(!b){return Object.extend({},d)}}var e=Kekule.BoxUtils.normalize(d);var c=Kekule.BoxUtils.normalize(b);var a={x1:Math.min(e.x1,c.x1),y1:Math.min(e.y1,c.y1),x2:Math.max(e.x2,c.x2),y2:Math.max(e.y2,c.y2)};if(Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&Kekule.ObjUtils.notUnset(c.z1)&&Kekule.ObjUtils.notUnset(c.z2)){a.z1=Math.min(e.z1,c.z1);a.z2=Math.max(e.z2,c.z2)}return a},getIntersection:function(c,a){var d=Kekule.BoxUtils.normalize(c);var b=Kekule.BoxUtils.normalize(a);var e={x1:Math.max(d.x1,b.x1),y1:Math.max(d.y1,b.y1),x2:Math.min(d.x2,b.x2),y2:Math.max(d.y2,b.y2)};if((e.x1>=e.x2)||(e.y1>=e.y2)){return null}if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)&&Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){e.z1=Math.max(d.z1,b.z1);e.z2=Math.min(d.z2,b.z2);if(e.z1>=e.z2){return null}}return e},hasIntersection:function(b,a){return !!Kekule.BoxUtils.getIntersection(b,a)},isEqual:function(b,a){return(Math.min(b.x1,b.x2)===Math.min(a.x1,a.x2))&&(Math.max(b.x1,b.x2)===Math.max(a.x1,a.x2))&&(Math.min(b.y1,b.y2)===Math.min(a.y1,a.y2))&&(Math.max(b.y1,b.y2)===Math.max(a.y1,a.y2))},isInside:function(a,c){var d=a;var b=c;return(Math.min(d.x1,d.x2)>=Math.min(b.x1,b.x2))&&(Math.max(d.x1,d.x2)<=Math.max(b.x1,b.x2))&&(Math.min(d.y1,d.y2)>=Math.min(b.y1,b.y2))&&(Math.max(d.y1,d.y2)<=Math.max(b.y1,b.y2))},getCenterCoord:function(b){var a={x:(b.x1||0+b.x2||0)/2,y:(b.y1||0+b.y2||0)/2};if(Kekule.ObjUtils.notUnset(b.z1)||Kekule.ObjUtils.notUnset(b.z2)){a.z=(b.z1||0+b.z2||0)/2}return a},getMinMaxCoords:function(d){var c=Kekule.BoxUtils.normalize(d);var a={min:{x:c.x1,y:c.y1},max:{x:c.x2,y:c.y2}};if(Kekule.ObjUtils.notUnset(c.z1)){a.min.z=c.z1;a.max.z=c.z2}return a},getCornerCoords:function(c){var a=Kekule.BoxUtils.normalize(c);if(Kekule.ObjUtils.isUnset(a.z1)){return[{x:a.x1,y:a.y1},{x:a.x1,y:a.y2},{x:a.x2,y:a.y1},{x:a.x2,y:a.y2}]}else{return[{x:a.x1,y:a.y1,z:a.z1},{x:a.x1,y:a.y2,z:a.z1},{x:a.x2,y:a.y1,z:a.z1},{x:a.x2,y:a.y2,z:a.z1},{x:a.x1,y:a.y1,z:a.z2},{x:a.x1,y:a.y2,z:a.z2},{x:a.x2,y:a.y1,z:a.z2},{x:a.x2,y:a.y2,z:a.z2}]}},transform2D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform2D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)},transform3D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform3D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)}};Kekule.RectUtils={createRect:function(e,d,c,b){var a={left:e,top:d,width:c,height:b};return a},convertToBox:function(b){var c=Kekule.CoordUtils.create(b.left,b.top);var a=Kekule.CoordUtils.create(b.left+b.width,b.top+b.height);return Kekule.BoxUtils.createBox(c,a)},inflateRect:function(d,c,b){if(Kekule.ObjUtils.isUnset(b)){b=c}var a=Kekule.RectUtils.createRect(d.left,d.top,d.width+c,d.height+b);return a},shiftRect:function(f,d,b){var e=d||0;var c=b||0;var a=Kekule.RectUtils.createRect(f.left+e,f.top+c,f.width,f.height);return a},getContainerRect:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getContainerBox(e,c);return Kekule.BoxUtils.convertToRect(a)},getIntersection:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getIntersection(e,c);return a?Kekule.BoxUtils.convertToRect(a):null},hasIntersection:function(b,a){return !!Kekule.RectUtils.getIntersection(b,a)}};Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[0.1,0.3,0.5,0.66,0.8,0.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],getNextZoomInRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b<c[a-1]){for(var d=0;d<a;++d){if(c[d]>b){return c[Math.min(d+e,a)-1]}}}return b},getNextZoomOutRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b>c[0]){for(var d=a-1;d>=0;--d){if(c[d]<b){return c[Math.max(d-e+1,0)]}}}return b}};(function(){Kekule.DomUtils={namespaceMatched:function(b,a,c){if(c===undefined){c=true}return((b.namespaceURI==a)||(c&&(!b.namespaceURI)))},isElement:function(a){return(a&&a.tagName&&a.nodeType)},getElementText:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){a+=d.childNodes[c].nodeValue}}return a},setElementText:function(d,f){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==3){d.childNodes[c].nodeValue=f;return f}}var e=d.ownerDocument.createTextNode(f);d.appendChild(e);return f},getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getChildNodesOfTypes:function(f,b){var a=[];var e=Kekule.ArrayUtils.toArray(b);for(var d=0,c=f.childNodes.length;d<c;++d){var g=f.childNodes[d];if(!b||(e.indexOf(g.nodeType)>=0)){a.push(g)}}return a},getFirstChildElem:function(g,e,b,c){for(var d=0,a=g.childNodes.length;d<a;++d){var f=g.childNodes[d];if(f.nodeType===Node.ELEMENT_NODE){if((e&&(e.toLowerCase()===f.tagName.toLowerCase()))||(b&&(b.toLowerCase()===Kekule.DomUtils.getLocalName(f).toLowerCase()))||((!e)&&(!b))){if((!c)||Kekule.DomUtils.namespaceMatched(f,c)){return f}}}}},getDirectChildElems:function(h,f,c,d){var a=[];for(var e=0,b=h.childNodes.length;e<b;++e){var g=h.childNodes[e];if(g.nodeType===Node.ELEMENT_NODE){if((f&&(f.toLowerCase()===g.tagName.toLowerCase()))||(c&&(c.toLowerCase()===Kekule.DomUtils.getLocalName(g).toLowerCase()))||((!f)&&(!c))){if((!d)||Kekule.DomUtils.namespaceMatched(g,d)){a.push(g)}}}}return a},getDirectChildElemsOfAttribValues:function(e,p,c,g,b){var a=Kekule.DomUtils.getDirectChildElems(e,c,g,b);var q=[];for(var n=0,f=a.length;n<f;++n){var o=true;for(var m=0,h=p.length;m<h;++m){var d=Kekule.ObjUtils.getOwnedFieldNames(p[m])[0];if(a[n].getAttribute(d)!=p[m][d]){o=false;break}}if(o){q.push(a[n])}}},isDescendantOf:function(b,a){try{if(b&&a){if(b.documentElement){return false}if(b.ownerDocument===a){return true}var c=b.parentNode;while(c){if(c===a){return true}c=c.parentNode}}return false}catch(d){return false}},getNearestAncestorByTagName:function(e,d,c){var b=d.toLowerCase();if(c&&(e.tagName.toLowerCase()===b)){return e}var a=e.parentNode;while(a&&a.tagName){if(a.tagName.toLowerCase()===b){return a}a=a.parentNode}return null},getSameNSAttributeValue:function(d,c,b){var a=d.getAttribute(c);return a},setSameNSAttributeValue:function(c,b,d,a){result=c.setAttribute(b,d);return result},fetchAttributeValuesToArray:function(c,b,d){var k=[];for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k.push({name:a,value:g.value})}return k},fetchAttributeValuesToJson:function(c,b,d){var k={};for(var h=0,f=c.attributes.length;h<f;++h){var g=c.attributes[h];if(b&&(!Kekule.DomUtils.namespaceMatched(g,b,true))){continue}var a;if(d){try{a=Kekule.DomUtils.getLocalName(g)}catch(j){a=g.name}}else{a=g.name}k[a]=g.value}return k},hasAttribute:function(b,a){if(b.hasAttribute){return b.hasAttribute(a)}else{var c=b.getAttribute(a);return !!c}},getDataAttrib:function(b,a){if(b.dataset){return b.dataset[a]}else{return b.getAttribute("data-"+a.toString().hyphenize())}},setDataAttrib:function(b,a,c){if(b.dataset){b.dataset[a]=c}else{b.setAttribute("data-"+a.toString().hyphenize(),c)}},getDataset:function(e){if(e.dataset){return e.dataset}else{var a={};var g=e.attributes;for(var d=0,b=g.length;d<b;++d){var f=g[d];var c=f.name;if(c.toLowerCase().indexOf("data-")===0){var h=c.substring(5).camelize();a[h]=f.value}}return a}},clearChildContent:function(a){var c=Kekule.ArrayUtils.toArray(a.childNodes);for(var b=c.length-1;b>=0;--b){var d=c[b];if(d.nodeType===Node.ATTRIBUTE_NODE){continue}a.removeChild(d)}return a},replaceTagName:function(c,d){if(c.tagName.toLowerCase()!==d.toLowerCase()){var h=c.ownerDocument.createElement(d);var a=Kekule.DomUtils.fetchAttributeValuesToArray(c);for(var f=0,e=a.length;f<e;++f){h.setAttribute(a[f].name,a[f].value)}var b=Kekule.DomUtils.getDirectChildElems(c);for(var f=0,e=b.length;f<e;++f){h.appendChild(b[f])}var g=c.parentNode;var j=c.nextSibling;g.removeChild(c);if(j){g.insertBefore(h,j)}else{g.appendChild(h)}return h}else{return c}},isInDomTree:function(b,c){if(!b){return false}if(!c){c=b.ownerDocument}if(c){var a=c.documentElement;return Kekule.DomUtils.isDescendantOf(b,a)||b===a}else{return false}}};Kekule.StyleUtils={removeStyleProperty:function(a,b){if(a.removeProperty){a.removeProperty(b)}else{if(a.removeAttribute){a.removeAttribute(b)}else{a[b]=null}}},analysisUnitsValue:function(e){var d={};d.total=e;d.value=parseFloat(e);var a;if(e&&e.length&&(d.value!==undefined)&&(d.value!==NaN)){a="";for(var b=e.length-1;b>=0;--b){var g=e.charAt(b);var f=(g>="0")&&(g<="9");if((!f)&&(g!==".")&&(g!=="-")){a=g+a}}}d.units=a||"";return d},multiplyUnitsValue:function(b,c){var a=Kekule.StyleUtils.analysisUnitsValue(b);a.value*=c;return""+a.value+a.units},colorStrToValue:function(f){var b=f.length>4;var d=b?f.substr(1,2):f.substr(1,1);var c=b?f.substr(3,2):f.substr(2,1);var e=b?f.substr(5,2):f.substr(3,1);if(!b){d+=d;c+=c;e+=e}var a=(parseInt(d,16)<<16)+(parseInt(c,16)<<8)+parseInt(e,16);return a},getComputedStyle:function(c,d){var b;var a=c.ownerDocument.defaultView;if(a&&a.getComputedStyle){b=a.getComputedStyle(c,null)}else{if(c.currentStyle){b=c.currentStyle}}if(b){return d?b[d]:b}else{return null}},isShown:function(b){var a=Kekule.StyleUtils;return(a.isDisplayed(b)&&a.isVisible(b))},isDisplayed:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"display")||"").toLowerCase()!=="none"},getDisplayed:function(a){return Kekule.StyleUtils.getComputedStyle(a,"display")},setDisplay:function(a,b){if(typeof(b)==="string"){a.style.display=b}else{a.style.display=(!!b)?"":"none"}},isVisible:function(a){return(Kekule.StyleUtils.getComputedStyle(a,"visibility")||"").toLowerCase()!=="hidden"},getVisibility:function(a){return Kekule.StyleUtils.getComputedStyle(a,"visibility")},setVisibility:function(a,b){if(typeof(b)==="string"){a.style.visibility=b}else{a.style.visibility=(!!b)?"":"hidden"}}};Kekule.HtmlElementUtils={getClassNames:function(a){return Kekule.StrUtils.splitTokens(a.className)},hasClass:function(b,a){var c=Kekule.HtmlElementUtils.getClassNames(b);return(c.indexOf(a)>=0)},addClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(!b.hasClass(e,f[c])){e.className+=" "+f[c]}}return b},removeClass:function(e,d){var a=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);var g=a.getClassNames(e);for(var c=g.length;c>=0;--c){var b=f.indexOf(g[c]);if(b>=0){g.splice(c,1)}}e.className=g.join(" ");return a},toggleClass:function(e,d){var b=Kekule.HtmlElementUtils;var f=Kekule.ArrayUtils.isArray(d)?d:Kekule.StrUtils.splitTokens(d);for(var c=0,a=f.length;c<a;++c){if(b.hasClass(e,f[c])){b.removeClass(e,f[c])}else{b.addClass(e,f[c])}}return b},getInnerText:function(a){return a.innerText||a.textContent},resizeElem:function(d,b,a,c){d.style.width=b+(c||"px");d.style.height=a+(c||"px")},getElemClientDimension:function(a){return{width:a.clientWidth,height:a.clientHeight}},getElemScrollDimension:function(a){return{width:a.scrollWidth,height:a.scrollHeight}},getElemComputedDimension:function(e){var c=Kekule.StyleUtils;var f={width:c.getComputedStyle(e,"width"),height:c.getComputedStyle(e,"height")};var d=c.analysisUnitsValue(f.width);var b=c.analysisUnitsValue(f.height);var a={};if(d.units==="px"){a.width=d.value}if(b.units==="px"){a.height=d.value}return a},getElemOffsetDimension:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},getViewportDimension:function(b){var a;if(b){if(b.ownerDocument){a=b.ownerDocument.defaultView}else{if(b.defaultView){a=b.defaultView}else{a=b}}}a=a||window;if(a.innerWidth!=null){return{width:a.innerWidth,height:a.innerHeight}}var c=a.document;if(c.compatMode=="CSS1Compat"){return{width:c.documentElement.clientWidth,height:c.documentElement.clientHeight}}return{width:c.body.clientWidth,height:c.body.clientHeight}},getElemBoundingClientRect:function(d,c){var b=Object.extend({},d.getBoundingClientRect());if(Kekule.ObjUtils.isUnset(b.width)){b.width=b.right-b.left}if(Kekule.ObjUtils.isUnset(b.height)){b.height=b.bottom-b.top}if(c){var f=d.ownerDocument;var e=f.documentElement.scrollTop||f.body.scrollTop||0;var g=f.documentElement.scrollLeft||f.body.scrollLeft||0;b.left+=g;b.right+=g;b.top+=e;b.bottom+=e}var a=b;a.x=a.left;a.y=a.top;return a},getElemPagePos:function(c){var a=0;var f=0;if(c.getBoundingClientRect){var e=c.getBoundingClientRect();var i=c.ownerDocument;var g=i.body;var b=i.documentElement;var d=b.clientTop||g.clientTop||0;var h=b.clientLeft||g.clientLeft||0;f=e.top+(window&&window.pageYOffset||b&&b.scrollTop||g.scrollTop)-d,a=e.left+(window&&window.pageXOffset||b&&b.scrollLeft||g.scrollLeft)-h}else{while(c){a+=(c.offsetLeft-c.scrollLeft+c.clientLeft);f+=(c.offsetTop-c.scrollTop+c.clientTop);c=c.offsetParent}}return{x:a,y:f}},getElemViewportPos:function(b){var a=Kekule.HtmlElementUtils.getElemBoundingClientRect(b);return{x:a.left,y:left.top}},makePositioned:function(a){var b=Kekule.StyleUtils.getComputedStyle(a,"position");if(!b||b.toLowerCase()==="static"){a.style.position="relative"}},isFormCtrlElement:function(b){var c=["input","button","textarea","select"];var a=b.tagName.toLowerCase();return c.indexOf(a)>=0}};Kekule.DocumentUtils={getClientDimension:function(a){if(a.compatMode=="BackCompat"){return{width:a.body.clientWidth,height:a.body.clientHeight}}else{return{width:a.documentElement.clientWidth,height:a.documentElement.clientHeight}}}};Kekule.DataSrcAttribUtils={isUrlBasedValue:function(b){var a=b.toLowerCase().indexOf("url(");return(a===0)},getUrl:function(d){var a=d.trim();var c=a.toLowerCase().indexOf("url(");if(c===0){var b=a.lastIndexOf(")");a=a.substring(4,b);return a}else{return null}},getElementContent:function(b){if(!b){return null}var a=b.innerHTML;a=a.ltrim();return a},getElementMimeType:function(a){return a.getAttribute("type")}}})();Kekule.DomHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DomHelper",NAMESPACE_DEFINE_PREFIX:"xmlns",NAMESPACE_DELIMITER:":",ERR_EMPTY_DOC:"Document is empty",ERR_ELEMENT_NOTSET:"Element not set",initialize:function($super,a){$super();this._supportNsMethods=null;if(a){this.setDocument(a)}},initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("document");if(!a){var b=this.getPropStoreFieldValue("rootElement");a=b?b.ownerDocument:null}return a},setter:function(a){if(a!=this.getPropStoreFieldValue("document")){this.setPropStoreFieldValue("document",a);this.analysisRootElem()}}});this.defineProp("rootElement",{dataType:DataType.OBJECT,serializable:false,getter:function(){var a=this.getPropStoreFieldValue("rootElement");if(!a){var b=this.getPropStoreFieldValue("document");a=b?b.documentElement:null}return a},setter:function(a){this.setPropStoreFieldValue("rootElement",a);this.analysisRootElem()}});this.defineProp("namespaces",{dataType:DataType.ARRAY,serializable:false,getter:function(){if(!this.getPropStoreFieldValue("namespaces")){this.setPropStoreFieldValue("namespaces",[])}return this.getPropStoreFieldValue("namespaces")}});this.defineProp("defNamespaceURI",{dataType:DataType.STRING,serializable:false});this.defineProp("forceAnalysisDoc",{dataType:DataType.BOOL})},analysisRootElem:function(){this.setNamespaces([]);this.setDefNamespaceURI(null);var b=this.getRootElement();if(!b){return}var j=b.ownerDocument;this._supportNsMethods=!!j.getElementsByTagNameNS;if((!this._supportNsMethods)||(this.getForceAnalysisDoc())){for(var f=0,d=b.attributes.length;f<d;++f){var e=b.attributes[f];var c=e.name;if(c&&c.indexOf(this.NAMESPACE_DEFINE_PREFIX)>=0){var h=e.value;var a=c.indexOf(this.NAMESPACE_DELIMITER);var g=(a>=0)?c.substring(a+1):null;this.getNamespaces().push({namespaceURI:h,prefix:g});if(!g){this.setDefNamespaceURI(h)}}}}},_getEmptyDocErrorMsg:function(){return Kekule.hasLocalRes()?this.ERR_EMPTY_DOC:Kekule.ErrorMsg.EMPTY_DOC},_getElementNotSetErrorMsg:function(){return Kekule.hasLocalRes()?this.ELEMENT_NOTSET:Kekule.ErrorMsg.ELEMENT_NOTSET},assertDocAvailable:function(a){if(!a){Kekule.raise(this._getEmptyDocErrorMsg());return false}else{return true}},assertElementAvailable:function(a){if(!a){Kekule.raise(this._getElementNotSetErrorMsg());return false}else{return true}},getNsPrefix:function(b){if(b==this.getDefNamespaceURI()){return""}var d=this.getNamespaces();for(var c=0,a=d.length;c<a;++c){if(d[c].namespaceURI==b){return d[c].prefix}}return null},getQualifiedName:function(b,a){var c=this.getNsPrefix(b);if(c===null){return null}else{return c?c+this.NAMESPACE_DELIMITER+a:a}},createElementNS:function(a,c){var b=this.getDocument();if(!this.assertDocAvailable(b)){return null}if(this._supportNsMethods){return b.createElementNS(a,c)}else{return b.createElement(c)}},getElementsByTagNameNS:function(c,b,d){var a=this.getPropStoreFieldValue("document")||this.getPropStoreFieldValue("rootElement");var f=this.getDocument();if(!this.assertDocAvailable(f)){return null}if(this._supportNsMethods){if(d){return d.getElementsByTagNameNS(c,b)}else{return a.getElementsByTagNameNS(c,b)}}else{var e=this.getQualifiedName(c,b);if(e===null){return[]}else{if(d){return d.getElementsByTagName(e)}else{return a.getElementsByTagName(e)}}}},getAttributeNodeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNodeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttributeNode(d)}}},getAttributeNS:function(b,a,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.getAttributeNS(b,a)}else{var d=this.getQualifiedName(b,a);if(d===null){return null}else{return c.getAttribute(d)}}},setAttributeNS:function(b,a,d,c){if(!this.assertElementAvailable(c)){return null}if(this._supportNsMethods){return c.setAttributeNS(b,a,d)}else{var e=this.getQualifiedName(b,a);if(e===null){return null}else{return c.setAttribute(e,d)}}}});Kekule.TextLinesBuffer=Class.create(ObjectEx,{CLASS_NAME:"Kekule.TextLinesBuffer",LINEBREAK:"\n",initialize:function($super,a){$super();this.setPropStoreFieldValue("lines",[]);if(a){if(typeof(a)=="string"){this.setText(a)}else{this.setLines(a)}}this.setCurrLineNo(0)},initProperties:function(){this.defineProp("lines",{dataType:DataType.ARRAY,serializable:false});this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getLines().join(this.LINEBREAK)},setter:function(a){this.setPropStoreFieldValue("lines",[]);this.reset();this.appendText(a)}});this.defineProp("currLineNo",{dataType:DataType.INT,serializable:false})},getUnreadLines:function(){var a=[].concat(this.getLines());a.splice(0,this.getCurrLineNo());return a},getUnreadText:function(){return this.getUnreadLines().join(this.LINEBREAK)},appendText:function(b){var a=b.split(this.LINEBREAK);this.appendLines(a)},appendLines:function(a){this.setPropStoreFieldValue("lines",this.getLines().concat(a));this.notifyPropSet("lines",this.getPropStoreFieldValue("lines"))},clear:function(){this.setLines([]);this.setCurrLineNo(0)},incCurrLineNo:function(b){if((b===null)||(typeof(b)=="undefined")){b=1}var a=this.getCurrLineNo();a+=b;this.setCurrLineNo(a)},getLineAt:function(a){var b=this.getLines()[a];if(b&&b.length&&(b.charAt(b.length-1)==="\r")){b=b.substring(0,b.length-1)}return b},getCurrLine:function(){return this.getLineAt(this.getCurrLineNo())},readLine:function(){var a=this.getLineAt(this.getCurrLineNo());this.incCurrLineNo();return a},writeLine:function(b){var a=this.getLines();a.splice(this.getCurrLineNo(),0,b);this.incCurrLineNo()},writeLines:function(b){for(var c=0,a=b.length;c<a;++c){this.writeLine(b[c])}},writeText:function(b){var a=b.split(this.LINEBREAK);this.writeLines(a)},eof:function(){return this.getCurrLineNo()>=this.getLines().length},reset:function(){this.setCurrLineNo(0)}});