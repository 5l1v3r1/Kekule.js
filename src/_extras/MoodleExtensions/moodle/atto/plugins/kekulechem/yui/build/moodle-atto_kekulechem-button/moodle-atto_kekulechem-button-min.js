YUI.add("moodle-atto_kekulechem-button",function(e,t){e.namespace("M.atto_kekulechem").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{BTN_NAME_OBJ_INSERT:"kekuleChemObjInsert",CHEM_OBJ_INSERTER_CLASS:"KekuleChemObjInserter",CHEM_OBJ_VIEWER_CLASS:"KekuleChemObjViewer",CHEM_OBJ_TAGNAME:"img",initializer:function(){var e=this.get("attoKekulePluginPath")+"pix/icon.gif";this.addButton({buttonName:this.BTN_NAME_OBJ_INSERT,iconurl:e,callback:this._execute,tags:"strike"}),this._addEssentialFiles()},_addEssentialFiles:function(){var e=this.get("kekuleCssUrl");this._addCssUrl(e)},_addCssUrl:function(e){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),document.head.appendChild(t)},_getSelectedChemObjTarget:function(){var e=this.get("host"),t=e.getSelectedNodes(),n=e.getSelection()[0],r=[],i=this;return!n||n.collapsed?null:(t.some(function(e){var t=null,n=e.getDOMNode();if(n&&n.tagName){var s=Kekule.DomUtils.getNearestAncestorByTagName(n,i.CHEM_OBJ_TAGNAME,!0);s&&(s.className||"").indexOf(i.CHEM_OBJ_VIEWER_CLASS)>=0&&(t=s)}if(t){r.push(t);if(r.length>1)return!0}}),r.length===1?r[0]:null)},_execute:function(){var e=this._getSelectedChemObjTarget();e?this._targetElem=e:this._targetElem=null,this._openDialog()},_openDialog:function(){this._inserterDialog||(this._inserterDialog=this._createDialog());var e=this._inserterDialog,t=this._targetElem?M.util.get_string("captionEditChemObj","atto_kekulechem"):M.util.get_string("captionAddChemObj","atto_kekulechem");e.setCaption(t),this._targetElem?this._chemObjInserter.importFromElem(this._targetElem):this._chemObjInserter.setChemObj(null);var n=null,r=this.buttons[this.BTN_NAME_OBJ_INSERT];r&&(n=r.getDOMNode());var i=this;return e.openModal(function(e){e===Kekule.Widget.DialogButtons.OK&&i._submitChemObj()},n),this._forceInserterResize.bind(this).delay(),e},_forceInserterResize:function(){this._chemObjInserter.resized()},_createDialog:function(){var e=new Kekule.Widget.Dialog(document);e.setButtons([Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);var t=e.getClientElem();t.style.minWidth="500px",t.style.minHeight="250px";var n=new Kekule.ChemWidget.ChemObjInserter(document);return n.setResizable(!0),n.appendToWidget(e),this._chemObjInserter=n,e},_submitChemObj:function(){var e=this._chemObjInserter,t=e.getExportImgElemAttributes();t["class"]||(t["class"]=""),t["class"]=" "+this.CHEM_OBJ_VIEWER_CLASS;if(!this._targetElem){var n=this._generateElemHtmlCode(this.CHEM_OBJ_TAGNAME,null,t),r=this.get("host");r.insertContentAtFocusPoint(n)}else Kekule.DomUtils.setElemAttributes(this._targetElem,t);this.markUpdated()},_generateElemHtmlCode:function(e,t,n){var r="<"+e,i=Kekule.ObjUtils.getOwnedFieldNames(n);for(var s=0,o=i.length;s<o;++s){var u=i[s],a=n[u].toString();a=a.replace('/"/g',"&quot;"),a=a.replace("/'/g","&#039;"),a=a.replace("/</g","&lt;"),a=a.replace("/>/g","&gt;"),u&&a&&(r+=" "+u+"='"+a+"'")}return r+=">",t&&(r+=t),r+="</"+e+">",r}},{ATTRS:{kekuleCssUrl:{value:""},attoKekulePluginPath:{value:""}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
